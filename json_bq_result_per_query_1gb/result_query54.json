{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon716c826a_f3b9_411c_965b_23b63678715d" }, "priority": "INTERACTIVE", "query": "-- start query 54 in stream 0 using template query54.tpl\nwith my_customers as (\n select distinct c_customer_sk\n , c_current_addr_sk\n from \n ( select cs_sold_date_sk sold_date_sk,\n cs_bill_customer_sk customer_sk,\n cs_item_sk item_sk\n from catalog_sales\n union all\n select ws_sold_date_sk sold_date_sk,\n ws_bill_customer_sk customer_sk,\n ws_item_sk item_sk\n from web_sales\n ) cs_or_ws_sales,\n item,\n date_dim,\n customer\n where sold_date_sk = d_date_sk\n and item_sk = i_item_sk\n and i_category = 'Women'\n and i_class = 'maternity'\n and c_customer_sk = cs_or_ws_sales.customer_sk\n and d_moy = 12\n and d_year = 1998\n )\n , my_revenue as (\n select c_customer_sk,\n sum(ss_ext_sales_price) as revenue\n from my_customers,\n store_sales,\n customer_address,\n store,\n date_dim\n where c_current_addr_sk = ca_address_sk\n and ca_county = s_county\n and ca_state = s_state\n and ss_sold_date_sk = d_date_sk\n and c_customer_sk = ss_customer_sk\n and d_month_seq between (select distinct d_month_seq+1\n from date_dim where d_year = 1998 and d_moy = 12)\n and (select distinct d_month_seq+3\n from date_dim where d_year = 1998 and d_moy = 12)\n group by c_customer_sk\n )\n , segments as\n (select cast((revenue/50) as int) as segment\n from my_revenue\n )\n select segment, count(*) as num_customers, segment*50 as segment_base\n from segments\n group by segment\n order by segment, num_customers\n limit 100\n ;\n\n-- end query 54 in stream 0 using template query54.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "HNBCxdUIum7hv1C8W1/vuw==", "id": "test-project-364309:europe-west1.query54_1665768386", "jobReference": { "jobId": "query54_1665768386", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query54_1665768386?location=europe-west1", "statistics": { "creationTime": "1665768387466", "endTime": "1665768388564", "finalExecutionDurationMs": "803", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "145522404", "performanceInsights": { "avgPreviousExecutionMs": "829" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "58", "computeMsMax": "58", "computeRatioAvg": 0.29743589743589743, "computeRatioMax": 0.29743589743589743, "endMs": "1665768387742", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.035897435897435895, "readRatioMax": 0.035897435897435895, "recordsRead": "100000", "recordsWritten": "100000", "shuffleOutputBytes": "1800000", "shuffleOutputBytesSpilled": "0", "slotMs": "58", "startMs": "1665768387694", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:c_customer_sk, $51:c_current_addr_sk", "FROM customer" ] }, { "kind": "WRITE", "substeps": [ "$50, $51", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.005128205128205128, "waitRatioMax": 0.005128205128205128, "writeMsAvg": "11", "writeMsMax": "11", "writeRatioAvg": 0.05641025641025641, "writeRatioMax": 0.05641025641025641 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.07179487179487179, "computeRatioMax": 0.07179487179487179, "endMs": "1665768387744", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.035897435897435895, "readRatioMax": 0.035897435897435895, "recordsRead": "73049", "recordsWritten": "31", "shuffleOutputBytes": "279", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665768387711", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70:d_date_sk, $71:d_year, $72:d_moy", "FROM date_dim", "WHERE and(equal($72, 12), equal($71, 1998))" ] }, { "kind": "WRITE", "substeps": [ "$70", "TO __stage01_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.010256410256410256, "waitRatioMax": 0.010256410256410256, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.08205128205128205, "writeRatioMax": 0.08205128205128205 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.06666666666666667, "computeRatioMax": 0.06666666666666667, "endMs": "1665768387774", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.03076923076923077, "readRatioMax": 0.03076923076923077, "recordsRead": "18000", "recordsWritten": "417", "shuffleOutputBytes": "3753", "shuffleOutputBytesSpilled": "0", "slotMs": "44", "startMs": "1665768387729", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$100:i_item_sk, $101:i_class, $102:i_category", "FROM item", "WHERE and(equal($102, 'Women'), equal($101, 'maternity'))" ] }, { "kind": "WRITE", "substeps": [ "$100", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.005128205128205128, "waitRatioMax": 0.005128205128205128, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.08205128205128205, "writeRatioMax": 0.08205128205128205 }, { "completedParallelInputs": "1", "computeMsAvg": "6", "computeMsMax": "6", "computeRatioAvg": 0.03076923076923077, "computeRatioMax": 0.03076923076923077, "endMs": "1665768387765", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.020512820512820513, "readRatioMax": 0.020512820512820513, "recordsRead": "73049", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "15", "startMs": "1665768387749", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:d_month_seq, $61:d_year, $62:d_moy", "FROM date_dim", "WHERE and(equal($61, 1998), equal($62, 12))" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $260 := $200" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := add($60, 3)" ] }, { "kind": "WRITE", "substeps": [ "$260", "TO __stage04_output", "BY HASH($260)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.010256410256410256, "waitRatioMax": 0.010256410256410256, "writeMsAvg": "5", "writeMsMax": "5", "writeRatioAvg": 0.02564102564102564, "writeRatioMax": 0.02564102564102564 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.046153846153846156, "computeRatioMax": 0.046153846153846156, "endMs": "1665768387775", "id": "5", "name": "S05: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.03076923076923077, "readRatioMax": 0.03076923076923077, "recordsRead": "73049", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "25", "startMs": "1665768387755", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_month_seq, $41:d_year, $42:d_moy", "FROM date_dim", "WHERE and(equal($41, 1998), equal($42, 12))" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $230 := $190" ] }, { "kind": "COMPUTE", "substeps": [ "$190 := add($40, 1)" ] }, { "kind": "WRITE", "substeps": [ "$230", "TO __stage05_output", "BY HASH($230)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.010256410256410256, "waitRatioMax": 0.010256410256410256, "writeMsAvg": "4", "writeMsMax": "4", "writeRatioAvg": 0.020512820512820513, "writeRatioMax": 0.020512820512820513 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.035897435897435895, "computeRatioMax": 0.035897435897435895, "endMs": "1665768387807", "id": "6", "inputStages": [ "4" ], "name": "S06: Aggregate+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "35", "startMs": "1665768387770", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$260", "FROM __stage04_output" ] }, { "kind": "LIMIT", "substeps": [ "2" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $270 := $260" ] }, { "kind": "WRITE", "substeps": [ "$270", "TO __stage06_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.010256410256410256, "waitRatioMax": 0.010256410256410256, "writeMsAvg": "29", "writeMsMax": "29", "writeRatioAvg": 0.14871794871794872, "writeRatioMax": 0.14871794871794872 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.041025641025641026, "computeRatioMax": 0.041025641025641026, "endMs": "1665768387824", "id": "7", "inputStages": [ "6" ], "name": "S07: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "39", "startMs": "1665768387771", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$270", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "$180 := ANY_AND_CHECK($270)" ] }, { "kind": "WRITE", "substeps": [ "$180", "TO __stage07_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.015384615384615385, "waitRatioMax": 0.015384615384615385, "writeMsAvg": "2", "writeMsMax": "2", "writeRatioAvg": 0.010256410256410256, "writeRatioMax": 0.010256410256410256 }, { "completedParallelInputs": "6", "computeMsAvg": "139", "computeMsMax": "195", "computeRatioAvg": 0.7128205128205128, "computeRatioMax": 1, "endMs": "1665768387935", "id": "8", "inputStages": [ "1", "0", "2" ], "name": "S08: Join+", "parallelInputs": "6", "readMsAvg": "14", "readMsMax": "23", "readRatioAvg": 0.07179487179487179, "readRatioMax": 0.11794871794871795, "recordsRead": "2763620", "recordsWritten": "1559", "shuffleOutputBytes": "28062", "shuffleOutputBytesSpilled": "0", "slotMs": "779", "startMs": "1665768387794", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:cs_sold_date_sk, $81:cs_bill_customer_sk, $82:cs_item_sk", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$90:ws_sold_date_sk, $91:ws_item_sk, $92:ws_bill_customer_sk", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$100", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$70", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$50, $51", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $320 := $310, $321 := $311" ] }, { "kind": "JOIN", "substeps": [ "$310 := $50, $311 := $51", "INNER HASH JOIN EACH WITH ALL ON $300 = $50" ] }, { "kind": "JOIN", "substeps": [ "$300 := $291", "INNER HASH JOIN EACH WITH ALL ON $290 = $70" ] }, { "kind": "JOIN", "substeps": [ "$290 := $210, $291 := $211", "INNER HASH JOIN EACH WITH ALL ON $212 = $100" ] }, { "kind": "WRITE", "substeps": [ "$320, $321", "TO __stage08_output", "BY HASH($320, $321)" ] } ], "waitMsAvg": "1", "waitMsMax": "4", "waitRatioAvg": 0.005128205128205128, "waitRatioMax": 0.020512820512820513, "writeMsAvg": "8", "writeMsMax": "10", "writeRatioAvg": 0.041025641025641026, "writeRatioMax": 0.05128205128205128 }, { "completedParallelInputs": "1", "computeMsAvg": "6", "computeMsMax": "6", "computeRatioAvg": 0.03076923076923077, "computeRatioMax": 0.03076923076923077, "endMs": "1665768387829", "id": "9", "inputStages": [ "5" ], "name": "S09: Aggregate+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "31", "startMs": "1665768387795", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$230", "FROM __stage05_output" ] }, { "kind": "LIMIT", "substeps": [ "2" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $240 := $230" ] }, { "kind": "WRITE", "substeps": [ "$240", "TO __stage09_output" ] } ], "waitMsAvg": "0", "waitMsMax": "0", "waitRatioAvg": 0, "waitRatioMax": 0, "writeMsAvg": "25", "writeMsMax": "25", "writeRatioAvg": 0.1282051282051282, "writeRatioMax": 0.1282051282051282 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.035897435897435895, "computeRatioMax": 0.035897435897435895, "endMs": "1665768387834", "id": "10", "inputStages": [ "9" ], "name": "S0A: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665768387797", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$240", "FROM __stage09_output" ] }, { "kind": "AGGREGATE", "substeps": [ "$170 := ANY_AND_CHECK($240)" ] }, { "kind": "WRITE", "substeps": [ "$170", "TO __stage0A_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.010256410256410256, "waitRatioMax": 0.010256410256410256, "writeMsAvg": "2", "writeMsMax": "2", "writeRatioAvg": 0.010256410256410256, "writeRatioMax": 0.010256410256410256 }, { "completedParallelInputs": "1", "computeMsAvg": "19", "computeMsMax": "19", "computeRatioAvg": 0.09743589743589744, "computeRatioMax": 0.09743589743589744, "endMs": "1665768388018", "id": "11", "name": "S0B: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.041025641025641026, "readRatioMax": 0.041025641025641026, "recordsRead": "73051", "recordsWritten": "90", "shuffleOutputBytes": "810", "shuffleOutputBytesSpilled": "0", "slotMs": "39", "startMs": "1665768387972", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$180", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$170", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_month_seq", "FROM date_dim" ] }, { "kind": "FILTER", "substeps": [ "between($11, $170, $180)" ] }, { "kind": "WRITE", "substeps": [ "$10", "TO __stage0B_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.005128205128205128, "waitRatioMax": 0.005128205128205128, "writeMsAvg": "20", "writeMsMax": "20", "writeRatioAvg": 0.10256410256410256, "writeRatioMax": 0.10256410256410256 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.06153846153846154, "computeRatioMax": 0.06153846153846154, "endMs": "1665768388028", "id": "12", "name": "S0C: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.02564102564102564, "readRatioMax": 0.02564102564102564, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "348", "shuffleOutputBytesSpilled": "0", "slotMs": "40", "startMs": "1665768387987", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:s_county, $2:s_state", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage0C_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.005128205128205128, "waitRatioMax": 0.005128205128205128, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.08205128205128205, "writeRatioMax": 0.08205128205128205 }, { "completedParallelInputs": "1", "computeMsAvg": "31", "computeMsMax": "31", "computeRatioAvg": 0.15897435897435896, "computeRatioMax": 0.15897435897435896, "endMs": "1665768388054", "id": "13", "name": "S0D: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.041025641025641026, "readRatioMax": 0.041025641025641026, "recordsRead": "50000", "recordsWritten": "50000", "shuffleOutputBytes": "1712413", "shuffleOutputBytesSpilled": "0", "slotMs": "54", "startMs": "1665768388005", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ca_address_sk, $21:ca_county, $22:ca_state", "FROM customer_address" ] }, { "kind": "WRITE", "substeps": [ "$20, $21, $22", "TO __stage0D_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.010256410256410256, "waitRatioMax": 0.010256410256410256, "writeMsAvg": "10", "writeMsMax": "10", "writeRatioAvg": 0.05128205128205128, "writeRatioMax": 0.05128205128205128 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.06666666666666667, "computeRatioMax": 0.06666666666666667, "endMs": "1665768388080", "id": "15", "inputStages": [ "8" ], "name": "S0F: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1559", "recordsWritten": "1477", "shuffleOutputBytes": "26586", "shuffleOutputBytesSpilled": "0", "slotMs": "25", "startMs": "1665768388041", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$320, $321", "FROM __stage08_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $330 := $320, $331 := $321" ] }, { "kind": "WRITE", "substeps": [ "$330, $331", "TO __stage0F_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.010256410256410256, "waitRatioMax": 0.010256410256410256, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.07179487179487179, "writeRatioMax": 0.07179487179487179 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "16", "computeRatioAvg": 0.041025641025641026, "computeRatioMax": 0.08205128205128205, "endMs": "1665768388174", "id": "16", "inputStages": [ "15" ], "name": "S10: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1477", "recordsWritten": "1477", "shuffleOutputBytes": "26586", "shuffleOutputBytesSpilled": "0", "slotMs": "5122", "startMs": "1665768388093", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0F_output" ] } ], "waitMsAvg": "2", "waitMsMax": "5", "waitRatioAvg": 0.010256410256410256, "waitRatioMax": 0.02564102564102564, "writeMsAvg": "46", "writeMsMax": "57", "writeRatioAvg": 0.2358974358974359, "writeRatioMax": 0.2923076923076923 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "20", "computeRatioAvg": 0.041025641025641026, "computeRatioMax": 0.10256410256410256, "endMs": "1665768388157", "id": "17", "inputStages": [ "11" ], "name": "S11: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "90", "recordsWritten": "90", "shuffleOutputBytes": "810", "shuffleOutputBytesSpilled": "0", "slotMs": "3415", "startMs": "1665768388095", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0B_output" ] } ], "waitMsAvg": "5", "waitMsMax": "7", "waitRatioAvg": 0.02564102564102564, "waitRatioMax": 0.035897435897435895, "writeMsAvg": "15", "writeMsMax": "28", "writeRatioAvg": 0.07692307692307693, "writeRatioMax": 0.14358974358974358 }, { "completedParallelInputs": "6", "computeMsAvg": "174", "computeMsMax": "193", "computeRatioAvg": 0.8923076923076924, "computeRatioMax": 0.9897435897435898, "endMs": "1665768388300", "id": "18", "inputStages": [ "10", "16", "17", "12", "7", "13" ], "name": "S12: Join+", "parallelInputs": "6", "readMsAvg": "18", "readMsMax": "27", "readRatioAvg": 0.09230769230769231, "readRatioMax": 0.13846153846153847, "recordsRead": "3189890", "recordsWritten": "5", "shuffleOutputBytes": "130", "shuffleOutputBytesSpilled": "0", "slotMs": "1232", "startMs": "1665768388110", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$170", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$180", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$30:ss_sold_date_sk, $31:ss_customer_sk, $32:ss_ext_sales_price", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$330, $331", "FROM __stage10_output" ] }, { "kind": "READ", "substeps": [ "$20, $21, $22", "FROM __stage0D_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage0C_output" ] }, { "kind": "READ", "substeps": [ "$10", "FROM __stage11_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $380 := $371", "$160 := SUM($370)" ] }, { "kind": "JOIN", "substeps": [ "$370 := $361, $371 := $362", "INNER HASH JOIN EACH WITH ALL ON $360 = $10" ] }, { "kind": "JOIN", "substeps": [ "$360 := $350, $361 := $351, $362 := $352", "INNER HASH JOIN EACH WITH ALL ON $353 = $1, $354 = $2" ] }, { "kind": "JOIN", "substeps": [ "$350 := $342, $351 := $343, $352 := $340, $353 := $21, $354 := $22", "INNER HASH JOIN EACH WITH ALL ON $341 = $20" ] }, { "kind": "JOIN", "substeps": [ "$342 := $30, $343 := $32, $340 := $330, $341 := $331", "INNER HASH JOIN EACH WITH ALL ON $31 = $330" ] }, { "kind": "WRITE", "substeps": [ "$380, $160", "TO __stage12_output", "BY HASH($380)" ] } ], "waitMsAvg": "2", "waitMsMax": "7", "waitRatioAvg": 0.010256410256410256, "waitRatioMax": 0.035897435897435895, "writeMsAvg": "7", "writeMsMax": "10", "writeRatioAvg": 0.035897435897435895, "writeRatioMax": 0.05128205128205128 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.046153846153846156, "computeRatioMax": 0.046153846153846156, "endMs": "1665768388378", "id": "19", "inputStages": [ "18" ], "name": "S13: Aggregate+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "5", "recordsWritten": "1", "shuffleOutputBytes": "18", "shuffleOutputBytesSpilled": "0", "slotMs": "39", "startMs": "1665768388339", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$380, $160", "FROM __stage12_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $400 := $140", "$130 := COUNT_STAR()" ] }, { "kind": "COMPUTE", "substeps": [ "$140 := CAST(divide($150, NUMERIC<...>) AS INT64)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $390 := $380", "$150 := SUM($160)" ] }, { "kind": "WRITE", "substeps": [ "$130, $400", "TO __stage13_output", "BY HASH($400)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.005128205128205128, "waitRatioMax": 0.005128205128205128, "writeMsAvg": "30", "writeMsMax": "30", "writeRatioAvg": 0.15384615384615385, "writeRatioMax": 0.15384615384615385 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.035897435897435895, "computeRatioMax": 0.035897435897435895, "endMs": "1665768388428", "id": "20", "inputStages": [ "19" ], "name": "S14: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "27", "shuffleOutputBytesSpilled": "0", "slotMs": "25", "startMs": "1665768388394", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$130, $400", "FROM __stage13_output" ] }, { "kind": "COMPUTE", "substeps": [ "$110 := multiply($421, 50)" ] }, { "kind": "SORT", "substeps": [ "$410 ASC, $120 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $410 := $400", "$120 := SUM_OF_COUNTS($130)" ] }, { "kind": "WRITE", "substeps": [ "$110, $420, $421", "TO __stage14_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.005128205128205128, "waitRatioMax": 0.005128205128205128, "writeMsAvg": "26", "writeMsMax": "26", "writeRatioAvg": 0.13333333333333333, "writeRatioMax": 0.13333333333333333 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.041025641025641026, "computeRatioMax": 0.041025641025641026, "endMs": "1665768388452", "id": "21", "inputStages": [ "20" ], "name": "S15: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "27", "shuffleOutputBytesSpilled": "0", "slotMs": "44", "startMs": "1665768388412", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$110, $420, $421", "FROM __stage14_output" ] }, { "kind": "SORT", "substeps": [ "$421 ASC, $420 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$430, $431, $432", "TO __stage15_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.005128205128205128, "waitRatioMax": 0.005128205128205128, "writeMsAvg": "7", "writeMsMax": "7", "writeRatioAvg": 0.035897435897435895, "writeRatioMax": 0.035897435897435895 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "item" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "customer_address" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "customer" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "6", "completedUnits": "219", "elapsedMs": "669", "estimatedRunnableUnits": "0", "pendingUnits": "6", "totalSlotMs": "9843" }, { "activeUnits": "6", "completedUnits": "228", "elapsedMs": "981", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "11094" } ], "totalBytesBilled": "145752064", "totalBytesProcessed": "145522404", "totalPartitionsProcessed": "0", "totalSlotMs": "11094", "transferredBytes": "0" }, "startTime": "1665768387528", "totalBytesProcessed": "145522404", "totalSlotMs": "11094" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon398db6cf_4003_4906_8b69_67bd68bbc953" }, "priority": "INTERACTIVE", "query": "-- start query 54 in stream 0 using template query54.tpl\nwith my_customers as (\n select distinct c_customer_sk\n , c_current_addr_sk\n from \n ( select cs_sold_date_sk sold_date_sk,\n cs_bill_customer_sk customer_sk,\n cs_item_sk item_sk\n from catalog_sales\n union all\n select ws_sold_date_sk sold_date_sk,\n ws_bill_customer_sk customer_sk,\n ws_item_sk item_sk\n from web_sales\n ) cs_or_ws_sales,\n item,\n date_dim,\n customer\n where sold_date_sk = d_date_sk\n and item_sk = i_item_sk\n and i_category = 'Women'\n and i_class = 'maternity'\n and c_customer_sk = cs_or_ws_sales.customer_sk\n and d_moy = 12\n and d_year = 1998\n )\n , my_revenue as (\n select c_customer_sk,\n sum(ss_ext_sales_price) as revenue\n from my_customers,\n store_sales,\n customer_address,\n store,\n date_dim\n where c_current_addr_sk = ca_address_sk\n and ca_county = s_county\n and ca_state = s_state\n and ss_sold_date_sk = d_date_sk\n and c_customer_sk = ss_customer_sk\n and d_month_seq between (select distinct d_month_seq+1\n from date_dim where d_year = 1998 and d_moy = 12)\n and (select distinct d_month_seq+3\n from date_dim where d_year = 1998 and d_moy = 12)\n group by c_customer_sk\n )\n , segments as\n (select cast((revenue/50) as int) as segment\n from my_revenue\n )\n select segment, count(*) as num_customers, segment*50 as segment_base\n from segments\n group by segment\n order by segment, num_customers\n limit 100\n ;\n\n-- end query 54 in stream 0 using template query54.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "NPng4h9E1O9QjOkbMo6A+Q==", "id": "test-project-364309:europe-west1.query54_1665777781", "jobReference": { "jobId": "query54_1665777781", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query54_1665777781?location=europe-west1", "statistics": { "creationTime": "1665777782574", "endTime": "1665777783727", "finalExecutionDurationMs": "884", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "145522404", "performanceInsights": { "avgPreviousExecutionMs": "825" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "44", "computeMsMax": "44", "computeRatioAvg": 0.1506849315068493, "computeRatioMax": 0.1506849315068493, "endMs": "1665777782848", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.017123287671232876, "readRatioMax": 0.017123287671232876, "recordsRead": "100000", "recordsWritten": "100000", "shuffleOutputBytes": "1800000", "shuffleOutputBytesSpilled": "0", "slotMs": "52", "startMs": "1665777782806", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:c_customer_sk, $51:c_current_addr_sk", "FROM customer" ] }, { "kind": "WRITE", "substeps": [ "$50, $51", "TO __stage00_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.00684931506849315, "waitRatioMax": 0.00684931506849315, "writeMsAvg": "9", "writeMsMax": "9", "writeRatioAvg": 0.030821917808219176, "writeRatioMax": 0.030821917808219176 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.03767123287671233, "computeRatioMax": 0.03767123287671233, "endMs": "1665777782860", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.02054794520547945, "readRatioMax": 0.02054794520547945, "recordsRead": "73049", "recordsWritten": "31", "shuffleOutputBytes": "279", "shuffleOutputBytesSpilled": "0", "slotMs": "34", "startMs": "1665777782826", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70:d_date_sk, $71:d_year, $72:d_moy", "FROM date_dim", "WHERE and(equal($72, 12), equal($71, 1998))" ] }, { "kind": "WRITE", "substeps": [ "$70", "TO __stage01_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.00684931506849315, "waitRatioMax": 0.00684931506849315, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.06506849315068493, "writeRatioMax": 0.06506849315068493 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.0273972602739726, "computeRatioMax": 0.0273972602739726, "endMs": "1665777782871", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.02054794520547945, "readRatioMax": 0.02054794520547945, "recordsRead": "18000", "recordsWritten": "417", "shuffleOutputBytes": "3753", "shuffleOutputBytesSpilled": "0", "slotMs": "23", "startMs": "1665777782841", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$100:i_item_sk, $101:i_class, $102:i_category", "FROM item", "WHERE and(equal($102, 'Women'), equal($101, 'maternity'))" ] }, { "kind": "WRITE", "substeps": [ "$100", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.003424657534246575, "waitRatioMax": 0.003424657534246575, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.05821917808219178, "writeRatioMax": 0.05821917808219178 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.023972602739726026, "computeRatioMax": 0.023972602739726026, "endMs": "1665777782879", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.0136986301369863, "readRatioMax": 0.0136986301369863, "recordsRead": "73049", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "15", "startMs": "1665777782863", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:d_month_seq, $61:d_year, $62:d_moy", "FROM date_dim", "WHERE and(equal($61, 1998), equal($62, 12))" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $260 := $200" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := add($60, 3)" ] }, { "kind": "WRITE", "substeps": [ "$260", "TO __stage04_output", "BY HASH($260)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.003424657534246575, "waitRatioMax": 0.003424657534246575, "writeMsAvg": "5", "writeMsMax": "5", "writeRatioAvg": 0.017123287671232876, "writeRatioMax": 0.017123287671232876 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.0410958904109589, "computeRatioMax": 0.0410958904109589, "endMs": "1665777782888", "id": "5", "name": "S05: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.02054794520547945, "readRatioMax": 0.02054794520547945, "recordsRead": "73049", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "20", "startMs": "1665777782868", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_month_seq, $41:d_year, $42:d_moy", "FROM date_dim", "WHERE and(equal($41, 1998), equal($42, 12))" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $230 := $190" ] }, { "kind": "COMPUTE", "substeps": [ "$190 := add($40, 1)" ] }, { "kind": "WRITE", "substeps": [ "$230", "TO __stage05_output", "BY HASH($230)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.003424657534246575, "waitRatioMax": 0.003424657534246575, "writeMsAvg": "5", "writeMsMax": "5", "writeRatioAvg": 0.017123287671232876, "writeRatioMax": 0.017123287671232876 }, { "completedParallelInputs": "6", "computeMsAvg": "152", "computeMsMax": "292", "computeRatioAvg": 0.5205479452054794, "computeRatioMax": 1, "endMs": "1665777783099", "id": "6", "inputStages": [ "2", "1", "0" ], "name": "S06: Join+", "parallelInputs": "6", "readMsAvg": "17", "readMsMax": "26", "readRatioAvg": 0.05821917808219178, "readRatioMax": 0.08904109589041095, "recordsRead": "2763620", "recordsWritten": "1559", "shuffleOutputBytes": "28062", "shuffleOutputBytesSpilled": "0", "slotMs": "930", "startMs": "1665777782908", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:cs_sold_date_sk, $81:cs_bill_customer_sk, $82:cs_item_sk", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$90:ws_sold_date_sk, $91:ws_item_sk, $92:ws_bill_customer_sk", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$100", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$70", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$50, $51", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $320 := $310, $321 := $311" ] }, { "kind": "JOIN", "substeps": [ "$310 := $50, $311 := $51", "INNER HASH JOIN EACH WITH ALL ON $300 = $50" ] }, { "kind": "JOIN", "substeps": [ "$300 := $291", "INNER HASH JOIN EACH WITH ALL ON $290 = $70" ] }, { "kind": "JOIN", "substeps": [ "$290 := $210, $291 := $211", "INNER HASH JOIN EACH WITH ALL ON $212 = $100" ] }, { "kind": "WRITE", "substeps": [ "$320, $321", "TO __stage06_output", "BY HASH($320, $321)" ] } ], "waitMsAvg": "2", "waitMsMax": "4", "waitRatioAvg": 0.00684931506849315, "waitRatioMax": 0.0136986301369863, "writeMsAvg": "8", "writeMsMax": "11", "writeRatioAvg": 0.0273972602739726, "writeRatioMax": 0.03767123287671233 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.03424657534246575, "computeRatioMax": 0.03424657534246575, "endMs": "1665777782946", "id": "7", "inputStages": [ "4" ], "name": "S07: Aggregate+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "22", "startMs": "1665777782908", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$260", "FROM __stage04_output" ] }, { "kind": "LIMIT", "substeps": [ "2" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $270 := $260" ] }, { "kind": "WRITE", "substeps": [ "$270", "TO __stage07_output" ] } ], "waitMsAvg": "0", "waitMsMax": "0", "waitRatioAvg": 0, "waitRatioMax": 0, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.05136986301369863, "writeRatioMax": 0.05136986301369863 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.03424657534246575, "computeRatioMax": 0.03424657534246575, "endMs": "1665777782953", "id": "8", "inputStages": [ "7" ], "name": "S08: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665777782910", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$270", "FROM __stage07_output" ] }, { "kind": "AGGREGATE", "substeps": [ "$180 := ANY_AND_CHECK($270)" ] }, { "kind": "WRITE", "substeps": [ "$180", "TO __stage08_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.00684931506849315, "waitRatioMax": 0.00684931506849315, "writeMsAvg": "4", "writeMsMax": "4", "writeRatioAvg": 0.0136986301369863, "writeRatioMax": 0.0136986301369863 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.0273972602739726, "computeRatioMax": 0.0273972602739726, "endMs": "1665777782951", "id": "9", "inputStages": [ "5" ], "name": "S09: Aggregate+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "30", "startMs": "1665777782913", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$230", "FROM __stage05_output" ] }, { "kind": "LIMIT", "substeps": [ "2" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $240 := $230" ] }, { "kind": "WRITE", "substeps": [ "$240", "TO __stage09_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.010273972602739725, "waitRatioMax": 0.010273972602739725, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.05136986301369863, "writeRatioMax": 0.05136986301369863 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.0273972602739726, "computeRatioMax": 0.0273972602739726, "endMs": "1665777782957", "id": "10", "inputStages": [ "9" ], "name": "S0A: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "26", "startMs": "1665777782913", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$240", "FROM __stage09_output" ] }, { "kind": "AGGREGATE", "substeps": [ "$170 := ANY_AND_CHECK($240)" ] }, { "kind": "WRITE", "substeps": [ "$170", "TO __stage0A_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.00684931506849315, "waitRatioMax": 0.00684931506849315, "writeMsAvg": "3", "writeMsMax": "3", "writeRatioAvg": 0.010273972602739725, "writeRatioMax": 0.010273972602739725 }, { "completedParallelInputs": "1", "computeMsAvg": "20", "computeMsMax": "20", "computeRatioAvg": 0.0684931506849315, "computeRatioMax": 0.0684931506849315, "endMs": "1665777783193", "id": "11", "name": "S0B: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.023972602739726026, "readRatioMax": 0.023972602739726026, "recordsRead": "73051", "recordsWritten": "90", "shuffleOutputBytes": "810", "shuffleOutputBytesSpilled": "0", "slotMs": "44", "startMs": "1665777783146", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$180", "FROM __stage08_output" ] }, { "kind": "READ", "substeps": [ "$170", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_month_seq", "FROM date_dim" ] }, { "kind": "FILTER", "substeps": [ "between($11, $170, $180)" ] }, { "kind": "WRITE", "substeps": [ "$10", "TO __stage0B_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.00684931506849315, "waitRatioMax": 0.00684931506849315, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.06506849315068493, "writeRatioMax": 0.06506849315068493 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.03767123287671233, "computeRatioMax": 0.03767123287671233, "endMs": "1665777783201", "id": "12", "name": "S0C: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.0136986301369863, "readRatioMax": 0.0136986301369863, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "348", "shuffleOutputBytesSpilled": "0", "slotMs": "30", "startMs": "1665777783161", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:s_county, $2:s_state", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage0C_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.003424657534246575, "waitRatioMax": 0.003424657534246575, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.05136986301369863, "writeRatioMax": 0.05136986301369863 }, { "completedParallelInputs": "1", "computeMsAvg": "35", "computeMsMax": "35", "computeRatioAvg": 0.11986301369863013, "computeRatioMax": 0.11986301369863013, "endMs": "1665777783222", "id": "13", "name": "S0D: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.02054794520547945, "readRatioMax": 0.02054794520547945, "recordsRead": "50000", "recordsWritten": "50000", "shuffleOutputBytes": "1712413", "shuffleOutputBytesSpilled": "0", "slotMs": "43", "startMs": "1665777783176", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ca_address_sk, $21:ca_county, $22:ca_state", "FROM customer_address" ] }, { "kind": "WRITE", "substeps": [ "$20, $21, $22", "TO __stage0D_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.003424657534246575, "waitRatioMax": 0.003424657534246575, "writeMsAvg": "9", "writeMsMax": "9", "writeRatioAvg": 0.030821917808219176, "writeRatioMax": 0.030821917808219176 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.0410958904109589, "computeRatioMax": 0.0410958904109589, "endMs": "1665777783252", "id": "15", "inputStages": [ "6" ], "name": "S0F: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1559", "recordsWritten": "1477", "shuffleOutputBytes": "26586", "shuffleOutputBytesSpilled": "0", "slotMs": "27", "startMs": "1665777783217", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$320, $321", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $330 := $320, $331 := $321" ] }, { "kind": "WRITE", "substeps": [ "$330, $331", "TO __stage0F_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.00684931506849315, "waitRatioMax": 0.00684931506849315, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.04452054794520548, "writeRatioMax": 0.04452054794520548 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "16", "computeRatioAvg": 0.0273972602739726, "computeRatioMax": 0.0547945205479452, "endMs": "1665777783347", "id": "16", "inputStages": [ "15" ], "name": "S10: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1477", "recordsWritten": "1477", "shuffleOutputBytes": "26586", "shuffleOutputBytesSpilled": "0", "slotMs": "4094", "startMs": "1665777783268", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0F_output" ] } ], "waitMsAvg": "4", "waitMsMax": "16", "waitRatioAvg": 0.0136986301369863, "waitRatioMax": 0.0547945205479452, "writeMsAvg": "45", "writeMsMax": "70", "writeRatioAvg": 0.1541095890410959, "writeRatioMax": 0.23972602739726026 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "17", "computeRatioAvg": 0.023972602739726026, "computeRatioMax": 0.05821917808219178, "endMs": "1665777783347", "id": "17", "inputStages": [ "11" ], "name": "S11: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "90", "recordsWritten": "90", "shuffleOutputBytes": "810", "shuffleOutputBytesSpilled": "0", "slotMs": "3318", "startMs": "1665777783270", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0B_output" ] } ], "waitMsAvg": "16", "waitMsMax": "19", "waitRatioAvg": 0.0547945205479452, "waitRatioMax": 0.06506849315068493, "writeMsAvg": "24", "writeMsMax": "65", "writeRatioAvg": 0.0821917808219178, "writeRatioMax": 0.2226027397260274 }, { "completedParallelInputs": "6", "computeMsAvg": "171", "computeMsMax": "188", "computeRatioAvg": 0.5856164383561644, "computeRatioMax": 0.6438356164383562, "endMs": "1665777783472", "id": "18", "inputStages": [ "10", "8", "13", "16", "12", "17" ], "name": "S12: Join+", "parallelInputs": "6", "readMsAvg": "15", "readMsMax": "18", "readRatioAvg": 0.05136986301369863, "readRatioMax": 0.06164383561643835, "recordsRead": "3189890", "recordsWritten": "5", "shuffleOutputBytes": "130", "shuffleOutputBytesSpilled": "0", "slotMs": "1092", "startMs": "1665777783287", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$170", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$180", "FROM __stage08_output" ] }, { "kind": "READ", "substeps": [ "$30:ss_sold_date_sk, $31:ss_customer_sk, $32:ss_ext_sales_price", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$330, $331", "FROM __stage10_output" ] }, { "kind": "READ", "substeps": [ "$20, $21, $22", "FROM __stage0D_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage0C_output" ] }, { "kind": "READ", "substeps": [ "$10", "FROM __stage11_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $380 := $371", "$160 := SUM($370)" ] }, { "kind": "JOIN", "substeps": [ "$370 := $361, $371 := $362", "INNER HASH JOIN EACH WITH ALL ON $360 = $10" ] }, { "kind": "JOIN", "substeps": [ "$360 := $350, $361 := $351, $362 := $352", "INNER HASH JOIN EACH WITH ALL ON $353 = $1, $354 = $2" ] }, { "kind": "JOIN", "substeps": [ "$350 := $342, $351 := $343, $352 := $340, $353 := $21, $354 := $22", "INNER HASH JOIN EACH WITH ALL ON $341 = $20" ] }, { "kind": "JOIN", "substeps": [ "$342 := $30, $343 := $32, $340 := $330, $341 := $331", "INNER HASH JOIN EACH WITH ALL ON $31 = $330" ] }, { "kind": "WRITE", "substeps": [ "$380, $160", "TO __stage12_output", "BY HASH($380)" ] } ], "waitMsAvg": "3", "waitMsMax": "5", "waitRatioAvg": 0.010273972602739725, "waitRatioMax": 0.017123287671232876, "writeMsAvg": "5", "writeMsMax": "9", "writeRatioAvg": 0.017123287671232876, "writeRatioMax": 0.030821917808219176 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.03424657534246575, "computeRatioMax": 0.03424657534246575, "endMs": "1665777783544", "id": "19", "inputStages": [ "18" ], "name": "S13: Aggregate+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "5", "recordsWritten": "1", "shuffleOutputBytes": "18", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665777783510", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$380, $160", "FROM __stage12_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $400 := $140", "$130 := COUNT_STAR()" ] }, { "kind": "COMPUTE", "substeps": [ "$140 := CAST(divide($150, NUMERIC<...>) AS INT64)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $390 := $380", "$150 := SUM($160)" ] }, { "kind": "WRITE", "substeps": [ "$130, $400", "TO __stage13_output", "BY HASH($400)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.003424657534246575, "waitRatioMax": 0.003424657534246575, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.04794520547945205, "writeRatioMax": 0.04794520547945205 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.030821917808219176, "computeRatioMax": 0.030821917808219176, "endMs": "1665777783609", "id": "20", "inputStages": [ "19" ], "name": "S14: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "27", "shuffleOutputBytesSpilled": "0", "slotMs": "36", "startMs": "1665777783561", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$130, $400", "FROM __stage13_output" ] }, { "kind": "COMPUTE", "substeps": [ "$110 := multiply($421, 50)" ] }, { "kind": "SORT", "substeps": [ "$410 ASC, $120 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $410 := $400", "$120 := SUM_OF_COUNTS($130)" ] }, { "kind": "WRITE", "substeps": [ "$110, $420, $421", "TO __stage14_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.00684931506849315, "waitRatioMax": 0.00684931506849315, "writeMsAvg": "27", "writeMsMax": "27", "writeRatioAvg": 0.09246575342465753, "writeRatioMax": 0.09246575342465753 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.0273972602739726, "computeRatioMax": 0.0273972602739726, "endMs": "1665777783628", "id": "21", "inputStages": [ "20" ], "name": "S15: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "27", "shuffleOutputBytesSpilled": "0", "slotMs": "31", "startMs": "1665777783576", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$110, $420, $421", "FROM __stage14_output" ] }, { "kind": "SORT", "substeps": [ "$421 ASC, $420 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$430, $431, $432", "TO __stage15_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.003424657534246575, "waitRatioMax": 0.003424657534246575, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.0547945205479452, "writeRatioMax": 0.0547945205479452 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "item" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "customer_address" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "customer" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "206", "completedUnits": "19", "elapsedMs": "680", "estimatedRunnableUnits": "0", "pendingUnits": "206", "totalSlotMs": "1522" }, { "activeUnits": "206", "completedUnits": "228", "elapsedMs": "1063", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "10003" } ], "totalBytesBilled": "145752064", "totalBytesProcessed": "145522404", "totalPartitionsProcessed": "0", "totalSlotMs": "10003", "transferredBytes": "0" }, "startTime": "1665777782628", "totalBytesProcessed": "145522404", "totalSlotMs": "10003" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anond61bb491_c43e_4d48_b283_918d0a32c048" }, "priority": "INTERACTIVE", "query": "-- start query 54 in stream 0 using template query54.tpl\nwith my_customers as (\n select distinct c_customer_sk\n , c_current_addr_sk\n from \n ( select cs_sold_date_sk sold_date_sk,\n cs_bill_customer_sk customer_sk,\n cs_item_sk item_sk\n from catalog_sales\n union all\n select ws_sold_date_sk sold_date_sk,\n ws_bill_customer_sk customer_sk,\n ws_item_sk item_sk\n from web_sales\n ) cs_or_ws_sales,\n item,\n date_dim,\n customer\n where sold_date_sk = d_date_sk\n and item_sk = i_item_sk\n and i_category = 'Women'\n and i_class = 'maternity'\n and c_customer_sk = cs_or_ws_sales.customer_sk\n and d_moy = 12\n and d_year = 1998\n )\n , my_revenue as (\n select c_customer_sk,\n sum(ss_ext_sales_price) as revenue\n from my_customers,\n store_sales,\n customer_address,\n store,\n date_dim\n where c_current_addr_sk = ca_address_sk\n and ca_county = s_county\n and ca_state = s_state\n and ss_sold_date_sk = d_date_sk\n and c_customer_sk = ss_customer_sk\n and d_month_seq between (select distinct d_month_seq+1\n from date_dim where d_year = 1998 and d_moy = 12)\n and (select distinct d_month_seq+3\n from date_dim where d_year = 1998 and d_moy = 12)\n group by c_customer_sk\n )\n , segments as\n (select cast((revenue/50) as int) as segment\n from my_revenue\n )\n select segment, count(*) as num_customers, segment*50 as segment_base\n from segments\n group by segment\n order by segment, num_customers\n limit 100\n ;\n\n-- end query 54 in stream 0 using template query54.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "SzuWZjYlimgXy2Xazthbkw==", "id": "test-project-364309:europe-west1.query54_1665777784", "jobReference": { "jobId": "query54_1665777784", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query54_1665777784?location=europe-west1", "statistics": { "creationTime": "1665777785354", "endTime": "1665777786464", "finalExecutionDurationMs": "804", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "145522404", "performanceInsights": { "avgPreviousExecutionMs": "833" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "55", "computeMsMax": "55", "computeRatioAvg": 0.21153846153846154, "computeRatioMax": 0.21153846153846154, "endMs": "1665777785646", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.026923076923076925, "readRatioMax": 0.026923076923076925, "recordsRead": "100000", "recordsWritten": "100000", "shuffleOutputBytes": "1800000", "shuffleOutputBytesSpilled": "0", "slotMs": "49", "startMs": "1665777785597", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:c_customer_sk, $51:c_current_addr_sk", "FROM customer" ] }, { "kind": "WRITE", "substeps": [ "$50, $51", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0038461538461538464, "waitRatioMax": 0.0038461538461538464, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.05, "writeRatioMax": 0.05 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.05384615384615385, "computeRatioMax": 0.05384615384615385, "endMs": "1665777785655", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.026923076923076925, "readRatioMax": 0.026923076923076925, "recordsRead": "73049", "recordsWritten": "31", "shuffleOutputBytes": "279", "shuffleOutputBytesSpilled": "0", "slotMs": "38", "startMs": "1665777785615", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70:d_date_sk, $71:d_year, $72:d_moy", "FROM date_dim", "WHERE and(equal($72, 12), equal($71, 1998))" ] }, { "kind": "WRITE", "substeps": [ "$70", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0038461538461538464, "waitRatioMax": 0.0038461538461538464, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.05, "writeRatioMax": 0.05 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.04230769230769231, "computeRatioMax": 0.04230769230769231, "endMs": "1665777785670", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.03461538461538462, "readRatioMax": 0.03461538461538462, "recordsRead": "18000", "recordsWritten": "417", "shuffleOutputBytes": "3753", "shuffleOutputBytesSpilled": "0", "slotMs": "39", "startMs": "1665777785629", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$100:i_item_sk, $101:i_class, $102:i_category", "FROM item", "WHERE and(equal($102, 'Women'), equal($101, 'maternity'))" ] }, { "kind": "WRITE", "substeps": [ "$100", "TO __stage02_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.007692307692307693, "waitRatioMax": 0.007692307692307693, "writeMsAvg": "9", "writeMsMax": "9", "writeRatioAvg": 0.03461538461538462, "writeRatioMax": 0.03461538461538462 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.05384615384615385, "computeRatioMax": 0.05384615384615385, "endMs": "1665777785685", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.03461538461538462, "readRatioMax": 0.03461538461538462, "recordsRead": "73049", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "27", "startMs": "1665777785660", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:d_month_seq, $61:d_year, $62:d_moy", "FROM date_dim", "WHERE and(equal($61, 1998), equal($62, 12))" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $260 := $200" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := add($60, 3)" ] }, { "kind": "WRITE", "substeps": [ "$260", "TO __stage04_output", "BY HASH($260)" ] } ], "waitMsAvg": "6", "waitMsMax": "6", "waitRatioAvg": 0.023076923076923078, "waitRatioMax": 0.023076923076923078, "writeMsAvg": "6", "writeMsMax": "6", "writeRatioAvg": 0.023076923076923078, "writeRatioMax": 0.023076923076923078 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.046153846153846156, "computeRatioMax": 0.046153846153846156, "endMs": "1665777785682", "id": "5", "name": "S05: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.026923076923076925, "readRatioMax": 0.026923076923076925, "recordsRead": "73049", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "22", "startMs": "1665777785661", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_month_seq, $41:d_year, $42:d_moy", "FROM date_dim", "WHERE and(equal($41, 1998), equal($42, 12))" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $230 := $190" ] }, { "kind": "COMPUTE", "substeps": [ "$190 := add($40, 1)" ] }, { "kind": "WRITE", "substeps": [ "$230", "TO __stage05_output", "BY HASH($230)" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.011538461538461539, "waitRatioMax": 0.011538461538461539, "writeMsAvg": "5", "writeMsMax": "5", "writeRatioAvg": 0.019230769230769232, "writeRatioMax": 0.019230769230769232 }, { "completedParallelInputs": "6", "computeMsAvg": "146", "computeMsMax": "230", "computeRatioAvg": 0.5615384615384615, "computeRatioMax": 0.8846153846153846, "endMs": "1665777785831", "id": "6", "inputStages": [ "1", "2", "0" ], "name": "S06: Join+", "parallelInputs": "6", "readMsAvg": "13", "readMsMax": "22", "readRatioAvg": 0.05, "readRatioMax": 0.08461538461538462, "recordsRead": "2763620", "recordsWritten": "1559", "shuffleOutputBytes": "28062", "shuffleOutputBytesSpilled": "0", "slotMs": "842", "startMs": "1665777785686", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:cs_sold_date_sk, $81:cs_bill_customer_sk, $82:cs_item_sk", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$90:ws_sold_date_sk, $91:ws_item_sk, $92:ws_bill_customer_sk", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$100", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$70", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$50, $51", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $320 := $310, $321 := $311" ] }, { "kind": "JOIN", "substeps": [ "$310 := $50, $311 := $51", "INNER HASH JOIN EACH WITH ALL ON $300 = $50" ] }, { "kind": "JOIN", "substeps": [ "$300 := $291", "INNER HASH JOIN EACH WITH ALL ON $290 = $70" ] }, { "kind": "JOIN", "substeps": [ "$290 := $210, $291 := $211", "INNER HASH JOIN EACH WITH ALL ON $212 = $100" ] }, { "kind": "WRITE", "substeps": [ "$320, $321", "TO __stage06_output", "BY HASH($320, $321)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0038461538461538464, "waitRatioMax": 0.0038461538461538464, "writeMsAvg": "7", "writeMsMax": "10", "writeRatioAvg": 0.026923076923076925, "writeRatioMax": 0.038461538461538464 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.038461538461538464, "computeRatioMax": 0.038461538461538464, "endMs": "1665777785729", "id": "7", "inputStages": [ "5" ], "name": "S07: Aggregate+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "43", "startMs": "1665777785690", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$230", "FROM __stage05_output" ] }, { "kind": "LIMIT", "substeps": [ "2" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $240 := $230" ] }, { "kind": "WRITE", "substeps": [ "$240", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0038461538461538464, "waitRatioMax": 0.0038461538461538464, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.06538461538461539, "writeRatioMax": 0.06538461538461539 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.038461538461538464, "computeRatioMax": 0.038461538461538464, "endMs": "1665777785743", "id": "8", "inputStages": [ "7" ], "name": "S08: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "39", "startMs": "1665777785702", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$240", "FROM __stage07_output" ] }, { "kind": "AGGREGATE", "substeps": [ "$170 := ANY_AND_CHECK($240)" ] }, { "kind": "WRITE", "substeps": [ "$170", "TO __stage08_output" ] } ], "waitMsAvg": "8", "waitMsMax": "8", "waitRatioAvg": 0.03076923076923077, "waitRatioMax": 0.03076923076923077, "writeMsAvg": "4", "writeMsMax": "4", "writeRatioAvg": 0.015384615384615385, "writeRatioMax": 0.015384615384615385 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.03076923076923077, "computeRatioMax": 0.03076923076923077, "endMs": "1665777785733", "id": "9", "inputStages": [ "4" ], "name": "S09: Aggregate+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "25", "startMs": "1665777785698", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$260", "FROM __stage04_output" ] }, { "kind": "LIMIT", "substeps": [ "2" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $270 := $260" ] }, { "kind": "WRITE", "substeps": [ "$270", "TO __stage09_output" ] } ], "waitMsAvg": "7", "waitMsMax": "7", "waitRatioAvg": 0.026923076923076925, "waitRatioMax": 0.026923076923076925, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.05, "writeRatioMax": 0.05 }, { "completedParallelInputs": "1", "computeMsAvg": "6", "computeMsMax": "6", "computeRatioAvg": 0.023076923076923078, "computeRatioMax": 0.023076923076923078, "endMs": "1665777785742", "id": "10", "inputStages": [ "9" ], "name": "S0A: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "40", "startMs": "1665777785701", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$270", "FROM __stage09_output" ] }, { "kind": "AGGREGATE", "substeps": [ "$180 := ANY_AND_CHECK($270)" ] }, { "kind": "WRITE", "substeps": [ "$180", "TO __stage0A_output" ] } ], "waitMsAvg": "7", "waitMsMax": "7", "waitRatioAvg": 0.026923076923076925, "waitRatioMax": 0.026923076923076925, "writeMsAvg": "3", "writeMsMax": "3", "writeRatioAvg": 0.011538461538461539, "writeRatioMax": 0.011538461538461539 }, { "completedParallelInputs": "1", "computeMsAvg": "17", "computeMsMax": "17", "computeRatioAvg": 0.06538461538461539, "computeRatioMax": 0.06538461538461539, "endMs": "1665777785911", "id": "11", "name": "S0B: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.023076923076923078, "readRatioMax": 0.023076923076923078, "recordsRead": "73051", "recordsWritten": "90", "shuffleOutputBytes": "810", "shuffleOutputBytesSpilled": "0", "slotMs": "40", "startMs": "1665777785857", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$180", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$170", "FROM __stage08_output" ] }, { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_month_seq", "FROM date_dim" ] }, { "kind": "FILTER", "substeps": [ "between($11, $170, $180)" ] }, { "kind": "WRITE", "substeps": [ "$10", "TO __stage0B_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0038461538461538464, "waitRatioMax": 0.0038461538461538464, "writeMsAvg": "32", "writeMsMax": "32", "writeRatioAvg": 0.12307692307692308, "writeRatioMax": 0.12307692307692308 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.026923076923076925, "computeRatioMax": 0.026923076923076925, "endMs": "1665777785907", "id": "12", "name": "S0C: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.015384615384615385, "readRatioMax": 0.015384615384615385, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "348", "shuffleOutputBytesSpilled": "0", "slotMs": "24", "startMs": "1665777785870", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:s_county, $2:s_state", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage0C_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0038461538461538464, "waitRatioMax": 0.0038461538461538464, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.06153846153846154, "writeRatioMax": 0.06153846153846154 }, { "completedParallelInputs": "1", "computeMsAvg": "34", "computeMsMax": "34", "computeRatioAvg": 0.13076923076923078, "computeRatioMax": 0.13076923076923078, "endMs": "1665777785922", "id": "13", "name": "S0D: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.019230769230769232, "readRatioMax": 0.019230769230769232, "recordsRead": "50000", "recordsWritten": "50000", "shuffleOutputBytes": "1712413", "shuffleOutputBytesSpilled": "0", "slotMs": "43", "startMs": "1665777785886", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ca_address_sk, $21:ca_county, $22:ca_state", "FROM customer_address" ] }, { "kind": "WRITE", "substeps": [ "$20, $21, $22", "TO __stage0D_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0038461538461538464, "waitRatioMax": 0.0038461538461538464, "writeMsAvg": "11", "writeMsMax": "11", "writeRatioAvg": 0.04230769230769231, "writeRatioMax": 0.04230769230769231 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.03076923076923077, "computeRatioMax": 0.03076923076923077, "endMs": "1665777785953", "id": "15", "inputStages": [ "6" ], "name": "S0F: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1559", "recordsWritten": "1477", "shuffleOutputBytes": "26586", "shuffleOutputBytesSpilled": "0", "slotMs": "31", "startMs": "1665777785917", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$320, $321", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $330 := $320, $331 := $321" ] }, { "kind": "WRITE", "substeps": [ "$330, $331", "TO __stage0F_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0038461538461538464, "waitRatioMax": 0.0038461538461538464, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.05384615384615385, "writeRatioMax": 0.05384615384615385 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "17", "computeRatioAvg": 0.03076923076923077, "computeRatioMax": 0.06538461538461539, "endMs": "1665777786019", "id": "16", "inputStages": [ "15" ], "name": "S10: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1477", "recordsWritten": "1477", "shuffleOutputBytes": "26586", "shuffleOutputBytesSpilled": "0", "slotMs": "3148", "startMs": "1665777785967", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0F_output" ] } ], "waitMsAvg": "2", "waitMsMax": "6", "waitRatioAvg": 0.007692307692307693, "waitRatioMax": 0.023076923076923078, "writeMsAvg": "15", "writeMsMax": "26", "writeRatioAvg": 0.057692307692307696, "writeRatioMax": 0.1 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "17", "computeRatioAvg": 0.03076923076923077, "computeRatioMax": 0.06538461538461539, "endMs": "1665777786025", "id": "17", "inputStages": [ "11" ], "name": "S11: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "90", "recordsWritten": "90", "shuffleOutputBytes": "810", "shuffleOutputBytesSpilled": "0", "slotMs": "3015", "startMs": "1665777785970", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0B_output" ] } ], "waitMsAvg": "5", "waitMsMax": "9", "waitRatioAvg": 0.019230769230769232, "waitRatioMax": 0.03461538461538462, "writeMsAvg": "14", "writeMsMax": "27", "writeRatioAvg": 0.05384615384615385, "writeRatioMax": 0.10384615384615385 }, { "completedParallelInputs": "6", "computeMsAvg": "200", "computeMsMax": "260", "computeRatioAvg": 0.7692307692307693, "computeRatioMax": 1, "endMs": "1665777786210", "id": "18", "inputStages": [ "13", "12", "10", "17", "16", "8" ], "name": "S12: Join+", "parallelInputs": "6", "readMsAvg": "17", "readMsMax": "27", "readRatioAvg": 0.06538461538461539, "readRatioMax": 0.10384615384615385, "recordsRead": "3189890", "recordsWritten": "5", "shuffleOutputBytes": "130", "shuffleOutputBytesSpilled": "0", "slotMs": "1181", "startMs": "1665777785980", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$170", "FROM __stage08_output" ] }, { "kind": "READ", "substeps": [ "$180", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$30:ss_sold_date_sk, $31:ss_customer_sk, $32:ss_ext_sales_price", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$330, $331", "FROM __stage10_output" ] }, { "kind": "READ", "substeps": [ "$20, $21, $22", "FROM __stage0D_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage0C_output" ] }, { "kind": "READ", "substeps": [ "$10", "FROM __stage11_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $380 := $371", "$160 := SUM($370)" ] }, { "kind": "JOIN", "substeps": [ "$370 := $361, $371 := $362", "INNER HASH JOIN EACH WITH ALL ON $360 = $10" ] }, { "kind": "JOIN", "substeps": [ "$360 := $350, $361 := $351, $362 := $352", "INNER HASH JOIN EACH WITH ALL ON $353 = $1, $354 = $2" ] }, { "kind": "JOIN", "substeps": [ "$350 := $342, $351 := $343, $352 := $340, $353 := $21, $354 := $22", "INNER HASH JOIN EACH WITH ALL ON $341 = $20" ] }, { "kind": "JOIN", "substeps": [ "$342 := $30, $343 := $32, $340 := $330, $341 := $331", "INNER HASH JOIN EACH WITH ALL ON $31 = $330" ] }, { "kind": "WRITE", "substeps": [ "$380, $160", "TO __stage12_output", "BY HASH($380)" ] } ], "waitMsAvg": "1", "waitMsMax": "4", "waitRatioAvg": 0.0038461538461538464, "waitRatioMax": 0.015384615384615385, "writeMsAvg": "6", "writeMsMax": "8", "writeRatioAvg": 0.023076923076923078, "writeRatioMax": 0.03076923076923077 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.03461538461538462, "computeRatioMax": 0.03461538461538462, "endMs": "1665777786273", "id": "19", "inputStages": [ "18" ], "name": "S13: Aggregate+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "5", "recordsWritten": "1", "shuffleOutputBytes": "18", "shuffleOutputBytesSpilled": "0", "slotMs": "21", "startMs": "1665777786237", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$380, $160", "FROM __stage12_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $400 := $140", "$130 := COUNT_STAR()" ] }, { "kind": "COMPUTE", "substeps": [ "$140 := CAST(divide($150, NUMERIC<...>) AS INT64)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $390 := $380", "$150 := SUM($160)" ] }, { "kind": "WRITE", "substeps": [ "$130, $400", "TO __stage13_output", "BY HASH($400)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0038461538461538464, "waitRatioMax": 0.0038461538461538464, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.06153846153846154, "writeRatioMax": 0.06153846153846154 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.03076923076923077, "computeRatioMax": 0.03076923076923077, "endMs": "1665777786343", "id": "20", "inputStages": [ "19" ], "name": "S14: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "27", "shuffleOutputBytesSpilled": "0", "slotMs": "55", "startMs": "1665777786290", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$130, $400", "FROM __stage13_output" ] }, { "kind": "COMPUTE", "substeps": [ "$110 := multiply($421, 50)" ] }, { "kind": "SORT", "substeps": [ "$410 ASC, $120 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $410 := $400", "$120 := SUM_OF_COUNTS($130)" ] }, { "kind": "WRITE", "substeps": [ "$110, $420, $421", "TO __stage14_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0038461538461538464, "waitRatioMax": 0.0038461538461538464, "writeMsAvg": "43", "writeMsMax": "43", "writeRatioAvg": 0.16538461538461538, "writeRatioMax": 0.16538461538461538 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.03461538461538462, "computeRatioMax": 0.03461538461538462, "endMs": "1665777786359", "id": "21", "inputStages": [ "20" ], "name": "S15: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "27", "shuffleOutputBytesSpilled": "0", "slotMs": "56", "startMs": "1665777786304", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$110, $420, $421", "FROM __stage14_output" ] }, { "kind": "SORT", "substeps": [ "$421 ASC, $420 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$430, $431, $432", "TO __stage15_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0038461538461538464, "waitRatioMax": 0.0038461538461538464, "writeMsAvg": "6", "writeMsMax": "6", "writeRatioAvg": 0.023076923076923078, "writeRatioMax": 0.023076923076923078 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "item" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "customer_address" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "customer" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "6", "completedUnits": "219", "elapsedMs": "681", "estimatedRunnableUnits": "0", "pendingUnits": "6", "totalSlotMs": "7518" }, { "activeUnits": "6", "completedUnits": "228", "elapsedMs": "987", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "8829" } ], "totalBytesBilled": "145752064", "totalBytesProcessed": "145522404", "totalPartitionsProcessed": "0", "totalSlotMs": "8829", "transferredBytes": "0" }, "startTime": "1665777785418", "totalBytesProcessed": "145522404", "totalSlotMs": "8829" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon61790efa_886f_4fa9_a50a_5ebffac3af87" }, "priority": "INTERACTIVE", "query": "-- start query 54 in stream 0 using template query54.tpl\nwith my_customers as (\n select distinct c_customer_sk\n , c_current_addr_sk\n from \n ( select cs_sold_date_sk sold_date_sk,\n cs_bill_customer_sk customer_sk,\n cs_item_sk item_sk\n from catalog_sales\n union all\n select ws_sold_date_sk sold_date_sk,\n ws_bill_customer_sk customer_sk,\n ws_item_sk item_sk\n from web_sales\n ) cs_or_ws_sales,\n item,\n date_dim,\n customer\n where sold_date_sk = d_date_sk\n and item_sk = i_item_sk\n and i_category = 'Women'\n and i_class = 'maternity'\n and c_customer_sk = cs_or_ws_sales.customer_sk\n and d_moy = 12\n and d_year = 1998\n )\n , my_revenue as (\n select c_customer_sk,\n sum(ss_ext_sales_price) as revenue\n from my_customers,\n store_sales,\n customer_address,\n store,\n date_dim\n where c_current_addr_sk = ca_address_sk\n and ca_county = s_county\n and ca_state = s_state\n and ss_sold_date_sk = d_date_sk\n and c_customer_sk = ss_customer_sk\n and d_month_seq between (select distinct d_month_seq+1\n from date_dim where d_year = 1998 and d_moy = 12)\n and (select distinct d_month_seq+3\n from date_dim where d_year = 1998 and d_moy = 12)\n group by c_customer_sk\n )\n , segments as\n (select cast((revenue/50) as int) as segment\n from my_revenue\n )\n select segment, count(*) as num_customers, segment*50 as segment_base\n from segments\n group by segment\n order by segment, num_customers\n limit 100\n ;\n\n-- end query 54 in stream 0 using template query54.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "XYDI/9dIDvdcnG+hun74vQ==", "id": "test-project-364309:europe-west1.query54_1665777787", "jobReference": { "jobId": "query54_1665777787", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query54_1665777787?location=europe-west1", "statistics": { "creationTime": "1665777788205", "endTime": "1665777789235", "finalExecutionDurationMs": "759", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "145522404", "performanceInsights": { "avgPreviousExecutionMs": "830" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "67", "computeMsMax": "67", "computeRatioAvg": 0.32367149758454106, "computeRatioMax": 0.32367149758454106, "endMs": "1665777788460", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.033816425120772944, "readRatioMax": 0.033816425120772944, "recordsRead": "100000", "recordsWritten": "100000", "shuffleOutputBytes": "1800000", "shuffleOutputBytesSpilled": "0", "slotMs": "49", "startMs": "1665777788412", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:c_customer_sk, $51:c_current_addr_sk", "FROM customer" ] }, { "kind": "WRITE", "substeps": [ "$50, $51", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004830917874396135, "waitRatioMax": 0.004830917874396135, "writeMsAvg": "10", "writeMsMax": "10", "writeRatioAvg": 0.04830917874396135, "writeRatioMax": 0.04830917874396135 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.057971014492753624, "computeRatioMax": 0.057971014492753624, "endMs": "1665777788458", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "11", "readMsMax": "11", "readRatioAvg": 0.05314009661835749, "readRatioMax": 0.05314009661835749, "recordsRead": "73049", "recordsWritten": "31", "shuffleOutputBytes": "279", "shuffleOutputBytesSpilled": "0", "slotMs": "31", "startMs": "1665777788429", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70:d_date_sk, $71:d_year, $72:d_moy", "FROM date_dim", "WHERE and(equal($72, 12), equal($71, 1998))" ] }, { "kind": "WRITE", "substeps": [ "$70", "TO __stage01_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.00966183574879227, "waitRatioMax": 0.00966183574879227, "writeMsAvg": "7", "writeMsMax": "7", "writeRatioAvg": 0.033816425120772944, "writeRatioMax": 0.033816425120772944 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.05314009661835749, "computeRatioMax": 0.05314009661835749, "endMs": "1665777788479", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.028985507246376812, "readRatioMax": 0.028985507246376812, "recordsRead": "18000", "recordsWritten": "417", "shuffleOutputBytes": "3753", "shuffleOutputBytesSpilled": "0", "slotMs": "41", "startMs": "1665777788444", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$100:i_item_sk, $101:i_class, $102:i_category", "FROM item", "WHERE and(equal($102, 'Women'), equal($101, 'maternity'))" ] }, { "kind": "WRITE", "substeps": [ "$100", "TO __stage02_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.00966183574879227, "waitRatioMax": 0.00966183574879227, "writeMsAvg": "20", "writeMsMax": "20", "writeRatioAvg": 0.0966183574879227, "writeRatioMax": 0.0966183574879227 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.033816425120772944, "computeRatioMax": 0.033816425120772944, "endMs": "1665777788496", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.024154589371980676, "readRatioMax": 0.024154589371980676, "recordsRead": "73049", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "25", "startMs": "1665777788480", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:d_month_seq, $61:d_year, $62:d_moy", "FROM date_dim", "WHERE and(equal($61, 1998), equal($62, 12))" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $260 := $200" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := add($60, 3)" ] }, { "kind": "WRITE", "substeps": [ "$260", "TO __stage04_output", "BY HASH($260)" ] } ], "waitMsAvg": "18", "waitMsMax": "18", "waitRatioAvg": 0.08695652173913043, "waitRatioMax": 0.08695652173913043, "writeMsAvg": "3", "writeMsMax": "3", "writeRatioAvg": 0.014492753623188406, "writeRatioMax": 0.014492753623188406 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.033816425120772944, "computeRatioMax": 0.033816425120772944, "endMs": "1665777788508", "id": "5", "name": "S05: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.01932367149758454, "readRatioMax": 0.01932367149758454, "recordsRead": "73049", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "16", "startMs": "1665777788492", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_month_seq, $41:d_year, $42:d_moy", "FROM date_dim", "WHERE and(equal($41, 1998), equal($42, 12))" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $230 := $190" ] }, { "kind": "COMPUTE", "substeps": [ "$190 := add($40, 1)" ] }, { "kind": "WRITE", "substeps": [ "$230", "TO __stage05_output", "BY HASH($230)" ] } ], "waitMsAvg": "24", "waitMsMax": "24", "waitRatioAvg": 0.11594202898550725, "waitRatioMax": 0.11594202898550725, "writeMsAvg": "4", "writeMsMax": "4", "writeRatioAvg": 0.01932367149758454, "writeRatioMax": 0.01932367149758454 }, { "completedParallelInputs": "6", "computeMsAvg": "137", "computeMsMax": "150", "computeRatioAvg": 0.6618357487922706, "computeRatioMax": 0.7246376811594203, "endMs": "1665777788626", "id": "6", "inputStages": [ "0", "1", "2" ], "name": "S06: Join+", "parallelInputs": "6", "readMsAvg": "11", "readMsMax": "14", "readRatioAvg": 0.05314009661835749, "readRatioMax": 0.06763285024154589, "recordsRead": "2763620", "recordsWritten": "1559", "shuffleOutputBytes": "28062", "shuffleOutputBytesSpilled": "0", "slotMs": "832", "startMs": "1665777788508", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:cs_sold_date_sk, $81:cs_bill_customer_sk, $82:cs_item_sk", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$90:ws_sold_date_sk, $91:ws_item_sk, $92:ws_bill_customer_sk", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$100", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$70", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$50, $51", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $320 := $310, $321 := $311" ] }, { "kind": "JOIN", "substeps": [ "$310 := $50, $311 := $51", "INNER HASH JOIN EACH WITH ALL ON $300 = $50" ] }, { "kind": "JOIN", "substeps": [ "$300 := $291", "INNER HASH JOIN EACH WITH ALL ON $290 = $70" ] }, { "kind": "JOIN", "substeps": [ "$290 := $210, $291 := $211", "INNER HASH JOIN EACH WITH ALL ON $212 = $100" ] }, { "kind": "WRITE", "substeps": [ "$320, $321", "TO __stage06_output", "BY HASH($320, $321)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.00966183574879227, "waitRatioMax": 0.00966183574879227, "writeMsAvg": "7", "writeMsMax": "8", "writeRatioAvg": 0.033816425120772944, "writeRatioMax": 0.03864734299516908 }, { "completedParallelInputs": "1", "computeMsAvg": "6", "computeMsMax": "6", "computeRatioAvg": 0.028985507246376812, "computeRatioMax": 0.028985507246376812, "endMs": "1665777788544", "id": "7", "inputStages": [ "4" ], "name": "S07: Aggregate+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "36", "startMs": "1665777788508", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$260", "FROM __stage04_output" ] }, { "kind": "LIMIT", "substeps": [ "2" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $270 := $260" ] }, { "kind": "WRITE", "substeps": [ "$270", "TO __stage07_output" ] } ], "waitMsAvg": "0", "waitMsMax": "0", "waitRatioAvg": 0, "waitRatioMax": 0, "writeMsAvg": "28", "writeMsMax": "28", "writeRatioAvg": 0.13526570048309178, "writeRatioMax": 0.13526570048309178 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.043478260869565216, "computeRatioMax": 0.043478260869565216, "endMs": "1665777788555", "id": "8", "inputStages": [ "7" ], "name": "S08: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "33", "startMs": "1665777788512", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$270", "FROM __stage07_output" ] }, { "kind": "AGGREGATE", "substeps": [ "$180 := ANY_AND_CHECK($270)" ] }, { "kind": "WRITE", "substeps": [ "$180", "TO __stage08_output" ] } ], "waitMsAvg": "4", "waitMsMax": "4", "waitRatioAvg": 0.01932367149758454, "waitRatioMax": 0.01932367149758454, "writeMsAvg": "3", "writeMsMax": "3", "writeRatioAvg": 0.014492753623188406, "writeRatioMax": 0.014492753623188406 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.03864734299516908, "computeRatioMax": 0.03864734299516908, "endMs": "1665777788551", "id": "9", "inputStages": [ "5" ], "name": "S09: Aggregate+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "37", "startMs": "1665777788516", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$230", "FROM __stage05_output" ] }, { "kind": "LIMIT", "substeps": [ "2" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $240 := $230" ] }, { "kind": "WRITE", "substeps": [ "$240", "TO __stage09_output" ] } ], "waitMsAvg": "5", "waitMsMax": "5", "waitRatioAvg": 0.024154589371980676, "waitRatioMax": 0.024154589371980676, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.06763285024154589, "writeRatioMax": 0.06763285024154589 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.04830917874396135, "computeRatioMax": 0.04830917874396135, "endMs": "1665777788558", "id": "10", "inputStages": [ "9" ], "name": "S0A: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "45", "startMs": "1665777788517", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$240", "FROM __stage09_output" ] }, { "kind": "AGGREGATE", "substeps": [ "$170 := ANY_AND_CHECK($240)" ] }, { "kind": "WRITE", "substeps": [ "$170", "TO __stage0A_output" ] } ], "waitMsAvg": "4", "waitMsMax": "4", "waitRatioAvg": 0.01932367149758454, "waitRatioMax": 0.01932367149758454, "writeMsAvg": "3", "writeMsMax": "3", "writeRatioAvg": 0.014492753623188406, "writeRatioMax": 0.014492753623188406 }, { "completedParallelInputs": "1", "computeMsAvg": "18", "computeMsMax": "18", "computeRatioAvg": 0.08695652173913043, "computeRatioMax": 0.08695652173913043, "endMs": "1665777788717", "id": "11", "name": "S0B: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.03864734299516908, "readRatioMax": 0.03864734299516908, "recordsRead": "73051", "recordsWritten": "90", "shuffleOutputBytes": "810", "shuffleOutputBytesSpilled": "0", "slotMs": "40", "startMs": "1665777788671", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$180", "FROM __stage08_output" ] }, { "kind": "READ", "substeps": [ "$170", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_month_seq", "FROM date_dim" ] }, { "kind": "FILTER", "substeps": [ "between($11, $170, $180)" ] }, { "kind": "WRITE", "substeps": [ "$10", "TO __stage0B_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.00966183574879227, "waitRatioMax": 0.00966183574879227, "writeMsAvg": "20", "writeMsMax": "20", "writeRatioAvg": 0.0966183574879227, "writeRatioMax": 0.0966183574879227 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.043478260869565216, "computeRatioMax": 0.043478260869565216, "endMs": "1665777788715", "id": "12", "name": "S0C: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.03864734299516908, "readRatioMax": 0.03864734299516908, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "348", "shuffleOutputBytesSpilled": "0", "slotMs": "30", "startMs": "1665777788688", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:s_county, $2:s_state", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage0C_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.00966183574879227, "waitRatioMax": 0.00966183574879227, "writeMsAvg": "12", "writeMsMax": "12", "writeRatioAvg": 0.057971014492753624, "writeRatioMax": 0.057971014492753624 }, { "completedParallelInputs": "1", "computeMsAvg": "34", "computeMsMax": "34", "computeRatioAvg": 0.1642512077294686, "computeRatioMax": 0.1642512077294686, "endMs": "1665777788746", "id": "13", "name": "S0D: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.043478260869565216, "readRatioMax": 0.043478260869565216, "recordsRead": "50000", "recordsWritten": "50000", "shuffleOutputBytes": "1712413", "shuffleOutputBytesSpilled": "0", "slotMs": "51", "startMs": "1665777788702", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ca_address_sk, $21:ca_county, $22:ca_state", "FROM customer_address" ] }, { "kind": "WRITE", "substeps": [ "$20, $21, $22", "TO __stage0D_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.00966183574879227, "waitRatioMax": 0.00966183574879227, "writeMsAvg": "10", "writeMsMax": "10", "writeRatioAvg": 0.04830917874396135, "writeRatioMax": 0.04830917874396135 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.04830917874396135, "computeRatioMax": 0.04830917874396135, "endMs": "1665777788769", "id": "15", "inputStages": [ "6" ], "name": "S0F: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1559", "recordsWritten": "1477", "shuffleOutputBytes": "26586", "shuffleOutputBytesSpilled": "0", "slotMs": "38", "startMs": "1665777788732", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$320, $321", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $330 := $320, $331 := $321" ] }, { "kind": "WRITE", "substeps": [ "$330, $331", "TO __stage0F_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.00966183574879227, "waitRatioMax": 0.00966183574879227, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.07246376811594203, "writeRatioMax": 0.07246376811594203 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "13", "computeRatioAvg": 0.033816425120772944, "computeRatioMax": 0.06280193236714976, "endMs": "1665777788842", "id": "16", "inputStages": [ "15" ], "name": "S10: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1477", "recordsWritten": "1477", "shuffleOutputBytes": "26586", "shuffleOutputBytesSpilled": "0", "slotMs": "2952", "startMs": "1665777788782", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0F_output" ] } ], "waitMsAvg": "4", "waitMsMax": "7", "waitRatioAvg": 0.01932367149758454, "waitRatioMax": 0.033816425120772944, "writeMsAvg": "14", "writeMsMax": "20", "writeRatioAvg": 0.06763285024154589, "writeRatioMax": 0.0966183574879227 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "14", "computeRatioAvg": 0.033816425120772944, "computeRatioMax": 0.06763285024154589, "endMs": "1665777788851", "id": "17", "inputStages": [ "11" ], "name": "S11: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "90", "recordsWritten": "90", "shuffleOutputBytes": "810", "shuffleOutputBytesSpilled": "0", "slotMs": "2687", "startMs": "1665777788784", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0B_output" ] } ], "waitMsAvg": "6", "waitMsMax": "10", "waitRatioAvg": 0.028985507246376812, "waitRatioMax": 0.04830917874396135, "writeMsAvg": "14", "writeMsMax": "29", "writeRatioAvg": 0.06763285024154589, "writeRatioMax": 0.14009661835748793 }, { "completedParallelInputs": "6", "computeMsAvg": "181", "computeMsMax": "207", "computeRatioAvg": 0.8743961352657005, "computeRatioMax": 1, "endMs": "1665777789002", "id": "18", "inputStages": [ "12", "17", "16", "13", "8", "10" ], "name": "S12: Join+", "parallelInputs": "6", "readMsAvg": "16", "readMsMax": "19", "readRatioAvg": 0.07729468599033816, "readRatioMax": 0.09178743961352658, "recordsRead": "3189890", "recordsWritten": "5", "shuffleOutputBytes": "130", "shuffleOutputBytesSpilled": "0", "slotMs": "1261", "startMs": "1665777788800", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$170", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$180", "FROM __stage08_output" ] }, { "kind": "READ", "substeps": [ "$30:ss_sold_date_sk, $31:ss_customer_sk, $32:ss_ext_sales_price", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$330, $331", "FROM __stage10_output" ] }, { "kind": "READ", "substeps": [ "$20, $21, $22", "FROM __stage0D_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage0C_output" ] }, { "kind": "READ", "substeps": [ "$10", "FROM __stage11_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $380 := $371", "$160 := SUM($370)" ] }, { "kind": "JOIN", "substeps": [ "$370 := $361, $371 := $362", "INNER HASH JOIN EACH WITH ALL ON $360 = $10" ] }, { "kind": "JOIN", "substeps": [ "$360 := $350, $361 := $351, $362 := $352", "INNER HASH JOIN EACH WITH ALL ON $353 = $1, $354 = $2" ] }, { "kind": "JOIN", "substeps": [ "$350 := $342, $351 := $343, $352 := $340, $353 := $21, $354 := $22", "INNER HASH JOIN EACH WITH ALL ON $341 = $20" ] }, { "kind": "JOIN", "substeps": [ "$342 := $30, $343 := $32, $340 := $330, $341 := $331", "INNER HASH JOIN EACH WITH ALL ON $31 = $330" ] }, { "kind": "WRITE", "substeps": [ "$380, $160", "TO __stage12_output", "BY HASH($380)" ] } ], "waitMsAvg": "5", "waitMsMax": "11", "waitRatioAvg": 0.024154589371980676, "waitRatioMax": 0.05314009661835749, "writeMsAvg": "6", "writeMsMax": "7", "writeRatioAvg": 0.028985507246376812, "writeRatioMax": 0.033816425120772944 }, { "completedParallelInputs": "1", "computeMsAvg": "4", "computeMsMax": "4", "computeRatioAvg": 0.01932367149758454, "computeRatioMax": 0.01932367149758454, "endMs": "1665777789056", "id": "19", "inputStages": [ "18" ], "name": "S13: Aggregate+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "5", "recordsWritten": "1", "shuffleOutputBytes": "18", "shuffleOutputBytesSpilled": "0", "slotMs": "22", "startMs": "1665777789022", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$380, $160", "FROM __stage12_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $400 := $140", "$130 := COUNT_STAR()" ] }, { "kind": "COMPUTE", "substeps": [ "$140 := CAST(divide($150, NUMERIC<...>) AS INT64)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $390 := $380", "$150 := SUM($160)" ] }, { "kind": "WRITE", "substeps": [ "$130, $400", "TO __stage13_output", "BY HASH($400)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.00966183574879227, "waitRatioMax": 0.00966183574879227, "writeMsAvg": "27", "writeMsMax": "27", "writeRatioAvg": 0.13043478260869565, "writeRatioMax": 0.13043478260869565 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.03864734299516908, "computeRatioMax": 0.03864734299516908, "endMs": "1665777789109", "id": "20", "inputStages": [ "19" ], "name": "S14: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "27", "shuffleOutputBytesSpilled": "0", "slotMs": "25", "startMs": "1665777789074", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$130, $400", "FROM __stage13_output" ] }, { "kind": "COMPUTE", "substeps": [ "$110 := multiply($421, 50)" ] }, { "kind": "SORT", "substeps": [ "$410 ASC, $120 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $410 := $400", "$120 := SUM_OF_COUNTS($130)" ] }, { "kind": "WRITE", "substeps": [ "$110, $420, $421", "TO __stage14_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.00966183574879227, "waitRatioMax": 0.00966183574879227, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.07246376811594203, "writeRatioMax": 0.07246376811594203 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.033816425120772944, "computeRatioMax": 0.033816425120772944, "endMs": "1665777789132", "id": "21", "inputStages": [ "20" ], "name": "S15: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "27", "shuffleOutputBytesSpilled": "0", "slotMs": "41", "startMs": "1665777789089", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$110, $420, $421", "FROM __stage14_output" ] }, { "kind": "SORT", "substeps": [ "$421 ASC, $420 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$430, $431, $432", "TO __stage15_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004830917874396135, "waitRatioMax": 0.004830917874396135, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.03864734299516908, "writeRatioMax": 0.03864734299516908 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "customer_address" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "item" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "customer" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "6", "completedUnits": "219", "elapsedMs": "656", "estimatedRunnableUnits": "0", "pendingUnits": "6", "totalSlotMs": "6970" }, { "activeUnits": "6", "completedUnits": "228", "elapsedMs": "931", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "8300" } ], "totalBytesBilled": "145752064", "totalBytesProcessed": "145522404", "totalPartitionsProcessed": "0", "totalSlotMs": "8300", "transferredBytes": "0" }, "startTime": "1665777788258", "totalBytesProcessed": "145522404", "totalSlotMs": "8300" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon2f94de2c_70a1_42ee_951a_964e85e84c6e" }, "priority": "INTERACTIVE", "query": "-- start query 54 in stream 0 using template query54.tpl\nwith my_customers as (\n select distinct c_customer_sk\n , c_current_addr_sk\n from \n ( select cs_sold_date_sk sold_date_sk,\n cs_bill_customer_sk customer_sk,\n cs_item_sk item_sk\n from catalog_sales\n union all\n select ws_sold_date_sk sold_date_sk,\n ws_bill_customer_sk customer_sk,\n ws_item_sk item_sk\n from web_sales\n ) cs_or_ws_sales,\n item,\n date_dim,\n customer\n where sold_date_sk = d_date_sk\n and item_sk = i_item_sk\n and i_category = 'Women'\n and i_class = 'maternity'\n and c_customer_sk = cs_or_ws_sales.customer_sk\n and d_moy = 12\n and d_year = 1998\n )\n , my_revenue as (\n select c_customer_sk,\n sum(ss_ext_sales_price) as revenue\n from my_customers,\n store_sales,\n customer_address,\n store,\n date_dim\n where c_current_addr_sk = ca_address_sk\n and ca_county = s_county\n and ca_state = s_state\n and ss_sold_date_sk = d_date_sk\n and c_customer_sk = ss_customer_sk\n and d_month_seq between (select distinct d_month_seq+1\n from date_dim where d_year = 1998 and d_moy = 12)\n and (select distinct d_month_seq+3\n from date_dim where d_year = 1998 and d_moy = 12)\n group by c_customer_sk\n )\n , segments as\n (select cast((revenue/50) as int) as segment\n from my_revenue\n )\n select segment, count(*) as num_customers, segment*50 as segment_base\n from segments\n group by segment\n order by segment, num_customers\n limit 100\n ;\n\n-- end query 54 in stream 0 using template query54.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "GmlpEQuokFiy/LCr31fYyw==", "id": "test-project-364309:europe-west1.query54_1665777790", "jobReference": { "jobId": "query54_1665777790", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query54_1665777790?location=europe-west1", "statistics": { "creationTime": "1665777790916", "endTime": "1665777792003", "finalExecutionDurationMs": "788", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "145522404", "performanceInsights": { "avgPreviousExecutionMs": "823" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "65", "computeMsMax": "65", "computeRatioAvg": 0.24253731343283583, "computeRatioMax": 0.24253731343283583, "endMs": "1665777791203", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.022388059701492536, "readRatioMax": 0.022388059701492536, "recordsRead": "100000", "recordsWritten": "100000", "shuffleOutputBytes": "1800000", "shuffleOutputBytesSpilled": "0", "slotMs": "68", "startMs": "1665777791154", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:c_customer_sk, $51:c_current_addr_sk", "FROM customer" ] }, { "kind": "WRITE", "substeps": [ "$50, $51", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0037313432835820895, "waitRatioMax": 0.0037313432835820895, "writeMsAvg": "11", "writeMsMax": "11", "writeRatioAvg": 0.041044776119402986, "writeRatioMax": 0.041044776119402986 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.04477611940298507, "computeRatioMax": 0.04477611940298507, "endMs": "1665777791207", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.022388059701492536, "readRatioMax": 0.022388059701492536, "recordsRead": "73049", "recordsWritten": "31", "shuffleOutputBytes": "279", "shuffleOutputBytesSpilled": "0", "slotMs": "41", "startMs": "1665777791170", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70:d_date_sk, $71:d_year, $72:d_moy", "FROM date_dim", "WHERE and(equal($72, 12), equal($71, 1998))" ] }, { "kind": "WRITE", "substeps": [ "$70", "TO __stage01_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.007462686567164179, "waitRatioMax": 0.007462686567164179, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.029850746268656716, "writeRatioMax": 0.029850746268656716 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.048507462686567165, "computeRatioMax": 0.048507462686567165, "endMs": "1665777791225", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.022388059701492536, "readRatioMax": 0.022388059701492536, "recordsRead": "18000", "recordsWritten": "417", "shuffleOutputBytes": "3753", "shuffleOutputBytesSpilled": "0", "slotMs": "37", "startMs": "1665777791184", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$100:i_item_sk, $101:i_class, $102:i_category", "FROM item", "WHERE and(equal($102, 'Women'), equal($101, 'maternity'))" ] }, { "kind": "WRITE", "substeps": [ "$100", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0037313432835820895, "waitRatioMax": 0.0037313432835820895, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.055970149253731345, "writeRatioMax": 0.055970149253731345 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.033582089552238806, "computeRatioMax": 0.033582089552238806, "endMs": "1665777791221", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.018656716417910446, "readRatioMax": 0.018656716417910446, "recordsRead": "73049", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "22", "startMs": "1665777791203", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:d_month_seq, $61:d_year, $62:d_moy", "FROM date_dim", "WHERE and(equal($61, 1998), equal($62, 12))" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $260 := $200" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := add($60, 3)" ] }, { "kind": "WRITE", "substeps": [ "$260", "TO __stage04_output", "BY HASH($260)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.007462686567164179, "waitRatioMax": 0.007462686567164179, "writeMsAvg": "4", "writeMsMax": "4", "writeRatioAvg": 0.014925373134328358, "writeRatioMax": 0.014925373134328358 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.033582089552238806, "computeRatioMax": 0.033582089552238806, "endMs": "1665777791228", "id": "5", "name": "S05: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.029850746268656716, "readRatioMax": 0.029850746268656716, "recordsRead": "73049", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "28", "startMs": "1665777791208", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_month_seq, $41:d_year, $42:d_moy", "FROM date_dim", "WHERE and(equal($41, 1998), equal($42, 12))" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $230 := $190" ] }, { "kind": "COMPUTE", "substeps": [ "$190 := add($40, 1)" ] }, { "kind": "WRITE", "substeps": [ "$230", "TO __stage05_output", "BY HASH($230)" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.011194029850746268, "waitRatioMax": 0.011194029850746268, "writeMsAvg": "3", "writeMsMax": "3", "writeRatioAvg": 0.011194029850746268, "writeRatioMax": 0.011194029850746268 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.041044776119402986, "computeRatioMax": 0.041044776119402986, "endMs": "1665777791265", "id": "6", "inputStages": [ "4" ], "name": "S06: Aggregate+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "37", "startMs": "1665777791225", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$260", "FROM __stage04_output" ] }, { "kind": "LIMIT", "substeps": [ "2" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $270 := $260" ] }, { "kind": "WRITE", "substeps": [ "$270", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0037313432835820895, "waitRatioMax": 0.0037313432835820895, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.06343283582089553, "writeRatioMax": 0.06343283582089553 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.026119402985074626, "computeRatioMax": 0.026119402985074626, "endMs": "1665777791283", "id": "7", "inputStages": [ "6" ], "name": "S07: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "60", "startMs": "1665777791229", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$270", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "$180 := ANY_AND_CHECK($270)" ] }, { "kind": "WRITE", "substeps": [ "$180", "TO __stage07_output" ] } ], "waitMsAvg": "5", "waitMsMax": "5", "waitRatioAvg": 0.018656716417910446, "waitRatioMax": 0.018656716417910446, "writeMsAvg": "3", "writeMsMax": "3", "writeRatioAvg": 0.011194029850746268, "writeRatioMax": 0.011194029850746268 }, { "completedParallelInputs": "6", "computeMsAvg": "147", "computeMsMax": "213", "computeRatioAvg": 0.5485074626865671, "computeRatioMax": 0.7947761194029851, "endMs": "1665777791379", "id": "8", "inputStages": [ "0", "2", "1" ], "name": "S08: Join+", "parallelInputs": "6", "readMsAvg": "12", "readMsMax": "14", "readRatioAvg": 0.04477611940298507, "readRatioMax": 0.05223880597014925, "recordsRead": "2763620", "recordsWritten": "1559", "shuffleOutputBytes": "28062", "shuffleOutputBytesSpilled": "0", "slotMs": "944", "startMs": "1665777791251", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:cs_sold_date_sk, $81:cs_bill_customer_sk, $82:cs_item_sk", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$90:ws_sold_date_sk, $91:ws_item_sk, $92:ws_bill_customer_sk", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$100", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$70", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$50, $51", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $320 := $310, $321 := $311" ] }, { "kind": "JOIN", "substeps": [ "$310 := $50, $311 := $51", "INNER HASH JOIN EACH WITH ALL ON $300 = $50" ] }, { "kind": "JOIN", "substeps": [ "$300 := $291", "INNER HASH JOIN EACH WITH ALL ON $290 = $70" ] }, { "kind": "JOIN", "substeps": [ "$290 := $210, $291 := $211", "INNER HASH JOIN EACH WITH ALL ON $212 = $100" ] }, { "kind": "WRITE", "substeps": [ "$320, $321", "TO __stage08_output", "BY HASH($320, $321)" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.007462686567164179, "waitRatioMax": 0.011194029850746268, "writeMsAvg": "6", "writeMsMax": "8", "writeRatioAvg": 0.022388059701492536, "writeRatioMax": 0.029850746268656716 }, { "completedParallelInputs": "1", "computeMsAvg": "5", "computeMsMax": "5", "computeRatioAvg": 0.018656716417910446, "computeRatioMax": 0.018656716417910446, "endMs": "1665777791284", "id": "9", "inputStages": [ "5" ], "name": "S09: Aggregate+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "28", "startMs": "1665777791252", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$230", "FROM __stage05_output" ] }, { "kind": "LIMIT", "substeps": [ "2" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $240 := $230" ] }, { "kind": "WRITE", "substeps": [ "$240", "TO __stage09_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0037313432835820895, "waitRatioMax": 0.0037313432835820895, "writeMsAvg": "25", "writeMsMax": "25", "writeRatioAvg": 0.09328358208955224, "writeRatioMax": 0.09328358208955224 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.029850746268656716, "computeRatioMax": 0.029850746268656716, "endMs": "1665777791291", "id": "10", "inputStages": [ "9" ], "name": "S0A: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "39", "startMs": "1665777791252", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$240", "FROM __stage09_output" ] }, { "kind": "AGGREGATE", "substeps": [ "$170 := ANY_AND_CHECK($240)" ] }, { "kind": "WRITE", "substeps": [ "$170", "TO __stage0A_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0037313432835820895, "waitRatioMax": 0.0037313432835820895, "writeMsAvg": "1", "writeMsMax": "1", "writeRatioAvg": 0.0037313432835820895, "writeRatioMax": 0.0037313432835820895 }, { "completedParallelInputs": "1", "computeMsAvg": "21", "computeMsMax": "21", "computeRatioAvg": 0.07835820895522388, "computeRatioMax": 0.07835820895522388, "endMs": "1665777791469", "id": "11", "name": "S0B: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.018656716417910446, "readRatioMax": 0.018656716417910446, "recordsRead": "73051", "recordsWritten": "90", "shuffleOutputBytes": "810", "shuffleOutputBytesSpilled": "0", "slotMs": "65", "startMs": "1665777791417", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$180", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$170", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_month_seq", "FROM date_dim" ] }, { "kind": "FILTER", "substeps": [ "between($11, $170, $180)" ] }, { "kind": "WRITE", "substeps": [ "$10", "TO __stage0B_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0037313432835820895, "waitRatioMax": 0.0037313432835820895, "writeMsAvg": "20", "writeMsMax": "20", "writeRatioAvg": 0.07462686567164178, "writeRatioMax": 0.07462686567164178 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.041044776119402986, "computeRatioMax": 0.041044776119402986, "endMs": "1665777791476", "id": "12", "name": "S0C: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.022388059701492536, "readRatioMax": 0.022388059701492536, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "348", "shuffleOutputBytesSpilled": "0", "slotMs": "40", "startMs": "1665777791434", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:s_county, $2:s_state", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage0C_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0037313432835820895, "waitRatioMax": 0.0037313432835820895, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.06716417910447761, "writeRatioMax": 0.06716417910447761 }, { "completedParallelInputs": "1", "computeMsAvg": "38", "computeMsMax": "38", "computeRatioAvg": 0.1417910447761194, "computeRatioMax": 0.1417910447761194, "endMs": "1665777791486", "id": "13", "name": "S0D: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.022388059701492536, "readRatioMax": 0.022388059701492536, "recordsRead": "50000", "recordsWritten": "50000", "shuffleOutputBytes": "1712413", "shuffleOutputBytesSpilled": "0", "slotMs": "47", "startMs": "1665777791448", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ca_address_sk, $21:ca_county, $22:ca_state", "FROM customer_address" ] }, { "kind": "WRITE", "substeps": [ "$20, $21, $22", "TO __stage0D_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0037313432835820895, "waitRatioMax": 0.0037313432835820895, "writeMsAvg": "11", "writeMsMax": "11", "writeRatioAvg": 0.041044776119402986, "writeRatioMax": 0.041044776119402986 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.03731343283582089, "computeRatioMax": 0.03731343283582089, "endMs": "1665777791514", "id": "15", "inputStages": [ "8" ], "name": "S0F: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1559", "recordsWritten": "1477", "shuffleOutputBytes": "26586", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665777791475", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$320, $321", "FROM __stage08_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $330 := $320, $331 := $321" ] }, { "kind": "WRITE", "substeps": [ "$330, $331", "TO __stage0F_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0037313432835820895, "waitRatioMax": 0.0037313432835820895, "writeMsAvg": "30", "writeMsMax": "30", "writeRatioAvg": 0.11194029850746269, "writeRatioMax": 0.11194029850746269 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "22", "computeRatioAvg": 0.029850746268656716, "computeRatioMax": 0.08208955223880597, "endMs": "1665777791580", "id": "16", "inputStages": [ "15" ], "name": "S10: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1477", "recordsWritten": "1477", "shuffleOutputBytes": "26586", "shuffleOutputBytesSpilled": "0", "slotMs": "3374", "startMs": "1665777791530", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0F_output" ] } ], "waitMsAvg": "2", "waitMsMax": "7", "waitRatioAvg": 0.007462686567164179, "waitRatioMax": 0.026119402985074626, "writeMsAvg": "15", "writeMsMax": "22", "writeRatioAvg": 0.055970149253731345, "writeRatioMax": 0.08208955223880597 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "15", "computeRatioAvg": 0.029850746268656716, "computeRatioMax": 0.055970149253731345, "endMs": "1665777791586", "id": "17", "inputStages": [ "11" ], "name": "S11: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "90", "recordsWritten": "90", "shuffleOutputBytes": "810", "shuffleOutputBytesSpilled": "0", "slotMs": "3124", "startMs": "1665777791531", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0B_output" ] } ], "waitMsAvg": "6", "waitMsMax": "9", "waitRatioAvg": 0.022388059701492536, "waitRatioMax": 0.033582089552238806, "writeMsAvg": "14", "writeMsMax": "26", "writeRatioAvg": 0.05223880597014925, "writeRatioMax": 0.09701492537313433 }, { "completedParallelInputs": "6", "computeMsAvg": "203", "computeMsMax": "268", "computeRatioAvg": 0.7574626865671642, "computeRatioMax": 1, "endMs": "1665777791766", "id": "18", "inputStages": [ "16", "12", "13", "17", "10", "7" ], "name": "S12: Join+", "parallelInputs": "6", "readMsAvg": "17", "readMsMax": "21", "readRatioAvg": 0.06343283582089553, "readRatioMax": 0.07835820895522388, "recordsRead": "3189890", "recordsWritten": "5", "shuffleOutputBytes": "130", "shuffleOutputBytesSpilled": "0", "slotMs": "1230", "startMs": "1665777791547", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$170", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$180", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$30:ss_sold_date_sk, $31:ss_customer_sk, $32:ss_ext_sales_price", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$330, $331", "FROM __stage10_output" ] }, { "kind": "READ", "substeps": [ "$20, $21, $22", "FROM __stage0D_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage0C_output" ] }, { "kind": "READ", "substeps": [ "$10", "FROM __stage11_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $380 := $371", "$160 := SUM($370)" ] }, { "kind": "JOIN", "substeps": [ "$370 := $361, $371 := $362", "INNER HASH JOIN EACH WITH ALL ON $360 = $10" ] }, { "kind": "JOIN", "substeps": [ "$360 := $350, $361 := $351, $362 := $352", "INNER HASH JOIN EACH WITH ALL ON $353 = $1, $354 = $2" ] }, { "kind": "JOIN", "substeps": [ "$350 := $342, $351 := $343, $352 := $340, $353 := $21, $354 := $22", "INNER HASH JOIN EACH WITH ALL ON $341 = $20" ] }, { "kind": "JOIN", "substeps": [ "$342 := $30, $343 := $32, $340 := $330, $341 := $331", "INNER HASH JOIN EACH WITH ALL ON $31 = $330" ] }, { "kind": "WRITE", "substeps": [ "$380, $160", "TO __stage12_output", "BY HASH($380)" ] } ], "waitMsAvg": "2", "waitMsMax": "4", "waitRatioAvg": 0.007462686567164179, "waitRatioMax": 0.014925373134328358, "writeMsAvg": "5", "writeMsMax": "7", "writeRatioAvg": 0.018656716417910446, "writeRatioMax": 0.026119402985074626 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.05223880597014925, "computeRatioMax": 0.05223880597014925, "endMs": "1665777791841", "id": "19", "inputStages": [ "18" ], "name": "S13: Aggregate+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "5", "recordsWritten": "1", "shuffleOutputBytes": "18", "shuffleOutputBytesSpilled": "0", "slotMs": "44", "startMs": "1665777791799", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$380, $160", "FROM __stage12_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $400 := $140", "$130 := COUNT_STAR()" ] }, { "kind": "COMPUTE", "substeps": [ "$140 := CAST(divide($150, NUMERIC<...>) AS INT64)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $390 := $380", "$150 := SUM($160)" ] }, { "kind": "WRITE", "substeps": [ "$130, $400", "TO __stage13_output", "BY HASH($400)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0037313432835820895, "waitRatioMax": 0.0037313432835820895, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.055970149253731345, "writeRatioMax": 0.055970149253731345 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.029850746268656716, "computeRatioMax": 0.029850746268656716, "endMs": "1665777791881", "id": "20", "inputStages": [ "19" ], "name": "S14: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "27", "shuffleOutputBytesSpilled": "0", "slotMs": "33", "startMs": "1665777791849", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$130, $400", "FROM __stage13_output" ] }, { "kind": "COMPUTE", "substeps": [ "$110 := multiply($421, 50)" ] }, { "kind": "SORT", "substeps": [ "$410 ASC, $120 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $410 := $400", "$120 := SUM_OF_COUNTS($130)" ] }, { "kind": "WRITE", "substeps": [ "$110, $420, $421", "TO __stage14_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0037313432835820895, "waitRatioMax": 0.0037313432835820895, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.048507462686567165, "writeRatioMax": 0.048507462686567165 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.029850746268656716, "computeRatioMax": 0.029850746268656716, "endMs": "1665777791909", "id": "21", "inputStages": [ "20" ], "name": "S15: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "27", "shuffleOutputBytesSpilled": "0", "slotMs": "25", "startMs": "1665777791874", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$110, $420, $421", "FROM __stage14_output" ] }, { "kind": "SORT", "substeps": [ "$421 ASC, $420 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$430, $431, $432", "TO __stage15_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.007462686567164179, "waitRatioMax": 0.007462686567164179, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.05223880597014925, "writeRatioMax": 0.05223880597014925 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "item" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "customer_address" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "customer" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "6", "completedUnits": "219", "elapsedMs": "681", "estimatedRunnableUnits": "0", "pendingUnits": "6", "totalSlotMs": "7996" }, { "activeUnits": "6", "completedUnits": "228", "elapsedMs": "978", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "9328" } ], "totalBytesBilled": "145752064", "totalBytesProcessed": "145522404", "totalPartitionsProcessed": "0", "totalSlotMs": "9328", "transferredBytes": "0" }, "startTime": "1665777790975", "totalBytesProcessed": "145522404", "totalSlotMs": "9328" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anonaf0ef37a_57d2_4901_9d6b_7f06a8cc3f48" }, "priority": "INTERACTIVE", "query": "-- start query 54 in stream 0 using template query54.tpl\nwith my_customers as (\n select distinct c_customer_sk\n , c_current_addr_sk\n from \n ( select cs_sold_date_sk sold_date_sk,\n cs_bill_customer_sk customer_sk,\n cs_item_sk item_sk\n from catalog_sales\n union all\n select ws_sold_date_sk sold_date_sk,\n ws_bill_customer_sk customer_sk,\n ws_item_sk item_sk\n from web_sales\n ) cs_or_ws_sales,\n item,\n date_dim,\n customer\n where sold_date_sk = d_date_sk\n and item_sk = i_item_sk\n and i_category = 'Women'\n and i_class = 'maternity'\n and c_customer_sk = cs_or_ws_sales.customer_sk\n and d_moy = 12\n and d_year = 1998\n )\n , my_revenue as (\n select c_customer_sk,\n sum(ss_ext_sales_price) as revenue\n from my_customers,\n store_sales,\n customer_address,\n store,\n date_dim\n where c_current_addr_sk = ca_address_sk\n and ca_county = s_county\n and ca_state = s_state\n and ss_sold_date_sk = d_date_sk\n and c_customer_sk = ss_customer_sk\n and d_month_seq between (select distinct d_month_seq+1\n from date_dim where d_year = 1998 and d_moy = 12)\n and (select distinct d_month_seq+3\n from date_dim where d_year = 1998 and d_moy = 12)\n group by c_customer_sk\n )\n , segments as\n (select cast((revenue/50) as int) as segment\n from my_revenue\n )\n select segment, count(*) as num_customers, segment*50 as segment_base\n from segments\n group by segment\n order by segment, num_customers\n limit 100\n ;\n\n-- end query 54 in stream 0 using template query54.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "OUkMSwu4L15qsfUs/t8keA==", "id": "test-project-364309:europe-west1.query54_1665777793", "jobReference": { "jobId": "query54_1665777793", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query54_1665777793?location=europe-west1", "statistics": { "creationTime": "1665777793658", "endTime": "1665777794697", "finalExecutionDurationMs": "748", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "145522404", "performanceInsights": { "avgPreviousExecutionMs": "819" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "42", "computeMsMax": "42", "computeRatioAvg": 0.19534883720930232, "computeRatioMax": 0.19534883720930232, "endMs": "1665777793938", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.027906976744186046, "readRatioMax": 0.027906976744186046, "recordsRead": "100000", "recordsWritten": "100000", "shuffleOutputBytes": "1800000", "shuffleOutputBytesSpilled": "0", "slotMs": "45", "startMs": "1665777793896", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:c_customer_sk, $51:c_current_addr_sk", "FROM customer" ] }, { "kind": "WRITE", "substeps": [ "$50, $51", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004651162790697674, "waitRatioMax": 0.004651162790697674, "writeMsAvg": "9", "writeMsMax": "9", "writeRatioAvg": 0.04186046511627907, "writeRatioMax": 0.04186046511627907 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.05116279069767442, "computeRatioMax": 0.05116279069767442, "endMs": "1665777793940", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.04186046511627907, "readRatioMax": 0.04186046511627907, "recordsRead": "73049", "recordsWritten": "31", "shuffleOutputBytes": "279", "shuffleOutputBytesSpilled": "0", "slotMs": "24", "startMs": "1665777793915", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70:d_date_sk, $71:d_year, $72:d_moy", "FROM date_dim", "WHERE and(equal($72, 12), equal($71, 1998))" ] }, { "kind": "WRITE", "substeps": [ "$70", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004651162790697674, "waitRatioMax": 0.004651162790697674, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.037209302325581395, "writeRatioMax": 0.037209302325581395 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.037209302325581395, "computeRatioMax": 0.037209302325581395, "endMs": "1665777793957", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.023255813953488372, "readRatioMax": 0.023255813953488372, "recordsRead": "18000", "recordsWritten": "417", "shuffleOutputBytes": "3753", "shuffleOutputBytesSpilled": "0", "slotMs": "27", "startMs": "1665777793930", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$100:i_item_sk, $101:i_class, $102:i_category", "FROM item", "WHERE and(equal($102, 'Women'), equal($101, 'maternity'))" ] }, { "kind": "WRITE", "substeps": [ "$100", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004651162790697674, "waitRatioMax": 0.004651162790697674, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.06976744186046512, "writeRatioMax": 0.06976744186046512 }, { "completedParallelInputs": "1", "computeMsAvg": "6", "computeMsMax": "6", "computeRatioAvg": 0.027906976744186046, "computeRatioMax": 0.027906976744186046, "endMs": "1665777793961", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.018604651162790697, "readRatioMax": 0.018604651162790697, "recordsRead": "73049", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "13", "startMs": "1665777793947", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:d_month_seq, $61:d_year, $62:d_moy", "FROM date_dim", "WHERE and(equal($61, 1998), equal($62, 12))" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $260 := $200" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := add($60, 3)" ] }, { "kind": "WRITE", "substeps": [ "$260", "TO __stage04_output", "BY HASH($260)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004651162790697674, "waitRatioMax": 0.004651162790697674, "writeMsAvg": "4", "writeMsMax": "4", "writeRatioAvg": 0.018604651162790697, "writeRatioMax": 0.018604651162790697 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.037209302325581395, "computeRatioMax": 0.037209302325581395, "endMs": "1665777793971", "id": "5", "name": "S05: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.023255813953488372, "readRatioMax": 0.023255813953488372, "recordsRead": "73049", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "19", "startMs": "1665777793952", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_month_seq, $41:d_year, $42:d_moy", "FROM date_dim", "WHERE and(equal($41, 1998), equal($42, 12))" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $230 := $190" ] }, { "kind": "COMPUTE", "substeps": [ "$190 := add($40, 1)" ] }, { "kind": "WRITE", "substeps": [ "$230", "TO __stage05_output", "BY HASH($230)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004651162790697674, "waitRatioMax": 0.004651162790697674, "writeMsAvg": "5", "writeMsMax": "5", "writeRatioAvg": 0.023255813953488372, "writeRatioMax": 0.023255813953488372 }, { "completedParallelInputs": "6", "computeMsAvg": "137", "computeMsMax": "197", "computeRatioAvg": 0.6372093023255814, "computeRatioMax": 0.9162790697674419, "endMs": "1665777794116", "id": "6", "inputStages": [ "2", "1", "0" ], "name": "S06: Join+", "parallelInputs": "6", "readMsAvg": "12", "readMsMax": "15", "readRatioAvg": 0.05581395348837209, "readRatioMax": 0.06976744186046512, "recordsRead": "2763620", "recordsWritten": "1559", "shuffleOutputBytes": "28062", "shuffleOutputBytesSpilled": "0", "slotMs": "832", "startMs": "1665777793976", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:cs_sold_date_sk, $81:cs_bill_customer_sk, $82:cs_item_sk", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$90:ws_sold_date_sk, $91:ws_item_sk, $92:ws_bill_customer_sk", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$100", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$70", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$50, $51", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $320 := $310, $321 := $311" ] }, { "kind": "JOIN", "substeps": [ "$310 := $50, $311 := $51", "INNER HASH JOIN EACH WITH ALL ON $300 = $50" ] }, { "kind": "JOIN", "substeps": [ "$300 := $291", "INNER HASH JOIN EACH WITH ALL ON $290 = $70" ] }, { "kind": "JOIN", "substeps": [ "$290 := $210, $291 := $211", "INNER HASH JOIN EACH WITH ALL ON $212 = $100" ] }, { "kind": "WRITE", "substeps": [ "$320, $321", "TO __stage06_output", "BY HASH($320, $321)" ] } ], "waitMsAvg": "1", "waitMsMax": "3", "waitRatioAvg": 0.004651162790697674, "waitRatioMax": 0.013953488372093023, "writeMsAvg": "7", "writeMsMax": "8", "writeRatioAvg": 0.03255813953488372, "writeRatioMax": 0.037209302325581395 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.05581395348837209, "computeRatioMax": 0.05581395348837209, "endMs": "1665777794015", "id": "7", "inputStages": [ "4" ], "name": "S07: Aggregate+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "27", "startMs": "1665777793977", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$260", "FROM __stage04_output" ] }, { "kind": "LIMIT", "substeps": [ "2" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $270 := $260" ] }, { "kind": "WRITE", "substeps": [ "$270", "TO __stage07_output" ] } ], "waitMsAvg": "0", "waitMsMax": "0", "waitRatioAvg": 0, "waitRatioMax": 0, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.06976744186046512, "writeRatioMax": 0.06976744186046512 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.03255813953488372, "computeRatioMax": 0.03255813953488372, "endMs": "1665777794035", "id": "8", "inputStages": [ "7" ], "name": "S08: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "54", "startMs": "1665777793979", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$270", "FROM __stage07_output" ] }, { "kind": "AGGREGATE", "substeps": [ "$180 := ANY_AND_CHECK($270)" ] }, { "kind": "WRITE", "substeps": [ "$180", "TO __stage08_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004651162790697674, "waitRatioMax": 0.004651162790697674, "writeMsAvg": "4", "writeMsMax": "4", "writeRatioAvg": 0.018604651162790697, "writeRatioMax": 0.018604651162790697 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.06046511627906977, "computeRatioMax": 0.06046511627906977, "endMs": "1665777794023", "id": "9", "inputStages": [ "5" ], "name": "S09: Aggregate+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "41", "startMs": "1665777793983", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$230", "FROM __stage05_output" ] }, { "kind": "LIMIT", "substeps": [ "2" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $240 := $230" ] }, { "kind": "WRITE", "substeps": [ "$240", "TO __stage09_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004651162790697674, "waitRatioMax": 0.004651162790697674, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.06046511627906977, "writeRatioMax": 0.06046511627906977 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.037209302325581395, "computeRatioMax": 0.037209302325581395, "endMs": "1665777794035", "id": "10", "inputStages": [ "9" ], "name": "S0A: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "9", "shuffleOutputBytesSpilled": "0", "slotMs": "38", "startMs": "1665777793985", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$240", "FROM __stage09_output" ] }, { "kind": "AGGREGATE", "substeps": [ "$170 := ANY_AND_CHECK($240)" ] }, { "kind": "WRITE", "substeps": [ "$170", "TO __stage0A_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.013953488372093023, "waitRatioMax": 0.013953488372093023, "writeMsAvg": "2", "writeMsMax": "2", "writeRatioAvg": 0.009302325581395349, "writeRatioMax": 0.009302325581395349 }, { "completedParallelInputs": "1", "computeMsAvg": "18", "computeMsMax": "18", "computeRatioAvg": 0.08372093023255814, "computeRatioMax": 0.08372093023255814, "endMs": "1665777794186", "id": "11", "name": "S0B: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.037209302325581395, "readRatioMax": 0.037209302325581395, "recordsRead": "73051", "recordsWritten": "90", "shuffleOutputBytes": "810", "shuffleOutputBytesSpilled": "0", "slotMs": "38", "startMs": "1665777794142", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$180", "FROM __stage08_output" ] }, { "kind": "READ", "substeps": [ "$170", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_month_seq", "FROM date_dim" ] }, { "kind": "FILTER", "substeps": [ "between($11, $170, $180)" ] }, { "kind": "WRITE", "substeps": [ "$10", "TO __stage0B_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004651162790697674, "waitRatioMax": 0.004651162790697674, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.08372093023255814, "writeRatioMax": 0.08372093023255814 }, { "completedParallelInputs": "1", "computeMsAvg": "6", "computeMsMax": "6", "computeRatioAvg": 0.027906976744186046, "computeRatioMax": 0.027906976744186046, "endMs": "1665777794194", "id": "12", "name": "S0C: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.018604651162790697, "readRatioMax": 0.018604651162790697, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "348", "shuffleOutputBytesSpilled": "0", "slotMs": "25", "startMs": "1665777794158", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:s_county, $2:s_state", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage0C_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004651162790697674, "waitRatioMax": 0.004651162790697674, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.06511627906976744, "writeRatioMax": 0.06511627906976744 }, { "completedParallelInputs": "1", "computeMsAvg": "45", "computeMsMax": "45", "computeRatioAvg": 0.20930232558139536, "computeRatioMax": 0.20930232558139536, "endMs": "1665777794227", "id": "13", "name": "S0D: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.04186046511627907, "readRatioMax": 0.04186046511627907, "recordsRead": "50000", "recordsWritten": "50000", "shuffleOutputBytes": "1712413", "shuffleOutputBytesSpilled": "0", "slotMs": "71", "startMs": "1665777794174", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ca_address_sk, $21:ca_county, $22:ca_state", "FROM customer_address" ] }, { "kind": "WRITE", "substeps": [ "$20, $21, $22", "TO __stage0D_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.009302325581395349, "waitRatioMax": 0.009302325581395349, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.06976744186046512, "writeRatioMax": 0.06976744186046512 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.037209302325581395, "computeRatioMax": 0.037209302325581395, "endMs": "1665777794238", "id": "15", "inputStages": [ "6" ], "name": "S0F: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1559", "recordsWritten": "1477", "shuffleOutputBytes": "26586", "shuffleOutputBytesSpilled": "0", "slotMs": "37", "startMs": "1665777794203", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$320, $321", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $330 := $320, $331 := $321" ] }, { "kind": "WRITE", "substeps": [ "$330, $331", "TO __stage0F_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004651162790697674, "waitRatioMax": 0.004651162790697674, "writeMsAvg": "26", "writeMsMax": "26", "writeRatioAvg": 0.12093023255813953, "writeRatioMax": 0.12093023255813953 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "17", "computeRatioAvg": 0.037209302325581395, "computeRatioMax": 0.07906976744186046, "endMs": "1665777794298", "id": "16", "inputStages": [ "15" ], "name": "S10: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1477", "recordsWritten": "1477", "shuffleOutputBytes": "26586", "shuffleOutputBytesSpilled": "0", "slotMs": "3433", "startMs": "1665777794242", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0F_output" ] } ], "waitMsAvg": "2", "waitMsMax": "5", "waitRatioAvg": 0.009302325581395349, "waitRatioMax": 0.023255813953488372, "writeMsAvg": "15", "writeMsMax": "25", "writeRatioAvg": 0.06976744186046512, "writeRatioMax": 0.11627906976744186 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "17", "computeRatioAvg": 0.037209302325581395, "computeRatioMax": 0.07906976744186046, "endMs": "1665777794300", "id": "17", "inputStages": [ "11" ], "name": "S11: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "90", "recordsWritten": "90", "shuffleOutputBytes": "810", "shuffleOutputBytesSpilled": "0", "slotMs": "3200", "startMs": "1665777794243", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0B_output" ] } ], "waitMsAvg": "5", "waitMsMax": "12", "waitRatioAvg": 0.023255813953488372, "waitRatioMax": 0.05581395348837209, "writeMsAvg": "14", "writeMsMax": "21", "writeRatioAvg": 0.06511627906976744, "writeRatioMax": 0.09767441860465116 }, { "completedParallelInputs": "6", "computeMsAvg": "189", "computeMsMax": "215", "computeRatioAvg": 0.8790697674418605, "computeRatioMax": 1, "endMs": "1665777794465", "id": "18", "inputStages": [ "13", "12", "17", "10", "8", "16" ], "name": "S12: Join+", "parallelInputs": "6", "readMsAvg": "17", "readMsMax": "24", "readRatioAvg": 0.07906976744186046, "readRatioMax": 0.11162790697674418, "recordsRead": "3189890", "recordsWritten": "5", "shuffleOutputBytes": "130", "shuffleOutputBytesSpilled": "0", "slotMs": "1304", "startMs": "1665777794258", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$170", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$180", "FROM __stage08_output" ] }, { "kind": "READ", "substeps": [ "$30:ss_sold_date_sk, $31:ss_customer_sk, $32:ss_ext_sales_price", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$330, $331", "FROM __stage10_output" ] }, { "kind": "READ", "substeps": [ "$20, $21, $22", "FROM __stage0D_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage0C_output" ] }, { "kind": "READ", "substeps": [ "$10", "FROM __stage11_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $380 := $371", "$160 := SUM($370)" ] }, { "kind": "JOIN", "substeps": [ "$370 := $361, $371 := $362", "INNER HASH JOIN EACH WITH ALL ON $360 = $10" ] }, { "kind": "JOIN", "substeps": [ "$360 := $350, $361 := $351, $362 := $352", "INNER HASH JOIN EACH WITH ALL ON $353 = $1, $354 = $2" ] }, { "kind": "JOIN", "substeps": [ "$350 := $342, $351 := $343, $352 := $340, $353 := $21, $354 := $22", "INNER HASH JOIN EACH WITH ALL ON $341 = $20" ] }, { "kind": "JOIN", "substeps": [ "$342 := $30, $343 := $32, $340 := $330, $341 := $331", "INNER HASH JOIN EACH WITH ALL ON $31 = $330" ] }, { "kind": "WRITE", "substeps": [ "$380, $160", "TO __stage12_output", "BY HASH($380)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004651162790697674, "waitRatioMax": 0.004651162790697674, "writeMsAvg": "7", "writeMsMax": "10", "writeRatioAvg": 0.03255813953488372, "writeRatioMax": 0.046511627906976744 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.03255813953488372, "computeRatioMax": 0.03255813953488372, "endMs": "1665777794542", "id": "19", "inputStages": [ "18" ], "name": "S13: Aggregate+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "5", "recordsWritten": "1", "shuffleOutputBytes": "18", "shuffleOutputBytesSpilled": "0", "slotMs": "33", "startMs": "1665777794495", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$380, $160", "FROM __stage12_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $400 := $140", "$130 := COUNT_STAR()" ] }, { "kind": "COMPUTE", "substeps": [ "$140 := CAST(divide($150, NUMERIC<...>) AS INT64)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $390 := $380", "$150 := SUM($160)" ] }, { "kind": "WRITE", "substeps": [ "$130, $400", "TO __stage13_output", "BY HASH($400)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004651162790697674, "waitRatioMax": 0.004651162790697674, "writeMsAvg": "28", "writeMsMax": "28", "writeRatioAvg": 0.13023255813953488, "writeRatioMax": 0.13023255813953488 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.05116279069767442, "computeRatioMax": 0.05116279069767442, "endMs": "1665777794589", "id": "20", "inputStages": [ "19" ], "name": "S14: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "27", "shuffleOutputBytesSpilled": "0", "slotMs": "41", "startMs": "1665777794553", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$130, $400", "FROM __stage13_output" ] }, { "kind": "COMPUTE", "substeps": [ "$110 := multiply($421, 50)" ] }, { "kind": "SORT", "substeps": [ "$410 ASC, $120 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $410 := $400", "$120 := SUM_OF_COUNTS($130)" ] }, { "kind": "WRITE", "substeps": [ "$110, $420, $421", "TO __stage14_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.009302325581395349, "waitRatioMax": 0.009302325581395349, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.06046511627906977, "writeRatioMax": 0.06046511627906977 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.037209302325581395, "computeRatioMax": 0.037209302325581395, "endMs": "1665777794597", "id": "21", "inputStages": [ "20" ], "name": "S15: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1", "recordsWritten": "1", "shuffleOutputBytes": "27", "shuffleOutputBytesSpilled": "0", "slotMs": "26", "startMs": "1665777794568", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$110, $420, $421", "FROM __stage14_output" ] }, { "kind": "SORT", "substeps": [ "$421 ASC, $420 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$430, $431, $432", "TO __stage15_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.009302325581395349, "waitRatioMax": 0.009302325581395349, "writeMsAvg": "6", "writeMsMax": "6", "writeRatioAvg": 0.027906976744186046, "writeRatioMax": 0.027906976744186046 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "item" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "customer" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "customer_address" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "5", "completedUnits": "220", "elapsedMs": "688", "estimatedRunnableUnits": "0", "pendingUnits": "5", "totalSlotMs": "8235" }, { "activeUnits": "5", "completedUnits": "228", "elapsedMs": "934", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "9221" } ], "totalBytesBilled": "145752064", "totalBytesProcessed": "145522404", "totalPartitionsProcessed": "0", "totalSlotMs": "9221", "transferredBytes": "0" }, "startTime": "1665777793710", "totalBytesProcessed": "145522404", "totalSlotMs": "9221" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
