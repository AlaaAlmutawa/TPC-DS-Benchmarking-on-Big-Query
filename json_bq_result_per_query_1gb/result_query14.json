{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon9bbf73b2_c7b3_4895_ac35_7305d8cd6879" }, "priority": "INTERACTIVE", "query": "with cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n ,iss.i_class_id class_id\n ,iss.i_category_id category_id\n from store_sales\n ,item iss\n ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n and ss_sold_date_sk = d1.d_date_sk\n and d1.d_year between 1999 AND 1999 + 2\n intersect distinct\n select ics.i_brand_id\n ,ics.i_class_id\n ,ics.i_category_id\n from catalog_sales\n ,item ics\n ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n and cs_sold_date_sk = d2.d_date_sk\n and d2.d_year between 1999 AND 1999 + 2\n intersect distinct\n select iws.i_brand_id\n ,iws.i_class_id\n ,iws.i_category_id\n from web_sales\n ,item iws\n ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n and ws_sold_date_sk = d3.d_date_sk\n and d3.d_year between 1999 AND 1999 + 2)\n where i_brand_id = brand_id\n and i_class_id = class_id\n and i_category_id = category_id\n),\n avg_sales as\n (select avg(quantity*list_price) average_sales\n from (select ss_quantity quantity\n ,ss_list_price list_price\n from store_sales\n ,date_dim\n where ss_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2\n union all \n select cs_quantity quantity \n ,cs_list_price list_price\n from catalog_sales\n ,date_dim\n where cs_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2 \n union all\n select ws_quantity quantity\n ,ws_list_price list_price\n from web_sales\n ,date_dim\n where ws_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2) x)\n select channel, i_brand_id,i_class_id,i_category_id,sum(sales), sum(number_sales)\n from(\n select 'store' channel, i_brand_id,i_class_id\n ,i_category_id,sum(ss_quantity*ss_list_price) sales\n , count(*) number_sales\n from store_sales\n ,item\n ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n and ss_item_sk = i_item_sk\n and ss_sold_date_sk = d_date_sk\n and d_year = 1999+2 \n and d_moy = 11\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)\n union all\n select 'catalog' channel, i_brand_id,i_class_id,i_category_id, sum(cs_quantity*cs_list_price) sales, count(*) number_sales\n from catalog_sales\n ,item\n ,date_dim\n where cs_item_sk in (select ss_item_sk from cross_items)\n and cs_item_sk = i_item_sk\n and cs_sold_date_sk = d_date_sk\n and d_year = 1999+2 \n and d_moy = 11\n group by i_brand_id,i_class_id,i_category_id\n having sum(cs_quantity*cs_list_price) > (select average_sales from avg_sales)\n union all\n select 'web' channel, i_brand_id,i_class_id,i_category_id, sum(ws_quantity*ws_list_price) sales , count(*) number_sales\n from web_sales\n ,item\n ,date_dim\n where ws_item_sk in (select ss_item_sk from cross_items)\n and ws_item_sk = i_item_sk\n and ws_sold_date_sk = d_date_sk\n and d_year = 1999+2\n and d_moy = 11\n group by i_brand_id,i_class_id,i_category_id\n having sum(ws_quantity*ws_list_price) > (select average_sales from avg_sales)\n ) y\n group by rollup (channel, i_brand_id,i_class_id,i_category_id)\n order by channel,i_brand_id,i_class_id,i_category_id\n limit 100;\nwith cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n ,iss.i_class_id class_id\n ,iss.i_category_id category_id\n from store_sales\n ,item iss\n ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n and ss_sold_date_sk = d1.d_date_sk\n and d1.d_year between 1999 AND 1999 + 2\n intersect distinct\n select ics.i_brand_id\n ,ics.i_class_id\n ,ics.i_category_id\n from catalog_sales\n ,item ics\n ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n and cs_sold_date_sk = d2.d_date_sk\n and d2.d_year between 1999 AND 1999 + 2\n intersect distinct\n select iws.i_brand_id\n ,iws.i_class_id\n ,iws.i_category_id\n from web_sales\n ,item iws\n ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n and ws_sold_date_sk = d3.d_date_sk\n and d3.d_year between 1999 AND 1999 + 2) x\n where i_brand_id = brand_id\n and i_class_id = class_id\n and i_category_id = category_id\n),\n avg_sales as\n(select avg(quantity*list_price) average_sales\n from (select ss_quantity quantity\n ,ss_list_price list_price\n from store_sales\n ,date_dim\n where ss_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2\n union all\n select cs_quantity quantity\n ,cs_list_price list_price\n from catalog_sales\n ,date_dim\n where cs_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2\n union all\n select ws_quantity quantity\n ,ws_list_price list_price\n from web_sales\n ,date_dim\n where ws_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2) x)\n select this_year.channel ty_channel\n ,this_year.i_brand_id ty_brand\n ,this_year.i_class_id ty_class\n ,this_year.i_category_id ty_category\n ,this_year.sales ty_sales\n ,this_year.number_sales ty_number_sales\n ,last_year.channel ly_channel\n ,last_year.i_brand_id ly_brand\n ,last_year.i_class_id ly_class\n ,last_year.i_category_id ly_category\n ,last_year.sales ly_sales\n ,last_year.number_sales ly_number_sales \n from\n (select 'store' channel, i_brand_id,i_class_id,i_category_id\n ,sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales \n ,item\n ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n and ss_item_sk = i_item_sk\n and ss_sold_date_sk = d_date_sk\n and d_week_seq = (select d_week_seq\n from date_dim\n where d_year = 1999 + 1\n and d_moy = 12\n and d_dom = 11)\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) this_year,\n (select 'store' channel, i_brand_id,i_class_id\n ,i_category_id, sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n ,item\n ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n and ss_item_sk = i_item_sk\n and ss_sold_date_sk = d_date_sk\n and d_week_seq = (select d_week_seq\n from date_dim\n where d_year = 1999\n and d_moy = 12\n and d_dom = 11)\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) last_year\n where this_year.i_brand_id= last_year.i_brand_id\n and this_year.i_class_id = last_year.i_class_id\n and this_year.i_category_id = last_year.i_category_id\n order by this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id\n limit 100;", "useLegacySql": false, "useQueryCache": false } }, "etag": "sWSvxPDh+4B/kExsaJtCmQ==", "id": "test-project-364309:europe-west1.query14_1665768238", "jobReference": { "jobId": "query14_1665768238", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query14_1665768238?location=europe-west1", "statistics": { "creationTime": "1665768239519", "endTime": "1665768245395", "numChildJobs": "2", "query": { "schema": { "fields": [ { "mode": "NULLABLE", "name": "ty_channel", "type": "STRING" }, { "mode": "NULLABLE", "name": "ty_brand", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ty_class", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ty_category", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ty_sales", "type": "NUMERIC" }, { "mode": "NULLABLE", "name": "ty_number_sales", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_channel", "type": "STRING" }, { "mode": "NULLABLE", "name": "ly_brand", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_class", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_category", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_sales", "type": "NUMERIC" }, { "mode": "NULLABLE", "name": "ly_number_sales", "type": "INTEGER" } ] }, "statementType": "SCRIPT", "totalBytesBilled": "401604608", "totalBytesProcessed": "400339584", "totalSlotMs": "140929" }, "startTime": "1665768239570", "totalBytesProcessed": "400339584", "totalSlotMs": "140929" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon91763af8_1cab_4e23_bb13_359c6e4614d6" }, "priority": "INTERACTIVE", "query": "with cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n ,iss.i_class_id class_id\n ,iss.i_category_id category_id\n from store_sales\n ,item iss\n ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n and ss_sold_date_sk = d1.d_date_sk\n and d1.d_year between 1999 AND 1999 + 2\n intersect distinct\n select ics.i_brand_id\n ,ics.i_class_id\n ,ics.i_category_id\n from catalog_sales\n ,item ics\n ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n and cs_sold_date_sk = d2.d_date_sk\n and d2.d_year between 1999 AND 1999 + 2\n intersect distinct\n select iws.i_brand_id\n ,iws.i_class_id\n ,iws.i_category_id\n from web_sales\n ,item iws\n ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n and ws_sold_date_sk = d3.d_date_sk\n and d3.d_year between 1999 AND 1999 + 2)\n where i_brand_id = brand_id\n and i_class_id = class_id\n and i_category_id = category_id\n),\n avg_sales as\n (select avg(quantity*list_price) average_sales\n from (select ss_quantity quantity\n ,ss_list_price list_price\n from store_sales\n ,date_dim\n where ss_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2\n union all \n select cs_quantity quantity \n ,cs_list_price list_price\n from catalog_sales\n ,date_dim\n where cs_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2 \n union all\n select ws_quantity quantity\n ,ws_list_price list_price\n from web_sales\n ,date_dim\n where ws_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2) x)\n select channel, i_brand_id,i_class_id,i_category_id,sum(sales), sum(number_sales)\n from(\n select 'store' channel, i_brand_id,i_class_id\n ,i_category_id,sum(ss_quantity*ss_list_price) sales\n , count(*) number_sales\n from store_sales\n ,item\n ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n and ss_item_sk = i_item_sk\n and ss_sold_date_sk = d_date_sk\n and d_year = 1999+2 \n and d_moy = 11\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)\n union all\n select 'catalog' channel, i_brand_id,i_class_id,i_category_id, sum(cs_quantity*cs_list_price) sales, count(*) number_sales\n from catalog_sales\n ,item\n ,date_dim\n where cs_item_sk in (select ss_item_sk from cross_items)\n and cs_item_sk = i_item_sk\n and cs_sold_date_sk = d_date_sk\n and d_year = 1999+2 \n and d_moy = 11\n group by i_brand_id,i_class_id,i_category_id\n having sum(cs_quantity*cs_list_price) > (select average_sales from avg_sales)\n union all\n select 'web' channel, i_brand_id,i_class_id,i_category_id, sum(ws_quantity*ws_list_price) sales , count(*) number_sales\n from web_sales\n ,item\n ,date_dim\n where ws_item_sk in (select ss_item_sk from cross_items)\n and ws_item_sk = i_item_sk\n and ws_sold_date_sk = d_date_sk\n and d_year = 1999+2\n and d_moy = 11\n group by i_brand_id,i_class_id,i_category_id\n having sum(ws_quantity*ws_list_price) > (select average_sales from avg_sales)\n ) y\n group by rollup (channel, i_brand_id,i_class_id,i_category_id)\n order by channel,i_brand_id,i_class_id,i_category_id\n limit 100;\nwith cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n ,iss.i_class_id class_id\n ,iss.i_category_id category_id\n from store_sales\n ,item iss\n ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n and ss_sold_date_sk = d1.d_date_sk\n and d1.d_year between 1999 AND 1999 + 2\n intersect distinct\n select ics.i_brand_id\n ,ics.i_class_id\n ,ics.i_category_id\n from catalog_sales\n ,item ics\n ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n and cs_sold_date_sk = d2.d_date_sk\n and d2.d_year between 1999 AND 1999 + 2\n intersect distinct\n select iws.i_brand_id\n ,iws.i_class_id\n ,iws.i_category_id\n from web_sales\n ,item iws\n ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n and ws_sold_date_sk = d3.d_date_sk\n and d3.d_year between 1999 AND 1999 + 2) x\n where i_brand_id = brand_id\n and i_class_id = class_id\n and i_category_id = category_id\n),\n avg_sales as\n(select avg(quantity*list_price) average_sales\n from (select ss_quantity quantity\n ,ss_list_price list_price\n from store_sales\n ,date_dim\n where ss_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2\n union all\n select cs_quantity quantity\n ,cs_list_price list_price\n from catalog_sales\n ,date_dim\n where cs_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2\n union all\n select ws_quantity quantity\n ,ws_list_price list_price\n from web_sales\n ,date_dim\n where ws_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2) x)\n select this_year.channel ty_channel\n ,this_year.i_brand_id ty_brand\n ,this_year.i_class_id ty_class\n ,this_year.i_category_id ty_category\n ,this_year.sales ty_sales\n ,this_year.number_sales ty_number_sales\n ,last_year.channel ly_channel\n ,last_year.i_brand_id ly_brand\n ,last_year.i_class_id ly_class\n ,last_year.i_category_id ly_category\n ,last_year.sales ly_sales\n ,last_year.number_sales ly_number_sales \n from\n (select 'store' channel, i_brand_id,i_class_id,i_category_id\n ,sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales \n ,item\n ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n and ss_item_sk = i_item_sk\n and ss_sold_date_sk = d_date_sk\n and d_week_seq = (select d_week_seq\n from date_dim\n where d_year = 1999 + 1\n and d_moy = 12\n and d_dom = 11)\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) this_year,\n (select 'store' channel, i_brand_id,i_class_id\n ,i_category_id, sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n ,item\n ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n and ss_item_sk = i_item_sk\n and ss_sold_date_sk = d_date_sk\n and d_week_seq = (select d_week_seq\n from date_dim\n where d_year = 1999\n and d_moy = 12\n and d_dom = 11)\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) last_year\n where this_year.i_brand_id= last_year.i_brand_id\n and this_year.i_class_id = last_year.i_class_id\n and this_year.i_category_id = last_year.i_category_id\n order by this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id\n limit 100;", "useLegacySql": false, "useQueryCache": false } }, "etag": "Cw+/xqAxAESZ80TXr3OYkw==", "id": "test-project-364309:europe-west1.query14_1665776868", "jobReference": { "jobId": "query14_1665776868", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query14_1665776868?location=europe-west1", "statistics": { "creationTime": "1665776869163", "endTime": "1665776876079", "numChildJobs": "2", "query": { "schema": { "fields": [ { "mode": "NULLABLE", "name": "ty_channel", "type": "STRING" }, { "mode": "NULLABLE", "name": "ty_brand", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ty_class", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ty_category", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ty_sales", "type": "NUMERIC" }, { "mode": "NULLABLE", "name": "ty_number_sales", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_channel", "type": "STRING" }, { "mode": "NULLABLE", "name": "ly_brand", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_class", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_category", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_sales", "type": "NUMERIC" }, { "mode": "NULLABLE", "name": "ly_number_sales", "type": "INTEGER" } ] }, "statementType": "SCRIPT", "totalBytesBilled": "401604608", "totalBytesProcessed": "400339584", "totalSlotMs": "135543" }, "startTime": "1665776869210", "totalBytesProcessed": "400339584", "totalSlotMs": "135543" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anonedc0ff0a_eddd_414b_85fd_ed883cfd21ed" }, "priority": "INTERACTIVE", "query": "with cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n ,iss.i_class_id class_id\n ,iss.i_category_id category_id\n from store_sales\n ,item iss\n ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n and ss_sold_date_sk = d1.d_date_sk\n and d1.d_year between 1999 AND 1999 + 2\n intersect distinct\n select ics.i_brand_id\n ,ics.i_class_id\n ,ics.i_category_id\n from catalog_sales\n ,item ics\n ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n and cs_sold_date_sk = d2.d_date_sk\n and d2.d_year between 1999 AND 1999 + 2\n intersect distinct\n select iws.i_brand_id\n ,iws.i_class_id\n ,iws.i_category_id\n from web_sales\n ,item iws\n ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n and ws_sold_date_sk = d3.d_date_sk\n and d3.d_year between 1999 AND 1999 + 2)\n where i_brand_id = brand_id\n and i_class_id = class_id\n and i_category_id = category_id\n),\n avg_sales as\n (select avg(quantity*list_price) average_sales\n from (select ss_quantity quantity\n ,ss_list_price list_price\n from store_sales\n ,date_dim\n where ss_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2\n union all \n select cs_quantity quantity \n ,cs_list_price list_price\n from catalog_sales\n ,date_dim\n where cs_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2 \n union all\n select ws_quantity quantity\n ,ws_list_price list_price\n from web_sales\n ,date_dim\n where ws_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2) x)\n select channel, i_brand_id,i_class_id,i_category_id,sum(sales), sum(number_sales)\n from(\n select 'store' channel, i_brand_id,i_class_id\n ,i_category_id,sum(ss_quantity*ss_list_price) sales\n , count(*) number_sales\n from store_sales\n ,item\n ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n and ss_item_sk = i_item_sk\n and ss_sold_date_sk = d_date_sk\n and d_year = 1999+2 \n and d_moy = 11\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)\n union all\n select 'catalog' channel, i_brand_id,i_class_id,i_category_id, sum(cs_quantity*cs_list_price) sales, count(*) number_sales\n from catalog_sales\n ,item\n ,date_dim\n where cs_item_sk in (select ss_item_sk from cross_items)\n and cs_item_sk = i_item_sk\n and cs_sold_date_sk = d_date_sk\n and d_year = 1999+2 \n and d_moy = 11\n group by i_brand_id,i_class_id,i_category_id\n having sum(cs_quantity*cs_list_price) > (select average_sales from avg_sales)\n union all\n select 'web' channel, i_brand_id,i_class_id,i_category_id, sum(ws_quantity*ws_list_price) sales , count(*) number_sales\n from web_sales\n ,item\n ,date_dim\n where ws_item_sk in (select ss_item_sk from cross_items)\n and ws_item_sk = i_item_sk\n and ws_sold_date_sk = d_date_sk\n and d_year = 1999+2\n and d_moy = 11\n group by i_brand_id,i_class_id,i_category_id\n having sum(ws_quantity*ws_list_price) > (select average_sales from avg_sales)\n ) y\n group by rollup (channel, i_brand_id,i_class_id,i_category_id)\n order by channel,i_brand_id,i_class_id,i_category_id\n limit 100;\nwith cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n ,iss.i_class_id class_id\n ,iss.i_category_id category_id\n from store_sales\n ,item iss\n ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n and ss_sold_date_sk = d1.d_date_sk\n and d1.d_year between 1999 AND 1999 + 2\n intersect distinct\n select ics.i_brand_id\n ,ics.i_class_id\n ,ics.i_category_id\n from catalog_sales\n ,item ics\n ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n and cs_sold_date_sk = d2.d_date_sk\n and d2.d_year between 1999 AND 1999 + 2\n intersect distinct\n select iws.i_brand_id\n ,iws.i_class_id\n ,iws.i_category_id\n from web_sales\n ,item iws\n ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n and ws_sold_date_sk = d3.d_date_sk\n and d3.d_year between 1999 AND 1999 + 2) x\n where i_brand_id = brand_id\n and i_class_id = class_id\n and i_category_id = category_id\n),\n avg_sales as\n(select avg(quantity*list_price) average_sales\n from (select ss_quantity quantity\n ,ss_list_price list_price\n from store_sales\n ,date_dim\n where ss_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2\n union all\n select cs_quantity quantity\n ,cs_list_price list_price\n from catalog_sales\n ,date_dim\n where cs_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2\n union all\n select ws_quantity quantity\n ,ws_list_price list_price\n from web_sales\n ,date_dim\n where ws_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2) x)\n select this_year.channel ty_channel\n ,this_year.i_brand_id ty_brand\n ,this_year.i_class_id ty_class\n ,this_year.i_category_id ty_category\n ,this_year.sales ty_sales\n ,this_year.number_sales ty_number_sales\n ,last_year.channel ly_channel\n ,last_year.i_brand_id ly_brand\n ,last_year.i_class_id ly_class\n ,last_year.i_category_id ly_category\n ,last_year.sales ly_sales\n ,last_year.number_sales ly_number_sales \n from\n (select 'store' channel, i_brand_id,i_class_id,i_category_id\n ,sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales \n ,item\n ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n and ss_item_sk = i_item_sk\n and ss_sold_date_sk = d_date_sk\n and d_week_seq = (select d_week_seq\n from date_dim\n where d_year = 1999 + 1\n and d_moy = 12\n and d_dom = 11)\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) this_year,\n (select 'store' channel, i_brand_id,i_class_id\n ,i_category_id, sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n ,item\n ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n and ss_item_sk = i_item_sk\n and ss_sold_date_sk = d_date_sk\n and d_week_seq = (select d_week_seq\n from date_dim\n where d_year = 1999\n and d_moy = 12\n and d_dom = 11)\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) last_year\n where this_year.i_brand_id= last_year.i_brand_id\n and this_year.i_class_id = last_year.i_class_id\n and this_year.i_category_id = last_year.i_category_id\n order by this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id\n limit 100;", "useLegacySql": false, "useQueryCache": false } }, "etag": "+BaXO27Y6nnNnTXosriZ5A==", "id": "test-project-364309:europe-west1.query14_1665776878", "jobReference": { "jobId": "query14_1665776878", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query14_1665776878?location=europe-west1", "statistics": { "creationTime": "1665776878703", "endTime": "1665776885482", "numChildJobs": "2", "query": { "schema": { "fields": [ { "mode": "NULLABLE", "name": "ty_channel", "type": "STRING" }, { "mode": "NULLABLE", "name": "ty_brand", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ty_class", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ty_category", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ty_sales", "type": "NUMERIC" }, { "mode": "NULLABLE", "name": "ty_number_sales", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_channel", "type": "STRING" }, { "mode": "NULLABLE", "name": "ly_brand", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_class", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_category", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_sales", "type": "NUMERIC" }, { "mode": "NULLABLE", "name": "ly_number_sales", "type": "INTEGER" } ] }, "statementType": "SCRIPT", "totalBytesBilled": "401604608", "totalBytesProcessed": "400339584", "totalSlotMs": "134764" }, "startTime": "1665776878753", "totalBytesProcessed": "400339584", "totalSlotMs": "134764" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anonc62dff7a_519b_4ee9_b059_f84e28035653" }, "priority": "INTERACTIVE", "query": "with cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n ,iss.i_class_id class_id\n ,iss.i_category_id category_id\n from store_sales\n ,item iss\n ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n and ss_sold_date_sk = d1.d_date_sk\n and d1.d_year between 1999 AND 1999 + 2\n intersect distinct\n select ics.i_brand_id\n ,ics.i_class_id\n ,ics.i_category_id\n from catalog_sales\n ,item ics\n ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n and cs_sold_date_sk = d2.d_date_sk\n and d2.d_year between 1999 AND 1999 + 2\n intersect distinct\n select iws.i_brand_id\n ,iws.i_class_id\n ,iws.i_category_id\n from web_sales\n ,item iws\n ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n and ws_sold_date_sk = d3.d_date_sk\n and d3.d_year between 1999 AND 1999 + 2)\n where i_brand_id = brand_id\n and i_class_id = class_id\n and i_category_id = category_id\n),\n avg_sales as\n (select avg(quantity*list_price) average_sales\n from (select ss_quantity quantity\n ,ss_list_price list_price\n from store_sales\n ,date_dim\n where ss_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2\n union all \n select cs_quantity quantity \n ,cs_list_price list_price\n from catalog_sales\n ,date_dim\n where cs_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2 \n union all\n select ws_quantity quantity\n ,ws_list_price list_price\n from web_sales\n ,date_dim\n where ws_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2) x)\n select channel, i_brand_id,i_class_id,i_category_id,sum(sales), sum(number_sales)\n from(\n select 'store' channel, i_brand_id,i_class_id\n ,i_category_id,sum(ss_quantity*ss_list_price) sales\n , count(*) number_sales\n from store_sales\n ,item\n ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n and ss_item_sk = i_item_sk\n and ss_sold_date_sk = d_date_sk\n and d_year = 1999+2 \n and d_moy = 11\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)\n union all\n select 'catalog' channel, i_brand_id,i_class_id,i_category_id, sum(cs_quantity*cs_list_price) sales, count(*) number_sales\n from catalog_sales\n ,item\n ,date_dim\n where cs_item_sk in (select ss_item_sk from cross_items)\n and cs_item_sk = i_item_sk\n and cs_sold_date_sk = d_date_sk\n and d_year = 1999+2 \n and d_moy = 11\n group by i_brand_id,i_class_id,i_category_id\n having sum(cs_quantity*cs_list_price) > (select average_sales from avg_sales)\n union all\n select 'web' channel, i_brand_id,i_class_id,i_category_id, sum(ws_quantity*ws_list_price) sales , count(*) number_sales\n from web_sales\n ,item\n ,date_dim\n where ws_item_sk in (select ss_item_sk from cross_items)\n and ws_item_sk = i_item_sk\n and ws_sold_date_sk = d_date_sk\n and d_year = 1999+2\n and d_moy = 11\n group by i_brand_id,i_class_id,i_category_id\n having sum(ws_quantity*ws_list_price) > (select average_sales from avg_sales)\n ) y\n group by rollup (channel, i_brand_id,i_class_id,i_category_id)\n order by channel,i_brand_id,i_class_id,i_category_id\n limit 100;\nwith cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n ,iss.i_class_id class_id\n ,iss.i_category_id category_id\n from store_sales\n ,item iss\n ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n and ss_sold_date_sk = d1.d_date_sk\n and d1.d_year between 1999 AND 1999 + 2\n intersect distinct\n select ics.i_brand_id\n ,ics.i_class_id\n ,ics.i_category_id\n from catalog_sales\n ,item ics\n ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n and cs_sold_date_sk = d2.d_date_sk\n and d2.d_year between 1999 AND 1999 + 2\n intersect distinct\n select iws.i_brand_id\n ,iws.i_class_id\n ,iws.i_category_id\n from web_sales\n ,item iws\n ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n and ws_sold_date_sk = d3.d_date_sk\n and d3.d_year between 1999 AND 1999 + 2) x\n where i_brand_id = brand_id\n and i_class_id = class_id\n and i_category_id = category_id\n),\n avg_sales as\n(select avg(quantity*list_price) average_sales\n from (select ss_quantity quantity\n ,ss_list_price list_price\n from store_sales\n ,date_dim\n where ss_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2\n union all\n select cs_quantity quantity\n ,cs_list_price list_price\n from catalog_sales\n ,date_dim\n where cs_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2\n union all\n select ws_quantity quantity\n ,ws_list_price list_price\n from web_sales\n ,date_dim\n where ws_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2) x)\n select this_year.channel ty_channel\n ,this_year.i_brand_id ty_brand\n ,this_year.i_class_id ty_class\n ,this_year.i_category_id ty_category\n ,this_year.sales ty_sales\n ,this_year.number_sales ty_number_sales\n ,last_year.channel ly_channel\n ,last_year.i_brand_id ly_brand\n ,last_year.i_class_id ly_class\n ,last_year.i_category_id ly_category\n ,last_year.sales ly_sales\n ,last_year.number_sales ly_number_sales \n from\n (select 'store' channel, i_brand_id,i_class_id,i_category_id\n ,sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales \n ,item\n ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n and ss_item_sk = i_item_sk\n and ss_sold_date_sk = d_date_sk\n and d_week_seq = (select d_week_seq\n from date_dim\n where d_year = 1999 + 1\n and d_moy = 12\n and d_dom = 11)\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) this_year,\n (select 'store' channel, i_brand_id,i_class_id\n ,i_category_id, sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n ,item\n ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n and ss_item_sk = i_item_sk\n and ss_sold_date_sk = d_date_sk\n and d_week_seq = (select d_week_seq\n from date_dim\n where d_year = 1999\n and d_moy = 12\n and d_dom = 11)\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) last_year\n where this_year.i_brand_id= last_year.i_brand_id\n and this_year.i_class_id = last_year.i_class_id\n and this_year.i_category_id = last_year.i_category_id\n order by this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id\n limit 100;", "useLegacySql": false, "useQueryCache": false } }, "etag": "6Rss7cnPQ9iESXP320p44Q==", "id": "test-project-364309:europe-west1.query14_1665776887", "jobReference": { "jobId": "query14_1665776887", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query14_1665776887?location=europe-west1", "statistics": { "creationTime": "1665776888375", "endTime": "1665776895109", "numChildJobs": "2", "query": { "schema": { "fields": [ { "mode": "NULLABLE", "name": "ty_channel", "type": "STRING" }, { "mode": "NULLABLE", "name": "ty_brand", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ty_class", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ty_category", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ty_sales", "type": "NUMERIC" }, { "mode": "NULLABLE", "name": "ty_number_sales", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_channel", "type": "STRING" }, { "mode": "NULLABLE", "name": "ly_brand", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_class", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_category", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_sales", "type": "NUMERIC" }, { "mode": "NULLABLE", "name": "ly_number_sales", "type": "INTEGER" } ] }, "statementType": "SCRIPT", "totalBytesBilled": "401604608", "totalBytesProcessed": "400339584", "totalSlotMs": "131323" }, "startTime": "1665776888435", "totalBytesProcessed": "400339584", "totalSlotMs": "131323" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anona19757aa_a838_410b_a0aa_0584114701d3" }, "priority": "INTERACTIVE", "query": "with cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n ,iss.i_class_id class_id\n ,iss.i_category_id category_id\n from store_sales\n ,item iss\n ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n and ss_sold_date_sk = d1.d_date_sk\n and d1.d_year between 1999 AND 1999 + 2\n intersect distinct\n select ics.i_brand_id\n ,ics.i_class_id\n ,ics.i_category_id\n from catalog_sales\n ,item ics\n ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n and cs_sold_date_sk = d2.d_date_sk\n and d2.d_year between 1999 AND 1999 + 2\n intersect distinct\n select iws.i_brand_id\n ,iws.i_class_id\n ,iws.i_category_id\n from web_sales\n ,item iws\n ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n and ws_sold_date_sk = d3.d_date_sk\n and d3.d_year between 1999 AND 1999 + 2)\n where i_brand_id = brand_id\n and i_class_id = class_id\n and i_category_id = category_id\n),\n avg_sales as\n (select avg(quantity*list_price) average_sales\n from (select ss_quantity quantity\n ,ss_list_price list_price\n from store_sales\n ,date_dim\n where ss_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2\n union all \n select cs_quantity quantity \n ,cs_list_price list_price\n from catalog_sales\n ,date_dim\n where cs_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2 \n union all\n select ws_quantity quantity\n ,ws_list_price list_price\n from web_sales\n ,date_dim\n where ws_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2) x)\n select channel, i_brand_id,i_class_id,i_category_id,sum(sales), sum(number_sales)\n from(\n select 'store' channel, i_brand_id,i_class_id\n ,i_category_id,sum(ss_quantity*ss_list_price) sales\n , count(*) number_sales\n from store_sales\n ,item\n ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n and ss_item_sk = i_item_sk\n and ss_sold_date_sk = d_date_sk\n and d_year = 1999+2 \n and d_moy = 11\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)\n union all\n select 'catalog' channel, i_brand_id,i_class_id,i_category_id, sum(cs_quantity*cs_list_price) sales, count(*) number_sales\n from catalog_sales\n ,item\n ,date_dim\n where cs_item_sk in (select ss_item_sk from cross_items)\n and cs_item_sk = i_item_sk\n and cs_sold_date_sk = d_date_sk\n and d_year = 1999+2 \n and d_moy = 11\n group by i_brand_id,i_class_id,i_category_id\n having sum(cs_quantity*cs_list_price) > (select average_sales from avg_sales)\n union all\n select 'web' channel, i_brand_id,i_class_id,i_category_id, sum(ws_quantity*ws_list_price) sales , count(*) number_sales\n from web_sales\n ,item\n ,date_dim\n where ws_item_sk in (select ss_item_sk from cross_items)\n and ws_item_sk = i_item_sk\n and ws_sold_date_sk = d_date_sk\n and d_year = 1999+2\n and d_moy = 11\n group by i_brand_id,i_class_id,i_category_id\n having sum(ws_quantity*ws_list_price) > (select average_sales from avg_sales)\n ) y\n group by rollup (channel, i_brand_id,i_class_id,i_category_id)\n order by channel,i_brand_id,i_class_id,i_category_id\n limit 100;\nwith cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n ,iss.i_class_id class_id\n ,iss.i_category_id category_id\n from store_sales\n ,item iss\n ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n and ss_sold_date_sk = d1.d_date_sk\n and d1.d_year between 1999 AND 1999 + 2\n intersect distinct\n select ics.i_brand_id\n ,ics.i_class_id\n ,ics.i_category_id\n from catalog_sales\n ,item ics\n ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n and cs_sold_date_sk = d2.d_date_sk\n and d2.d_year between 1999 AND 1999 + 2\n intersect distinct\n select iws.i_brand_id\n ,iws.i_class_id\n ,iws.i_category_id\n from web_sales\n ,item iws\n ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n and ws_sold_date_sk = d3.d_date_sk\n and d3.d_year between 1999 AND 1999 + 2) x\n where i_brand_id = brand_id\n and i_class_id = class_id\n and i_category_id = category_id\n),\n avg_sales as\n(select avg(quantity*list_price) average_sales\n from (select ss_quantity quantity\n ,ss_list_price list_price\n from store_sales\n ,date_dim\n where ss_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2\n union all\n select cs_quantity quantity\n ,cs_list_price list_price\n from catalog_sales\n ,date_dim\n where cs_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2\n union all\n select ws_quantity quantity\n ,ws_list_price list_price\n from web_sales\n ,date_dim\n where ws_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2) x)\n select this_year.channel ty_channel\n ,this_year.i_brand_id ty_brand\n ,this_year.i_class_id ty_class\n ,this_year.i_category_id ty_category\n ,this_year.sales ty_sales\n ,this_year.number_sales ty_number_sales\n ,last_year.channel ly_channel\n ,last_year.i_brand_id ly_brand\n ,last_year.i_class_id ly_class\n ,last_year.i_category_id ly_category\n ,last_year.sales ly_sales\n ,last_year.number_sales ly_number_sales \n from\n (select 'store' channel, i_brand_id,i_class_id,i_category_id\n ,sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales \n ,item\n ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n and ss_item_sk = i_item_sk\n and ss_sold_date_sk = d_date_sk\n and d_week_seq = (select d_week_seq\n from date_dim\n where d_year = 1999 + 1\n and d_moy = 12\n and d_dom = 11)\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) this_year,\n (select 'store' channel, i_brand_id,i_class_id\n ,i_category_id, sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n ,item\n ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n and ss_item_sk = i_item_sk\n and ss_sold_date_sk = d_date_sk\n and d_week_seq = (select d_week_seq\n from date_dim\n where d_year = 1999\n and d_moy = 12\n and d_dom = 11)\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) last_year\n where this_year.i_brand_id= last_year.i_brand_id\n and this_year.i_class_id = last_year.i_class_id\n and this_year.i_category_id = last_year.i_category_id\n order by this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id\n limit 100;", "useLegacySql": false, "useQueryCache": false } }, "etag": "A8zlvsbxV5avK9WJXOCaWw==", "id": "test-project-364309:europe-west1.query14_1665776897", "jobReference": { "jobId": "query14_1665776897", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query14_1665776897?location=europe-west1", "statistics": { "creationTime": "1665776898065", "endTime": "1665776905097", "numChildJobs": "2", "query": { "schema": { "fields": [ { "mode": "NULLABLE", "name": "ty_channel", "type": "STRING" }, { "mode": "NULLABLE", "name": "ty_brand", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ty_class", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ty_category", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ty_sales", "type": "NUMERIC" }, { "mode": "NULLABLE", "name": "ty_number_sales", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_channel", "type": "STRING" }, { "mode": "NULLABLE", "name": "ly_brand", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_class", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_category", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_sales", "type": "NUMERIC" }, { "mode": "NULLABLE", "name": "ly_number_sales", "type": "INTEGER" } ] }, "statementType": "SCRIPT", "totalBytesBilled": "401604608", "totalBytesProcessed": "400339584", "totalSlotMs": "132604" }, "startTime": "1665776898135", "totalBytesProcessed": "400339584", "totalSlotMs": "132604" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anondfc94450_79a2_4273_b0ec_e66699f15ea6" }, "priority": "INTERACTIVE", "query": "with cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n ,iss.i_class_id class_id\n ,iss.i_category_id category_id\n from store_sales\n ,item iss\n ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n and ss_sold_date_sk = d1.d_date_sk\n and d1.d_year between 1999 AND 1999 + 2\n intersect distinct\n select ics.i_brand_id\n ,ics.i_class_id\n ,ics.i_category_id\n from catalog_sales\n ,item ics\n ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n and cs_sold_date_sk = d2.d_date_sk\n and d2.d_year between 1999 AND 1999 + 2\n intersect distinct\n select iws.i_brand_id\n ,iws.i_class_id\n ,iws.i_category_id\n from web_sales\n ,item iws\n ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n and ws_sold_date_sk = d3.d_date_sk\n and d3.d_year between 1999 AND 1999 + 2)\n where i_brand_id = brand_id\n and i_class_id = class_id\n and i_category_id = category_id\n),\n avg_sales as\n (select avg(quantity*list_price) average_sales\n from (select ss_quantity quantity\n ,ss_list_price list_price\n from store_sales\n ,date_dim\n where ss_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2\n union all \n select cs_quantity quantity \n ,cs_list_price list_price\n from catalog_sales\n ,date_dim\n where cs_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2 \n union all\n select ws_quantity quantity\n ,ws_list_price list_price\n from web_sales\n ,date_dim\n where ws_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2) x)\n select channel, i_brand_id,i_class_id,i_category_id,sum(sales), sum(number_sales)\n from(\n select 'store' channel, i_brand_id,i_class_id\n ,i_category_id,sum(ss_quantity*ss_list_price) sales\n , count(*) number_sales\n from store_sales\n ,item\n ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n and ss_item_sk = i_item_sk\n and ss_sold_date_sk = d_date_sk\n and d_year = 1999+2 \n and d_moy = 11\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)\n union all\n select 'catalog' channel, i_brand_id,i_class_id,i_category_id, sum(cs_quantity*cs_list_price) sales, count(*) number_sales\n from catalog_sales\n ,item\n ,date_dim\n where cs_item_sk in (select ss_item_sk from cross_items)\n and cs_item_sk = i_item_sk\n and cs_sold_date_sk = d_date_sk\n and d_year = 1999+2 \n and d_moy = 11\n group by i_brand_id,i_class_id,i_category_id\n having sum(cs_quantity*cs_list_price) > (select average_sales from avg_sales)\n union all\n select 'web' channel, i_brand_id,i_class_id,i_category_id, sum(ws_quantity*ws_list_price) sales , count(*) number_sales\n from web_sales\n ,item\n ,date_dim\n where ws_item_sk in (select ss_item_sk from cross_items)\n and ws_item_sk = i_item_sk\n and ws_sold_date_sk = d_date_sk\n and d_year = 1999+2\n and d_moy = 11\n group by i_brand_id,i_class_id,i_category_id\n having sum(ws_quantity*ws_list_price) > (select average_sales from avg_sales)\n ) y\n group by rollup (channel, i_brand_id,i_class_id,i_category_id)\n order by channel,i_brand_id,i_class_id,i_category_id\n limit 100;\nwith cross_items as\n (select i_item_sk ss_item_sk\n from item,\n (select iss.i_brand_id brand_id\n ,iss.i_class_id class_id\n ,iss.i_category_id category_id\n from store_sales\n ,item iss\n ,date_dim d1\n where ss_item_sk = iss.i_item_sk\n and ss_sold_date_sk = d1.d_date_sk\n and d1.d_year between 1999 AND 1999 + 2\n intersect distinct\n select ics.i_brand_id\n ,ics.i_class_id\n ,ics.i_category_id\n from catalog_sales\n ,item ics\n ,date_dim d2\n where cs_item_sk = ics.i_item_sk\n and cs_sold_date_sk = d2.d_date_sk\n and d2.d_year between 1999 AND 1999 + 2\n intersect distinct\n select iws.i_brand_id\n ,iws.i_class_id\n ,iws.i_category_id\n from web_sales\n ,item iws\n ,date_dim d3\n where ws_item_sk = iws.i_item_sk\n and ws_sold_date_sk = d3.d_date_sk\n and d3.d_year between 1999 AND 1999 + 2) x\n where i_brand_id = brand_id\n and i_class_id = class_id\n and i_category_id = category_id\n),\n avg_sales as\n(select avg(quantity*list_price) average_sales\n from (select ss_quantity quantity\n ,ss_list_price list_price\n from store_sales\n ,date_dim\n where ss_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2\n union all\n select cs_quantity quantity\n ,cs_list_price list_price\n from catalog_sales\n ,date_dim\n where cs_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2\n union all\n select ws_quantity quantity\n ,ws_list_price list_price\n from web_sales\n ,date_dim\n where ws_sold_date_sk = d_date_sk\n and d_year between 1999 and 1999 + 2) x)\n select this_year.channel ty_channel\n ,this_year.i_brand_id ty_brand\n ,this_year.i_class_id ty_class\n ,this_year.i_category_id ty_category\n ,this_year.sales ty_sales\n ,this_year.number_sales ty_number_sales\n ,last_year.channel ly_channel\n ,last_year.i_brand_id ly_brand\n ,last_year.i_class_id ly_class\n ,last_year.i_category_id ly_category\n ,last_year.sales ly_sales\n ,last_year.number_sales ly_number_sales \n from\n (select 'store' channel, i_brand_id,i_class_id,i_category_id\n ,sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales \n ,item\n ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n and ss_item_sk = i_item_sk\n and ss_sold_date_sk = d_date_sk\n and d_week_seq = (select d_week_seq\n from date_dim\n where d_year = 1999 + 1\n and d_moy = 12\n and d_dom = 11)\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) this_year,\n (select 'store' channel, i_brand_id,i_class_id\n ,i_category_id, sum(ss_quantity*ss_list_price) sales, count(*) number_sales\n from store_sales\n ,item\n ,date_dim\n where ss_item_sk in (select ss_item_sk from cross_items)\n and ss_item_sk = i_item_sk\n and ss_sold_date_sk = d_date_sk\n and d_week_seq = (select d_week_seq\n from date_dim\n where d_year = 1999\n and d_moy = 12\n and d_dom = 11)\n group by i_brand_id,i_class_id,i_category_id\n having sum(ss_quantity*ss_list_price) > (select average_sales from avg_sales)) last_year\n where this_year.i_brand_id= last_year.i_brand_id\n and this_year.i_class_id = last_year.i_class_id\n and this_year.i_category_id = last_year.i_category_id\n order by this_year.channel, this_year.i_brand_id, this_year.i_class_id, this_year.i_category_id\n limit 100;", "useLegacySql": false, "useQueryCache": false } }, "etag": "m4AF+lQ4wbjtPve0dZVSXw==", "id": "test-project-364309:europe-west1.query14_1665776907", "jobReference": { "jobId": "query14_1665776907", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query14_1665776907?location=europe-west1", "statistics": { "creationTime": "1665776907819", "endTime": "1665776913952", "numChildJobs": "2", "query": { "schema": { "fields": [ { "mode": "NULLABLE", "name": "ty_channel", "type": "STRING" }, { "mode": "NULLABLE", "name": "ty_brand", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ty_class", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ty_category", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ty_sales", "type": "NUMERIC" }, { "mode": "NULLABLE", "name": "ty_number_sales", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_channel", "type": "STRING" }, { "mode": "NULLABLE", "name": "ly_brand", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_class", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_category", "type": "INTEGER" }, { "mode": "NULLABLE", "name": "ly_sales", "type": "NUMERIC" }, { "mode": "NULLABLE", "name": "ly_number_sales", "type": "INTEGER" } ] }, "statementType": "SCRIPT", "totalBytesBilled": "401604608", "totalBytesProcessed": "400339584", "totalSlotMs": "130294" }, "startTime": "1665776907864", "totalBytesProcessed": "400339584", "totalSlotMs": "130294" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
