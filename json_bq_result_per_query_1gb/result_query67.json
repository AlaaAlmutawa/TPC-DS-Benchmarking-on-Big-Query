{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anonabab0e41_ad6a_4cd8_812b_92a038f71a69" }, "priority": "INTERACTIVE", "query": "-- start query 67 in stream 0 using template query67.tpl\n\n/*\nFind top stores for each category based on store sales in a specific year.\n*/\n\nselect *\nfrom (select i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sumsales\n ,rank() over (partition by i_category order by sumsales desc) rk\n from (select i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sum(coalesce(ss_sales_price*ss_quantity,0)) sumsales\n from store_sales\n ,date_dim\n ,store\n ,item\n where ss_sold_date_sk=d_date_sk\n and ss_item_sk=i_item_sk\n and ss_store_sk = s_store_sk\n and d_month_seq between 1200 and 1200+11\n group by rollup(i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy,s_store_id))dw1) dw2\nwhere rk <= 100\norder by i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sumsales\n ,rk\nlimit 100\n;\n\n-- end query 67 in stream 0 using template query67.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "Zbxi5XRmxbNjZIA2F4oPGw==", "id": "test-project-364309:europe-west1.query67_1665768428", "jobReference": { "jobId": "query67_1665768428", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query67_1665768428?location=europe-west1", "statistics": { "creationTime": "1665768428717", "endTime": "1665768431621", "finalExecutionDurationMs": "2681", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "137134150", "performanceInsights": { "avgPreviousExecutionMs": "3556" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "28", "computeMsMax": "28", "computeRatioAvg": 0.011484823625922888, "computeRatioMax": 0.011484823625922888, "endMs": "1665768428929", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.002461033634126333, "readRatioMax": 0.002461033634126333, "recordsRead": "18000", "recordsWritten": "18000", "shuffleOutputBytes": "1381802", "shuffleOutputBytesSpilled": "0", "slotMs": "49", "startMs": "1665768428873", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:i_item_sk, $2:i_brand, $3:i_class, $4:i_category, $5:i_product_name", "FROM item" ] }, { "kind": "WRITE", "substeps": [ "$1, $2, $3, $4, $5", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00041017227235438887, "waitRatioMax": 0.00041017227235438887, "writeMsAvg": "23", "writeMsMax": "23", "writeRatioAvg": 0.009433962264150943, "writeRatioMax": 0.009433962264150943 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.004101722723543888, "computeRatioMax": 0.004101722723543888, "endMs": "1665768428917", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.002461033634126333, "readRatioMax": 0.002461033634126333, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "360", "shuffleOutputBytesSpilled": "0", "slotMs": "31", "startMs": "1665768428889", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:s_store_sk, $11:s_store_id", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00041017227235438887, "waitRatioMax": 0.00041017227235438887, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.006562756357670222, "writeRatioMax": 0.006562756357670222 }, { "completedParallelInputs": "1", "computeMsAvg": "15", "computeMsMax": "15", "computeRatioAvg": 0.0061525840853158325, "computeRatioMax": 0.0061525840853158325, "endMs": "1665768428946", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "10", "readMsMax": "10", "readRatioAvg": 0.004101722723543888, "readRatioMax": 0.004101722723543888, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "13176", "shuffleOutputBytesSpilled": "0", "slotMs": "82", "startMs": "1665768428903", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $32:d_year, $33:d_moy, $34:d_qoy, $31:d_month_seq", "FROM date_dim", "WHERE between($31, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$30, $32, $33, $34", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00041017227235438887, "waitRatioMax": 0.00041017227235438887, "writeMsAvg": "10", "writeMsMax": "10", "writeRatioAvg": 0.004101722723543888, "writeRatioMax": 0.004101722723543888 }, { "completedParallelInputs": "6", "computeMsAvg": "2128", "computeMsMax": "2438", "computeRatioAvg": 0.8728465955701394, "computeRatioMax": 1, "endMs": "1665768430199", "id": "4", "inputStages": [ "1", "0", "2" ], "name": "S04: Join+", "parallelInputs": "6", "readMsAvg": "11", "readMsMax": "13", "readRatioAvg": 0.004511894995898278, "readRatioMax": 0.005332239540607055, "recordsRead": "2990672", "recordsWritten": "1141035", "shuffleOutputBytes": "144923488", "shuffleOutputBytesSpilled": "0", "slotMs": "9752", "startMs": "1665768428956", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ss_sold_date_sk, $21:ss_item_sk, $22:ss_store_sk, $23:ss_quantity, $24:ss_sales_price", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$30, $32, $33, $34", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$1, $2, $3, $4, $5", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $260 := $161, $261 := $162, $262 := $163, $263 := $164, $264 := $165, $265 := $166, $266 := $167, $267 := $168, $268 := $200", "$110 := SUM($160)" ] }, { "kind": "COMPUTE", "substeps": [ "$160 := coalesce(multiply($252, CAST($251 AS NUMERIC)), NUMERIC<...>)", "$161 := if(equal(bitwise_and($220, 1), 0), NULL, $258)", "$162 := if(equal(bitwise_and($220, 2), 0), NULL, $257)", "$163 := if(equal(bitwise_and($220, 4), 0), NULL, $256)", "$164 := if(equal(bitwise_and($220, 8), 0), NULL, $259)", "$165 := if(equal(bitwise_and($220, 16), 0), NULL, $253)", "$166 := if(equal(bitwise_and($220, 32), 0), NULL, $255)", "$167 := if(equal(bitwise_and($220, 64), 0), NULL, $254)", "$168 := if(equal(bitwise_and($220, 128), 0), NULL, $250)" ] }, { "kind": "COMPUTE", "substeps": [ "$190 := ARRAY<...>" ] }, { "kind": "JOIN", "substeps": [ "$250 := $246, $251 := $241, $252 := $242, $253 := $243, $254 := $244, $255 := $245, $256 := $2, $257 := $3, $258 := $4, $259 := $5", "INNER HASH JOIN EACH WITH ALL ON $240 = $1" ] }, { "kind": "JOIN", "substeps": [ "$240 := $230, $241 := $232, $242 := $233, $243 := $234, $244 := $235, $245 := $236, $246 := $11", "INNER HASH JOIN EACH WITH ALL ON $231 = $10" ] }, { "kind": "JOIN", "substeps": [ "$230 := $21, $231 := $22, $232 := $23, $233 := $24, $234 := $32, $235 := $33, $236 := $34", "INNER HASH JOIN EACH WITH ALL ON $20 = $30" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := subtract($221, 1)" ] }, { "kind": "WRITE", "substeps": [ "$110, $260, $261, $262, $263, $264, $265, $266, $267, $268", "TO __stage04_output", "BY HASH($260, $261, $262, $263, $264, $265, $266, $267, $268)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00041017227235438887, "waitRatioMax": 0.00041017227235438887, "writeMsAvg": "10", "writeMsMax": "11", "writeRatioAvg": 0.004101722723543888, "writeRatioMax": 0.004511894995898278 }, { "completedParallelInputs": "1", "computeMsAvg": "1932", "computeMsMax": "1932", "computeRatioAvg": 0.7924528301886793, "computeRatioMax": 0.7924528301886793, "endMs": "1665768431251", "id": "5", "inputStages": [ "4" ], "name": "S05: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1141035", "recordsWritten": "505037", "shuffleOutputBytes": "63087737", "shuffleOutputBytesSpilled": "0", "slotMs": "1423", "startMs": "1665768430227", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$110, $260, $261, $262, $263, $264, $265, $266, $267, $268", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $270 := $260, $271 := $261, $272 := $262, $273 := $263, $274 := $264, $275 := $265, $276 := $266, $277 := $267, $278 := $268", "$70 := SUM($110)" ] }, { "kind": "WRITE", "substeps": [ "$70, $270, $271, $272, $273, $274, $275, $276, $277", "TO __stage05_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00041017227235438887, "waitRatioMax": 0.00041017227235438887, "writeMsAvg": "10", "writeMsMax": "10", "writeRatioAvg": 0.004101722723543888, "writeRatioMax": 0.004101722723543888 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.0036915504511894994, "computeRatioMax": 0.0036915504511894994, "endMs": "1665768431384", "id": "6", "name": "S06: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "36", "startMs": "1665768431350", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$180, $351, $350", "FROM __SHUFFLE4" ] }, { "kind": "COMPUTE", "substeps": [ "$100 := coalesce($360, '')", "$101 := coalesce($360, '0')", "$102 := coalesce($361, NUMERIC<...>)", "$103 := coalesce($361, NUMERIC<...>)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $360 := $350, $361 := $351", "$150 := MIN($180)" ] }, { "kind": "WRITE", "substeps": [ "$100, $101, $102, $103, $150", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00041017227235438887, "waitRatioMax": 0.00041017227235438887, "writeMsAvg": "30", "writeMsMax": "30", "writeRatioAvg": 0.012305168170631665, "writeRatioMax": 0.012305168170631665 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "16", "computeRatioAvg": 0.003281378178835111, "computeRatioMax": 0.006562756357670222, "endMs": "1665768431448", "id": "8", "inputStages": [ "6" ], "name": "S08: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3283", "startMs": "1665768431392", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "2", "waitRatioAvg": 0.00041017227235438887, "waitRatioMax": 0.0008203445447087777, "writeMsAvg": "16", "writeMsMax": "31", "writeRatioAvg": 0.006562756357670222, "writeRatioMax": 0.012715340442986054 }, { "completedParallelInputs": "101", "computeMsAvg": "22", "computeMsMax": "182", "computeRatioAvg": 0.009023789991796555, "computeRatioMax": 0.07465135356849877, "endMs": "1665768431494", "id": "9", "inputStages": [ "5", "8" ], "name": "S09: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "505037", "recordsWritten": "1000", "shuffleOutputBytes": "83974", "shuffleOutputBytesSpilled": "0", "slotMs": "4202", "startMs": "1665768431395", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70, $270, $271, $272, $273, $274, $275, $276, $277", "FROM __stage05_output" ] }, { "kind": "READ", "substeps": [ "$130, $320, $321, $322, $323, $324, $325, $326, $327, $328", "FROM __SHUFFLE3" ] }, { "kind": "READ", "substeps": [ "$100, $101, $102, $103, $150", "FROM __stage08_output" ] }, { "kind": "SORT", "substeps": [ "$52 ASC, $53 ASC, $54 ASC, $55 ASC, $56 ASC, $57 ASC, $58 ASC, $59 ASC, $51 ASC, $50 ASC", "LIMIT 100" ] }, { "kind": "FILTER", "substeps": [ "less_or_equal($50, 100)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$60 := RANK() OVER (PARTITION BY $281 ORDER BY $280 DESC)" ] }, { "kind": "SORT", "substeps": [ "$121 ASC, $120 DESC" ] }, { "kind": "JOIN", "substeps": [ "$370 := $140, $371 := $141, $372 := $142, $373 := $143, $374 := $144, $375 := $145, $376 := $146, $377 := $147, $378 := $148, $379 := $150", "INNER HASH JOIN EACH WITH ALL ON $90 = $100, $91 = $101, $92 = $102, $93 = $103" ] }, { "kind": "COMPUTE", "substeps": [ "$90 := coalesce($141, '')", "$91 := coalesce($141, '0')", "$92 := coalesce($140, NUMERIC<...>)", "$93 := coalesce($140, NUMERIC<...>)" ] }, { "kind": "WRITE", "substeps": [ "$380, $381, $382, $383, $384, $385, $386, $387, $388, $389", "TO __stage09_output" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.0008203445447087777, "waitRatioMax": 0.0012305168170631665, "writeMsAvg": "13", "writeMsMax": "22", "writeRatioAvg": 0.005332239540607055, "writeRatioMax": 0.009023789991796555 }, { "completedParallelInputs": "1", "computeMsAvg": "6", "computeMsMax": "6", "computeRatioAvg": 0.002461033634126333, "computeRatioMax": 0.002461033634126333, "endMs": "1665768431500", "id": "10", "inputStages": [ "9" ], "name": "S0A: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1000", "recordsWritten": "100", "shuffleOutputBytes": "6205", "shuffleOutputBytesSpilled": "0", "slotMs": "22", "startMs": "1665768431409", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$380, $381, $382, $383, $384, $385, $386, $387, $388, $389", "FROM __stage09_output" ] }, { "kind": "SORT", "substeps": [ "$382 ASC, $383 ASC, $384 ASC, $385 ASC, $386 ASC, $387 ASC, $388 ASC, $389 ASC, $381 ASC, $380 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$390, $391, $392, $393, $394, $395, $396, $397, $398, $399", "TO __stage0A_output" ] } ], "waitMsAvg": "6", "waitMsMax": "6", "waitRatioAvg": 0.002461033634126333, "waitRatioMax": 0.002461033634126333, "writeMsAvg": "4", "writeMsMax": "4", "writeRatioAvg": 0.0016406890894175555, "writeRatioMax": 0.0016406890894175555 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "item" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "6", "completedUnits": "3", "elapsedMs": "608", "estimatedRunnableUnits": "0", "pendingUnits": "6", "totalSlotMs": "1169" }, { "activeUnits": "1", "completedUnits": "9", "elapsedMs": "1587", "estimatedRunnableUnits": "6", "pendingUnits": "1", "totalSlotMs": "9916" }, { "activeUnits": "1", "completedUnits": "213", "elapsedMs": "2784", "estimatedRunnableUnits": "6", "pendingUnits": "0", "totalSlotMs": "18884" } ], "totalBytesBilled": "137363456", "totalBytesProcessed": "137134150", "totalPartitionsProcessed": "0", "totalSlotMs": "18884", "transferredBytes": "0" }, "startTime": "1665768428766", "totalBytesProcessed": "137134150", "totalSlotMs": "18884" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon96b69e82_24b0_4b9c_9f74_1a4204085a6f" }, "priority": "INTERACTIVE", "query": "-- start query 67 in stream 0 using template query67.tpl\n\n/*\nFind top stores for each category based on store sales in a specific year.\n*/\n\nselect *\nfrom (select i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sumsales\n ,rank() over (partition by i_category order by sumsales desc) rk\n from (select i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sum(coalesce(ss_sales_price*ss_quantity,0)) sumsales\n from store_sales\n ,date_dim\n ,store\n ,item\n where ss_sold_date_sk=d_date_sk\n and ss_item_sk=i_item_sk\n and ss_store_sk = s_store_sk\n and d_month_seq between 1200 and 1200+11\n group by rollup(i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy,s_store_id))dw1) dw2\nwhere rk <= 100\norder by i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sumsales\n ,rk\nlimit 100\n;\n\n-- end query 67 in stream 0 using template query67.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "P4nTJj6wIp31gHym51SVEA==", "id": "test-project-364309:europe-west1.query67_1665778367", "jobReference": { "jobId": "query67_1665778367", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query67_1665778367?location=europe-west1", "statistics": { "creationTime": "1665778367968", "endTime": "1665778372369", "finalExecutionDurationMs": "4162", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "137134150", "performanceInsights": { "avgPreviousExecutionMs": "3337" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "19", "computeMsMax": "19", "computeRatioAvg": 0.00448642266824085, "computeRatioMax": 0.00448642266824085, "endMs": "1665778368167", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.0014167650531286896, "readRatioMax": 0.0014167650531286896, "recordsRead": "18000", "recordsWritten": "18000", "shuffleOutputBytes": "1381802", "shuffleOutputBytesSpilled": "0", "slotMs": "34", "startMs": "1665778368135", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:i_item_sk, $2:i_brand, $3:i_class, $4:i_category, $5:i_product_name", "FROM item" ] }, { "kind": "WRITE", "substeps": [ "$1, $2, $3, $4, $5", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0002361275088547816, "waitRatioMax": 0.0002361275088547816, "writeMsAvg": "12", "writeMsMax": "12", "writeRatioAvg": 0.002833530106257379, "writeRatioMax": 0.002833530106257379 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.001652892561983471, "computeRatioMax": 0.001652892561983471, "endMs": "1665778368190", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.0009445100354191264, "readRatioMax": 0.0009445100354191264, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "360", "shuffleOutputBytesSpilled": "0", "slotMs": "38", "startMs": "1665778368152", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:s_store_sk, $11:s_store_id", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0002361275088547816, "waitRatioMax": 0.0002361275088547816, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.0035419126328217238, "writeRatioMax": 0.0035419126328217238 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.0021251475796930344, "computeRatioMax": 0.0021251475796930344, "endMs": "1665778368195", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.0011806375442739079, "readRatioMax": 0.0011806375442739079, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "13176", "shuffleOutputBytesSpilled": "0", "slotMs": "27", "startMs": "1665778368168", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $32:d_year, $33:d_moy, $34:d_qoy, $31:d_month_seq", "FROM date_dim", "WHERE between($31, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$30, $32, $33, $34", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0002361275088547816, "waitRatioMax": 0.0002361275088547816, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.003305785123966942, "writeRatioMax": 0.003305785123966942 }, { "completedParallelInputs": "6", "computeMsAvg": "2068", "computeMsMax": "2543", "computeRatioAvg": 0.4883116883116883, "computeRatioMax": 0.6004722550177095, "endMs": "1665778369634", "id": "4", "inputStages": [ "2", "1", "0" ], "name": "S04: Join+", "parallelInputs": "6", "readMsAvg": "14", "readMsMax": "24", "readRatioAvg": 0.003305785123966942, "readRatioMax": 0.005667060212514758, "recordsRead": "2990672", "recordsWritten": "1141035", "shuffleOutputBytes": "144923488", "shuffleOutputBytesSpilled": "0", "slotMs": "10181", "startMs": "1665778368202", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ss_sold_date_sk, $21:ss_item_sk, $22:ss_store_sk, $23:ss_quantity, $24:ss_sales_price", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$30, $32, $33, $34", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$1, $2, $3, $4, $5", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $260 := $161, $261 := $162, $262 := $163, $263 := $164, $264 := $165, $265 := $166, $266 := $167, $267 := $168, $268 := $200", "$110 := SUM($160)" ] }, { "kind": "COMPUTE", "substeps": [ "$160 := coalesce(multiply($252, CAST($251 AS NUMERIC)), NUMERIC<...>)", "$161 := if(equal(bitwise_and($220, 1), 0), NULL, $258)", "$162 := if(equal(bitwise_and($220, 2), 0), NULL, $257)", "$163 := if(equal(bitwise_and($220, 4), 0), NULL, $256)", "$164 := if(equal(bitwise_and($220, 8), 0), NULL, $259)", "$165 := if(equal(bitwise_and($220, 16), 0), NULL, $253)", "$166 := if(equal(bitwise_and($220, 32), 0), NULL, $255)", "$167 := if(equal(bitwise_and($220, 64), 0), NULL, $254)", "$168 := if(equal(bitwise_and($220, 128), 0), NULL, $250)" ] }, { "kind": "COMPUTE", "substeps": [ "$190 := ARRAY<...>" ] }, { "kind": "JOIN", "substeps": [ "$250 := $246, $251 := $241, $252 := $242, $253 := $243, $254 := $244, $255 := $245, $256 := $2, $257 := $3, $258 := $4, $259 := $5", "INNER HASH JOIN EACH WITH ALL ON $240 = $1" ] }, { "kind": "JOIN", "substeps": [ "$240 := $230, $241 := $232, $242 := $233, $243 := $234, $244 := $235, $245 := $236, $246 := $11", "INNER HASH JOIN EACH WITH ALL ON $231 = $10" ] }, { "kind": "JOIN", "substeps": [ "$230 := $21, $231 := $22, $232 := $23, $233 := $24, $234 := $32, $235 := $33, $236 := $34", "INNER HASH JOIN EACH WITH ALL ON $20 = $30" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := subtract($221, 1)" ] }, { "kind": "WRITE", "substeps": [ "$110, $260, $261, $262, $263, $264, $265, $266, $267, $268", "TO __stage04_output", "BY HASH($260, $261, $262, $263, $264, $265, $266, $267, $268)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0002361275088547816, "waitRatioMax": 0.0002361275088547816, "writeMsAvg": "10", "writeMsMax": "14", "writeRatioAvg": 0.0023612750885478157, "writeRatioMax": 0.003305785123966942 }, { "completedParallelInputs": "1", "computeMsAvg": "4235", "computeMsMax": "4235", "computeRatioAvg": 1, "computeRatioMax": 1, "endMs": "1665778372069", "id": "5", "inputStages": [ "4" ], "name": "S05: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1141035", "recordsWritten": "505037", "shuffleOutputBytes": "63087737", "shuffleOutputBytesSpilled": "0", "slotMs": "3845", "startMs": "1665778369688", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$110, $260, $261, $262, $263, $264, $265, $266, $267, $268", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $270 := $260, $271 := $261, $272 := $262, $273 := $263, $274 := $264, $275 := $265, $276 := $266, $277 := $267, $278 := $268", "$70 := SUM($110)" ] }, { "kind": "WRITE", "substeps": [ "$70, $270, $271, $272, $273, $274, $275, $276, $277", "TO __stage05_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0002361275088547816, "waitRatioMax": 0.0002361275088547816, "writeMsAvg": "21", "writeMsMax": "21", "writeRatioAvg": 0.0049586776859504135, "writeRatioMax": 0.0049586776859504135 }, { "completedParallelInputs": "1", "computeMsAvg": "6", "computeMsMax": "6", "computeRatioAvg": 0.0014167650531286896, "computeRatioMax": 0.0014167650531286896, "endMs": "1665778372119", "id": "6", "name": "S06: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "34", "startMs": "1665778372085", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$180, $351, $350", "FROM __SHUFFLE4" ] }, { "kind": "COMPUTE", "substeps": [ "$100 := coalesce($360, '')", "$101 := coalesce($360, '0')", "$102 := coalesce($361, NUMERIC<...>)", "$103 := coalesce($361, NUMERIC<...>)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $360 := $350, $361 := $351", "$150 := MIN($180)" ] }, { "kind": "WRITE", "substeps": [ "$100, $101, $102, $103, $150", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0002361275088547816, "waitRatioMax": 0.0002361275088547816, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.004250295159386069, "writeRatioMax": 0.004250295159386069 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "19", "computeRatioAvg": 0.0018890200708382527, "computeRatioMax": 0.00448642266824085, "endMs": "1665778372184", "id": "8", "inputStages": [ "6" ], "name": "S08: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3644", "startMs": "1665778372130", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage06_output" ] } ], "waitMsAvg": "2", "waitMsMax": "4", "waitRatioAvg": 0.0004722550177095632, "waitRatioMax": 0.0009445100354191264, "writeMsAvg": "15", "writeMsMax": "26", "writeRatioAvg": 0.0035419126328217238, "writeRatioMax": 0.006139315230224321 }, { "completedParallelInputs": "101", "computeMsAvg": "21", "computeMsMax": "169", "computeRatioAvg": 0.0049586776859504135, "computeRatioMax": 0.03990554899645809, "endMs": "1665778372263", "id": "9", "inputStages": [ "8", "5" ], "name": "S09: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "505037", "recordsWritten": "1000", "shuffleOutputBytes": "83974", "shuffleOutputBytesSpilled": "0", "slotMs": "3598", "startMs": "1665778372137", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70, $270, $271, $272, $273, $274, $275, $276, $277", "FROM __stage05_output" ] }, { "kind": "READ", "substeps": [ "$130, $320, $321, $322, $323, $324, $325, $326, $327, $328", "FROM __SHUFFLE3" ] }, { "kind": "READ", "substeps": [ "$100, $101, $102, $103, $150", "FROM __stage08_output" ] }, { "kind": "SORT", "substeps": [ "$52 ASC, $53 ASC, $54 ASC, $55 ASC, $56 ASC, $57 ASC, $58 ASC, $59 ASC, $51 ASC, $50 ASC", "LIMIT 100" ] }, { "kind": "FILTER", "substeps": [ "less_or_equal($50, 100)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$60 := RANK() OVER (PARTITION BY $281 ORDER BY $280 DESC)" ] }, { "kind": "SORT", "substeps": [ "$121 ASC, $120 DESC" ] }, { "kind": "JOIN", "substeps": [ "$370 := $140, $371 := $141, $372 := $142, $373 := $143, $374 := $144, $375 := $145, $376 := $146, $377 := $147, $378 := $148, $379 := $150", "INNER HASH JOIN EACH WITH ALL ON $90 = $100, $91 = $101, $92 = $102, $93 = $103" ] }, { "kind": "COMPUTE", "substeps": [ "$90 := coalesce($141, '')", "$91 := coalesce($141, '0')", "$92 := coalesce($140, NUMERIC<...>)", "$93 := coalesce($140, NUMERIC<...>)" ] }, { "kind": "WRITE", "substeps": [ "$380, $381, $382, $383, $384, $385, $386, $387, $388, $389", "TO __stage09_output" ] } ], "waitMsAvg": "6", "waitMsMax": "8", "waitRatioAvg": 0.0014167650531286896, "waitRatioMax": 0.0018890200708382527, "writeMsAvg": "12", "writeMsMax": "18", "writeRatioAvg": 0.002833530106257379, "writeRatioMax": 0.004250295159386069 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.0023612750885478157, "computeRatioMax": 0.0023612750885478157, "endMs": "1665778372267", "id": "10", "inputStages": [ "9" ], "name": "S0A: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1000", "recordsWritten": "100", "shuffleOutputBytes": "6205", "shuffleOutputBytesSpilled": "0", "slotMs": "53", "startMs": "1665778372148", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$380, $381, $382, $383, $384, $385, $386, $387, $388, $389", "FROM __stage09_output" ] }, { "kind": "SORT", "substeps": [ "$382 ASC, $383 ASC, $384 ASC, $385 ASC, $386 ASC, $387 ASC, $388 ASC, $389 ASC, $381 ASC, $380 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$390, $391, $392, $393, $394, $395, $396, $397, $398, $399", "TO __stage0A_output" ] } ], "waitMsAvg": "11", "waitMsMax": "11", "waitRatioAvg": 0.0025974025974025974, "waitRatioMax": 0.0025974025974025974, "writeMsAvg": "4", "writeMsMax": "4", "writeRatioAvg": 0.0009445100354191264, "writeRatioMax": 0.0009445100354191264 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "item" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "6", "completedUnits": "3", "elapsedMs": "610", "estimatedRunnableUnits": "0", "pendingUnits": "6", "totalSlotMs": "1595" }, { "activeUnits": "2", "completedUnits": "9", "elapsedMs": "2111", "estimatedRunnableUnits": "0", "pendingUnits": "1", "totalSlotMs": "10397" }, { "activeUnits": "1", "completedUnits": "213", "elapsedMs": "4276", "estimatedRunnableUnits": "1", "pendingUnits": "0", "totalSlotMs": "21410" } ], "totalBytesBilled": "137363456", "totalBytesProcessed": "137134150", "totalPartitionsProcessed": "0", "totalSlotMs": "21410", "transferredBytes": "0" }, "startTime": "1665778368026", "totalBytesProcessed": "137134150", "totalSlotMs": "21410" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon1102c101_5504_4d0c_bf55_5217b65f3f6e" }, "priority": "INTERACTIVE", "query": "-- start query 67 in stream 0 using template query67.tpl\n\n/*\nFind top stores for each category based on store sales in a specific year.\n*/\n\nselect *\nfrom (select i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sumsales\n ,rank() over (partition by i_category order by sumsales desc) rk\n from (select i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sum(coalesce(ss_sales_price*ss_quantity,0)) sumsales\n from store_sales\n ,date_dim\n ,store\n ,item\n where ss_sold_date_sk=d_date_sk\n and ss_item_sk=i_item_sk\n and ss_store_sk = s_store_sk\n and d_month_seq between 1200 and 1200+11\n group by rollup(i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy,s_store_id))dw1) dw2\nwhere rk <= 100\norder by i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sumsales\n ,rk\nlimit 100\n;\n\n-- end query 67 in stream 0 using template query67.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "cxr3wks8Xa3jK5b8SO3REA==", "id": "test-project-364309:europe-west1.query67_1665778373", "jobReference": { "jobId": "query67_1665778373", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query67_1665778373?location=europe-west1", "statistics": { "creationTime": "1665778374026", "endTime": "1665778377409", "finalExecutionDurationMs": "3168", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "137134150", "performanceInsights": { "avgPreviousExecutionMs": "3502" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "36", "computeMsMax": "36", "computeRatioAvg": 0.012884753042233358, "computeRatioMax": 0.012884753042233358, "endMs": "1665778374225", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.0021474588403722263, "readRatioMax": 0.0021474588403722263, "recordsRead": "18000", "recordsWritten": "18000", "shuffleOutputBytes": "1381802", "shuffleOutputBytesSpilled": "0", "slotMs": "47", "startMs": "1665778374189", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:i_item_sk, $2:i_brand, $3:i_class, $4:i_category, $5:i_product_name", "FROM item" ] }, { "kind": "WRITE", "substeps": [ "$1, $2, $3, $4, $5", "TO __stage00_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0007158196134574087, "waitRatioMax": 0.0007158196134574087, "writeMsAvg": "11", "writeMsMax": "11", "writeRatioAvg": 0.003937007874015748, "writeRatioMax": 0.003937007874015748 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.0025053686471009306, "computeRatioMax": 0.0025053686471009306, "endMs": "1665778374249", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.0014316392269148174, "readRatioMax": 0.0014316392269148174, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "360", "shuffleOutputBytesSpilled": "0", "slotMs": "40", "startMs": "1665778374207", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:s_store_sk, $11:s_store_id", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00035790980672870435, "waitRatioMax": 0.00035790980672870435, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.006084466714387974, "writeRatioMax": 0.006084466714387974 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.0025053686471009306, "computeRatioMax": 0.0025053686471009306, "endMs": "1665778374269", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.0021474588403722263, "readRatioMax": 0.0021474588403722263, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "13176", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665778374232", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $32:d_year, $33:d_moy, $34:d_qoy, $31:d_month_seq", "FROM date_dim", "WHERE between($31, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$30, $32, $33, $34", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00035790980672870435, "waitRatioMax": 0.00035790980672870435, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.0046528274874731565, "writeRatioMax": 0.0046528274874731565 }, { "completedParallelInputs": "6", "computeMsAvg": "2034", "computeMsMax": "2285", "computeRatioAvg": 0.7279885468861846, "computeRatioMax": 0.8178239083750894, "endMs": "1665778375540", "id": "4", "inputStages": [ "1", "0", "2" ], "name": "S04: Join+", "parallelInputs": "6", "readMsAvg": "13", "readMsMax": "23", "readRatioAvg": 0.0046528274874731565, "readRatioMax": 0.0082319255547602, "recordsRead": "2990672", "recordsWritten": "1141035", "shuffleOutputBytes": "144923488", "shuffleOutputBytesSpilled": "0", "slotMs": "10874", "startMs": "1665778374282", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ss_sold_date_sk, $21:ss_item_sk, $22:ss_store_sk, $23:ss_quantity, $24:ss_sales_price", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$30, $32, $33, $34", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$1, $2, $3, $4, $5", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $260 := $161, $261 := $162, $262 := $163, $263 := $164, $264 := $165, $265 := $166, $266 := $167, $267 := $168, $268 := $200", "$110 := SUM($160)" ] }, { "kind": "COMPUTE", "substeps": [ "$160 := coalesce(multiply($252, CAST($251 AS NUMERIC)), NUMERIC<...>)", "$161 := if(equal(bitwise_and($220, 1), 0), NULL, $258)", "$162 := if(equal(bitwise_and($220, 2), 0), NULL, $257)", "$163 := if(equal(bitwise_and($220, 4), 0), NULL, $256)", "$164 := if(equal(bitwise_and($220, 8), 0), NULL, $259)", "$165 := if(equal(bitwise_and($220, 16), 0), NULL, $253)", "$166 := if(equal(bitwise_and($220, 32), 0), NULL, $255)", "$167 := if(equal(bitwise_and($220, 64), 0), NULL, $254)", "$168 := if(equal(bitwise_and($220, 128), 0), NULL, $250)" ] }, { "kind": "COMPUTE", "substeps": [ "$190 := ARRAY<...>" ] }, { "kind": "JOIN", "substeps": [ "$250 := $246, $251 := $241, $252 := $242, $253 := $243, $254 := $244, $255 := $245, $256 := $2, $257 := $3, $258 := $4, $259 := $5", "INNER HASH JOIN EACH WITH ALL ON $240 = $1" ] }, { "kind": "JOIN", "substeps": [ "$240 := $230, $241 := $232, $242 := $233, $243 := $234, $244 := $235, $245 := $236, $246 := $11", "INNER HASH JOIN EACH WITH ALL ON $231 = $10" ] }, { "kind": "JOIN", "substeps": [ "$230 := $21, $231 := $22, $232 := $23, $233 := $24, $234 := $32, $235 := $33, $236 := $34", "INNER HASH JOIN EACH WITH ALL ON $20 = $30" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := subtract($221, 1)" ] }, { "kind": "WRITE", "substeps": [ "$110, $260, $261, $262, $263, $264, $265, $266, $267, $268", "TO __stage04_output", "BY HASH($260, $261, $262, $263, $264, $265, $266, $267, $268)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0007158196134574087, "waitRatioMax": 0.0007158196134574087, "writeMsAvg": "11", "writeMsMax": "19", "writeRatioAvg": 0.003937007874015748, "writeRatioMax": 0.006800286327845383 }, { "completedParallelInputs": "1", "computeMsAvg": "2794", "computeMsMax": "2794", "computeRatioAvg": 1, "computeRatioMax": 1, "endMs": "1665778377049", "id": "5", "inputStages": [ "4" ], "name": "S05: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1141035", "recordsWritten": "505037", "shuffleOutputBytes": "63087737", "shuffleOutputBytesSpilled": "0", "slotMs": "2354", "startMs": "1665778375569", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$110, $260, $261, $262, $263, $264, $265, $266, $267, $268", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $270 := $260, $271 := $261, $272 := $262, $273 := $263, $274 := $264, $275 := $265, $276 := $266, $277 := $267, $278 := $268", "$70 := SUM($110)" ] }, { "kind": "WRITE", "substeps": [ "$70, $270, $271, $272, $273, $274, $275, $276, $277", "TO __stage05_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0007158196134574087, "waitRatioMax": 0.0007158196134574087, "writeMsAvg": "12", "writeMsMax": "12", "writeRatioAvg": 0.004294917680744453, "writeRatioMax": 0.004294917680744453 }, { "completedParallelInputs": "1", "computeMsAvg": "6", "computeMsMax": "6", "computeRatioAvg": 0.0021474588403722263, "computeRatioMax": 0.0021474588403722263, "endMs": "1665778377162", "id": "6", "name": "S06: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "40", "startMs": "1665778377124", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$180, $351, $350", "FROM __SHUFFLE4" ] }, { "kind": "COMPUTE", "substeps": [ "$100 := coalesce($360, '')", "$101 := coalesce($360, '0')", "$102 := coalesce($361, NUMERIC<...>)", "$103 := coalesce($361, NUMERIC<...>)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $360 := $350, $361 := $351", "$150 := MIN($180)" ] }, { "kind": "WRITE", "substeps": [ "$100, $101, $102, $103, $150", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00035790980672870435, "waitRatioMax": 0.00035790980672870435, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.006442376521116679, "writeRatioMax": 0.006442376521116679 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "13", "computeRatioAvg": 0.002863278453829635, "computeRatioMax": 0.0046528274874731565, "endMs": "1665778377242", "id": "8", "inputStages": [ "6" ], "name": "S08: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "4016", "startMs": "1665778377175", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage06_output" ] } ], "waitMsAvg": "2", "waitMsMax": "4", "waitRatioAvg": 0.0007158196134574087, "waitRatioMax": 0.0014316392269148174, "writeMsAvg": "17", "writeMsMax": "29", "writeRatioAvg": 0.006084466714387974, "writeRatioMax": 0.010379384395132427 }, { "completedParallelInputs": "101", "computeMsAvg": "22", "computeMsMax": "182", "computeRatioAvg": 0.007874015748031496, "computeRatioMax": 0.06513958482462419, "endMs": "1665778377286", "id": "9", "inputStages": [ "8", "5" ], "name": "S09: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "505037", "recordsWritten": "1000", "shuffleOutputBytes": "83974", "shuffleOutputBytesSpilled": "0", "slotMs": "5742", "startMs": "1665778377182", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70, $270, $271, $272, $273, $274, $275, $276, $277", "FROM __stage05_output" ] }, { "kind": "READ", "substeps": [ "$130, $320, $321, $322, $323, $324, $325, $326, $327, $328", "FROM __SHUFFLE3" ] }, { "kind": "READ", "substeps": [ "$100, $101, $102, $103, $150", "FROM __stage08_output" ] }, { "kind": "SORT", "substeps": [ "$52 ASC, $53 ASC, $54 ASC, $55 ASC, $56 ASC, $57 ASC, $58 ASC, $59 ASC, $51 ASC, $50 ASC", "LIMIT 100" ] }, { "kind": "FILTER", "substeps": [ "less_or_equal($50, 100)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$60 := RANK() OVER (PARTITION BY $281 ORDER BY $280 DESC)" ] }, { "kind": "SORT", "substeps": [ "$121 ASC, $120 DESC" ] }, { "kind": "JOIN", "substeps": [ "$370 := $140, $371 := $141, $372 := $142, $373 := $143, $374 := $144, $375 := $145, $376 := $146, $377 := $147, $378 := $148, $379 := $150", "INNER HASH JOIN EACH WITH ALL ON $90 = $100, $91 = $101, $92 = $102, $93 = $103" ] }, { "kind": "COMPUTE", "substeps": [ "$90 := coalesce($141, '')", "$91 := coalesce($141, '0')", "$92 := coalesce($140, NUMERIC<...>)", "$93 := coalesce($140, NUMERIC<...>)" ] }, { "kind": "WRITE", "substeps": [ "$380, $381, $382, $383, $384, $385, $386, $387, $388, $389", "TO __stage09_output" ] } ], "waitMsAvg": "6", "waitMsMax": "16", "waitRatioAvg": 0.0021474588403722263, "waitRatioMax": 0.00572655690765927, "writeMsAvg": "16", "writeMsMax": "31", "writeRatioAvg": 0.00572655690765927, "writeRatioMax": 0.011095204008589835 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.004294917680744453, "computeRatioMax": 0.004294917680744453, "endMs": "1665778377303", "id": "10", "inputStages": [ "9" ], "name": "S0A: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1000", "recordsWritten": "100", "shuffleOutputBytes": "6205", "shuffleOutputBytesSpilled": "0", "slotMs": "57", "startMs": "1665778377199", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$380, $381, $382, $383, $384, $385, $386, $387, $388, $389", "FROM __stage09_output" ] }, { "kind": "SORT", "substeps": [ "$382 ASC, $383 ASC, $384 ASC, $385 ASC, $386 ASC, $387 ASC, $388 ASC, $389 ASC, $381 ASC, $380 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$390, $391, $392, $393, $394, $395, $396, $397, $398, $399", "TO __stage0A_output" ] } ], "waitMsAvg": "5", "waitMsMax": "5", "waitRatioAvg": 0.0017895490336435219, "waitRatioMax": 0.0017895490336435219, "writeMsAvg": "6", "writeMsMax": "6", "writeRatioAvg": 0.0021474588403722263, "writeRatioMax": 0.0021474588403722263 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "item" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "6", "completedUnits": "3", "elapsedMs": "611", "estimatedRunnableUnits": "0", "pendingUnits": "6", "totalSlotMs": "2012" }, { "activeUnits": "1", "completedUnits": "9", "elapsedMs": "1592", "estimatedRunnableUnits": "0", "pendingUnits": "1", "totalSlotMs": "10995" }, { "activeUnits": "1", "completedUnits": "213", "elapsedMs": "3281", "estimatedRunnableUnits": "1", "pendingUnits": "0", "totalSlotMs": "23108" } ], "totalBytesBilled": "137363456", "totalBytesProcessed": "137134150", "totalPartitionsProcessed": "0", "totalSlotMs": "23108", "transferredBytes": "0" }, "startTime": "1665778374080", "totalBytesProcessed": "137134150", "totalSlotMs": "23108" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon893061f9_0034_4cda_a2b5_d48d94d869f7" }, "priority": "INTERACTIVE", "query": "-- start query 67 in stream 0 using template query67.tpl\n\n/*\nFind top stores for each category based on store sales in a specific year.\n*/\n\nselect *\nfrom (select i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sumsales\n ,rank() over (partition by i_category order by sumsales desc) rk\n from (select i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sum(coalesce(ss_sales_price*ss_quantity,0)) sumsales\n from store_sales\n ,date_dim\n ,store\n ,item\n where ss_sold_date_sk=d_date_sk\n and ss_item_sk=i_item_sk\n and ss_store_sk = s_store_sk\n and d_month_seq between 1200 and 1200+11\n group by rollup(i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy,s_store_id))dw1) dw2\nwhere rk <= 100\norder by i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sumsales\n ,rk\nlimit 100\n;\n\n-- end query 67 in stream 0 using template query67.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "m5D2bIRA643JlMjhSKQx0w==", "id": "test-project-364309:europe-west1.query67_1665778378", "jobReference": { "jobId": "query67_1665778378", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query67_1665778378?location=europe-west1", "statistics": { "creationTime": "1665778379715", "endTime": "1665778383674", "finalExecutionDurationMs": "3746", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "137134150", "performanceInsights": { "avgPreviousExecutionMs": "3447" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "24", "computeMsMax": "24", "computeRatioAvg": 0.007252946509519492, "computeRatioMax": 0.007252946509519492, "endMs": "1665778379913", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.001813236627379873, "readRatioMax": 0.001813236627379873, "recordsRead": "18000", "recordsWritten": "18000", "shuffleOutputBytes": "1381802", "shuffleOutputBytesSpilled": "0", "slotMs": "34", "startMs": "1665778379877", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:i_item_sk, $2:i_brand, $3:i_class, $4:i_category, $5:i_product_name", "FROM item" ] }, { "kind": "WRITE", "substeps": [ "$1, $2, $3, $4, $5", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0003022061045633122, "waitRatioMax": 0.0003022061045633122, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.0042308854638863705, "writeRatioMax": 0.0042308854638863705 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.0027198549410698096, "computeRatioMax": 0.0027198549410698096, "endMs": "1665778379922", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.0012088244182532487, "readRatioMax": 0.0012088244182532487, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "360", "shuffleOutputBytesSpilled": "0", "slotMs": "30", "startMs": "1665778379893", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:s_store_sk, $11:s_store_id", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0003022061045633122, "waitRatioMax": 0.0003022061045633122, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.005439709882139619, "writeRatioMax": 0.005439709882139619 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.003626473254759746, "computeRatioMax": 0.003626473254759746, "endMs": "1665778379940", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.0024176488365064974, "readRatioMax": 0.0024176488365064974, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "13176", "shuffleOutputBytesSpilled": "0", "slotMs": "35", "startMs": "1665778379908", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $32:d_year, $33:d_moy, $34:d_qoy, $31:d_month_seq", "FROM date_dim", "WHERE between($31, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$30, $32, $33, $34", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0003022061045633122, "waitRatioMax": 0.0003022061045633122, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.004533091568449683, "writeRatioMax": 0.004533091568449683 }, { "completedParallelInputs": "6", "computeMsAvg": "2204", "computeMsMax": "2634", "computeRatioAvg": 0.6660622544575401, "computeRatioMax": 0.7960108794197642, "endMs": "1665778381409", "id": "4", "inputStages": [ "2", "1", "0" ], "name": "S04: Join+", "parallelInputs": "6", "readMsAvg": "14", "readMsMax": "20", "readRatioAvg": 0.0042308854638863705, "readRatioMax": 0.0060441220912662436, "recordsRead": "2990672", "recordsWritten": "1141035", "shuffleOutputBytes": "144923488", "shuffleOutputBytesSpilled": "0", "slotMs": "11396", "startMs": "1665778379961", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ss_sold_date_sk, $21:ss_item_sk, $22:ss_store_sk, $23:ss_quantity, $24:ss_sales_price", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$30, $32, $33, $34", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$1, $2, $3, $4, $5", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $260 := $161, $261 := $162, $262 := $163, $263 := $164, $264 := $165, $265 := $166, $266 := $167, $267 := $168, $268 := $200", "$110 := SUM($160)" ] }, { "kind": "COMPUTE", "substeps": [ "$160 := coalesce(multiply($252, CAST($251 AS NUMERIC)), NUMERIC<...>)", "$161 := if(equal(bitwise_and($220, 1), 0), NULL, $258)", "$162 := if(equal(bitwise_and($220, 2), 0), NULL, $257)", "$163 := if(equal(bitwise_and($220, 4), 0), NULL, $256)", "$164 := if(equal(bitwise_and($220, 8), 0), NULL, $259)", "$165 := if(equal(bitwise_and($220, 16), 0), NULL, $253)", "$166 := if(equal(bitwise_and($220, 32), 0), NULL, $255)", "$167 := if(equal(bitwise_and($220, 64), 0), NULL, $254)", "$168 := if(equal(bitwise_and($220, 128), 0), NULL, $250)" ] }, { "kind": "COMPUTE", "substeps": [ "$190 := ARRAY<...>" ] }, { "kind": "JOIN", "substeps": [ "$250 := $246, $251 := $241, $252 := $242, $253 := $243, $254 := $244, $255 := $245, $256 := $2, $257 := $3, $258 := $4, $259 := $5", "INNER HASH JOIN EACH WITH ALL ON $240 = $1" ] }, { "kind": "JOIN", "substeps": [ "$240 := $230, $241 := $232, $242 := $233, $243 := $234, $244 := $235, $245 := $236, $246 := $11", "INNER HASH JOIN EACH WITH ALL ON $231 = $10" ] }, { "kind": "JOIN", "substeps": [ "$230 := $21, $231 := $22, $232 := $23, $233 := $24, $234 := $32, $235 := $33, $236 := $34", "INNER HASH JOIN EACH WITH ALL ON $20 = $30" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := subtract($221, 1)" ] }, { "kind": "WRITE", "substeps": [ "$110, $260, $261, $262, $263, $264, $265, $266, $267, $268", "TO __stage04_output", "BY HASH($260, $261, $262, $263, $264, $265, $266, $267, $268)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0003022061045633122, "waitRatioMax": 0.0003022061045633122, "writeMsAvg": "16", "writeMsMax": "40", "writeRatioAvg": 0.004835297673012995, "writeRatioMax": 0.012088244182532487 }, { "completedParallelInputs": "1", "computeMsAvg": "3309", "computeMsMax": "3309", "computeRatioAvg": 1, "computeRatioMax": 1, "endMs": "1665778383380", "id": "5", "inputStages": [ "4" ], "name": "S05: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1141035", "recordsWritten": "505037", "shuffleOutputBytes": "63087737", "shuffleOutputBytesSpilled": "0", "slotMs": "2980", "startMs": "1665778381428", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$110, $260, $261, $262, $263, $264, $265, $266, $267, $268", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $270 := $260, $271 := $261, $272 := $262, $273 := $263, $274 := $264, $275 := $265, $276 := $266, $277 := $267, $278 := $268", "$70 := SUM($110)" ] }, { "kind": "WRITE", "substeps": [ "$70, $270, $271, $272, $273, $274, $275, $276, $277", "TO __stage05_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0003022061045633122, "waitRatioMax": 0.0003022061045633122, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.003928679359323058, "writeRatioMax": 0.003928679359323058 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.0030220610456331218, "computeRatioMax": 0.0030220610456331218, "endMs": "1665778383459", "id": "6", "name": "S06: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "37", "startMs": "1665778383420", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$180, $351, $350", "FROM __SHUFFLE4" ] }, { "kind": "COMPUTE", "substeps": [ "$100 := coalesce($360, '')", "$101 := coalesce($360, '0')", "$102 := coalesce($361, NUMERIC<...>)", "$103 := coalesce($361, NUMERIC<...>)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $360 := $350, $361 := $351", "$150 := MIN($180)" ] }, { "kind": "WRITE", "substeps": [ "$100, $101, $102, $103, $150", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0003022061045633122, "waitRatioMax": 0.0003022061045633122, "writeMsAvg": "32", "writeMsMax": "32", "writeRatioAvg": 0.00967059534602599, "writeRatioMax": 0.00967059534602599 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "18", "computeRatioAvg": 0.0024176488365064974, "computeRatioMax": 0.005439709882139619, "endMs": "1665778383525", "id": "8", "inputStages": [ "6" ], "name": "S08: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3948", "startMs": "1665778383464", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage06_output" ] } ], "waitMsAvg": "2", "waitMsMax": "4", "waitRatioAvg": 0.0006044122091266244, "waitRatioMax": 0.0012088244182532487, "writeMsAvg": "19", "writeMsMax": "42", "writeRatioAvg": 0.005741915986702931, "writeRatioMax": 0.012692656391659111 }, { "completedParallelInputs": "101", "computeMsAvg": "21", "computeMsMax": "166", "computeRatioAvg": 0.006346328195829556, "computeRatioMax": 0.05016621335750982, "endMs": "1665778383568", "id": "9", "inputStages": [ "5", "8" ], "name": "S09: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "505037", "recordsWritten": "1000", "shuffleOutputBytes": "83974", "shuffleOutputBytesSpilled": "0", "slotMs": "4383", "startMs": "1665778383471", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70, $270, $271, $272, $273, $274, $275, $276, $277", "FROM __stage05_output" ] }, { "kind": "READ", "substeps": [ "$130, $320, $321, $322, $323, $324, $325, $326, $327, $328", "FROM __SHUFFLE3" ] }, { "kind": "READ", "substeps": [ "$100, $101, $102, $103, $150", "FROM __stage08_output" ] }, { "kind": "SORT", "substeps": [ "$52 ASC, $53 ASC, $54 ASC, $55 ASC, $56 ASC, $57 ASC, $58 ASC, $59 ASC, $51 ASC, $50 ASC", "LIMIT 100" ] }, { "kind": "FILTER", "substeps": [ "less_or_equal($50, 100)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$60 := RANK() OVER (PARTITION BY $281 ORDER BY $280 DESC)" ] }, { "kind": "SORT", "substeps": [ "$121 ASC, $120 DESC" ] }, { "kind": "JOIN", "substeps": [ "$370 := $140, $371 := $141, $372 := $142, $373 := $143, $374 := $144, $375 := $145, $376 := $146, $377 := $147, $378 := $148, $379 := $150", "INNER HASH JOIN EACH WITH ALL ON $90 = $100, $91 = $101, $92 = $102, $93 = $103" ] }, { "kind": "COMPUTE", "substeps": [ "$90 := coalesce($141, '')", "$91 := coalesce($141, '0')", "$92 := coalesce($140, NUMERIC<...>)", "$93 := coalesce($140, NUMERIC<...>)" ] }, { "kind": "WRITE", "substeps": [ "$380, $381, $382, $383, $384, $385, $386, $387, $388, $389", "TO __stage09_output" ] } ], "waitMsAvg": "5", "waitMsMax": "6", "waitRatioAvg": 0.0015110305228165609, "waitRatioMax": 0.001813236627379873, "writeMsAvg": "13", "writeMsMax": "28", "writeRatioAvg": 0.003928679359323058, "writeRatioMax": 0.008461770927772741 }, { "completedParallelInputs": "1", "computeMsAvg": "5", "computeMsMax": "5", "computeRatioAvg": 0.0015110305228165609, "computeRatioMax": 0.0015110305228165609, "endMs": "1665778383571", "id": "10", "inputStages": [ "9" ], "name": "S0A: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1000", "recordsWritten": "100", "shuffleOutputBytes": "6205", "shuffleOutputBytesSpilled": "0", "slotMs": "12", "startMs": "1665778383483", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$380, $381, $382, $383, $384, $385, $386, $387, $388, $389", "FROM __stage09_output" ] }, { "kind": "SORT", "substeps": [ "$382 ASC, $383 ASC, $384 ASC, $385 ASC, $386 ASC, $387 ASC, $388 ASC, $389 ASC, $381 ASC, $380 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$390, $391, $392, $393, $394, $395, $396, $397, $398, $399", "TO __stage0A_output" ] } ], "waitMsAvg": "4", "waitMsMax": "4", "waitRatioAvg": 0.0012088244182532487, "waitRatioMax": 0.0012088244182532487, "writeMsAvg": "2", "writeMsMax": "2", "writeRatioAvg": 0.0006044122091266244, "writeRatioMax": 0.0006044122091266244 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "item" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "6", "completedUnits": "3", "elapsedMs": "602", "estimatedRunnableUnits": "0", "pendingUnits": "6", "totalSlotMs": "2345" }, { "activeUnits": "6", "completedUnits": "9", "elapsedMs": "2116", "estimatedRunnableUnits": "0", "pendingUnits": "1", "totalSlotMs": "12145" }, { "activeUnits": "1", "completedUnits": "213", "elapsedMs": "3847", "estimatedRunnableUnits": "2", "pendingUnits": "0", "totalSlotMs": "22817" } ], "totalBytesBilled": "137363456", "totalBytesProcessed": "137134150", "totalPartitionsProcessed": "0", "totalSlotMs": "22817", "transferredBytes": "0" }, "startTime": "1665778379777", "totalBytesProcessed": "137134150", "totalSlotMs": "22817" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon47d6b1d6_fc58_4a95_afe3_8531ef7ce239" }, "priority": "INTERACTIVE", "query": "-- start query 67 in stream 0 using template query67.tpl\n\n/*\nFind top stores for each category based on store sales in a specific year.\n*/\n\nselect *\nfrom (select i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sumsales\n ,rank() over (partition by i_category order by sumsales desc) rk\n from (select i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sum(coalesce(ss_sales_price*ss_quantity,0)) sumsales\n from store_sales\n ,date_dim\n ,store\n ,item\n where ss_sold_date_sk=d_date_sk\n and ss_item_sk=i_item_sk\n and ss_store_sk = s_store_sk\n and d_month_seq between 1200 and 1200+11\n group by rollup(i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy,s_store_id))dw1) dw2\nwhere rk <= 100\norder by i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sumsales\n ,rk\nlimit 100\n;\n\n-- end query 67 in stream 0 using template query67.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "Jfu3XmwZmkMJa/tYNCunCg==", "id": "test-project-364309:europe-west1.query67_1665778385", "jobReference": { "jobId": "query67_1665778385", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query67_1665778385?location=europe-west1", "statistics": { "creationTime": "1665778386167", "endTime": "1665778389419", "finalExecutionDurationMs": "3049", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "137134150", "performanceInsights": { "avgPreviousExecutionMs": "3489" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "35", "computeMsMax": "35", "computeRatioAvg": 0.012156998957971519, "computeRatioMax": 0.012156998957971519, "endMs": "1665778386365", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.0027787426189649182, "readRatioMax": 0.0027787426189649182, "recordsRead": "18000", "recordsWritten": "18000", "shuffleOutputBytes": "1381802", "shuffleOutputBytesSpilled": "0", "slotMs": "48", "startMs": "1665778386328", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:i_item_sk, $2:i_brand, $3:i_class, $4:i_category, $5:i_product_name", "FROM item" ] }, { "kind": "WRITE", "substeps": [ "$1, $2, $3, $4, $5", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0003473428273706148, "waitRatioMax": 0.0003473428273706148, "writeMsAvg": "9", "writeMsMax": "9", "writeRatioAvg": 0.003126085446335533, "writeRatioMax": 0.003126085446335533 }, { "completedParallelInputs": "1", "computeMsAvg": "15", "computeMsMax": "15", "computeRatioAvg": 0.005210142410559222, "computeRatioMax": 0.005210142410559222, "endMs": "1665778386395", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.0024313997915943034, "readRatioMax": 0.0024313997915943034, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "360", "shuffleOutputBytesSpilled": "0", "slotMs": "49", "startMs": "1665778386345", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:s_store_sk, $11:s_store_id", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0003473428273706148, "waitRatioMax": 0.0003473428273706148, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.006599513720041681, "writeRatioMax": 0.006599513720041681 }, { "completedParallelInputs": "1", "computeMsAvg": "16", "computeMsMax": "16", "computeRatioAvg": 0.0055574852379298365, "computeRatioMax": 0.0055574852379298365, "endMs": "1665778386401", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "13", "readMsMax": "13", "readRatioAvg": 0.0045154567558179926, "readRatioMax": 0.0045154567558179926, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "13176", "shuffleOutputBytesSpilled": "0", "slotMs": "51", "startMs": "1665778386362", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $32:d_year, $33:d_moy, $34:d_qoy, $31:d_month_seq", "FROM date_dim", "WHERE between($31, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$30, $32, $33, $34", "TO __stage02_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0006946856547412296, "waitRatioMax": 0.0006946856547412296, "writeMsAvg": "12", "writeMsMax": "12", "writeRatioAvg": 0.004168113928447377, "writeRatioMax": 0.004168113928447377 }, { "completedParallelInputs": "6", "computeMsAvg": "2000", "computeMsMax": "2377", "computeRatioAvg": 0.6946856547412296, "computeRatioMax": 0.8256339006599513, "endMs": "1665778387623", "id": "4", "inputStages": [ "0", "1", "2" ], "name": "S04: Join+", "parallelInputs": "6", "readMsAvg": "12", "readMsMax": "19", "readRatioAvg": 0.004168113928447377, "readRatioMax": 0.006599513720041681, "recordsRead": "2990672", "recordsWritten": "1141035", "shuffleOutputBytes": "144923488", "shuffleOutputBytesSpilled": "0", "slotMs": "9808", "startMs": "1665778386413", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ss_sold_date_sk, $21:ss_item_sk, $22:ss_store_sk, $23:ss_quantity, $24:ss_sales_price", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$30, $32, $33, $34", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$1, $2, $3, $4, $5", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $260 := $161, $261 := $162, $262 := $163, $263 := $164, $264 := $165, $265 := $166, $266 := $167, $267 := $168, $268 := $200", "$110 := SUM($160)" ] }, { "kind": "COMPUTE", "substeps": [ "$160 := coalesce(multiply($252, CAST($251 AS NUMERIC)), NUMERIC<...>)", "$161 := if(equal(bitwise_and($220, 1), 0), NULL, $258)", "$162 := if(equal(bitwise_and($220, 2), 0), NULL, $257)", "$163 := if(equal(bitwise_and($220, 4), 0), NULL, $256)", "$164 := if(equal(bitwise_and($220, 8), 0), NULL, $259)", "$165 := if(equal(bitwise_and($220, 16), 0), NULL, $253)", "$166 := if(equal(bitwise_and($220, 32), 0), NULL, $255)", "$167 := if(equal(bitwise_and($220, 64), 0), NULL, $254)", "$168 := if(equal(bitwise_and($220, 128), 0), NULL, $250)" ] }, { "kind": "COMPUTE", "substeps": [ "$190 := ARRAY<...>" ] }, { "kind": "JOIN", "substeps": [ "$250 := $246, $251 := $241, $252 := $242, $253 := $243, $254 := $244, $255 := $245, $256 := $2, $257 := $3, $258 := $4, $259 := $5", "INNER HASH JOIN EACH WITH ALL ON $240 = $1" ] }, { "kind": "JOIN", "substeps": [ "$240 := $230, $241 := $232, $242 := $233, $243 := $234, $244 := $235, $245 := $236, $246 := $11", "INNER HASH JOIN EACH WITH ALL ON $231 = $10" ] }, { "kind": "JOIN", "substeps": [ "$230 := $21, $231 := $22, $232 := $23, $233 := $24, $234 := $32, $235 := $33, $236 := $34", "INNER HASH JOIN EACH WITH ALL ON $20 = $30" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := subtract($221, 1)" ] }, { "kind": "WRITE", "substeps": [ "$110, $260, $261, $262, $263, $264, $265, $266, $267, $268", "TO __stage04_output", "BY HASH($260, $261, $262, $263, $264, $265, $266, $267, $268)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0003473428273706148, "waitRatioMax": 0.0003473428273706148, "writeMsAvg": "10", "writeMsMax": "14", "writeRatioAvg": 0.0034734282737061478, "writeRatioMax": 0.004862799583188607 }, { "completedParallelInputs": "1", "computeMsAvg": "2879", "computeMsMax": "2879", "computeRatioAvg": 1, "computeRatioMax": 1, "endMs": "1665778389178", "id": "5", "inputStages": [ "4" ], "name": "S05: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1141035", "recordsWritten": "505037", "shuffleOutputBytes": "63087737", "shuffleOutputBytesSpilled": "0", "slotMs": "2572", "startMs": "1665778387657", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$110, $260, $261, $262, $263, $264, $265, $266, $267, $268", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $270 := $260, $271 := $261, $272 := $262, $273 := $263, $274 := $264, $275 := $265, $276 := $266, $277 := $267, $278 := $268", "$70 := SUM($110)" ] }, { "kind": "WRITE", "substeps": [ "$70, $270, $271, $272, $273, $274, $275, $276, $277", "TO __stage05_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0003473428273706148, "waitRatioMax": 0.0003473428273706148, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.0045154567558179926, "writeRatioMax": 0.0045154567558179926 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.0027787426189649182, "computeRatioMax": 0.0027787426189649182, "endMs": "1665778389232", "id": "6", "name": "S06: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "28", "startMs": "1665778389197", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$180, $351, $350", "FROM __SHUFFLE4" ] }, { "kind": "COMPUTE", "substeps": [ "$100 := coalesce($360, '')", "$101 := coalesce($360, '0')", "$102 := coalesce($361, NUMERIC<...>)", "$103 := coalesce($361, NUMERIC<...>)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $360 := $350, $361 := $351", "$150 := MIN($180)" ] }, { "kind": "WRITE", "substeps": [ "$100, $101, $102, $103, $150", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0003473428273706148, "waitRatioMax": 0.0003473428273706148, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.0055574852379298365, "writeRatioMax": 0.0055574852379298365 }, { "completedParallelInputs": "100", "computeMsAvg": "9", "computeMsMax": "19", "computeRatioAvg": 0.003126085446335533, "computeRatioMax": 0.006599513720041681, "endMs": "1665778389295", "id": "8", "inputStages": [ "6" ], "name": "S08: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "4070", "startMs": "1665778389239", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage06_output" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.0006946856547412296, "waitRatioMax": 0.0010420284821118443, "writeMsAvg": "22", "writeMsMax": "30", "writeRatioAvg": 0.007641542202153525, "writeRatioMax": 0.010420284821118444 }, { "completedParallelInputs": "101", "computeMsAvg": "18", "computeMsMax": "133", "computeRatioAvg": 0.006252170892671066, "computeRatioMax": 0.04619659604029177, "endMs": "1665778389334", "id": "9", "inputStages": [ "8", "5" ], "name": "S09: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "505037", "recordsWritten": "1000", "shuffleOutputBytes": "83974", "shuffleOutputBytesSpilled": "0", "slotMs": "3984", "startMs": "1665778389244", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70, $270, $271, $272, $273, $274, $275, $276, $277", "FROM __stage05_output" ] }, { "kind": "READ", "substeps": [ "$130, $320, $321, $322, $323, $324, $325, $326, $327, $328", "FROM __SHUFFLE3" ] }, { "kind": "READ", "substeps": [ "$100, $101, $102, $103, $150", "FROM __stage08_output" ] }, { "kind": "SORT", "substeps": [ "$52 ASC, $53 ASC, $54 ASC, $55 ASC, $56 ASC, $57 ASC, $58 ASC, $59 ASC, $51 ASC, $50 ASC", "LIMIT 100" ] }, { "kind": "FILTER", "substeps": [ "less_or_equal($50, 100)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$60 := RANK() OVER (PARTITION BY $281 ORDER BY $280 DESC)" ] }, { "kind": "SORT", "substeps": [ "$121 ASC, $120 DESC" ] }, { "kind": "JOIN", "substeps": [ "$370 := $140, $371 := $141, $372 := $142, $373 := $143, $374 := $144, $375 := $145, $376 := $146, $377 := $147, $378 := $148, $379 := $150", "INNER HASH JOIN EACH WITH ALL ON $90 = $100, $91 = $101, $92 = $102, $93 = $103" ] }, { "kind": "COMPUTE", "substeps": [ "$90 := coalesce($141, '')", "$91 := coalesce($141, '0')", "$92 := coalesce($140, NUMERIC<...>)", "$93 := coalesce($140, NUMERIC<...>)" ] }, { "kind": "WRITE", "substeps": [ "$380, $381, $382, $383, $384, $385, $386, $387, $388, $389", "TO __stage09_output" ] } ], "waitMsAvg": "5", "waitMsMax": "6", "waitRatioAvg": 0.0017367141368530739, "waitRatioMax": 0.0020840569642236887, "writeMsAvg": "13", "writeMsMax": "28", "writeRatioAvg": 0.0045154567558179926, "writeRatioMax": 0.009725599166377214 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.003126085446335533, "computeRatioMax": 0.003126085446335533, "endMs": "1665778389341", "id": "10", "inputStages": [ "9" ], "name": "S0A: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1000", "recordsWritten": "100", "shuffleOutputBytes": "6205", "shuffleOutputBytesSpilled": "0", "slotMs": "14", "startMs": "1665778389255", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$380, $381, $382, $383, $384, $385, $386, $387, $388, $389", "FROM __stage09_output" ] }, { "kind": "SORT", "substeps": [ "$382 ASC, $383 ASC, $384 ASC, $385 ASC, $386 ASC, $387 ASC, $388 ASC, $389 ASC, $381 ASC, $380 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$390, $391, $392, $393, $394, $395, $396, $397, $398, $399", "TO __stage0A_output" ] } ], "waitMsAvg": "4", "waitMsMax": "4", "waitRatioAvg": 0.0013893713094824591, "waitRatioMax": 0.0013893713094824591, "writeMsAvg": "5", "writeMsMax": "5", "writeRatioAvg": 0.0017367141368530739, "writeRatioMax": 0.0017367141368530739 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "item" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "6", "completedUnits": "3", "elapsedMs": "607", "estimatedRunnableUnits": "0", "pendingUnits": "6", "totalSlotMs": "2327" }, { "activeUnits": "1", "completedUnits": "9", "elapsedMs": "2587", "estimatedRunnableUnits": "0", "pendingUnits": "1", "totalSlotMs": "11915" }, { "activeUnits": "1", "completedUnits": "213", "elapsedMs": "3150", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "20627" } ], "totalBytesBilled": "137363456", "totalBytesProcessed": "137134150", "totalPartitionsProcessed": "0", "totalSlotMs": "20627", "transferredBytes": "0" }, "startTime": "1665778386223", "totalBytesProcessed": "137134150", "totalSlotMs": "20627" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anonba848eeb_afeb_4321_8e6d_560a2fdd5103" }, "priority": "INTERACTIVE", "query": "-- start query 67 in stream 0 using template query67.tpl\n\n/*\nFind top stores for each category based on store sales in a specific year.\n*/\n\nselect *\nfrom (select i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sumsales\n ,rank() over (partition by i_category order by sumsales desc) rk\n from (select i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sum(coalesce(ss_sales_price*ss_quantity,0)) sumsales\n from store_sales\n ,date_dim\n ,store\n ,item\n where ss_sold_date_sk=d_date_sk\n and ss_item_sk=i_item_sk\n and ss_store_sk = s_store_sk\n and d_month_seq between 1200 and 1200+11\n group by rollup(i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy,s_store_id))dw1) dw2\nwhere rk <= 100\norder by i_category\n ,i_class\n ,i_brand\n ,i_product_name\n ,d_year\n ,d_qoy\n ,d_moy\n ,s_store_id\n ,sumsales\n ,rk\nlimit 100\n;\n\n-- end query 67 in stream 0 using template query67.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "VazSFkiODCBCun4S/la1FA==", "id": "test-project-364309:europe-west1.query67_1665778390", "jobReference": { "jobId": "query67_1665778390", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query67_1665778390?location=europe-west1", "statistics": { "creationTime": "1665778391365", "endTime": "1665778395355", "finalExecutionDurationMs": "3785", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "137134150", "performanceInsights": { "avgPreviousExecutionMs": "3434" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "20", "computeMsMax": "20", "computeRatioAvg": 0.006642311524410495, "computeRatioMax": 0.006642311524410495, "endMs": "1665778391551", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.002324809033543673, "readRatioMax": 0.002324809033543673, "recordsRead": "18000", "recordsWritten": "18000", "shuffleOutputBytes": "1381802", "shuffleOutputBytesSpilled": "0", "slotMs": "30", "startMs": "1665778391519", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:i_item_sk, $2:i_brand, $3:i_class, $4:i_category, $5:i_product_name", "FROM item" ] }, { "kind": "WRITE", "substeps": [ "$1, $2, $3, $4, $5", "TO __stage00_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.0009963467286615742, "waitRatioMax": 0.0009963467286615742, "writeMsAvg": "12", "writeMsMax": "12", "writeRatioAvg": 0.003985386914646297, "writeRatioMax": 0.003985386914646297 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.0029890401859847225, "computeRatioMax": 0.0029890401859847225, "endMs": "1665778391572", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.0016605778811026237, "readRatioMax": 0.0016605778811026237, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "360", "shuffleOutputBytesSpilled": "0", "slotMs": "38", "startMs": "1665778391531", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:s_store_sk, $11:s_store_id", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00033211557622052476, "waitRatioMax": 0.00033211557622052476, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.005645964795748921, "writeRatioMax": 0.005645964795748921 }, { "completedParallelInputs": "1", "computeMsAvg": "18", "computeMsMax": "18", "computeRatioAvg": 0.005978080371969445, "computeRatioMax": 0.005978080371969445, "endMs": "1665778391582", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "12", "readMsMax": "12", "readRatioAvg": 0.003985386914646297, "readRatioMax": 0.003985386914646297, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "13176", "shuffleOutputBytesSpilled": "0", "slotMs": "44", "startMs": "1665778391548", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $32:d_year, $33:d_moy, $34:d_qoy, $31:d_month_seq", "FROM date_dim", "WHERE between($31, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$30, $32, $33, $34", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00033211557622052476, "waitRatioMax": 0.00033211557622052476, "writeMsAvg": "10", "writeMsMax": "10", "writeRatioAvg": 0.0033211557622052474, "writeRatioMax": 0.0033211557622052474 }, { "completedParallelInputs": "6", "computeMsAvg": "2006", "computeMsMax": "2532", "computeRatioAvg": 0.6662238458983726, "computeRatioMax": 0.8409166389903686, "endMs": "1665778392970", "id": "4", "inputStages": [ "1", "0", "2" ], "name": "S04: Join+", "parallelInputs": "6", "readMsAvg": "11", "readMsMax": "14", "readRatioAvg": 0.0036532713384257723, "readRatioMax": 0.004649618067087346, "recordsRead": "2990672", "recordsWritten": "1141035", "shuffleOutputBytes": "144923488", "shuffleOutputBytesSpilled": "0", "slotMs": "10661", "startMs": "1665778391599", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ss_sold_date_sk, $21:ss_item_sk, $22:ss_store_sk, $23:ss_quantity, $24:ss_sales_price", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$30, $32, $33, $34", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$1, $2, $3, $4, $5", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $260 := $161, $261 := $162, $262 := $163, $263 := $164, $264 := $165, $265 := $166, $266 := $167, $267 := $168, $268 := $200", "$110 := SUM($160)" ] }, { "kind": "COMPUTE", "substeps": [ "$160 := coalesce(multiply($252, CAST($251 AS NUMERIC)), NUMERIC<...>)", "$161 := if(equal(bitwise_and($220, 1), 0), NULL, $258)", "$162 := if(equal(bitwise_and($220, 2), 0), NULL, $257)", "$163 := if(equal(bitwise_and($220, 4), 0), NULL, $256)", "$164 := if(equal(bitwise_and($220, 8), 0), NULL, $259)", "$165 := if(equal(bitwise_and($220, 16), 0), NULL, $253)", "$166 := if(equal(bitwise_and($220, 32), 0), NULL, $255)", "$167 := if(equal(bitwise_and($220, 64), 0), NULL, $254)", "$168 := if(equal(bitwise_and($220, 128), 0), NULL, $250)" ] }, { "kind": "COMPUTE", "substeps": [ "$190 := ARRAY<...>" ] }, { "kind": "JOIN", "substeps": [ "$250 := $246, $251 := $241, $252 := $242, $253 := $243, $254 := $244, $255 := $245, $256 := $2, $257 := $3, $258 := $4, $259 := $5", "INNER HASH JOIN EACH WITH ALL ON $240 = $1" ] }, { "kind": "JOIN", "substeps": [ "$240 := $230, $241 := $232, $242 := $233, $243 := $234, $244 := $235, $245 := $236, $246 := $11", "INNER HASH JOIN EACH WITH ALL ON $231 = $10" ] }, { "kind": "JOIN", "substeps": [ "$230 := $21, $231 := $22, $232 := $23, $233 := $24, $234 := $32, $235 := $33, $236 := $34", "INNER HASH JOIN EACH WITH ALL ON $20 = $30" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := subtract($221, 1)" ] }, { "kind": "WRITE", "substeps": [ "$110, $260, $261, $262, $263, $264, $265, $266, $267, $268", "TO __stage04_output", "BY HASH($260, $261, $262, $263, $264, $265, $266, $267, $268)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0006642311524410495, "waitRatioMax": 0.0006642311524410495, "writeMsAvg": "10", "writeMsMax": "11", "writeRatioAvg": 0.0033211557622052474, "writeRatioMax": 0.0036532713384257723 }, { "completedParallelInputs": "1", "computeMsAvg": "3011", "computeMsMax": "3011", "computeRatioAvg": 1, "computeRatioMax": 1, "endMs": "1665778394817", "id": "5", "inputStages": [ "4" ], "name": "S05: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1141035", "recordsWritten": "505037", "shuffleOutputBytes": "63087737", "shuffleOutputBytesSpilled": "0", "slotMs": "2962", "startMs": "1665778393002", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$110, $260, $261, $262, $263, $264, $265, $266, $267, $268", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $270 := $260, $271 := $261, $272 := $262, $273 := $263, $274 := $264, $275 := $265, $276 := $266, $277 := $267, $278 := $268", "$70 := SUM($110)" ] }, { "kind": "WRITE", "substeps": [ "$70, $270, $271, $272, $273, $274, $275, $276, $277", "TO __stage05_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00033211557622052476, "waitRatioMax": 0.00033211557622052476, "writeMsAvg": "12", "writeMsMax": "12", "writeRatioAvg": 0.003985386914646297, "writeRatioMax": 0.003985386914646297 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.002324809033543673, "computeRatioMax": 0.002324809033543673, "endMs": "1665778395119", "id": "6", "name": "S06: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665778395084", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$180, $351, $350", "FROM __SHUFFLE4" ] }, { "kind": "COMPUTE", "substeps": [ "$100 := coalesce($360, '')", "$101 := coalesce($360, '0')", "$102 := coalesce($361, NUMERIC<...>)", "$103 := coalesce($361, NUMERIC<...>)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $360 := $350, $361 := $351", "$150 := MIN($180)" ] }, { "kind": "WRITE", "substeps": [ "$100, $101, $102, $103, $150", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00033211557622052476, "waitRatioMax": 0.00033211557622052476, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.005978080371969445, "writeRatioMax": 0.005978080371969445 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "15", "computeRatioAvg": 0.002656924609764198, "computeRatioMax": 0.004981733643307871, "endMs": "1665778395195", "id": "8", "inputStages": [ "6" ], "name": "S08: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3721", "startMs": "1665778395134", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage06_output" ] } ], "waitMsAvg": "3", "waitMsMax": "4", "waitRatioAvg": 0.0009963467286615742, "waitRatioMax": 0.001328462304882099, "writeMsAvg": "17", "writeMsMax": "30", "writeRatioAvg": 0.005645964795748921, "writeRatioMax": 0.009963467286615742 }, { "completedParallelInputs": "101", "computeMsAvg": "19", "computeMsMax": "169", "computeRatioAvg": 0.00631019594818997, "computeRatioMax": 0.056127532381268684, "endMs": "1665778395236", "id": "9", "inputStages": [ "5", "8" ], "name": "S09: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "505037", "recordsWritten": "1000", "shuffleOutputBytes": "83974", "shuffleOutputBytesSpilled": "0", "slotMs": "4131", "startMs": "1665778395141", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70, $270, $271, $272, $273, $274, $275, $276, $277", "FROM __stage05_output" ] }, { "kind": "READ", "substeps": [ "$130, $320, $321, $322, $323, $324, $325, $326, $327, $328", "FROM __SHUFFLE3" ] }, { "kind": "READ", "substeps": [ "$100, $101, $102, $103, $150", "FROM __stage08_output" ] }, { "kind": "SORT", "substeps": [ "$52 ASC, $53 ASC, $54 ASC, $55 ASC, $56 ASC, $57 ASC, $58 ASC, $59 ASC, $51 ASC, $50 ASC", "LIMIT 100" ] }, { "kind": "FILTER", "substeps": [ "less_or_equal($50, 100)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$60 := RANK() OVER (PARTITION BY $281 ORDER BY $280 DESC)" ] }, { "kind": "SORT", "substeps": [ "$121 ASC, $120 DESC" ] }, { "kind": "JOIN", "substeps": [ "$370 := $140, $371 := $141, $372 := $142, $373 := $143, $374 := $144, $375 := $145, $376 := $146, $377 := $147, $378 := $148, $379 := $150", "INNER HASH JOIN EACH WITH ALL ON $90 = $100, $91 = $101, $92 = $102, $93 = $103" ] }, { "kind": "COMPUTE", "substeps": [ "$90 := coalesce($141, '')", "$91 := coalesce($141, '0')", "$92 := coalesce($140, NUMERIC<...>)", "$93 := coalesce($140, NUMERIC<...>)" ] }, { "kind": "WRITE", "substeps": [ "$380, $381, $382, $383, $384, $385, $386, $387, $388, $389", "TO __stage09_output" ] } ], "waitMsAvg": "6", "waitMsMax": "7", "waitRatioAvg": 0.0019926934573231483, "waitRatioMax": 0.002324809033543673, "writeMsAvg": "19", "writeMsMax": "29", "writeRatioAvg": 0.00631019594818997, "writeRatioMax": 0.009631351710395218 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.002656924609764198, "computeRatioMax": 0.002656924609764198, "endMs": "1665778395247", "id": "10", "inputStages": [ "9" ], "name": "S0A: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "1000", "recordsWritten": "100", "shuffleOutputBytes": "6205", "shuffleOutputBytesSpilled": "0", "slotMs": "37", "startMs": "1665778395152", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$380, $381, $382, $383, $384, $385, $386, $387, $388, $389", "FROM __stage09_output" ] }, { "kind": "SORT", "substeps": [ "$382 ASC, $383 ASC, $384 ASC, $385 ASC, $386 ASC, $387 ASC, $388 ASC, $389 ASC, $381 ASC, $380 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$390, $391, $392, $393, $394, $395, $396, $397, $398, $399", "TO __stage0A_output" ] } ], "waitMsAvg": "6", "waitMsMax": "6", "waitRatioAvg": 0.0019926934573231483, "waitRatioMax": 0.0019926934573231483, "writeMsAvg": "4", "writeMsMax": "4", "writeRatioAvg": 0.001328462304882099, "writeRatioMax": 0.001328462304882099 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "item" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "6", "completedUnits": "3", "elapsedMs": "604", "estimatedRunnableUnits": "0", "pendingUnits": "6", "totalSlotMs": "788" }, { "activeUnits": "2", "completedUnits": "9", "elapsedMs": "2056", "estimatedRunnableUnits": "0", "pendingUnits": "1", "totalSlotMs": "11101" }, { "activeUnits": "1", "completedUnits": "9", "elapsedMs": "2587", "estimatedRunnableUnits": "0", "pendingUnits": "1", "totalSlotMs": "11908" }, { "activeUnits": "0", "completedUnits": "213", "elapsedMs": "3898", "estimatedRunnableUnits": "1", "pendingUnits": "0", "totalSlotMs": "21660" } ], "totalBytesBilled": "137363456", "totalBytesProcessed": "137134150", "totalPartitionsProcessed": "0", "totalSlotMs": "21660", "transferredBytes": "0" }, "startTime": "1665778391416", "totalBytesProcessed": "137134150", "totalSlotMs": "21660" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
