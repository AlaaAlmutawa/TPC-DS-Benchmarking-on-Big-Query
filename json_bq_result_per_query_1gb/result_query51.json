{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon61ed7d3a_0a35_474b_a1d4_0509b491b83b" }, "priority": "INTERACTIVE", "query": "-- start query 51 in stream 0 using template query51.tpl\n\n/*\nCompute the count of store sales resulting from promotions, \nthe count of all store sales and \ntheir ratio for specific categories in a particular time zone and for a given year and month.\n*/\n\nWITH web_v1 as (\nselect\n ws_item_sk item_sk, d_date,\n sum(sum(ws_sales_price))\n over (partition by ws_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom web_sales\n ,date_dim\nwhere ws_sold_date_sk=d_date_sk\n and d_month_seq between 1200 and 1200+11\n and ws_item_sk is not NULL\ngroup by ws_item_sk, d_date),\nstore_v1 as (\nselect\n ss_item_sk item_sk, d_date,\n sum(sum(ss_sales_price))\n over (partition by ss_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom store_sales\n ,date_dim\nwhere ss_sold_date_sk=d_date_sk\n and d_month_seq between 1200 and 1200+11\n and ss_item_sk is not NULL\ngroup by ss_item_sk, d_date)\nselect *\nfrom (select item_sk\n ,d_date\n ,web_sales\n ,store_sales\n ,max(web_sales)\n over (partition by item_sk order by d_date rows between unbounded preceding and current row) web_cumulative\n ,max(store_sales)\n over (partition by item_sk order by d_date rows between unbounded preceding and current row) store_cumulative\n from (select case when web.item_sk is not null then web.item_sk else store.item_sk end item_sk\n ,case when web.d_date is not null then web.d_date else store.d_date end d_date\n ,web.cume_sales web_sales\n ,store.cume_sales store_sales\n from web_v1 web full outer join store_v1 store on (web.item_sk = store.item_sk\n and web.d_date = store.d_date)\n )x )y\nwhere web_cumulative > store_cumulative\norder by item_sk\n ,d_date\nlimit 100\n;\n\n-- end query 51 in stream 0 using template query51.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "Kfw1+pkn17/jVsDMBoiy8Q==", "id": "test-project-364309:europe-west1.query51_1665768378", "jobReference": { "jobId": "query51_1665768378", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query51_1665768378?location=europe-west1", "statistics": { "creationTime": "1665768378807", "endTime": "1665768380725", "finalExecutionDurationMs": "1672", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "113826808", "performanceInsights": { "avgPreviousExecutionMs": "1437" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.011121408711770158, "computeRatioMax": 0.011121408711770158, "endMs": "1665768379011", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.005560704355885079, "readRatioMax": 0.005560704355885079, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "5124", "shuffleOutputBytesSpilled": "0", "slotMs": "43", "startMs": "1665768378970", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $31:d_date, $32:d_month_seq", "FROM date_dim", "WHERE between($32, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$30, $31", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0009267840593141798, "waitRatioMax": 0.0009267840593141798, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.012974976830398516, "writeRatioMax": 0.012974976830398516 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.008341056533827619, "computeRatioMax": 0.008341056533827619, "endMs": "1665768379032", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.005560704355885079, "readRatioMax": 0.005560704355885079, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "5124", "shuffleOutputBytesSpilled": "0", "slotMs": "29", "startMs": "1665768378998", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_date, $12:d_month_seq", "FROM date_dim", "WHERE between($12, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0009267840593141798, "waitRatioMax": 0.0009267840593141798, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.0074142724745134385, "writeRatioMax": 0.0074142724745134385 }, { "completedParallelInputs": "6", "computeMsAvg": "278", "computeMsMax": "345", "computeRatioAvg": 0.25764596848934196, "computeRatioMax": 0.31974050046339203, "endMs": "1665768379236", "id": "4", "inputStages": [ "0" ], "name": "S04: Join+", "parallelInputs": "6", "readMsAvg": "10", "readMsMax": "12", "readRatioAvg": 0.009267840593141797, "readRatioMax": 0.011121408711770158, "recordsRead": "2882600", "recordsWritten": "543984", "shuffleOutputBytes": "16663712", "shuffleOutputBytesSpilled": "0", "slotMs": "1383", "startMs": "1665768379033", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ss_sold_date_sk, $21:ss_item_sk, $22:ss_sales_price", "FROM store_sales", "WHERE not(is_null($21))" ] }, { "kind": "READ", "substeps": [ "$30, $31", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1310 := $1300, $1311 := $1302", "$440 := SUM($1301)" ] }, { "kind": "JOIN", "substeps": [ "$1300 := $21, $1301 := $22, $1302 := $31", "INNER HASH JOIN EACH WITH ALL ON $20 = $30" ] }, { "kind": "WRITE", "substeps": [ "$1310, $1311, $440", "TO __stage04_output", "BY HASH($1310, $1311)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0009267840593141798, "waitRatioMax": 0.0009267840593141798, "writeMsAvg": "20", "writeMsMax": "23", "writeRatioAvg": 0.018535681186283594, "writeRatioMax": 0.021316033364226137 }, { "completedParallelInputs": "1", "computeMsAvg": "360", "computeMsMax": "360", "computeRatioAvg": 0.3336422613531047, "computeRatioMax": 0.3336422613531047, "endMs": "1665768379228", "id": "5", "inputStages": [ "2" ], "name": "S05: Join+", "parallelInputs": "1", "readMsAvg": "12", "readMsMax": "12", "readRatioAvg": 0.011121408711770158, "readRatioMax": 0.011121408711770158, "recordsRead": "719750", "recordsWritten": "138313", "shuffleOutputBytes": "4287431", "shuffleOutputBytesSpilled": "0", "slotMs": "317", "startMs": "1665768379057", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:ws_sold_date_sk, $2:ws_item_sk, $3:ws_sales_price", "FROM web_sales", "WHERE not(is_null($2))" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage02_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1090 := $1080, $1091 := $1082", "$390 := SUM($1081)" ] }, { "kind": "JOIN", "substeps": [ "$1080 := $2, $1081 := $3, $1082 := $11", "INNER HASH JOIN EACH WITH ALL ON $1 = $10" ] }, { "kind": "WRITE", "substeps": [ "$1090, $1091, $390", "TO __stage05_output", "BY HASH($1090, $1091)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0009267840593141798, "waitRatioMax": 0.0009267840593141798, "writeMsAvg": "21", "writeMsMax": "21", "writeRatioAvg": 0.019462465245597776, "writeRatioMax": 0.019462465245597776 }, { "completedParallelInputs": "1", "computeMsAvg": "284", "computeMsMax": "284", "computeRatioAvg": 0.2632066728452271, "computeRatioMax": 0.2632066728452271, "endMs": "1665768379425", "id": "6", "inputStages": [ "5" ], "name": "S06: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "138313", "recordsWritten": "138313", "shuffleOutputBytes": "4287431", "shuffleOutputBytesSpilled": "0", "slotMs": "220", "startMs": "1665768379263", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1090, $1091, $390", "FROM __stage05_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1100 := $1090, $1101 := $1091", "$240 := SUM($390)" ] }, { "kind": "WRITE", "substeps": [ "$1100, $1101, $240", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0009267840593141798, "waitRatioMax": 0.0009267840593141798, "writeMsAvg": "25", "writeMsMax": "25", "writeRatioAvg": 0.023169601482854494, "writeRatioMax": 0.023169601482854494 }, { "completedParallelInputs": "1", "computeMsAvg": "1079", "computeMsMax": "1079", "computeRatioAvg": 1, "computeRatioMax": 1, "endMs": "1665768379892", "id": "7", "inputStages": [ "4" ], "name": "S07: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "543984", "recordsWritten": "499071", "shuffleOutputBytes": "15303153", "shuffleOutputBytesSpilled": "0", "slotMs": "809", "startMs": "1665768379280", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1310, $1311, $440", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1320 := $1310, $1321 := $1311", "$270 := SUM($440)" ] }, { "kind": "WRITE", "substeps": [ "$1320, $1321, $270", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0009267840593141798, "waitRatioMax": 0.0009267840593141798, "writeMsAvg": "31", "writeMsMax": "31", "writeRatioAvg": 0.028730305838739572, "writeRatioMax": 0.028730305838739572 }, { "completedParallelInputs": "1", "computeMsAvg": "6", "computeMsMax": "6", "computeRatioAvg": 0.005560704355885079, "computeRatioMax": 0.005560704355885079, "endMs": "1665768379964", "id": "8", "name": "S08: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "30", "startMs": "1665768379927", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$850, $1481, $1480", "FROM __SHUFFLE17" ] }, { "kind": "COMPUTE", "substeps": [ "$480 := coalesce($1501, 0)", "$481 := coalesce($1501, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$510 := SUM($1490) OVER (PARTITION BY $1492 ORDER BY $1491 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1480 ASC, $1481 ASC" ] }, { "kind": "WRITE", "substeps": [ "$480, $481, $510, $1500", "TO __stage08_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0009267840593141798, "waitRatioMax": 0.0009267840593141798, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.017608897126969416, "writeRatioMax": 0.017608897126969416 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.011121408711770158, "computeRatioMax": 0.011121408711770158, "endMs": "1665768379977", "id": "9", "name": "S09: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "30", "startMs": "1665768379941", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$960, $1040, $1041, $1042", "FROM __SHUFFLE15" ] }, { "kind": "COMPUTE", "substeps": [ "$620 := coalesce($1440, 0)", "$621 := coalesce($1440, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$740 := SUM($1432) OVER (PARTITION BY $1431, $1430 ORDER BY $1433 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1040 ASC, $960 ASC, $1042 ASC" ] }, { "kind": "WRITE", "substeps": [ "$620, $621, $740, $1441", "TO __stage09_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0009267840593141798, "waitRatioMax": 0.0009267840593141798, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.016682113067655237, "writeRatioMax": 0.016682113067655237 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.008341056533827619, "computeRatioMax": 0.008341056533827619, "endMs": "1665768380003", "id": "10", "name": "S0A: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "42", "startMs": "1665768379956", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$800, $1261, $1260", "FROM __SHUFFLE8" ] }, { "kind": "COMPUTE", "substeps": [ "$430 := coalesce($1281, 0)", "$431 := coalesce($1281, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$500 := SUM($1270) OVER (PARTITION BY $1272 ORDER BY $1271 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1260 ASC, $1261 ASC" ] }, { "kind": "WRITE", "substeps": [ "$430, $431, $500, $1280", "TO __stage0A_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0009267840593141798, "waitRatioMax": 0.0009267840593141798, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.015755329008341055, "writeRatioMax": 0.015755329008341055 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.006487488415199258, "computeRatioMax": 0.006487488415199258, "endMs": "1665768380027", "id": "11", "name": "S0B: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "61", "startMs": "1665768379970", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$910, $1000, $1001, $1002", "FROM __SHUFFLE6" ] }, { "kind": "COMPUTE", "substeps": [ "$590 := coalesce($1220, 0)", "$591 := coalesce($1220, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$700 := SUM($1212) OVER (PARTITION BY $1211, $1210 ORDER BY $1213 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1000 ASC, $910 ASC, $1002 ASC" ] }, { "kind": "WRITE", "substeps": [ "$590, $591, $700, $1221", "TO __stage0B_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0009267840593141798, "waitRatioMax": 0.0009267840593141798, "writeMsAvg": "52", "writeMsMax": "52", "writeRatioAvg": 0.04819277108433735, "writeRatioMax": 0.04819277108433735 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "16", "computeRatioAvg": 0.006487488415199258, "computeRatioMax": 0.014828544949026877, "endMs": "1665768380070", "id": "12", "inputStages": [ "9" ], "name": "S0C: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3405", "startMs": "1665768379992", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage09_output" ] } ], "waitMsAvg": "2", "waitMsMax": "4", "waitRatioAvg": 0.0018535681186283596, "waitRatioMax": 0.0037071362372567192, "writeMsAvg": "14", "writeMsMax": "26", "writeRatioAvg": 0.012974976830398516, "writeRatioMax": 0.024096385542168676 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "16", "computeRatioAvg": 0.006487488415199258, "computeRatioMax": 0.014828544949026877, "endMs": "1665768380071", "id": "13", "inputStages": [ "8" ], "name": "S0D: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3036", "startMs": "1665768379992", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage08_output" ] } ], "waitMsAvg": "4", "waitMsMax": "8", "waitRatioAvg": 0.0037071362372567192, "waitRatioMax": 0.0074142724745134385, "writeMsAvg": "12", "writeMsMax": "27", "writeRatioAvg": 0.011121408711770158, "writeRatioMax": 0.025023169601482854 }, { "completedParallelInputs": "101", "computeMsAvg": "18", "computeMsMax": "29", "computeRatioAvg": 0.016682113067655237, "computeRatioMax": 0.026876737720111215, "endMs": "1665768380085", "id": "14", "inputStages": [ "12", "13", "7" ], "name": "S0E: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "499071", "recordsWritten": "499071", "shuffleOutputBytes": "15467793", "shuffleOutputBytesSpilled": "0", "slotMs": "3744", "startMs": "1665768380007", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1320, $1321, $270", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$460, $1400, $1401, $1402, $1404", "FROM __SHUFFLE14" ] }, { "kind": "READ", "substeps": [ "$620, $621, $740, $1441", "FROM __stage0C_output" ] }, { "kind": "READ", "substeps": [ "$480, $481, $510, $1500", "FROM __stage0D_output" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$200 := SUM($1332) OVER (PARTITION BY $1330 ORDER BY $1331 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$450 ASC, $451 ASC" ] }, { "kind": "COMPUTE", "substeps": [ "$290 := if(equal($1511, -1), if(equal($1510, -1), NULL, $1512), ...)" ] }, { "kind": "JOIN", "substeps": [ "$1510 := $1450, $1511 := $1451, $1512 := $1454, $1513 := $1452, $1514 := $1453, $1515 := $510", "LEFT OUTER HASH JOIN EACH WITH ALL ON $470 = $480, $471 = $481, $1451 = $1500" ] }, { "kind": "COMPUTE", "substeps": [ "$470 := coalesce($1452, 0)", "$471 := coalesce($1452, 1)" ] }, { "kind": "JOIN", "substeps": [ "$1450 := $612, $1451 := $613, $1452 := $1030, $1453 := $1031, $1454 := $740", "LEFT OUTER HASH JOIN EACH WITH ALL ON $610 = $620, $611 = $621, $612 = $1441" ] }, { "kind": "COMPUTE", "substeps": [ "$610 := coalesce($1030, 0)", "$611 := coalesce($1030, 1)", "$612 := if(or($870, $730), -1, $840)", "$613 := if($870, -1, if($730, $731, subtract($731, 1)))" ] }, { "kind": "COMPUTE", "substeps": [ "$730 := equal(mod(add($840, 1), 16384), 0)", "$731 := div($840, 16384)" ] }, { "kind": "COMPUTE", "substeps": [ "$840 := if($871, subtract($1032, 1), $950)" ] }, { "kind": "COMPUTE", "substeps": [ "$870 := less($950, 0)", "$871 := greater_or_equal($950, $1032)" ] }, { "kind": "COMPUTE", "substeps": [ "$950 := $1033" ] }, { "kind": "WRITE", "substeps": [ "$170, $171, $172", "TO __stage0E_output" ] } ], "waitMsAvg": "3", "waitMsMax": "12", "waitRatioAvg": 0.0027803521779425394, "waitRatioMax": 0.011121408711770158, "writeMsAvg": "12", "writeMsMax": "26", "writeRatioAvg": 0.011121408711770158, "writeRatioMax": 0.024096385542168676 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "17", "computeRatioAvg": 0.0074142724745134385, "computeRatioMax": 0.015755329008341055, "endMs": "1665768380092", "id": "15", "inputStages": [ "11" ], "name": "S0F: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3308", "startMs": "1665768380034", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0B_output" ] } ], "waitMsAvg": "1", "waitMsMax": "3", "waitRatioAvg": 0.0009267840593141798, "waitRatioMax": 0.0027803521779425394, "writeMsAvg": "15", "writeMsMax": "35", "writeRatioAvg": 0.013901760889712697, "writeRatioMax": 0.03243744207599629 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "20", "computeRatioAvg": 0.006487488415199258, "computeRatioMax": 0.018535681186283594, "endMs": "1665768380093", "id": "16", "inputStages": [ "10" ], "name": "S10: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "2640", "startMs": "1665768380036", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0A_output" ] } ], "waitMsAvg": "6", "waitMsMax": "8", "waitRatioAvg": 0.005560704355885079, "waitRatioMax": 0.0074142724745134385, "writeMsAvg": "10", "writeMsMax": "21", "writeRatioAvg": 0.009267840593141797, "writeRatioMax": 0.019462465245597776 }, { "completedParallelInputs": "101", "computeMsAvg": "13", "computeMsMax": "23", "computeRatioAvg": 0.012048192771084338, "computeRatioMax": 0.021316033364226137, "endMs": "1665768380108", "id": "17", "inputStages": [ "15", "16", "6" ], "name": "S11: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "138313", "recordsWritten": "138313", "shuffleOutputBytes": "4287687", "shuffleOutputBytesSpilled": "0", "slotMs": "4504", "startMs": "1665768380056", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1100, $1101, $240", "FROM __stage06_output" ] }, { "kind": "READ", "substeps": [ "$410, $1180, $1181, $1182, $1184", "FROM __SHUFFLE5" ] }, { "kind": "READ", "substeps": [ "$590, $591, $700, $1221", "FROM __stage0F_output" ] }, { "kind": "READ", "substeps": [ "$430, $431, $500, $1280", "FROM __stage10_output" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$190 := SUM($1112) OVER (PARTITION BY $1110 ORDER BY $1111 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$400 ASC, $401 ASC" ] }, { "kind": "COMPUTE", "substeps": [ "$260 := if(equal($1291, -1), if(equal($1290, -1), NULL, $1292), ...)" ] }, { "kind": "JOIN", "substeps": [ "$1290 := $1230, $1291 := $1231, $1292 := $1234, $1293 := $1232, $1294 := $1233, $1295 := $500", "LEFT OUTER HASH JOIN EACH WITH ALL ON $420 = $430, $421 = $431, $1231 = $1280" ] }, { "kind": "COMPUTE", "substeps": [ "$420 := coalesce($1232, 0)", "$421 := coalesce($1232, 1)" ] }, { "kind": "JOIN", "substeps": [ "$1230 := $582, $1231 := $583, $1232 := $990, $1233 := $991, $1234 := $700", "LEFT OUTER HASH JOIN EACH WITH ALL ON $580 = $590, $581 = $591, $582 = $1221" ] }, { "kind": "COMPUTE", "substeps": [ "$580 := coalesce($990, 0)", "$581 := coalesce($990, 1)", "$582 := if(or($860, $690), -1, $790)", "$583 := if($860, -1, if($690, $691, subtract($691, 1)))" ] }, { "kind": "COMPUTE", "substeps": [ "$690 := equal(mod(add($790, 1), 16384), 0)", "$691 := div($790, 16384)" ] }, { "kind": "COMPUTE", "substeps": [ "$790 := if($861, subtract($992, 1), $900)" ] }, { "kind": "COMPUTE", "substeps": [ "$860 := less($900, 0)", "$861 := greater_or_equal($900, $992)" ] }, { "kind": "COMPUTE", "substeps": [ "$900 := $993" ] }, { "kind": "WRITE", "substeps": [ "$150, $151, $152", "TO __stage11_output" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.0018535681186283596, "waitRatioMax": 0.0027803521779425394, "writeMsAvg": "17", "writeMsMax": "29", "writeRatioAvg": 0.015755329008341055, "writeRatioMax": 0.026876737720111215 }, { "completedParallelInputs": "100", "computeMsAvg": "21", "computeMsMax": "38", "computeRatioAvg": 0.019462465245597776, "computeRatioMax": 0.03521779425393883, "endMs": "1665768380312", "id": "18", "inputStages": [ "14", "17" ], "name": "S12: Join+", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "637384", "recordsWritten": "610617", "shuffleOutputBytes": "19964592", "shuffleOutputBytesSpilled": "0", "slotMs": "4194", "startMs": "1665768380246", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$150, $151, $152", "FROM __stage11_output" ] }, { "kind": "READ", "substeps": [ "$170, $171, $172", "FROM __stage0E_output" ] }, { "kind": "COMPUTE", "substeps": [ "$70 := case_no_value(not(is_null($1520)), $1520, $1523)", "$71 := case_no_value(not(is_null($1521)), $1521, $1524)" ] }, { "kind": "JOIN", "substeps": [ "$1520 := $150, $1521 := $151, $1522 := $152, $1523 := $170, $1524 := $171, $1525 := $172", "FULL OUTER HASH JOIN EACH WITH EACH ON $150 = $170, $151 = $171" ] }, { "kind": "WRITE", "substeps": [ "$70, $71, $1522, $1525", "TO __stage12_output" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.0018535681186283596, "waitRatioMax": 0.0027803521779425394, "writeMsAvg": "8", "writeMsMax": "24", "writeRatioAvg": 0.0074142724745134385, "writeRatioMax": 0.022242817423540315 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.006487488415199258, "computeRatioMax": 0.006487488415199258, "endMs": "1665768380376", "id": "19", "name": "S13: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "18", "startMs": "1665768380339", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$380, $381, $1671, $1670", "FROM __SHUFFLE25" ] }, { "kind": "COMPUTE", "substeps": [ "$130 := coalesce($1691, 0)", "$131 := coalesce($1691, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$180 := MAX($1680) OVER (PARTITION BY $1683 ORDER BY $1682 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)", "$181 := MAX($1681) OVER (PARTITION BY $1683 ORDER BY $1682 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1670 ASC, $1671 ASC" ] }, { "kind": "WRITE", "substeps": [ "$130, $131, $180, $181, $1690", "TO __stage13_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0009267840593141798, "waitRatioMax": 0.0009267840593141798, "writeMsAvg": "32", "writeMsMax": "32", "writeRatioAvg": 0.029657089898053754, "writeRatioMax": 0.029657089898053754 }, { "completedParallelInputs": "1", "computeMsAvg": "4", "computeMsMax": "4", "computeRatioAvg": 0.0037071362372567192, "computeRatioMax": 0.0037071362372567192, "endMs": "1665768380393", "id": "20", "name": "S14: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "33", "startMs": "1665768380356", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$550, $650, $651, $652, $653", "FROM __SHUFFLE23" ] }, { "kind": "COMPUTE", "substeps": [ "$230 := coalesce($1630, 0)", "$231 := coalesce($1630, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$330 := MAX($1622) OVER (PARTITION BY $1621, $1620 ORDER BY $1624 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)", "$331 := MAX($1623) OVER (PARTITION BY $1621, $1620 ORDER BY $1624 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$650 ASC, $550 ASC, $653 ASC" ] }, { "kind": "WRITE", "substeps": [ "$230, $231, $330, $331, $1631", "TO __stage14_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0009267840593141798, "waitRatioMax": 0.0009267840593141798, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.017608897126969416, "writeRatioMax": 0.017608897126969416 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "19", "computeRatioAvg": 0.0074142724745134385, "computeRatioMax": 0.017608897126969416, "endMs": "1665768380469", "id": "21", "inputStages": [ "20" ], "name": "S15: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "4004", "startMs": "1665768380404", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage14_output" ] } ], "waitMsAvg": "2", "waitMsMax": "5", "waitRatioAvg": 0.0018535681186283596, "waitRatioMax": 0.004633920296570899, "writeMsAvg": "25", "writeMsMax": "55", "writeRatioAvg": 0.023169601482854494, "writeRatioMax": 0.05097312326227989 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "14", "computeRatioAvg": 0.006487488415199258, "computeRatioMax": 0.012974976830398516, "endMs": "1665768380459", "id": "22", "inputStages": [ "19" ], "name": "S16: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "2672", "startMs": "1665768380405", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage13_output" ] } ], "waitMsAvg": "5", "waitMsMax": "7", "waitRatioAvg": 0.004633920296570899, "waitRatioMax": 0.006487488415199258, "writeMsAvg": "12", "writeMsMax": "25", "writeRatioAvg": 0.011121408711770158, "writeRatioMax": 0.023169601482854494 }, { "completedParallelInputs": "101", "computeMsAvg": "15", "computeMsMax": "27", "computeRatioAvg": 0.013901760889712697, "computeRatioMax": 0.025023169601482854, "endMs": "1665768380469", "id": "23", "inputStages": [ "22", "18", "21" ], "name": "S17: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "610617", "recordsWritten": "10000", "shuffleOutputBytes": "668048", "shuffleOutputBytesSpilled": "0", "slotMs": "3850", "startMs": "1665768380418", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70, $71, $1522, $1525", "FROM __stage12_output" ] }, { "kind": "READ", "substeps": [ "$110, $1600, $1601, $1602, $1603, $1605", "FROM __SHUFFLE22" ] }, { "kind": "READ", "substeps": [ "$230, $231, $330, $331, $1631", "FROM __stage15_output" ] }, { "kind": "READ", "substeps": [ "$130, $131, $180, $181, $1690", "FROM __stage16_output" ] }, { "kind": "SORT", "substeps": [ "$52 ASC, $53 ASC", "LIMIT 100" ] }, { "kind": "FILTER", "substeps": [ "greater($51, $50)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$60 := MAX($1532) OVER (PARTITION BY $1530 ORDER BY $1531 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)", "$61 := MAX($1533) OVER (PARTITION BY $1530 ORDER BY $1531 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$100 ASC, $101 ASC" ] }, { "kind": "COMPUTE", "substeps": [ "$90 := if(equal($1701, -1), if(equal($1700, -1), NULL, $1702), ...)", "$91 := if(equal($1701, -1), if(equal($1700, -1), NULL, $1703), ...)" ] }, { "kind": "JOIN", "substeps": [ "$1700 := $1640, $1701 := $1641, $1702 := $1646, $1703 := $1647, $1704 := $1642, $1705 := $1643, $1706 := $1644, $1707 := $1645, $1708 := $180, $1709 := $181", "LEFT OUTER HASH JOIN EACH WITH ALL ON $120 = $130, $121 = $131, $1641 = $1690" ] }, { "kind": "COMPUTE", "substeps": [ "$120 := coalesce($1642, 0)", "$121 := coalesce($1642, 1)" ] }, { "kind": "JOIN", "substeps": [ "$1640 := $222, $1641 := $223, $1642 := $640, $1643 := $641, $1644 := $642, $1645 := $643, $1646 := $330, $1647 := $331", "LEFT OUTER HASH JOIN EACH WITH ALL ON $220 = $230, $221 = $231, $222 = $1631" ] }, { "kind": "COMPUTE", "substeps": [ "$220 := coalesce($640, 0)", "$221 := coalesce($640, 1)", "$222 := if(or($490, $320), -1, $370)", "$223 := if($490, -1, if($320, $321, subtract($321, 1)))" ] }, { "kind": "COMPUTE", "substeps": [ "$320 := equal(mod(add($370, 1), 16384), 0)", "$321 := div($370, 16384)" ] }, { "kind": "COMPUTE", "substeps": [ "$370 := if($491, subtract($644, 1), $540)" ] }, { "kind": "COMPUTE", "substeps": [ "$490 := less($540, 0)", "$491 := greater_or_equal($540, $644)" ] }, { "kind": "COMPUTE", "substeps": [ "$540 := $645" ] }, { "kind": "WRITE", "substeps": [ "$1710, $1711, $1712, $1713, $1714, $1715", "TO __stage17_output" ] } ], "waitMsAvg": "7", "waitMsMax": "9", "waitRatioAvg": 0.006487488415199258, "waitRatioMax": 0.008341056533827619, "writeMsAvg": "14", "writeMsMax": "37", "writeRatioAvg": 0.012974976830398516, "writeRatioMax": 0.03429101019462465 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.012048192771084338, "computeRatioMax": 0.012048192771084338, "endMs": "1665768380589", "id": "24", "inputStages": [ "23" ], "name": "S18: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "10000", "recordsWritten": "100", "shuffleOutputBytes": "6696", "shuffleOutputBytesSpilled": "0", "slotMs": "210", "startMs": "1665768380424", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1710, $1711, $1712, $1713, $1714, $1715", "FROM __stage17_output" ] }, { "kind": "SORT", "substeps": [ "$1712 ASC, $1713 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$1720, $1721, $1722, $1723, $1724, $1725", "TO __stage18_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0018535681186283596, "waitRatioMax": 0.0018535681186283596, "writeMsAvg": "9", "writeMsMax": "9", "writeRatioAvg": 0.008341056533827619, "writeRatioMax": 0.008341056533827619 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "1", "completedUnits": "10", "elapsedMs": "622", "estimatedRunnableUnits": "0", "pendingUnits": "1", "totalSlotMs": "2123" }, { "activeUnits": "1", "completedUnits": "1021", "elapsedMs": "1819", "estimatedRunnableUnits": "1", "pendingUnits": "0", "totalSlotMs": "38321" } ], "totalBytesBilled": "114294784", "totalBytesProcessed": "113826808", "totalPartitionsProcessed": "0", "totalSlotMs": "38321", "transferredBytes": "0" }, "startTime": "1665768378849", "totalBytesProcessed": "113826808", "totalSlotMs": "38321" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon0e6f1633_0c1f_4653_90f3_59b2560f7691" }, "priority": "INTERACTIVE", "query": "-- start query 51 in stream 0 using template query51.tpl\n\n/*\nCompute the count of store sales resulting from promotions, \nthe count of all store sales and \ntheir ratio for specific categories in a particular time zone and for a given year and month.\n*/\n\nWITH web_v1 as (\nselect\n ws_item_sk item_sk, d_date,\n sum(sum(ws_sales_price))\n over (partition by ws_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom web_sales\n ,date_dim\nwhere ws_sold_date_sk=d_date_sk\n and d_month_seq between 1200 and 1200+11\n and ws_item_sk is not NULL\ngroup by ws_item_sk, d_date),\nstore_v1 as (\nselect\n ss_item_sk item_sk, d_date,\n sum(sum(ss_sales_price))\n over (partition by ss_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom store_sales\n ,date_dim\nwhere ss_sold_date_sk=d_date_sk\n and d_month_seq between 1200 and 1200+11\n and ss_item_sk is not NULL\ngroup by ss_item_sk, d_date)\nselect *\nfrom (select item_sk\n ,d_date\n ,web_sales\n ,store_sales\n ,max(web_sales)\n over (partition by item_sk order by d_date rows between unbounded preceding and current row) web_cumulative\n ,max(store_sales)\n over (partition by item_sk order by d_date rows between unbounded preceding and current row) store_cumulative\n from (select case when web.item_sk is not null then web.item_sk else store.item_sk end item_sk\n ,case when web.d_date is not null then web.d_date else store.d_date end d_date\n ,web.cume_sales web_sales\n ,store.cume_sales store_sales\n from web_v1 web full outer join store_v1 store on (web.item_sk = store.item_sk\n and web.d_date = store.d_date)\n )x )y\nwhere web_cumulative > store_cumulative\norder by item_sk\n ,d_date\nlimit 100\n;\n\n-- end query 51 in stream 0 using template query51.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "7m7H45zUT8RPI0T9WKtzOg==", "id": "test-project-364309:europe-west1.query51_1665777738", "jobReference": { "jobId": "query51_1665777738", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query51_1665777738?location=europe-west1", "statistics": { "creationTime": "1665777739546", "endTime": "1665777741343", "finalExecutionDurationMs": "1521", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "113826808", "performanceInsights": { "avgPreviousExecutionMs": "1495" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "15", "computeMsMax": "15", "computeRatioAvg": 0.01282051282051282, "computeRatioMax": 0.01282051282051282, "endMs": "1665777739759", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.007692307692307693, "readRatioMax": 0.007692307692307693, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "5124", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665777739727", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $31:d_date, $32:d_month_seq", "FROM date_dim", "WHERE between($32, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$30, $31", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0008547008547008547, "waitRatioMax": 0.0008547008547008547, "writeMsAvg": "10", "writeMsMax": "10", "writeRatioAvg": 0.008547008547008548, "writeRatioMax": 0.008547008547008548 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.010256410256410256, "computeRatioMax": 0.010256410256410256, "endMs": "1665777739790", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.004273504273504274, "readRatioMax": 0.004273504273504274, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "5124", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665777739756", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_date, $12:d_month_seq", "FROM date_dim", "WHERE between($12, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0008547008547008547, "waitRatioMax": 0.0008547008547008547, "writeMsAvg": "6", "writeMsMax": "6", "writeRatioAvg": 0.005128205128205128, "writeRatioMax": 0.005128205128205128 }, { "completedParallelInputs": "6", "computeMsAvg": "225", "computeMsMax": "253", "computeRatioAvg": 0.19230769230769232, "computeRatioMax": 0.21623931623931625, "endMs": "1665777739974", "id": "4", "inputStages": [ "0" ], "name": "S04: Join+", "parallelInputs": "6", "readMsAvg": "9", "readMsMax": "10", "readRatioAvg": 0.007692307692307693, "readRatioMax": 0.008547008547008548, "recordsRead": "2882600", "recordsWritten": "543984", "shuffleOutputBytes": "16663712", "shuffleOutputBytesSpilled": "0", "slotMs": "1250", "startMs": "1665777739785", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ss_sold_date_sk, $21:ss_item_sk, $22:ss_sales_price", "FROM store_sales", "WHERE not(is_null($21))" ] }, { "kind": "READ", "substeps": [ "$30, $31", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1310 := $1300, $1311 := $1302", "$440 := SUM($1301)" ] }, { "kind": "JOIN", "substeps": [ "$1300 := $21, $1301 := $22, $1302 := $31", "INNER HASH JOIN EACH WITH ALL ON $20 = $30" ] }, { "kind": "WRITE", "substeps": [ "$1310, $1311, $440", "TO __stage04_output", "BY HASH($1310, $1311)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0008547008547008547, "waitRatioMax": 0.0008547008547008547, "writeMsAvg": "21", "writeMsMax": "22", "writeRatioAvg": 0.017948717948717947, "writeRatioMax": 0.018803418803418803 }, { "completedParallelInputs": "1", "computeMsAvg": "446", "computeMsMax": "446", "computeRatioAvg": 0.3811965811965812, "computeRatioMax": 0.3811965811965812, "endMs": "1665777740061", "id": "5", "inputStages": [ "2" ], "name": "S05: Join+", "parallelInputs": "1", "readMsAvg": "11", "readMsMax": "11", "readRatioAvg": 0.009401709401709401, "readRatioMax": 0.009401709401709401, "recordsRead": "719750", "recordsWritten": "138313", "shuffleOutputBytes": "4287431", "shuffleOutputBytesSpilled": "0", "slotMs": "382", "startMs": "1665777739814", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:ws_sold_date_sk, $2:ws_item_sk, $3:ws_sales_price", "FROM web_sales", "WHERE not(is_null($2))" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage02_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1090 := $1080, $1091 := $1082", "$390 := SUM($1081)" ] }, { "kind": "JOIN", "substeps": [ "$1080 := $2, $1081 := $3, $1082 := $11", "INNER HASH JOIN EACH WITH ALL ON $1 = $10" ] }, { "kind": "WRITE", "substeps": [ "$1090, $1091, $390", "TO __stage05_output", "BY HASH($1090, $1091)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0008547008547008547, "waitRatioMax": 0.0008547008547008547, "writeMsAvg": "23", "writeMsMax": "23", "writeRatioAvg": 0.019658119658119658, "writeRatioMax": 0.019658119658119658 }, { "completedParallelInputs": "1", "computeMsAvg": "1170", "computeMsMax": "1170", "computeRatioAvg": 1, "computeRatioMax": 1, "endMs": "1665777740666", "id": "6", "inputStages": [ "4" ], "name": "S06: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "543984", "recordsWritten": "499071", "shuffleOutputBytes": "15303153", "shuffleOutputBytesSpilled": "0", "slotMs": "1005", "startMs": "1665777739993", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1310, $1311, $440", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1320 := $1310, $1321 := $1311", "$270 := SUM($440)" ] }, { "kind": "WRITE", "substeps": [ "$1320, $1321, $270", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0008547008547008547, "waitRatioMax": 0.0008547008547008547, "writeMsAvg": "30", "writeMsMax": "30", "writeRatioAvg": 0.02564102564102564, "writeRatioMax": 0.02564102564102564 }, { "completedParallelInputs": "1", "computeMsAvg": "225", "computeMsMax": "225", "computeRatioAvg": 0.19230769230769232, "computeRatioMax": 0.19230769230769232, "endMs": "1665777740263", "id": "7", "inputStages": [ "5" ], "name": "S07: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "138313", "recordsWritten": "138313", "shuffleOutputBytes": "4287431", "shuffleOutputBytesSpilled": "0", "slotMs": "189", "startMs": "1665777740114", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1090, $1091, $390", "FROM __stage05_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1100 := $1090, $1101 := $1091", "$240 := SUM($390)" ] }, { "kind": "WRITE", "substeps": [ "$1100, $1101, $240", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0008547008547008547, "waitRatioMax": 0.0008547008547008547, "writeMsAvg": "21", "writeMsMax": "21", "writeRatioAvg": 0.017948717948717947, "writeRatioMax": 0.017948717948717947 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.008547008547008548, "computeRatioMax": 0.008547008547008548, "endMs": "1665777740749", "id": "8", "name": "S08: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "52", "startMs": "1665777740693", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$850, $1481, $1480", "FROM __SHUFFLE17" ] }, { "kind": "COMPUTE", "substeps": [ "$480 := coalesce($1501, 0)", "$481 := coalesce($1501, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$510 := SUM($1490) OVER (PARTITION BY $1492 ORDER BY $1491 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1480 ASC, $1481 ASC" ] }, { "kind": "WRITE", "substeps": [ "$480, $481, $510, $1500", "TO __stage08_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0017094017094017094, "waitRatioMax": 0.0017094017094017094, "writeMsAvg": "48", "writeMsMax": "48", "writeRatioAvg": 0.041025641025641026, "writeRatioMax": 0.041025641025641026 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.006837606837606838, "computeRatioMax": 0.006837606837606838, "endMs": "1665777740749", "id": "9", "name": "S09: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "36", "startMs": "1665777740711", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$960, $1040, $1041, $1042", "FROM __SHUFFLE15" ] }, { "kind": "COMPUTE", "substeps": [ "$620 := coalesce($1440, 0)", "$621 := coalesce($1440, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$740 := SUM($1432) OVER (PARTITION BY $1431, $1430 ORDER BY $1433 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1040 ASC, $960 ASC, $1042 ASC" ] }, { "kind": "WRITE", "substeps": [ "$620, $621, $740, $1441", "TO __stage09_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0008547008547008547, "waitRatioMax": 0.0008547008547008547, "writeMsAvg": "33", "writeMsMax": "33", "writeRatioAvg": 0.028205128205128206, "writeRatioMax": 0.028205128205128206 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.010256410256410256, "computeRatioMax": 0.010256410256410256, "endMs": "1665777740761", "id": "10", "name": "S0A: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "33", "startMs": "1665777740733", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$800, $1261, $1260", "FROM __SHUFFLE8" ] }, { "kind": "COMPUTE", "substeps": [ "$430 := coalesce($1281, 0)", "$431 := coalesce($1281, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$500 := SUM($1270) OVER (PARTITION BY $1272 ORDER BY $1271 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1260 ASC, $1261 ASC" ] }, { "kind": "WRITE", "substeps": [ "$430, $431, $500, $1280", "TO __stage0A_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0008547008547008547, "waitRatioMax": 0.0008547008547008547, "writeMsAvg": "20", "writeMsMax": "20", "writeRatioAvg": 0.017094017094017096, "writeRatioMax": 0.017094017094017096 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.005982905982905983, "computeRatioMax": 0.005982905982905983, "endMs": "1665777740785", "id": "11", "name": "S0B: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665777740748", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$910, $1000, $1001, $1002", "FROM __SHUFFLE6" ] }, { "kind": "COMPUTE", "substeps": [ "$590 := coalesce($1220, 0)", "$591 := coalesce($1220, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$700 := SUM($1212) OVER (PARTITION BY $1211, $1210 ORDER BY $1213 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1000 ASC, $910 ASC, $1002 ASC" ] }, { "kind": "WRITE", "substeps": [ "$590, $591, $700, $1221", "TO __stage0B_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0017094017094017094, "waitRatioMax": 0.0017094017094017094, "writeMsAvg": "20", "writeMsMax": "20", "writeRatioAvg": 0.017094017094017096, "writeRatioMax": 0.017094017094017096 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "16", "computeRatioAvg": 0.006837606837606838, "computeRatioMax": 0.013675213675213675, "endMs": "1665777740852", "id": "12", "inputStages": [ "9" ], "name": "S0C: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "2957", "startMs": "1665777740765", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage09_output" ] } ], "waitMsAvg": "2", "waitMsMax": "8", "waitRatioAvg": 0.0017094017094017094, "waitRatioMax": 0.006837606837606838, "writeMsAvg": "13", "writeMsMax": "19", "writeRatioAvg": 0.011111111111111112, "writeRatioMax": 0.01623931623931624 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "16", "computeRatioAvg": 0.005982905982905983, "computeRatioMax": 0.013675213675213675, "endMs": "1665777740856", "id": "13", "inputStages": [ "8" ], "name": "S0D: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "2251", "startMs": "1665777740766", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage08_output" ] } ], "waitMsAvg": "7", "waitMsMax": "8", "waitRatioAvg": 0.005982905982905983, "waitRatioMax": 0.006837606837606838, "writeMsAvg": "4", "writeMsMax": "17", "writeRatioAvg": 0.003418803418803419, "writeRatioMax": 0.01452991452991453 }, { "completedParallelInputs": "101", "computeMsAvg": "19", "computeMsMax": "37", "computeRatioAvg": 0.01623931623931624, "computeRatioMax": 0.03162393162393162, "endMs": "1665777740866", "id": "14", "inputStages": [ "13", "6", "12" ], "name": "S0E: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "499071", "recordsWritten": "499071", "shuffleOutputBytes": "15467793", "shuffleOutputBytesSpilled": "0", "slotMs": "3622", "startMs": "1665777740785", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1320, $1321, $270", "FROM __stage06_output" ] }, { "kind": "READ", "substeps": [ "$460, $1400, $1401, $1402, $1404", "FROM __SHUFFLE14" ] }, { "kind": "READ", "substeps": [ "$620, $621, $740, $1441", "FROM __stage0C_output" ] }, { "kind": "READ", "substeps": [ "$480, $481, $510, $1500", "FROM __stage0D_output" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$200 := SUM($1332) OVER (PARTITION BY $1330 ORDER BY $1331 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$450 ASC, $451 ASC" ] }, { "kind": "COMPUTE", "substeps": [ "$290 := if(equal($1511, -1), if(equal($1510, -1), NULL, $1512), ...)" ] }, { "kind": "JOIN", "substeps": [ "$1510 := $1450, $1511 := $1451, $1512 := $1454, $1513 := $1452, $1514 := $1453, $1515 := $510", "LEFT OUTER HASH JOIN EACH WITH ALL ON $470 = $480, $471 = $481, $1451 = $1500" ] }, { "kind": "COMPUTE", "substeps": [ "$470 := coalesce($1452, 0)", "$471 := coalesce($1452, 1)" ] }, { "kind": "JOIN", "substeps": [ "$1450 := $612, $1451 := $613, $1452 := $1030, $1453 := $1031, $1454 := $740", "LEFT OUTER HASH JOIN EACH WITH ALL ON $610 = $620, $611 = $621, $612 = $1441" ] }, { "kind": "COMPUTE", "substeps": [ "$610 := coalesce($1030, 0)", "$611 := coalesce($1030, 1)", "$612 := if(or($870, $730), -1, $840)", "$613 := if($870, -1, if($730, $731, subtract($731, 1)))" ] }, { "kind": "COMPUTE", "substeps": [ "$730 := equal(mod(add($840, 1), 16384), 0)", "$731 := div($840, 16384)" ] }, { "kind": "COMPUTE", "substeps": [ "$840 := if($871, subtract($1032, 1), $950)" ] }, { "kind": "COMPUTE", "substeps": [ "$870 := less($950, 0)", "$871 := greater_or_equal($950, $1032)" ] }, { "kind": "COMPUTE", "substeps": [ "$950 := $1033" ] }, { "kind": "WRITE", "substeps": [ "$170, $171, $172", "TO __stage0E_output" ] } ], "waitMsAvg": "2", "waitMsMax": "4", "waitRatioAvg": 0.0017094017094017094, "waitRatioMax": 0.003418803418803419, "writeMsAvg": "10", "writeMsMax": "19", "writeRatioAvg": 0.008547008547008548, "writeRatioMax": 0.01623931623931624 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "11", "computeRatioAvg": 0.005982905982905983, "computeRatioMax": 0.009401709401709401, "endMs": "1665777740889", "id": "15", "inputStages": [ "11" ], "name": "S0F: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3317", "startMs": "1665777740800", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0B_output" ] } ], "waitMsAvg": "4", "waitMsMax": "7", "waitRatioAvg": 0.003418803418803419, "waitRatioMax": 0.005982905982905983, "writeMsAvg": "11", "writeMsMax": "29", "writeRatioAvg": 0.009401709401709401, "writeRatioMax": 0.024786324786324785 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "15", "computeRatioAvg": 0.005982905982905983, "computeRatioMax": 0.01282051282051282, "endMs": "1665777740886", "id": "16", "inputStages": [ "10" ], "name": "S10: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "2333", "startMs": "1665777740810", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0A_output" ] } ], "waitMsAvg": "6", "waitMsMax": "7", "waitRatioAvg": 0.005128205128205128, "waitRatioMax": 0.005982905982905983, "writeMsAvg": "6", "writeMsMax": "18", "writeRatioAvg": 0.005128205128205128, "writeRatioMax": 0.015384615384615385 }, { "completedParallelInputs": "101", "computeMsAvg": "13", "computeMsMax": "28", "computeRatioAvg": 0.011111111111111112, "computeRatioMax": 0.023931623931623933, "endMs": "1665777740896", "id": "17", "inputStages": [ "16", "15", "7" ], "name": "S11: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "138313", "recordsWritten": "138313", "shuffleOutputBytes": "4287687", "shuffleOutputBytesSpilled": "0", "slotMs": "3269", "startMs": "1665777740833", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1100, $1101, $240", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$410, $1180, $1181, $1182, $1184", "FROM __SHUFFLE5" ] }, { "kind": "READ", "substeps": [ "$590, $591, $700, $1221", "FROM __stage0F_output" ] }, { "kind": "READ", "substeps": [ "$430, $431, $500, $1280", "FROM __stage10_output" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$190 := SUM($1112) OVER (PARTITION BY $1110 ORDER BY $1111 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$400 ASC, $401 ASC" ] }, { "kind": "COMPUTE", "substeps": [ "$260 := if(equal($1291, -1), if(equal($1290, -1), NULL, $1292), ...)" ] }, { "kind": "JOIN", "substeps": [ "$1290 := $1230, $1291 := $1231, $1292 := $1234, $1293 := $1232, $1294 := $1233, $1295 := $500", "LEFT OUTER HASH JOIN EACH WITH ALL ON $420 = $430, $421 = $431, $1231 = $1280" ] }, { "kind": "COMPUTE", "substeps": [ "$420 := coalesce($1232, 0)", "$421 := coalesce($1232, 1)" ] }, { "kind": "JOIN", "substeps": [ "$1230 := $582, $1231 := $583, $1232 := $990, $1233 := $991, $1234 := $700", "LEFT OUTER HASH JOIN EACH WITH ALL ON $580 = $590, $581 = $591, $582 = $1221" ] }, { "kind": "COMPUTE", "substeps": [ "$580 := coalesce($990, 0)", "$581 := coalesce($990, 1)", "$582 := if(or($860, $690), -1, $790)", "$583 := if($860, -1, if($690, $691, subtract($691, 1)))" ] }, { "kind": "COMPUTE", "substeps": [ "$690 := equal(mod(add($790, 1), 16384), 0)", "$691 := div($790, 16384)" ] }, { "kind": "COMPUTE", "substeps": [ "$790 := if($861, subtract($992, 1), $900)" ] }, { "kind": "COMPUTE", "substeps": [ "$860 := less($900, 0)", "$861 := greater_or_equal($900, $992)" ] }, { "kind": "COMPUTE", "substeps": [ "$900 := $993" ] }, { "kind": "WRITE", "substeps": [ "$150, $151, $152", "TO __stage11_output" ] } ], "waitMsAvg": "2", "waitMsMax": "9", "waitRatioAvg": 0.0017094017094017094, "waitRatioMax": 0.007692307692307693, "writeMsAvg": "11", "writeMsMax": "21", "writeRatioAvg": 0.009401709401709401, "writeRatioMax": 0.017948717948717947 }, { "completedParallelInputs": "100", "computeMsAvg": "22", "computeMsMax": "35", "computeRatioAvg": 0.018803418803418803, "computeRatioMax": 0.029914529914529916, "endMs": "1665777740978", "id": "18", "inputStages": [ "14", "17" ], "name": "S12: Join+", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "637384", "recordsWritten": "610617", "shuffleOutputBytes": "19964592", "shuffleOutputBytesSpilled": "0", "slotMs": "4327", "startMs": "1665777740914", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$150, $151, $152", "FROM __stage11_output" ] }, { "kind": "READ", "substeps": [ "$170, $171, $172", "FROM __stage0E_output" ] }, { "kind": "COMPUTE", "substeps": [ "$70 := case_no_value(not(is_null($1520)), $1520, $1523)", "$71 := case_no_value(not(is_null($1521)), $1521, $1524)" ] }, { "kind": "JOIN", "substeps": [ "$1520 := $150, $1521 := $151, $1522 := $152, $1523 := $170, $1524 := $171, $1525 := $172", "FULL OUTER HASH JOIN EACH WITH EACH ON $150 = $170, $151 = $171" ] }, { "kind": "WRITE", "substeps": [ "$70, $71, $1522, $1525", "TO __stage12_output" ] } ], "waitMsAvg": "2", "waitMsMax": "4", "waitRatioAvg": 0.0017094017094017094, "waitRatioMax": 0.003418803418803419, "writeMsAvg": "8", "writeMsMax": "27", "writeRatioAvg": 0.006837606837606838, "writeRatioMax": 0.023076923076923078 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.009401709401709401, "computeRatioMax": 0.009401709401709401, "endMs": "1665777741050", "id": "19", "name": "S13: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "52", "startMs": "1665777741012", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$380, $381, $1671, $1670", "FROM __SHUFFLE25" ] }, { "kind": "COMPUTE", "substeps": [ "$130 := coalesce($1691, 0)", "$131 := coalesce($1691, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$180 := MAX($1680) OVER (PARTITION BY $1683 ORDER BY $1682 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)", "$181 := MAX($1681) OVER (PARTITION BY $1683 ORDER BY $1682 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1670 ASC, $1671 ASC" ] }, { "kind": "WRITE", "substeps": [ "$130, $131, $180, $181, $1690", "TO __stage13_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.002564102564102564, "waitRatioMax": 0.002564102564102564, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.01623931623931624, "writeRatioMax": 0.01623931623931624 }, { "completedParallelInputs": "1", "computeMsAvg": "6", "computeMsMax": "6", "computeRatioAvg": 0.005128205128205128, "computeRatioMax": 0.005128205128205128, "endMs": "1665777741069", "id": "20", "name": "S14: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "52", "startMs": "1665777741030", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$550, $650, $651, $652, $653", "FROM __SHUFFLE23" ] }, { "kind": "COMPUTE", "substeps": [ "$230 := coalesce($1630, 0)", "$231 := coalesce($1630, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$330 := MAX($1622) OVER (PARTITION BY $1621, $1620 ORDER BY $1624 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)", "$331 := MAX($1623) OVER (PARTITION BY $1621, $1620 ORDER BY $1624 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$650 ASC, $550 ASC, $653 ASC" ] }, { "kind": "WRITE", "substeps": [ "$230, $231, $330, $331, $1631", "TO __stage14_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0017094017094017094, "waitRatioMax": 0.0017094017094017094, "writeMsAvg": "33", "writeMsMax": "33", "writeRatioAvg": 0.028205128205128206, "writeRatioMax": 0.028205128205128206 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "13", "computeRatioAvg": 0.005982905982905983, "computeRatioMax": 0.011111111111111112, "endMs": "1665777741167", "id": "21", "inputStages": [ "20" ], "name": "S15: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "2777", "startMs": "1665777741085", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage14_output" ] } ], "waitMsAvg": "5", "waitMsMax": "9", "waitRatioAvg": 0.004273504273504274, "waitRatioMax": 0.007692307692307693, "writeMsAvg": "8", "writeMsMax": "28", "writeRatioAvg": 0.006837606837606838, "writeRatioMax": 0.023931623931623933 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "13", "computeRatioAvg": 0.005982905982905983, "computeRatioMax": 0.011111111111111112, "endMs": "1665777741157", "id": "22", "inputStages": [ "19" ], "name": "S16: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "2993", "startMs": "1665777741092", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage13_output" ] } ], "waitMsAvg": "9", "waitMsMax": "10", "waitRatioAvg": 0.007692307692307693, "waitRatioMax": 0.008547008547008548, "writeMsAvg": "11", "writeMsMax": "19", "writeRatioAvg": 0.009401709401709401, "writeRatioMax": 0.01623931623931624 }, { "completedParallelInputs": "101", "computeMsAvg": "15", "computeMsMax": "30", "computeRatioAvg": 0.01282051282051282, "computeRatioMax": 0.02564102564102564, "endMs": "1665777741179", "id": "23", "inputStages": [ "22", "18", "21" ], "name": "S17: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "610617", "recordsWritten": "10000", "shuffleOutputBytes": "668048", "shuffleOutputBytesSpilled": "0", "slotMs": "3557", "startMs": "1665777741104", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70, $71, $1522, $1525", "FROM __stage12_output" ] }, { "kind": "READ", "substeps": [ "$110, $1600, $1601, $1602, $1603, $1605", "FROM __SHUFFLE22" ] }, { "kind": "READ", "substeps": [ "$230, $231, $330, $331, $1631", "FROM __stage15_output" ] }, { "kind": "READ", "substeps": [ "$130, $131, $180, $181, $1690", "FROM __stage16_output" ] }, { "kind": "SORT", "substeps": [ "$52 ASC, $53 ASC", "LIMIT 100" ] }, { "kind": "FILTER", "substeps": [ "greater($51, $50)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$60 := MAX($1532) OVER (PARTITION BY $1530 ORDER BY $1531 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)", "$61 := MAX($1533) OVER (PARTITION BY $1530 ORDER BY $1531 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$100 ASC, $101 ASC" ] }, { "kind": "COMPUTE", "substeps": [ "$90 := if(equal($1701, -1), if(equal($1700, -1), NULL, $1702), ...)", "$91 := if(equal($1701, -1), if(equal($1700, -1), NULL, $1703), ...)" ] }, { "kind": "JOIN", "substeps": [ "$1700 := $1640, $1701 := $1641, $1702 := $1646, $1703 := $1647, $1704 := $1642, $1705 := $1643, $1706 := $1644, $1707 := $1645, $1708 := $180, $1709 := $181", "LEFT OUTER HASH JOIN EACH WITH ALL ON $120 = $130, $121 = $131, $1641 = $1690" ] }, { "kind": "COMPUTE", "substeps": [ "$120 := coalesce($1642, 0)", "$121 := coalesce($1642, 1)" ] }, { "kind": "JOIN", "substeps": [ "$1640 := $222, $1641 := $223, $1642 := $640, $1643 := $641, $1644 := $642, $1645 := $643, $1646 := $330, $1647 := $331", "LEFT OUTER HASH JOIN EACH WITH ALL ON $220 = $230, $221 = $231, $222 = $1631" ] }, { "kind": "COMPUTE", "substeps": [ "$220 := coalesce($640, 0)", "$221 := coalesce($640, 1)", "$222 := if(or($490, $320), -1, $370)", "$223 := if($490, -1, if($320, $321, subtract($321, 1)))" ] }, { "kind": "COMPUTE", "substeps": [ "$320 := equal(mod(add($370, 1), 16384), 0)", "$321 := div($370, 16384)" ] }, { "kind": "COMPUTE", "substeps": [ "$370 := if($491, subtract($644, 1), $540)" ] }, { "kind": "COMPUTE", "substeps": [ "$490 := less($540, 0)", "$491 := greater_or_equal($540, $644)" ] }, { "kind": "COMPUTE", "substeps": [ "$540 := $645" ] }, { "kind": "WRITE", "substeps": [ "$1710, $1711, $1712, $1713, $1714, $1715", "TO __stage17_output" ] } ], "waitMsAvg": "9", "waitMsMax": "12", "waitRatioAvg": 0.007692307692307693, "waitRatioMax": 0.010256410256410256, "writeMsAvg": "11", "writeMsMax": "28", "writeRatioAvg": 0.009401709401709401, "writeRatioMax": 0.023931623931623933 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.008547008547008548, "computeRatioMax": 0.008547008547008548, "endMs": "1665777741189", "id": "24", "inputStages": [ "23" ], "name": "S18: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "10000", "recordsWritten": "100", "shuffleOutputBytes": "6696", "shuffleOutputBytesSpilled": "0", "slotMs": "16", "startMs": "1665777741112", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1710, $1711, $1712, $1713, $1714, $1715", "FROM __stage17_output" ] }, { "kind": "SORT", "substeps": [ "$1712 ASC, $1713 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$1720, $1721, $1722, $1723, $1724, $1725", "TO __stage18_output" ] } ], "waitMsAvg": "16", "waitMsMax": "16", "waitRatioAvg": 0.013675213675213675, "waitRatioMax": 0.013675213675213675, "writeMsAvg": "4", "writeMsMax": "4", "writeRatioAvg": 0.003418803418803419, "writeRatioMax": 0.003418803418803419 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "2", "completedUnits": "9", "elapsedMs": "637", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "1813" }, { "activeUnits": "201", "completedUnits": "1021", "elapsedMs": "1698", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "34821" } ], "totalBytesBilled": "114294784", "totalBytesProcessed": "113826808", "totalPartitionsProcessed": "0", "totalSlotMs": "34821", "transferredBytes": "0" }, "startTime": "1665777739591", "totalBytesProcessed": "113826808", "totalSlotMs": "34821" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon557b1b5c_4556_46b5_a70a_b144f53f36c1" }, "priority": "INTERACTIVE", "query": "-- start query 51 in stream 0 using template query51.tpl\n\n/*\nCompute the count of store sales resulting from promotions, \nthe count of all store sales and \ntheir ratio for specific categories in a particular time zone and for a given year and month.\n*/\n\nWITH web_v1 as (\nselect\n ws_item_sk item_sk, d_date,\n sum(sum(ws_sales_price))\n over (partition by ws_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom web_sales\n ,date_dim\nwhere ws_sold_date_sk=d_date_sk\n and d_month_seq between 1200 and 1200+11\n and ws_item_sk is not NULL\ngroup by ws_item_sk, d_date),\nstore_v1 as (\nselect\n ss_item_sk item_sk, d_date,\n sum(sum(ss_sales_price))\n over (partition by ss_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom store_sales\n ,date_dim\nwhere ss_sold_date_sk=d_date_sk\n and d_month_seq between 1200 and 1200+11\n and ss_item_sk is not NULL\ngroup by ss_item_sk, d_date)\nselect *\nfrom (select item_sk\n ,d_date\n ,web_sales\n ,store_sales\n ,max(web_sales)\n over (partition by item_sk order by d_date rows between unbounded preceding and current row) web_cumulative\n ,max(store_sales)\n over (partition by item_sk order by d_date rows between unbounded preceding and current row) store_cumulative\n from (select case when web.item_sk is not null then web.item_sk else store.item_sk end item_sk\n ,case when web.d_date is not null then web.d_date else store.d_date end d_date\n ,web.cume_sales web_sales\n ,store.cume_sales store_sales\n from web_v1 web full outer join store_v1 store on (web.item_sk = store.item_sk\n and web.d_date = store.d_date)\n )x )y\nwhere web_cumulative > store_cumulative\norder by item_sk\n ,d_date\nlimit 100\n;\n\n-- end query 51 in stream 0 using template query51.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "FBatFQz52Uk4e8bApqZMCg==", "id": "test-project-364309:europe-west1.query51_1665777742", "jobReference": { "jobId": "query51_1665777742", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query51_1665777742?location=europe-west1", "statistics": { "creationTime": "1665777743495", "endTime": "1665777745359", "finalExecutionDurationMs": "1627", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "113826808", "performanceInsights": { "avgPreviousExecutionMs": "1500" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.008350730688935281, "computeRatioMax": 0.008350730688935281, "endMs": "1665777743691", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.003479471120389701, "readRatioMax": 0.003479471120389701, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "5124", "shuffleOutputBytesSpilled": "0", "slotMs": "34", "startMs": "1665777743653", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $31:d_date, $32:d_month_seq", "FROM date_dim", "WHERE between($32, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$30, $31", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006958942240779402, "waitRatioMax": 0.0006958942240779402, "writeMsAvg": "12", "writeMsMax": "12", "writeRatioAvg": 0.008350730688935281, "writeRatioMax": 0.008350730688935281 }, { "completedParallelInputs": "1", "computeMsAvg": "15", "computeMsMax": "15", "computeRatioAvg": 0.010438413361169102, "computeRatioMax": 0.010438413361169102, "endMs": "1665777743724", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.006263048016701462, "readRatioMax": 0.006263048016701462, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "5124", "shuffleOutputBytesSpilled": "0", "slotMs": "42", "startMs": "1665777743683", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_date, $12:d_month_seq", "FROM date_dim", "WHERE between($12, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006958942240779402, "waitRatioMax": 0.0006958942240779402, "writeMsAvg": "9", "writeMsMax": "9", "writeRatioAvg": 0.006263048016701462, "writeRatioMax": 0.006263048016701462 }, { "completedParallelInputs": "6", "computeMsAvg": "263", "computeMsMax": "325", "computeRatioAvg": 0.18302018093249825, "computeRatioMax": 0.22616562282533054, "endMs": "1665777743942", "id": "4", "inputStages": [ "0" ], "name": "S04: Join+", "parallelInputs": "6", "readMsAvg": "16", "readMsMax": "24", "readRatioAvg": 0.011134307585247043, "readRatioMax": 0.016701461377870562, "recordsRead": "2882600", "recordsWritten": "543984", "shuffleOutputBytes": "16663712", "shuffleOutputBytesSpilled": "0", "slotMs": "1505", "startMs": "1665777743720", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ss_sold_date_sk, $21:ss_item_sk, $22:ss_sales_price", "FROM store_sales", "WHERE not(is_null($21))" ] }, { "kind": "READ", "substeps": [ "$30, $31", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1310 := $1300, $1311 := $1302", "$440 := SUM($1301)" ] }, { "kind": "JOIN", "substeps": [ "$1300 := $21, $1301 := $22, $1302 := $31", "INNER HASH JOIN EACH WITH ALL ON $20 = $30" ] }, { "kind": "WRITE", "substeps": [ "$1310, $1311, $440", "TO __stage04_output", "BY HASH($1310, $1311)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006958942240779402, "waitRatioMax": 0.0006958942240779402, "writeMsAvg": "23", "writeMsMax": "34", "writeRatioAvg": 0.016005567153792623, "writeRatioMax": 0.023660403618649965 }, { "completedParallelInputs": "1", "computeMsAvg": "338", "computeMsMax": "338", "computeRatioAvg": 0.23521224773834376, "computeRatioMax": 0.23521224773834376, "endMs": "1665777743970", "id": "5", "inputStages": [ "2" ], "name": "S05: Join+", "parallelInputs": "1", "readMsAvg": "14", "readMsMax": "14", "readRatioAvg": 0.009742519137091163, "readRatioMax": 0.009742519137091163, "recordsRead": "719750", "recordsWritten": "138313", "shuffleOutputBytes": "4287431", "shuffleOutputBytesSpilled": "0", "slotMs": "329", "startMs": "1665777743746", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:ws_sold_date_sk, $2:ws_item_sk, $3:ws_sales_price", "FROM web_sales", "WHERE not(is_null($2))" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage02_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1090 := $1080, $1091 := $1082", "$390 := SUM($1081)" ] }, { "kind": "JOIN", "substeps": [ "$1080 := $2, $1081 := $3, $1082 := $11", "INNER HASH JOIN EACH WITH ALL ON $1 = $10" ] }, { "kind": "WRITE", "substeps": [ "$1090, $1091, $390", "TO __stage05_output", "BY HASH($1090, $1091)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006958942240779402, "waitRatioMax": 0.0006958942240779402, "writeMsAvg": "26", "writeMsMax": "26", "writeRatioAvg": 0.018093249826026444, "writeRatioMax": 0.018093249826026444 }, { "completedParallelInputs": "1", "computeMsAvg": "1437", "computeMsMax": "1437", "computeRatioAvg": 1, "computeRatioMax": 1, "endMs": "1665777744771", "id": "6", "inputStages": [ "4" ], "name": "S06: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "543984", "recordsWritten": "499071", "shuffleOutputBytes": "15303153", "shuffleOutputBytesSpilled": "0", "slotMs": "1231", "startMs": "1665777743960", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1310, $1311, $440", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1320 := $1310, $1321 := $1311", "$270 := SUM($440)" ] }, { "kind": "WRITE", "substeps": [ "$1320, $1321, $270", "TO __stage06_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0013917884481558804, "waitRatioMax": 0.0013917884481558804, "writeMsAvg": "34", "writeMsMax": "34", "writeRatioAvg": 0.023660403618649965, "writeRatioMax": 0.023660403618649965 }, { "completedParallelInputs": "1", "computeMsAvg": "164", "computeMsMax": "164", "computeRatioAvg": 0.11412665274878218, "computeRatioMax": 0.11412665274878218, "endMs": "1665777744136", "id": "7", "inputStages": [ "5" ], "name": "S07: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "138313", "recordsWritten": "138313", "shuffleOutputBytes": "4287431", "shuffleOutputBytesSpilled": "0", "slotMs": "148", "startMs": "1665777744014", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1090, $1091, $390", "FROM __stage05_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1100 := $1090, $1101 := $1091", "$240 := SUM($390)" ] }, { "kind": "WRITE", "substeps": [ "$1100, $1101, $240", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006958942240779402, "waitRatioMax": 0.0006958942240779402, "writeMsAvg": "22", "writeMsMax": "22", "writeRatioAvg": 0.015309672929714684, "writeRatioMax": 0.015309672929714684 }, { "completedParallelInputs": "1", "computeMsAvg": "18", "computeMsMax": "18", "computeRatioAvg": 0.012526096033402923, "computeRatioMax": 0.012526096033402923, "endMs": "1665777744846", "id": "8", "name": "S08: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "48", "startMs": "1665777744802", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$850, $1481, $1480", "FROM __SHUFFLE17" ] }, { "kind": "COMPUTE", "substeps": [ "$480 := coalesce($1501, 0)", "$481 := coalesce($1501, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$510 := SUM($1490) OVER (PARTITION BY $1492 ORDER BY $1491 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1480 ASC, $1481 ASC" ] }, { "kind": "WRITE", "substeps": [ "$480, $481, $510, $1500", "TO __stage08_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006958942240779402, "waitRatioMax": 0.0006958942240779402, "writeMsAvg": "23", "writeMsMax": "23", "writeRatioAvg": 0.016005567153792623, "writeRatioMax": 0.016005567153792623 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.006958942240779402, "computeRatioMax": 0.006958942240779402, "endMs": "1665777744856", "id": "9", "name": "S09: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665777744820", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$960, $1040, $1041, $1042", "FROM __SHUFFLE15" ] }, { "kind": "COMPUTE", "substeps": [ "$620 := coalesce($1440, 0)", "$621 := coalesce($1440, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$740 := SUM($1432) OVER (PARTITION BY $1431, $1430 ORDER BY $1433 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1040 ASC, $960 ASC, $1042 ASC" ] }, { "kind": "WRITE", "substeps": [ "$620, $621, $740, $1441", "TO __stage09_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0013917884481558804, "waitRatioMax": 0.0013917884481558804, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.012526096033402923, "writeRatioMax": 0.012526096033402923 }, { "completedParallelInputs": "1", "computeMsAvg": "5", "computeMsMax": "5", "computeRatioAvg": 0.003479471120389701, "computeRatioMax": 0.003479471120389701, "endMs": "1665777744879", "id": "10", "name": "S0A: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665777744837", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$800, $1261, $1260", "FROM __SHUFFLE8" ] }, { "kind": "COMPUTE", "substeps": [ "$430 := coalesce($1281, 0)", "$431 := coalesce($1281, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$500 := SUM($1270) OVER (PARTITION BY $1272 ORDER BY $1271 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1260 ASC, $1261 ASC" ] }, { "kind": "WRITE", "substeps": [ "$430, $431, $500, $1280", "TO __stage0A_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006958942240779402, "waitRatioMax": 0.0006958942240779402, "writeMsAvg": "33", "writeMsMax": "33", "writeRatioAvg": 0.022964509394572025, "writeRatioMax": 0.022964509394572025 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.006263048016701462, "computeRatioMax": 0.006263048016701462, "endMs": "1665777744892", "id": "11", "name": "S0B: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "31", "startMs": "1665777744851", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$910, $1000, $1001, $1002", "FROM __SHUFFLE6" ] }, { "kind": "COMPUTE", "substeps": [ "$590 := coalesce($1220, 0)", "$591 := coalesce($1220, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$700 := SUM($1212) OVER (PARTITION BY $1211, $1210 ORDER BY $1213 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1000 ASC, $910 ASC, $1002 ASC" ] }, { "kind": "WRITE", "substeps": [ "$590, $591, $700, $1221", "TO __stage0B_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006958942240779402, "waitRatioMax": 0.0006958942240779402, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.013221990257480862, "writeRatioMax": 0.013221990257480862 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "13", "computeRatioAvg": 0.0055671537926235215, "computeRatioMax": 0.009046624913013222, "endMs": "1665777744937", "id": "12", "inputStages": [ "9" ], "name": "S0C: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3030", "startMs": "1665777744869", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage09_output" ] } ], "waitMsAvg": "3", "waitMsMax": "6", "waitRatioAvg": 0.0020876826722338203, "waitRatioMax": 0.0041753653444676405, "writeMsAvg": "14", "writeMsMax": "26", "writeRatioAvg": 0.009742519137091163, "writeRatioMax": 0.018093249826026444 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "17", "computeRatioAvg": 0.0055671537926235215, "computeRatioMax": 0.011830201809324982, "endMs": "1665777744970", "id": "13", "inputStages": [ "8" ], "name": "S0D: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3452", "startMs": "1665777744870", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage08_output" ] } ], "waitMsAvg": "5", "waitMsMax": "6", "waitRatioAvg": 0.003479471120389701, "waitRatioMax": 0.0041753653444676405, "writeMsAvg": "15", "writeMsMax": "29", "writeRatioAvg": 0.010438413361169102, "writeRatioMax": 0.020180932498260265 }, { "completedParallelInputs": "101", "computeMsAvg": "20", "computeMsMax": "35", "computeRatioAvg": 0.013917884481558803, "computeRatioMax": 0.024356297842727904, "endMs": "1665777744953", "id": "14", "inputStages": [ "13", "12", "6" ], "name": "S0E: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "499071", "recordsWritten": "499071", "shuffleOutputBytes": "15467793", "shuffleOutputBytesSpilled": "0", "slotMs": "3977", "startMs": "1665777744886", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1320, $1321, $270", "FROM __stage06_output" ] }, { "kind": "READ", "substeps": [ "$460, $1400, $1401, $1402, $1404", "FROM __SHUFFLE14" ] }, { "kind": "READ", "substeps": [ "$620, $621, $740, $1441", "FROM __stage0C_output" ] }, { "kind": "READ", "substeps": [ "$480, $481, $510, $1500", "FROM __stage0D_output" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$200 := SUM($1332) OVER (PARTITION BY $1330 ORDER BY $1331 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$450 ASC, $451 ASC" ] }, { "kind": "COMPUTE", "substeps": [ "$290 := if(equal($1511, -1), if(equal($1510, -1), NULL, $1512), ...)" ] }, { "kind": "JOIN", "substeps": [ "$1510 := $1450, $1511 := $1451, $1512 := $1454, $1513 := $1452, $1514 := $1453, $1515 := $510", "LEFT OUTER HASH JOIN EACH WITH ALL ON $470 = $480, $471 = $481, $1451 = $1500" ] }, { "kind": "COMPUTE", "substeps": [ "$470 := coalesce($1452, 0)", "$471 := coalesce($1452, 1)" ] }, { "kind": "JOIN", "substeps": [ "$1450 := $612, $1451 := $613, $1452 := $1030, $1453 := $1031, $1454 := $740", "LEFT OUTER HASH JOIN EACH WITH ALL ON $610 = $620, $611 = $621, $612 = $1441" ] }, { "kind": "COMPUTE", "substeps": [ "$610 := coalesce($1030, 0)", "$611 := coalesce($1030, 1)", "$612 := if(or($870, $730), -1, $840)", "$613 := if($870, -1, if($730, $731, subtract($731, 1)))" ] }, { "kind": "COMPUTE", "substeps": [ "$730 := equal(mod(add($840, 1), 16384), 0)", "$731 := div($840, 16384)" ] }, { "kind": "COMPUTE", "substeps": [ "$840 := if($871, subtract($1032, 1), $950)" ] }, { "kind": "COMPUTE", "substeps": [ "$870 := less($950, 0)", "$871 := greater_or_equal($950, $1032)" ] }, { "kind": "COMPUTE", "substeps": [ "$950 := $1033" ] }, { "kind": "WRITE", "substeps": [ "$170, $171, $172", "TO __stage0E_output" ] } ], "waitMsAvg": "1", "waitMsMax": "3", "waitRatioAvg": 0.0006958942240779402, "waitRatioMax": 0.0020876826722338203, "writeMsAvg": "12", "writeMsMax": "31", "writeRatioAvg": 0.008350730688935281, "writeRatioMax": 0.021572720946416143 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "16", "computeRatioAvg": 0.0055671537926235215, "computeRatioMax": 0.011134307585247043, "endMs": "1665777744962", "id": "15", "inputStages": [ "11" ], "name": "S0F: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3107", "startMs": "1665777744898", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0B_output" ] } ], "waitMsAvg": "1", "waitMsMax": "3", "waitRatioAvg": 0.0006958942240779402, "waitRatioMax": 0.0020876826722338203, "writeMsAvg": "14", "writeMsMax": "21", "writeRatioAvg": 0.009742519137091163, "writeRatioMax": 0.014613778705636743 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "16", "computeRatioAvg": 0.0055671537926235215, "computeRatioMax": 0.011134307585247043, "endMs": "1665777744963", "id": "16", "inputStages": [ "10" ], "name": "S10: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "2877", "startMs": "1665777744898", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0A_output" ] } ], "waitMsAvg": "3", "waitMsMax": "5", "waitRatioAvg": 0.0020876826722338203, "waitRatioMax": 0.003479471120389701, "writeMsAvg": "10", "writeMsMax": "27", "writeRatioAvg": 0.006958942240779402, "writeRatioMax": 0.018789144050104383 }, { "completedParallelInputs": "101", "computeMsAvg": "14", "computeMsMax": "21", "computeRatioAvg": 0.009742519137091163, "computeRatioMax": 0.014613778705636743, "endMs": "1665777744988", "id": "17", "inputStages": [ "7", "15", "16" ], "name": "S11: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "138313", "recordsWritten": "138313", "shuffleOutputBytes": "4287687", "shuffleOutputBytesSpilled": "0", "slotMs": "3549", "startMs": "1665777744928", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1100, $1101, $240", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$410, $1180, $1181, $1182, $1184", "FROM __SHUFFLE5" ] }, { "kind": "READ", "substeps": [ "$590, $591, $700, $1221", "FROM __stage0F_output" ] }, { "kind": "READ", "substeps": [ "$430, $431, $500, $1280", "FROM __stage10_output" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$190 := SUM($1112) OVER (PARTITION BY $1110 ORDER BY $1111 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$400 ASC, $401 ASC" ] }, { "kind": "COMPUTE", "substeps": [ "$260 := if(equal($1291, -1), if(equal($1290, -1), NULL, $1292), ...)" ] }, { "kind": "JOIN", "substeps": [ "$1290 := $1230, $1291 := $1231, $1292 := $1234, $1293 := $1232, $1294 := $1233, $1295 := $500", "LEFT OUTER HASH JOIN EACH WITH ALL ON $420 = $430, $421 = $431, $1231 = $1280" ] }, { "kind": "COMPUTE", "substeps": [ "$420 := coalesce($1232, 0)", "$421 := coalesce($1232, 1)" ] }, { "kind": "JOIN", "substeps": [ "$1230 := $582, $1231 := $583, $1232 := $990, $1233 := $991, $1234 := $700", "LEFT OUTER HASH JOIN EACH WITH ALL ON $580 = $590, $581 = $591, $582 = $1221" ] }, { "kind": "COMPUTE", "substeps": [ "$580 := coalesce($990, 0)", "$581 := coalesce($990, 1)", "$582 := if(or($860, $690), -1, $790)", "$583 := if($860, -1, if($690, $691, subtract($691, 1)))" ] }, { "kind": "COMPUTE", "substeps": [ "$690 := equal(mod(add($790, 1), 16384), 0)", "$691 := div($790, 16384)" ] }, { "kind": "COMPUTE", "substeps": [ "$790 := if($861, subtract($992, 1), $900)" ] }, { "kind": "COMPUTE", "substeps": [ "$860 := less($900, 0)", "$861 := greater_or_equal($900, $992)" ] }, { "kind": "COMPUTE", "substeps": [ "$900 := $993" ] }, { "kind": "WRITE", "substeps": [ "$150, $151, $152", "TO __stage11_output" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.0013917884481558804, "waitRatioMax": 0.0020876826722338203, "writeMsAvg": "12", "writeMsMax": "25", "writeRatioAvg": 0.008350730688935281, "writeRatioMax": 0.017397355601948505 }, { "completedParallelInputs": "100", "computeMsAvg": "21", "computeMsMax": "37", "computeRatioAvg": 0.014613778705636743, "computeRatioMax": 0.025748086290883786, "endMs": "1665777745066", "id": "18", "inputStages": [ "17", "14" ], "name": "S12: Join+", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "637384", "recordsWritten": "610617", "shuffleOutputBytes": "19964592", "shuffleOutputBytesSpilled": "0", "slotMs": "3449", "startMs": "1665777745022", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$150, $151, $152", "FROM __stage11_output" ] }, { "kind": "READ", "substeps": [ "$170, $171, $172", "FROM __stage0E_output" ] }, { "kind": "COMPUTE", "substeps": [ "$70 := case_no_value(not(is_null($1520)), $1520, $1523)", "$71 := case_no_value(not(is_null($1521)), $1521, $1524)" ] }, { "kind": "JOIN", "substeps": [ "$1520 := $150, $1521 := $151, $1522 := $152, $1523 := $170, $1524 := $171, $1525 := $172", "FULL OUTER HASH JOIN EACH WITH EACH ON $150 = $170, $151 = $171" ] }, { "kind": "WRITE", "substeps": [ "$70, $71, $1522, $1525", "TO __stage12_output" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.0013917884481558804, "waitRatioMax": 0.0020876826722338203, "writeMsAvg": "7", "writeMsMax": "10", "writeRatioAvg": 0.0048712595685455815, "writeRatioMax": 0.006958942240779402 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.006263048016701462, "computeRatioMax": 0.006263048016701462, "endMs": "1665777745140", "id": "19", "name": "S13: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "47", "startMs": "1665777745089", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$380, $381, $1671, $1670", "FROM __SHUFFLE25" ] }, { "kind": "COMPUTE", "substeps": [ "$130 := coalesce($1691, 0)", "$131 := coalesce($1691, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$180 := MAX($1680) OVER (PARTITION BY $1683 ORDER BY $1682 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)", "$181 := MAX($1681) OVER (PARTITION BY $1683 ORDER BY $1682 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1670 ASC, $1671 ASC" ] }, { "kind": "WRITE", "substeps": [ "$130, $131, $180, $181, $1690", "TO __stage13_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006958942240779402, "waitRatioMax": 0.0006958942240779402, "writeMsAvg": "32", "writeMsMax": "32", "writeRatioAvg": 0.022268615170494086, "writeRatioMax": 0.022268615170494086 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.006958942240779402, "computeRatioMax": 0.006958942240779402, "endMs": "1665777745143", "id": "20", "name": "S14: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "36", "startMs": "1665777745107", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$550, $650, $651, $652, $653", "FROM __SHUFFLE23" ] }, { "kind": "COMPUTE", "substeps": [ "$230 := coalesce($1630, 0)", "$231 := coalesce($1630, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$330 := MAX($1622) OVER (PARTITION BY $1621, $1620 ORDER BY $1624 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)", "$331 := MAX($1623) OVER (PARTITION BY $1621, $1620 ORDER BY $1624 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$650 ASC, $550 ASC, $653 ASC" ] }, { "kind": "WRITE", "substeps": [ "$230, $231, $330, $331, $1631", "TO __stage14_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006958942240779402, "waitRatioMax": 0.0006958942240779402, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.012526096033402923, "writeRatioMax": 0.012526096033402923 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "15", "computeRatioAvg": 0.0048712595685455815, "computeRatioMax": 0.010438413361169102, "endMs": "1665777745217", "id": "21", "inputStages": [ "20" ], "name": "S15: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3172", "startMs": "1665777745158", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage14_output" ] } ], "waitMsAvg": "2", "waitMsMax": "6", "waitRatioAvg": 0.0013917884481558804, "waitRatioMax": 0.0041753653444676405, "writeMsAvg": "15", "writeMsMax": "26", "writeRatioAvg": 0.010438413361169102, "writeRatioMax": 0.018093249826026444 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "15", "computeRatioAvg": 0.0055671537926235215, "computeRatioMax": 0.010438413361169102, "endMs": "1665777745216", "id": "22", "inputStages": [ "19" ], "name": "S16: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3061", "startMs": "1665777745159", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage13_output" ] } ], "waitMsAvg": "6", "waitMsMax": "7", "waitRatioAvg": 0.0041753653444676405, "waitRatioMax": 0.0048712595685455815, "writeMsAvg": "14", "writeMsMax": "21", "writeRatioAvg": 0.009742519137091163, "writeRatioMax": 0.014613778705636743 }, { "completedParallelInputs": "101", "computeMsAvg": "15", "computeMsMax": "30", "computeRatioAvg": 0.010438413361169102, "computeRatioMax": 0.020876826722338204, "endMs": "1665777745217", "id": "23", "inputStages": [ "21", "18", "22" ], "name": "S17: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "610617", "recordsWritten": "10000", "shuffleOutputBytes": "668048", "shuffleOutputBytesSpilled": "0", "slotMs": "3141", "startMs": "1665777745169", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70, $71, $1522, $1525", "FROM __stage12_output" ] }, { "kind": "READ", "substeps": [ "$110, $1600, $1601, $1602, $1603, $1605", "FROM __SHUFFLE22" ] }, { "kind": "READ", "substeps": [ "$230, $231, $330, $331, $1631", "FROM __stage15_output" ] }, { "kind": "READ", "substeps": [ "$130, $131, $180, $181, $1690", "FROM __stage16_output" ] }, { "kind": "SORT", "substeps": [ "$52 ASC, $53 ASC", "LIMIT 100" ] }, { "kind": "FILTER", "substeps": [ "greater($51, $50)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$60 := MAX($1532) OVER (PARTITION BY $1530 ORDER BY $1531 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)", "$61 := MAX($1533) OVER (PARTITION BY $1530 ORDER BY $1531 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$100 ASC, $101 ASC" ] }, { "kind": "COMPUTE", "substeps": [ "$90 := if(equal($1701, -1), if(equal($1700, -1), NULL, $1702), ...)", "$91 := if(equal($1701, -1), if(equal($1700, -1), NULL, $1703), ...)" ] }, { "kind": "JOIN", "substeps": [ "$1700 := $1640, $1701 := $1641, $1702 := $1646, $1703 := $1647, $1704 := $1642, $1705 := $1643, $1706 := $1644, $1707 := $1645, $1708 := $180, $1709 := $181", "LEFT OUTER HASH JOIN EACH WITH ALL ON $120 = $130, $121 = $131, $1641 = $1690" ] }, { "kind": "COMPUTE", "substeps": [ "$120 := coalesce($1642, 0)", "$121 := coalesce($1642, 1)" ] }, { "kind": "JOIN", "substeps": [ "$1640 := $222, $1641 := $223, $1642 := $640, $1643 := $641, $1644 := $642, $1645 := $643, $1646 := $330, $1647 := $331", "LEFT OUTER HASH JOIN EACH WITH ALL ON $220 = $230, $221 = $231, $222 = $1631" ] }, { "kind": "COMPUTE", "substeps": [ "$220 := coalesce($640, 0)", "$221 := coalesce($640, 1)", "$222 := if(or($490, $320), -1, $370)", "$223 := if($490, -1, if($320, $321, subtract($321, 1)))" ] }, { "kind": "COMPUTE", "substeps": [ "$320 := equal(mod(add($370, 1), 16384), 0)", "$321 := div($370, 16384)" ] }, { "kind": "COMPUTE", "substeps": [ "$370 := if($491, subtract($644, 1), $540)" ] }, { "kind": "COMPUTE", "substeps": [ "$490 := less($540, 0)", "$491 := greater_or_equal($540, $644)" ] }, { "kind": "COMPUTE", "substeps": [ "$540 := $645" ] }, { "kind": "WRITE", "substeps": [ "$1710, $1711, $1712, $1713, $1714, $1715", "TO __stage17_output" ] } ], "waitMsAvg": "6", "waitMsMax": "7", "waitRatioAvg": 0.0041753653444676405, "waitRatioMax": 0.0048712595685455815, "writeMsAvg": "9", "writeMsMax": "18", "writeRatioAvg": 0.006263048016701462, "writeRatioMax": 0.012526096033402923 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.006263048016701462, "computeRatioMax": 0.006263048016701462, "endMs": "1665777745234", "id": "24", "inputStages": [ "23" ], "name": "S18: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "10000", "recordsWritten": "100", "shuffleOutputBytes": "6696", "shuffleOutputBytesSpilled": "0", "slotMs": "57", "startMs": "1665777745175", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1710, $1711, $1712, $1713, $1714, $1715", "FROM __stage17_output" ] }, { "kind": "SORT", "substeps": [ "$1712 ASC, $1713 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$1720, $1721, $1722, $1723, $1724, $1725", "TO __stage18_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.0020876826722338203, "waitRatioMax": 0.0020876826722338203, "writeMsAvg": "5", "writeMsMax": "5", "writeRatioAvg": 0.003479471120389701, "writeRatioMax": 0.003479471120389701 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "1", "completedUnits": "10", "elapsedMs": "616", "estimatedRunnableUnits": "0", "pendingUnits": "1", "totalSlotMs": "2140" }, { "activeUnits": "2", "completedUnits": "1021", "elapsedMs": "1764", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "36248" } ], "totalBytesBilled": "114294784", "totalBytesProcessed": "113826808", "totalPartitionsProcessed": "0", "totalSlotMs": "36248", "transferredBytes": "0" }, "startTime": "1665777743538", "totalBytesProcessed": "113826808", "totalSlotMs": "36248" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon82ff3872_628f_4520_9062_f3c88f621f69" }, "priority": "INTERACTIVE", "query": "-- start query 51 in stream 0 using template query51.tpl\n\n/*\nCompute the count of store sales resulting from promotions, \nthe count of all store sales and \ntheir ratio for specific categories in a particular time zone and for a given year and month.\n*/\n\nWITH web_v1 as (\nselect\n ws_item_sk item_sk, d_date,\n sum(sum(ws_sales_price))\n over (partition by ws_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom web_sales\n ,date_dim\nwhere ws_sold_date_sk=d_date_sk\n and d_month_seq between 1200 and 1200+11\n and ws_item_sk is not NULL\ngroup by ws_item_sk, d_date),\nstore_v1 as (\nselect\n ss_item_sk item_sk, d_date,\n sum(sum(ss_sales_price))\n over (partition by ss_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom store_sales\n ,date_dim\nwhere ss_sold_date_sk=d_date_sk\n and d_month_seq between 1200 and 1200+11\n and ss_item_sk is not NULL\ngroup by ss_item_sk, d_date)\nselect *\nfrom (select item_sk\n ,d_date\n ,web_sales\n ,store_sales\n ,max(web_sales)\n over (partition by item_sk order by d_date rows between unbounded preceding and current row) web_cumulative\n ,max(store_sales)\n over (partition by item_sk order by d_date rows between unbounded preceding and current row) store_cumulative\n from (select case when web.item_sk is not null then web.item_sk else store.item_sk end item_sk\n ,case when web.d_date is not null then web.d_date else store.d_date end d_date\n ,web.cume_sales web_sales\n ,store.cume_sales store_sales\n from web_v1 web full outer join store_v1 store on (web.item_sk = store.item_sk\n and web.d_date = store.d_date)\n )x )y\nwhere web_cumulative > store_cumulative\norder by item_sk\n ,d_date\nlimit 100\n;\n\n-- end query 51 in stream 0 using template query51.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "PICDtJSThwInDgRhPtYguw==", "id": "test-project-364309:europe-west1.query51_1665777746", "jobReference": { "jobId": "query51_1665777746", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query51_1665777746?location=europe-west1", "statistics": { "creationTime": "1665777747422", "endTime": "1665777749159", "finalExecutionDurationMs": "1473", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "113826808", "performanceInsights": { "avgPreviousExecutionMs": "1522" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.008005822416302766, "computeRatioMax": 0.008005822416302766, "endMs": "1665777747639", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.005094614264919942, "readRatioMax": 0.005094614264919942, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "5124", "shuffleOutputBytesSpilled": "0", "slotMs": "34", "startMs": "1665777747597", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $31:d_date, $32:d_month_seq", "FROM date_dim", "WHERE between($32, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$30, $31", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.000727802037845706, "waitRatioMax": 0.000727802037845706, "writeMsAvg": "26", "writeMsMax": "26", "writeRatioAvg": 0.018922852983988356, "writeRatioMax": 0.018922852983988356 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.008733624454148471, "computeRatioMax": 0.008733624454148471, "endMs": "1665777747677", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.004366812227074236, "readRatioMax": 0.004366812227074236, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "5124", "shuffleOutputBytesSpilled": "0", "slotMs": "36", "startMs": "1665777747636", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_date, $12:d_month_seq", "FROM date_dim", "WHERE between($12, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage02_output" ] } ], "waitMsAvg": "5", "waitMsMax": "5", "waitRatioAvg": 0.00363901018922853, "waitRatioMax": 0.00363901018922853, "writeMsAvg": "12", "writeMsMax": "12", "writeRatioAvg": 0.008733624454148471, "writeRatioMax": 0.008733624454148471 }, { "completedParallelInputs": "6", "computeMsAvg": "204", "computeMsMax": "247", "computeRatioAvg": 0.14847161572052403, "computeRatioMax": 0.17976710334788937, "endMs": "1665777747844", "id": "4", "inputStages": [ "0" ], "name": "S04: Join+", "parallelInputs": "6", "readMsAvg": "9", "readMsMax": "11", "readRatioAvg": 0.006550218340611353, "readRatioMax": 0.008005822416302766, "recordsRead": "2882600", "recordsWritten": "543984", "shuffleOutputBytes": "16663712", "shuffleOutputBytesSpilled": "0", "slotMs": "1080", "startMs": "1665777747668", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ss_sold_date_sk, $21:ss_item_sk, $22:ss_sales_price", "FROM store_sales", "WHERE not(is_null($21))" ] }, { "kind": "READ", "substeps": [ "$30, $31", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1310 := $1300, $1311 := $1302", "$440 := SUM($1301)" ] }, { "kind": "JOIN", "substeps": [ "$1300 := $21, $1301 := $22, $1302 := $31", "INNER HASH JOIN EACH WITH ALL ON $20 = $30" ] }, { "kind": "WRITE", "substeps": [ "$1310, $1311, $440", "TO __stage04_output", "BY HASH($1310, $1311)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.000727802037845706, "waitRatioMax": 0.000727802037845706, "writeMsAvg": "21", "writeMsMax": "23", "writeRatioAvg": 0.015283842794759825, "writeRatioMax": 0.016739446870451237 }, { "completedParallelInputs": "1", "computeMsAvg": "512", "computeMsMax": "512", "computeRatioAvg": 0.3726346433770015, "computeRatioMax": 0.3726346433770015, "endMs": "1665777747980", "id": "5", "inputStages": [ "2" ], "name": "S05: Join+", "parallelInputs": "1", "readMsAvg": "11", "readMsMax": "11", "readRatioAvg": 0.008005822416302766, "readRatioMax": 0.008005822416302766, "recordsRead": "719750", "recordsWritten": "138313", "shuffleOutputBytes": "4287431", "shuffleOutputBytesSpilled": "0", "slotMs": "417", "startMs": "1665777747697", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:ws_sold_date_sk, $2:ws_item_sk, $3:ws_sales_price", "FROM web_sales", "WHERE not(is_null($2))" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage02_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1090 := $1080, $1091 := $1082", "$390 := SUM($1081)" ] }, { "kind": "JOIN", "substeps": [ "$1080 := $2, $1081 := $3, $1082 := $11", "INNER HASH JOIN EACH WITH ALL ON $1 = $10" ] }, { "kind": "WRITE", "substeps": [ "$1090, $1091, $390", "TO __stage05_output", "BY HASH($1090, $1091)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.000727802037845706, "waitRatioMax": 0.000727802037845706, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.013828238719068414, "writeRatioMax": 0.013828238719068414 }, { "completedParallelInputs": "1", "computeMsAvg": "1374", "computeMsMax": "1374", "computeRatioAvg": 1, "computeRatioMax": 1, "endMs": "1665777748537", "id": "6", "inputStages": [ "4" ], "name": "S06: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "543984", "recordsWritten": "499071", "shuffleOutputBytes": "15303153", "shuffleOutputBytesSpilled": "0", "slotMs": "1031", "startMs": "1665777747869", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1310, $1311, $440", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1320 := $1310, $1321 := $1311", "$270 := SUM($440)" ] }, { "kind": "WRITE", "substeps": [ "$1320, $1321, $270", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.000727802037845706, "waitRatioMax": 0.000727802037845706, "writeMsAvg": "25", "writeMsMax": "25", "writeRatioAvg": 0.018195050946142648, "writeRatioMax": 0.018195050946142648 }, { "completedParallelInputs": "1", "computeMsAvg": "197", "computeMsMax": "197", "computeRatioAvg": 0.1433770014556041, "computeRatioMax": 0.1433770014556041, "endMs": "1665777748144", "id": "7", "inputStages": [ "5" ], "name": "S07: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "138313", "recordsWritten": "138313", "shuffleOutputBytes": "4287431", "shuffleOutputBytesSpilled": "0", "slotMs": "167", "startMs": "1665777748014", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1090, $1091, $390", "FROM __stage05_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1100 := $1090, $1101 := $1091", "$240 := SUM($390)" ] }, { "kind": "WRITE", "substeps": [ "$1100, $1101, $240", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.000727802037845706, "waitRatioMax": 0.000727802037845706, "writeMsAvg": "21", "writeMsMax": "21", "writeRatioAvg": 0.015283842794759825, "writeRatioMax": 0.015283842794759825 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.006550218340611353, "computeRatioMax": 0.006550218340611353, "endMs": "1665777748598", "id": "8", "name": "S08: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "28", "startMs": "1665777748561", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$850, $1481, $1480", "FROM __SHUFFLE17" ] }, { "kind": "COMPUTE", "substeps": [ "$480 := coalesce($1501, 0)", "$481 := coalesce($1501, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$510 := SUM($1490) OVER (PARTITION BY $1492 ORDER BY $1491 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1480 ASC, $1481 ASC" ] }, { "kind": "WRITE", "substeps": [ "$480, $481, $510, $1500", "TO __stage08_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.000727802037845706, "waitRatioMax": 0.000727802037845706, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.012372634643377001, "writeRatioMax": 0.012372634643377001 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.006550218340611353, "computeRatioMax": 0.006550218340611353, "endMs": "1665777748610", "id": "9", "name": "S09: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "26", "startMs": "1665777748577", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$960, $1040, $1041, $1042", "FROM __SHUFFLE15" ] }, { "kind": "COMPUTE", "substeps": [ "$620 := coalesce($1440, 0)", "$621 := coalesce($1440, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$740 := SUM($1432) OVER (PARTITION BY $1431, $1430 ORDER BY $1433 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1040 ASC, $960 ASC, $1042 ASC" ] }, { "kind": "WRITE", "substeps": [ "$620, $621, $740, $1441", "TO __stage09_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.000727802037845706, "waitRatioMax": 0.000727802037845706, "writeMsAvg": "27", "writeMsMax": "27", "writeRatioAvg": 0.019650655021834062, "writeRatioMax": 0.019650655021834062 }, { "completedParallelInputs": "1", "computeMsAvg": "6", "computeMsMax": "6", "computeRatioAvg": 0.004366812227074236, "computeRatioMax": 0.004366812227074236, "endMs": "1665777748636", "id": "10", "name": "S0A: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "33", "startMs": "1665777748595", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$800, $1261, $1260", "FROM __SHUFFLE8" ] }, { "kind": "COMPUTE", "substeps": [ "$430 := coalesce($1281, 0)", "$431 := coalesce($1281, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$500 := SUM($1270) OVER (PARTITION BY $1272 ORDER BY $1271 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1260 ASC, $1261 ASC" ] }, { "kind": "WRITE", "substeps": [ "$430, $431, $500, $1280", "TO __stage0A_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.000727802037845706, "waitRatioMax": 0.000727802037845706, "writeMsAvg": "21", "writeMsMax": "21", "writeRatioAvg": 0.015283842794759825, "writeRatioMax": 0.015283842794759825 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.005822416302765648, "computeRatioMax": 0.005822416302765648, "endMs": "1665777748674", "id": "11", "name": "S0B: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "51", "startMs": "1665777748613", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$910, $1000, $1001, $1002", "FROM __SHUFFLE6" ] }, { "kind": "COMPUTE", "substeps": [ "$590 := coalesce($1220, 0)", "$591 := coalesce($1220, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$700 := SUM($1212) OVER (PARTITION BY $1211, $1210 ORDER BY $1213 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1000 ASC, $910 ASC, $1002 ASC" ] }, { "kind": "WRITE", "substeps": [ "$590, $591, $700, $1221", "TO __stage0B_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.000727802037845706, "waitRatioMax": 0.000727802037845706, "writeMsAvg": "52", "writeMsMax": "52", "writeRatioAvg": 0.03784570596797671, "writeRatioMax": 0.03784570596797671 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "16", "computeRatioAvg": 0.005822416302765648, "computeRatioMax": 0.011644832605531296, "endMs": "1665777748680", "id": "12", "inputStages": [ "9" ], "name": "S0C: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3273", "startMs": "1665777748624", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage09_output" ] } ], "waitMsAvg": "2", "waitMsMax": "4", "waitRatioAvg": 0.001455604075691412, "waitRatioMax": 0.002911208151382824, "writeMsAvg": "14", "writeMsMax": "18", "writeRatioAvg": 0.010189228529839884, "writeRatioMax": 0.013100436681222707 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "17", "computeRatioAvg": 0.005822416302765648, "computeRatioMax": 0.012372634643377001, "endMs": "1665777748706", "id": "13", "inputStages": [ "8" ], "name": "S0D: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3404", "startMs": "1665777748624", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage08_output" ] } ], "waitMsAvg": "3", "waitMsMax": "6", "waitRatioAvg": 0.002183406113537118, "waitRatioMax": 0.004366812227074236, "writeMsAvg": "18", "writeMsMax": "32", "writeRatioAvg": 0.013100436681222707, "writeRatioMax": 0.023289665211062592 }, { "completedParallelInputs": "101", "computeMsAvg": "19", "computeMsMax": "30", "computeRatioAvg": 0.013828238719068414, "computeRatioMax": 0.021834061135371178, "endMs": "1665777748707", "id": "14", "inputStages": [ "12", "13", "6" ], "name": "S0E: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "499071", "recordsWritten": "499071", "shuffleOutputBytes": "15467793", "shuffleOutputBytesSpilled": "0", "slotMs": "3700", "startMs": "1665777748643", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1320, $1321, $270", "FROM __stage06_output" ] }, { "kind": "READ", "substeps": [ "$460, $1400, $1401, $1402, $1404", "FROM __SHUFFLE14" ] }, { "kind": "READ", "substeps": [ "$620, $621, $740, $1441", "FROM __stage0C_output" ] }, { "kind": "READ", "substeps": [ "$480, $481, $510, $1500", "FROM __stage0D_output" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$200 := SUM($1332) OVER (PARTITION BY $1330 ORDER BY $1331 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$450 ASC, $451 ASC" ] }, { "kind": "COMPUTE", "substeps": [ "$290 := if(equal($1511, -1), if(equal($1510, -1), NULL, $1512), ...)" ] }, { "kind": "JOIN", "substeps": [ "$1510 := $1450, $1511 := $1451, $1512 := $1454, $1513 := $1452, $1514 := $1453, $1515 := $510", "LEFT OUTER HASH JOIN EACH WITH ALL ON $470 = $480, $471 = $481, $1451 = $1500" ] }, { "kind": "COMPUTE", "substeps": [ "$470 := coalesce($1452, 0)", "$471 := coalesce($1452, 1)" ] }, { "kind": "JOIN", "substeps": [ "$1450 := $612, $1451 := $613, $1452 := $1030, $1453 := $1031, $1454 := $740", "LEFT OUTER HASH JOIN EACH WITH ALL ON $610 = $620, $611 = $621, $612 = $1441" ] }, { "kind": "COMPUTE", "substeps": [ "$610 := coalesce($1030, 0)", "$611 := coalesce($1030, 1)", "$612 := if(or($870, $730), -1, $840)", "$613 := if($870, -1, if($730, $731, subtract($731, 1)))" ] }, { "kind": "COMPUTE", "substeps": [ "$730 := equal(mod(add($840, 1), 16384), 0)", "$731 := div($840, 16384)" ] }, { "kind": "COMPUTE", "substeps": [ "$840 := if($871, subtract($1032, 1), $950)" ] }, { "kind": "COMPUTE", "substeps": [ "$870 := less($950, 0)", "$871 := greater_or_equal($950, $1032)" ] }, { "kind": "COMPUTE", "substeps": [ "$950 := $1033" ] }, { "kind": "WRITE", "substeps": [ "$170, $171, $172", "TO __stage0E_output" ] } ], "waitMsAvg": "2", "waitMsMax": "7", "waitRatioAvg": 0.001455604075691412, "waitRatioMax": 0.005094614264919942, "writeMsAvg": "11", "writeMsMax": "22", "writeRatioAvg": 0.008005822416302766, "writeRatioMax": 0.01601164483260553 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "11", "computeRatioAvg": 0.005094614264919942, "computeRatioMax": 0.008005822416302766, "endMs": "1665777748744", "id": "15", "inputStages": [ "11" ], "name": "S0F: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3106", "startMs": "1665777748690", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0B_output" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.001455604075691412, "waitRatioMax": 0.002183406113537118, "writeMsAvg": "14", "writeMsMax": "27", "writeRatioAvg": 0.010189228529839884, "writeRatioMax": 0.019650655021834062 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "15", "computeRatioAvg": 0.005822416302765648, "computeRatioMax": 0.010917030567685589, "endMs": "1665777748761", "id": "16", "inputStages": [ "10" ], "name": "S10: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3561", "startMs": "1665777748691", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0A_output" ] } ], "waitMsAvg": "4", "waitMsMax": "6", "waitRatioAvg": 0.002911208151382824, "waitRatioMax": 0.004366812227074236, "writeMsAvg": "16", "writeMsMax": "30", "writeRatioAvg": 0.011644832605531296, "writeRatioMax": 0.021834061135371178 }, { "completedParallelInputs": "101", "computeMsAvg": "14", "computeMsMax": "28", "computeRatioAvg": 0.010189228529839884, "computeRatioMax": 0.020378457059679767, "endMs": "1665777748756", "id": "17", "inputStages": [ "15", "16", "7" ], "name": "S11: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "138313", "recordsWritten": "138313", "shuffleOutputBytes": "4287687", "shuffleOutputBytesSpilled": "0", "slotMs": "4002", "startMs": "1665777748707", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1100, $1101, $240", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$410, $1180, $1181, $1182, $1184", "FROM __SHUFFLE5" ] }, { "kind": "READ", "substeps": [ "$590, $591, $700, $1221", "FROM __stage0F_output" ] }, { "kind": "READ", "substeps": [ "$430, $431, $500, $1280", "FROM __stage10_output" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$190 := SUM($1112) OVER (PARTITION BY $1110 ORDER BY $1111 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$400 ASC, $401 ASC" ] }, { "kind": "COMPUTE", "substeps": [ "$260 := if(equal($1291, -1), if(equal($1290, -1), NULL, $1292), ...)" ] }, { "kind": "JOIN", "substeps": [ "$1290 := $1230, $1291 := $1231, $1292 := $1234, $1293 := $1232, $1294 := $1233, $1295 := $500", "LEFT OUTER HASH JOIN EACH WITH ALL ON $420 = $430, $421 = $431, $1231 = $1280" ] }, { "kind": "COMPUTE", "substeps": [ "$420 := coalesce($1232, 0)", "$421 := coalesce($1232, 1)" ] }, { "kind": "JOIN", "substeps": [ "$1230 := $582, $1231 := $583, $1232 := $990, $1233 := $991, $1234 := $700", "LEFT OUTER HASH JOIN EACH WITH ALL ON $580 = $590, $581 = $591, $582 = $1221" ] }, { "kind": "COMPUTE", "substeps": [ "$580 := coalesce($990, 0)", "$581 := coalesce($990, 1)", "$582 := if(or($860, $690), -1, $790)", "$583 := if($860, -1, if($690, $691, subtract($691, 1)))" ] }, { "kind": "COMPUTE", "substeps": [ "$690 := equal(mod(add($790, 1), 16384), 0)", "$691 := div($790, 16384)" ] }, { "kind": "COMPUTE", "substeps": [ "$790 := if($861, subtract($992, 1), $900)" ] }, { "kind": "COMPUTE", "substeps": [ "$860 := less($900, 0)", "$861 := greater_or_equal($900, $992)" ] }, { "kind": "COMPUTE", "substeps": [ "$900 := $993" ] }, { "kind": "WRITE", "substeps": [ "$150, $151, $152", "TO __stage11_output" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.001455604075691412, "waitRatioMax": 0.002183406113537118, "writeMsAvg": "15", "writeMsMax": "30", "writeRatioAvg": 0.010917030567685589, "writeRatioMax": 0.021834061135371178 }, { "completedParallelInputs": "100", "computeMsAvg": "22", "computeMsMax": "38", "computeRatioAvg": 0.01601164483260553, "computeRatioMax": 0.027656477438136828, "endMs": "1665777748838", "id": "18", "inputStages": [ "17", "14" ], "name": "S12: Join+", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "637384", "recordsWritten": "610617", "shuffleOutputBytes": "19964592", "shuffleOutputBytesSpilled": "0", "slotMs": "3585", "startMs": "1665777748774", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$150, $151, $152", "FROM __stage11_output" ] }, { "kind": "READ", "substeps": [ "$170, $171, $172", "FROM __stage0E_output" ] }, { "kind": "COMPUTE", "substeps": [ "$70 := case_no_value(not(is_null($1520)), $1520, $1523)", "$71 := case_no_value(not(is_null($1521)), $1521, $1524)" ] }, { "kind": "JOIN", "substeps": [ "$1520 := $150, $1521 := $151, $1522 := $152, $1523 := $170, $1524 := $171, $1525 := $172", "FULL OUTER HASH JOIN EACH WITH EACH ON $150 = $170, $151 = $171" ] }, { "kind": "WRITE", "substeps": [ "$70, $71, $1522, $1525", "TO __stage12_output" ] } ], "waitMsAvg": "2", "waitMsMax": "6", "waitRatioAvg": 0.001455604075691412, "waitRatioMax": 0.004366812227074236, "writeMsAvg": "8", "writeMsMax": "30", "writeRatioAvg": 0.005822416302765648, "writeRatioMax": 0.021834061135371178 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.006550218340611353, "computeRatioMax": 0.006550218340611353, "endMs": "1665777748912", "id": "19", "name": "S13: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "45", "startMs": "1665777748878", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$380, $381, $1671, $1670", "FROM __SHUFFLE25" ] }, { "kind": "COMPUTE", "substeps": [ "$130 := coalesce($1691, 0)", "$131 := coalesce($1691, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$180 := MAX($1680) OVER (PARTITION BY $1683 ORDER BY $1682 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)", "$181 := MAX($1681) OVER (PARTITION BY $1683 ORDER BY $1682 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1670 ASC, $1671 ASC" ] }, { "kind": "WRITE", "substeps": [ "$130, $131, $180, $181, $1690", "TO __stage13_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.001455604075691412, "waitRatioMax": 0.001455604075691412, "writeMsAvg": "30", "writeMsMax": "30", "writeRatioAvg": 0.021834061135371178, "writeRatioMax": 0.021834061135371178 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.006550218340611353, "computeRatioMax": 0.006550218340611353, "endMs": "1665777748938", "id": "20", "name": "S14: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "34", "startMs": "1665777748904", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$550, $650, $651, $652, $653", "FROM __SHUFFLE23" ] }, { "kind": "COMPUTE", "substeps": [ "$230 := coalesce($1630, 0)", "$231 := coalesce($1630, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$330 := MAX($1622) OVER (PARTITION BY $1621, $1620 ORDER BY $1624 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)", "$331 := MAX($1623) OVER (PARTITION BY $1621, $1620 ORDER BY $1624 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$650 ASC, $550 ASC, $653 ASC" ] }, { "kind": "WRITE", "substeps": [ "$230, $231, $330, $331, $1631", "TO __stage14_output" ] } ], "waitMsAvg": "10", "waitMsMax": "10", "waitRatioAvg": 0.00727802037845706, "waitRatioMax": 0.00727802037845706, "writeMsAvg": "29", "writeMsMax": "29", "writeRatioAvg": 0.021106259097525473, "writeRatioMax": 0.021106259097525473 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "13", "computeRatioAvg": 0.005822416302765648, "computeRatioMax": 0.009461426491994178, "endMs": "1665777749011", "id": "21", "inputStages": [ "20" ], "name": "S15: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3273", "startMs": "1665777748946", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage14_output" ] } ], "waitMsAvg": "4", "waitMsMax": "12", "waitRatioAvg": 0.002911208151382824, "waitRatioMax": 0.008733624454148471, "writeMsAvg": "14", "writeMsMax": "25", "writeRatioAvg": 0.010189228529839884, "writeRatioMax": 0.018195050946142648 }, { "completedParallelInputs": "100", "computeMsAvg": "6", "computeMsMax": "11", "computeRatioAvg": 0.004366812227074236, "computeRatioMax": 0.008005822416302766, "endMs": "1665777749006", "id": "22", "inputStages": [ "19" ], "name": "S16: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "2624", "startMs": "1665777748947", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage13_output" ] } ], "waitMsAvg": "11", "waitMsMax": "13", "waitRatioAvg": 0.008005822416302766, "waitRatioMax": 0.009461426491994178, "writeMsAvg": "10", "writeMsMax": "18", "writeRatioAvg": 0.00727802037845706, "writeRatioMax": 0.013100436681222707 }, { "completedParallelInputs": "101", "computeMsAvg": "14", "computeMsMax": "22", "computeRatioAvg": 0.010189228529839884, "computeRatioMax": 0.01601164483260553, "endMs": "1665777749011", "id": "23", "inputStages": [ "22", "18", "21" ], "name": "S17: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "610617", "recordsWritten": "10000", "shuffleOutputBytes": "668048", "shuffleOutputBytesSpilled": "0", "slotMs": "3309", "startMs": "1665777748961", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70, $71, $1522, $1525", "FROM __stage12_output" ] }, { "kind": "READ", "substeps": [ "$110, $1600, $1601, $1602, $1603, $1605", "FROM __SHUFFLE22" ] }, { "kind": "READ", "substeps": [ "$230, $231, $330, $331, $1631", "FROM __stage15_output" ] }, { "kind": "READ", "substeps": [ "$130, $131, $180, $181, $1690", "FROM __stage16_output" ] }, { "kind": "SORT", "substeps": [ "$52 ASC, $53 ASC", "LIMIT 100" ] }, { "kind": "FILTER", "substeps": [ "greater($51, $50)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$60 := MAX($1532) OVER (PARTITION BY $1530 ORDER BY $1531 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)", "$61 := MAX($1533) OVER (PARTITION BY $1530 ORDER BY $1531 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$100 ASC, $101 ASC" ] }, { "kind": "COMPUTE", "substeps": [ "$90 := if(equal($1701, -1), if(equal($1700, -1), NULL, $1702), ...)", "$91 := if(equal($1701, -1), if(equal($1700, -1), NULL, $1703), ...)" ] }, { "kind": "JOIN", "substeps": [ "$1700 := $1640, $1701 := $1641, $1702 := $1646, $1703 := $1647, $1704 := $1642, $1705 := $1643, $1706 := $1644, $1707 := $1645, $1708 := $180, $1709 := $181", "LEFT OUTER HASH JOIN EACH WITH ALL ON $120 = $130, $121 = $131, $1641 = $1690" ] }, { "kind": "COMPUTE", "substeps": [ "$120 := coalesce($1642, 0)", "$121 := coalesce($1642, 1)" ] }, { "kind": "JOIN", "substeps": [ "$1640 := $222, $1641 := $223, $1642 := $640, $1643 := $641, $1644 := $642, $1645 := $643, $1646 := $330, $1647 := $331", "LEFT OUTER HASH JOIN EACH WITH ALL ON $220 = $230, $221 = $231, $222 = $1631" ] }, { "kind": "COMPUTE", "substeps": [ "$220 := coalesce($640, 0)", "$221 := coalesce($640, 1)", "$222 := if(or($490, $320), -1, $370)", "$223 := if($490, -1, if($320, $321, subtract($321, 1)))" ] }, { "kind": "COMPUTE", "substeps": [ "$320 := equal(mod(add($370, 1), 16384), 0)", "$321 := div($370, 16384)" ] }, { "kind": "COMPUTE", "substeps": [ "$370 := if($491, subtract($644, 1), $540)" ] }, { "kind": "COMPUTE", "substeps": [ "$490 := less($540, 0)", "$491 := greater_or_equal($540, $644)" ] }, { "kind": "COMPUTE", "substeps": [ "$540 := $645" ] }, { "kind": "WRITE", "substeps": [ "$1710, $1711, $1712, $1713, $1714, $1715", "TO __stage17_output" ] } ], "waitMsAvg": "12", "waitMsMax": "14", "waitRatioAvg": 0.008733624454148471, "waitRatioMax": 0.010189228529839884, "writeMsAvg": "10", "writeMsMax": "21", "writeRatioAvg": 0.00727802037845706, "writeRatioMax": 0.015283842794759825 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.005094614264919942, "computeRatioMax": 0.005094614264919942, "endMs": "1665777749022", "id": "24", "inputStages": [ "23" ], "name": "S18: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "10000", "recordsWritten": "100", "shuffleOutputBytes": "6696", "shuffleOutputBytesSpilled": "0", "slotMs": "21", "startMs": "1665777748970", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1710, $1711, $1712, $1713, $1714, $1715", "FROM __stage17_output" ] }, { "kind": "SORT", "substeps": [ "$1712 ASC, $1713 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$1720, $1721, $1722, $1723, $1724, $1725", "TO __stage18_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.001455604075691412, "waitRatioMax": 0.001455604075691412, "writeMsAvg": "3", "writeMsMax": "3", "writeRatioAvg": 0.002183406113537118, "writeRatioMax": 0.002183406113537118 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "2", "completedUnits": "9", "elapsedMs": "635", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "1569" }, { "activeUnits": "302", "completedUnits": "1021", "elapsedMs": "1638", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "36527" } ], "totalBytesBilled": "114294784", "totalBytesProcessed": "113826808", "totalPartitionsProcessed": "0", "totalSlotMs": "36527", "transferredBytes": "0" }, "startTime": "1665777747463", "totalBytesProcessed": "113826808", "totalSlotMs": "36527" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon89cb8c6a_adb4_41f5_b037_97e44dad5f23" }, "priority": "INTERACTIVE", "query": "-- start query 51 in stream 0 using template query51.tpl\n\n/*\nCompute the count of store sales resulting from promotions, \nthe count of all store sales and \ntheir ratio for specific categories in a particular time zone and for a given year and month.\n*/\n\nWITH web_v1 as (\nselect\n ws_item_sk item_sk, d_date,\n sum(sum(ws_sales_price))\n over (partition by ws_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom web_sales\n ,date_dim\nwhere ws_sold_date_sk=d_date_sk\n and d_month_seq between 1200 and 1200+11\n and ws_item_sk is not NULL\ngroup by ws_item_sk, d_date),\nstore_v1 as (\nselect\n ss_item_sk item_sk, d_date,\n sum(sum(ss_sales_price))\n over (partition by ss_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom store_sales\n ,date_dim\nwhere ss_sold_date_sk=d_date_sk\n and d_month_seq between 1200 and 1200+11\n and ss_item_sk is not NULL\ngroup by ss_item_sk, d_date)\nselect *\nfrom (select item_sk\n ,d_date\n ,web_sales\n ,store_sales\n ,max(web_sales)\n over (partition by item_sk order by d_date rows between unbounded preceding and current row) web_cumulative\n ,max(store_sales)\n over (partition by item_sk order by d_date rows between unbounded preceding and current row) store_cumulative\n from (select case when web.item_sk is not null then web.item_sk else store.item_sk end item_sk\n ,case when web.d_date is not null then web.d_date else store.d_date end d_date\n ,web.cume_sales web_sales\n ,store.cume_sales store_sales\n from web_v1 web full outer join store_v1 store on (web.item_sk = store.item_sk\n and web.d_date = store.d_date)\n )x )y\nwhere web_cumulative > store_cumulative\norder by item_sk\n ,d_date\nlimit 100\n;\n\n-- end query 51 in stream 0 using template query51.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "vSlnbDbEgeaxC1L2M+9Rcg==", "id": "test-project-364309:europe-west1.query51_1665777750", "jobReference": { "jobId": "query51_1665777750", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query51_1665777750?location=europe-west1", "statistics": { "creationTime": "1665777751411", "endTime": "1665777752998", "finalExecutionDurationMs": "1339", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "113826808", "performanceInsights": { "avgPreviousExecutionMs": "1515" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.012150668286755772, "computeRatioMax": 0.012150668286755772, "endMs": "1665777751604", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.00850546780072904, "readRatioMax": 0.00850546780072904, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "5124", "shuffleOutputBytesSpilled": "0", "slotMs": "31", "startMs": "1665777751569", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $31:d_date, $32:d_month_seq", "FROM date_dim", "WHERE between($32, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$30, $31", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.001215066828675577, "waitRatioMax": 0.001215066828675577, "writeMsAvg": "7", "writeMsMax": "7", "writeRatioAvg": 0.00850546780072904, "writeRatioMax": 0.00850546780072904 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.014580801944106925, "computeRatioMax": 0.014580801944106925, "endMs": "1665777751637", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.006075334143377886, "readRatioMax": 0.006075334143377886, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "5124", "shuffleOutputBytesSpilled": "0", "slotMs": "40", "startMs": "1665777751599", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_date, $12:d_month_seq", "FROM date_dim", "WHERE between($12, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage02_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002430133657351154, "waitRatioMax": 0.002430133657351154, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.01701093560145808, "writeRatioMax": 0.01701093560145808 }, { "completedParallelInputs": "6", "computeMsAvg": "222", "computeMsMax": "266", "computeRatioAvg": 0.26974483596597815, "computeRatioMax": 0.32320777642770354, "endMs": "1665777751831", "id": "4", "inputStages": [ "0" ], "name": "S04: Join+", "parallelInputs": "6", "readMsAvg": "11", "readMsMax": "18", "readRatioAvg": 0.013365735115431349, "readRatioMax": 0.02187120291616039, "recordsRead": "2882600", "recordsWritten": "543984", "shuffleOutputBytes": "16663712", "shuffleOutputBytesSpilled": "0", "slotMs": "1369", "startMs": "1665777751630", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ss_sold_date_sk, $21:ss_item_sk, $22:ss_sales_price", "FROM store_sales", "WHERE not(is_null($21))" ] }, { "kind": "READ", "substeps": [ "$30, $31", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1310 := $1300, $1311 := $1302", "$440 := SUM($1301)" ] }, { "kind": "JOIN", "substeps": [ "$1300 := $21, $1301 := $22, $1302 := $31", "INNER HASH JOIN EACH WITH ALL ON $20 = $30" ] }, { "kind": "WRITE", "substeps": [ "$1310, $1311, $440", "TO __stage04_output", "BY HASH($1310, $1311)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.001215066828675577, "waitRatioMax": 0.001215066828675577, "writeMsAvg": "22", "writeMsMax": "24", "writeRatioAvg": 0.026731470230862697, "writeRatioMax": 0.02916160388821385 }, { "completedParallelInputs": "1", "computeMsAvg": "410", "computeMsMax": "410", "computeRatioAvg": 0.49817739975698666, "computeRatioMax": 0.49817739975698666, "endMs": "1665777751959", "id": "5", "inputStages": [ "2" ], "name": "S05: Join+", "parallelInputs": "1", "readMsAvg": "20", "readMsMax": "20", "readRatioAvg": 0.024301336573511544, "readRatioMax": 0.024301336573511544, "recordsRead": "719750", "recordsWritten": "138313", "shuffleOutputBytes": "4287431", "shuffleOutputBytesSpilled": "0", "slotMs": "399", "startMs": "1665777751658", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:ws_sold_date_sk, $2:ws_item_sk, $3:ws_sales_price", "FROM web_sales", "WHERE not(is_null($2))" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage02_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1090 := $1080, $1091 := $1082", "$390 := SUM($1081)" ] }, { "kind": "JOIN", "substeps": [ "$1080 := $2, $1081 := $3, $1082 := $11", "INNER HASH JOIN EACH WITH ALL ON $1 = $10" ] }, { "kind": "WRITE", "substeps": [ "$1090, $1091, $390", "TO __stage05_output", "BY HASH($1090, $1091)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.001215066828675577, "waitRatioMax": 0.001215066828675577, "writeMsAvg": "30", "writeMsMax": "30", "writeRatioAvg": 0.03645200486026731, "writeRatioMax": 0.03645200486026731 }, { "completedParallelInputs": "1", "computeMsAvg": "823", "computeMsMax": "823", "computeRatioAvg": 1, "computeRatioMax": 1, "endMs": "1665777752355", "id": "6", "inputStages": [ "4" ], "name": "S06: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "543984", "recordsWritten": "499071", "shuffleOutputBytes": "15303153", "shuffleOutputBytesSpilled": "0", "slotMs": "671", "startMs": "1665777751848", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1310, $1311, $440", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1320 := $1310, $1321 := $1311", "$270 := SUM($440)" ] }, { "kind": "WRITE", "substeps": [ "$1320, $1321, $270", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.001215066828675577, "waitRatioMax": 0.001215066828675577, "writeMsAvg": "28", "writeMsMax": "28", "writeRatioAvg": 0.03402187120291616, "writeRatioMax": 0.03402187120291616 }, { "completedParallelInputs": "1", "computeMsAvg": "283", "computeMsMax": "283", "computeRatioAvg": 0.34386391251518833, "computeRatioMax": 0.34386391251518833, "endMs": "1665777752141", "id": "7", "inputStages": [ "5" ], "name": "S07: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "138313", "recordsWritten": "138313", "shuffleOutputBytes": "4287431", "shuffleOutputBytesSpilled": "0", "slotMs": "248", "startMs": "1665777751977", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1090, $1091, $390", "FROM __stage05_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1100 := $1090, $1101 := $1091", "$240 := SUM($390)" ] }, { "kind": "WRITE", "substeps": [ "$1100, $1101, $240", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.001215066828675577, "waitRatioMax": 0.001215066828675577, "writeMsAvg": "24", "writeMsMax": "24", "writeRatioAvg": 0.02916160388821385, "writeRatioMax": 0.02916160388821385 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.00850546780072904, "computeRatioMax": 0.00850546780072904, "endMs": "1665777752430", "id": "8", "name": "S08: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "33", "startMs": "1665777752394", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$850, $1481, $1480", "FROM __SHUFFLE17" ] }, { "kind": "COMPUTE", "substeps": [ "$480 := coalesce($1501, 0)", "$481 := coalesce($1501, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$510 := SUM($1490) OVER (PARTITION BY $1492 ORDER BY $1491 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1480 ASC, $1481 ASC" ] }, { "kind": "WRITE", "substeps": [ "$480, $481, $510, $1500", "TO __stage08_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.001215066828675577, "waitRatioMax": 0.001215066828675577, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.020656136087484813, "writeRatioMax": 0.020656136087484813 }, { "completedParallelInputs": "1", "computeMsAvg": "5", "computeMsMax": "5", "computeRatioAvg": 0.006075334143377886, "computeRatioMax": 0.006075334143377886, "endMs": "1665777752442", "id": "9", "name": "S09: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "29", "startMs": "1665777752407", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$960, $1040, $1041, $1042", "FROM __SHUFFLE15" ] }, { "kind": "COMPUTE", "substeps": [ "$620 := coalesce($1440, 0)", "$621 := coalesce($1440, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$740 := SUM($1432) OVER (PARTITION BY $1431, $1430 ORDER BY $1433 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1040 ASC, $960 ASC, $1042 ASC" ] }, { "kind": "WRITE", "substeps": [ "$620, $621, $740, $1441", "TO __stage09_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.001215066828675577, "waitRatioMax": 0.001215066828675577, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.020656136087484813, "writeRatioMax": 0.020656136087484813 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.010935601458080195, "computeRatioMax": 0.010935601458080195, "endMs": "1665777752462", "id": "10", "name": "S0A: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "29", "startMs": "1665777752421", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$800, $1261, $1260", "FROM __SHUFFLE8" ] }, { "kind": "COMPUTE", "substeps": [ "$430 := coalesce($1281, 0)", "$431 := coalesce($1281, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$500 := SUM($1270) OVER (PARTITION BY $1272 ORDER BY $1271 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1260 ASC, $1261 ASC" ] }, { "kind": "WRITE", "substeps": [ "$430, $431, $500, $1280", "TO __stage0A_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.001215066828675577, "waitRatioMax": 0.001215066828675577, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.020656136087484813, "writeRatioMax": 0.020656136087484813 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.010935601458080195, "computeRatioMax": 0.010935601458080195, "endMs": "1665777752471", "id": "11", "name": "S0B: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "28", "startMs": "1665777752432", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$910, $1000, $1001, $1002", "FROM __SHUFFLE6" ] }, { "kind": "COMPUTE", "substeps": [ "$590 := coalesce($1220, 0)", "$591 := coalesce($1220, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$700 := SUM($1212) OVER (PARTITION BY $1211, $1210 ORDER BY $1213 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1000 ASC, $910 ASC, $1002 ASC" ] }, { "kind": "WRITE", "substeps": [ "$590, $591, $700, $1221", "TO __stage0B_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.001215066828675577, "waitRatioMax": 0.001215066828675577, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.020656136087484813, "writeRatioMax": 0.020656136087484813 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "19", "computeRatioAvg": 0.009720534629404616, "computeRatioMax": 0.023086269744835967, "endMs": "1665777752507", "id": "12", "inputStages": [ "9" ], "name": "S0C: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3144", "startMs": "1665777752452", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage09_output" ] } ], "waitMsAvg": "1", "waitMsMax": "4", "waitRatioAvg": 0.001215066828675577, "waitRatioMax": 0.004860267314702308, "writeMsAvg": "14", "writeMsMax": "20", "writeRatioAvg": 0.01701093560145808, "writeRatioMax": 0.024301336573511544 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "14", "computeRatioAvg": 0.00850546780072904, "computeRatioMax": 0.01701093560145808, "endMs": "1665777752508", "id": "13", "inputStages": [ "8" ], "name": "S0D: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "2959", "startMs": "1665777752453", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage08_output" ] } ], "waitMsAvg": "4", "waitMsMax": "5", "waitRatioAvg": 0.004860267314702308, "waitRatioMax": 0.006075334143377886, "writeMsAvg": "13", "writeMsMax": "19", "writeRatioAvg": 0.015795868772782502, "writeRatioMax": 0.023086269744835967 }, { "completedParallelInputs": "101", "computeMsAvg": "19", "computeMsMax": "33", "computeRatioAvg": 0.023086269744835967, "computeRatioMax": 0.040097205346294046, "endMs": "1665777752520", "id": "14", "inputStages": [ "13", "6", "12" ], "name": "S0E: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "499071", "recordsWritten": "499071", "shuffleOutputBytes": "15467793", "shuffleOutputBytesSpilled": "0", "slotMs": "3553", "startMs": "1665777752466", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1320, $1321, $270", "FROM __stage06_output" ] }, { "kind": "READ", "substeps": [ "$460, $1400, $1401, $1402, $1404", "FROM __SHUFFLE14" ] }, { "kind": "READ", "substeps": [ "$620, $621, $740, $1441", "FROM __stage0C_output" ] }, { "kind": "READ", "substeps": [ "$480, $481, $510, $1500", "FROM __stage0D_output" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$200 := SUM($1332) OVER (PARTITION BY $1330 ORDER BY $1331 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$450 ASC, $451 ASC" ] }, { "kind": "COMPUTE", "substeps": [ "$290 := if(equal($1511, -1), if(equal($1510, -1), NULL, $1512), ...)" ] }, { "kind": "JOIN", "substeps": [ "$1510 := $1450, $1511 := $1451, $1512 := $1454, $1513 := $1452, $1514 := $1453, $1515 := $510", "LEFT OUTER HASH JOIN EACH WITH ALL ON $470 = $480, $471 = $481, $1451 = $1500" ] }, { "kind": "COMPUTE", "substeps": [ "$470 := coalesce($1452, 0)", "$471 := coalesce($1452, 1)" ] }, { "kind": "JOIN", "substeps": [ "$1450 := $612, $1451 := $613, $1452 := $1030, $1453 := $1031, $1454 := $740", "LEFT OUTER HASH JOIN EACH WITH ALL ON $610 = $620, $611 = $621, $612 = $1441" ] }, { "kind": "COMPUTE", "substeps": [ "$610 := coalesce($1030, 0)", "$611 := coalesce($1030, 1)", "$612 := if(or($870, $730), -1, $840)", "$613 := if($870, -1, if($730, $731, subtract($731, 1)))" ] }, { "kind": "COMPUTE", "substeps": [ "$730 := equal(mod(add($840, 1), 16384), 0)", "$731 := div($840, 16384)" ] }, { "kind": "COMPUTE", "substeps": [ "$840 := if($871, subtract($1032, 1), $950)" ] }, { "kind": "COMPUTE", "substeps": [ "$870 := less($950, 0)", "$871 := greater_or_equal($950, $1032)" ] }, { "kind": "COMPUTE", "substeps": [ "$950 := $1033" ] }, { "kind": "WRITE", "substeps": [ "$170, $171, $172", "TO __stage0E_output" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.002430133657351154, "waitRatioMax": 0.0036452004860267314, "writeMsAvg": "12", "writeMsMax": "19", "writeRatioAvg": 0.014580801944106925, "writeRatioMax": 0.023086269744835967 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "16", "computeRatioAvg": 0.009720534629404616, "computeRatioMax": 0.019441069258809233, "endMs": "1665777752531", "id": "15", "inputStages": [ "11" ], "name": "S0F: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3099", "startMs": "1665777752477", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0B_output" ] } ], "waitMsAvg": "2", "waitMsMax": "4", "waitRatioAvg": 0.002430133657351154, "waitRatioMax": 0.004860267314702308, "writeMsAvg": "14", "writeMsMax": "21", "writeRatioAvg": 0.01701093560145808, "writeRatioMax": 0.02551640340218712 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "12", "computeRatioAvg": 0.00850546780072904, "computeRatioMax": 0.014580801944106925, "endMs": "1665777752532", "id": "16", "inputStages": [ "10" ], "name": "S10: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "2722", "startMs": "1665777752479", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0A_output" ] } ], "waitMsAvg": "4", "waitMsMax": "6", "waitRatioAvg": 0.004860267314702308, "waitRatioMax": 0.007290400972053463, "writeMsAvg": "14", "writeMsMax": "37", "writeRatioAvg": 0.01701093560145808, "writeRatioMax": 0.04495747266099635 }, { "completedParallelInputs": "101", "computeMsAvg": "12", "computeMsMax": "26", "computeRatioAvg": 0.014580801944106925, "computeRatioMax": 0.031591737545565005, "endMs": "1665777752534", "id": "17", "inputStages": [ "16", "15", "7" ], "name": "S11: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "138313", "recordsWritten": "138313", "shuffleOutputBytes": "4287687", "shuffleOutputBytesSpilled": "0", "slotMs": "2561", "startMs": "1665777752489", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1100, $1101, $240", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$410, $1180, $1181, $1182, $1184", "FROM __SHUFFLE5" ] }, { "kind": "READ", "substeps": [ "$590, $591, $700, $1221", "FROM __stage0F_output" ] }, { "kind": "READ", "substeps": [ "$430, $431, $500, $1280", "FROM __stage10_output" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$190 := SUM($1112) OVER (PARTITION BY $1110 ORDER BY $1111 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$400 ASC, $401 ASC" ] }, { "kind": "COMPUTE", "substeps": [ "$260 := if(equal($1291, -1), if(equal($1290, -1), NULL, $1292), ...)" ] }, { "kind": "JOIN", "substeps": [ "$1290 := $1230, $1291 := $1231, $1292 := $1234, $1293 := $1232, $1294 := $1233, $1295 := $500", "LEFT OUTER HASH JOIN EACH WITH ALL ON $420 = $430, $421 = $431, $1231 = $1280" ] }, { "kind": "COMPUTE", "substeps": [ "$420 := coalesce($1232, 0)", "$421 := coalesce($1232, 1)" ] }, { "kind": "JOIN", "substeps": [ "$1230 := $582, $1231 := $583, $1232 := $990, $1233 := $991, $1234 := $700", "LEFT OUTER HASH JOIN EACH WITH ALL ON $580 = $590, $581 = $591, $582 = $1221" ] }, { "kind": "COMPUTE", "substeps": [ "$580 := coalesce($990, 0)", "$581 := coalesce($990, 1)", "$582 := if(or($860, $690), -1, $790)", "$583 := if($860, -1, if($690, $691, subtract($691, 1)))" ] }, { "kind": "COMPUTE", "substeps": [ "$690 := equal(mod(add($790, 1), 16384), 0)", "$691 := div($790, 16384)" ] }, { "kind": "COMPUTE", "substeps": [ "$790 := if($861, subtract($992, 1), $900)" ] }, { "kind": "COMPUTE", "substeps": [ "$860 := less($900, 0)", "$861 := greater_or_equal($900, $992)" ] }, { "kind": "COMPUTE", "substeps": [ "$900 := $993" ] }, { "kind": "WRITE", "substeps": [ "$150, $151, $152", "TO __stage11_output" ] } ], "waitMsAvg": "1", "waitMsMax": "2", "waitRatioAvg": 0.001215066828675577, "waitRatioMax": 0.002430133657351154, "writeMsAvg": "11", "writeMsMax": "20", "writeRatioAvg": 0.013365735115431349, "writeRatioMax": 0.024301336573511544 }, { "completedParallelInputs": "100", "computeMsAvg": "22", "computeMsMax": "41", "computeRatioAvg": 0.026731470230862697, "computeRatioMax": 0.04981773997569866, "endMs": "1665777752608", "id": "18", "inputStages": [ "17", "14" ], "name": "S12: Join+", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "637384", "recordsWritten": "610617", "shuffleOutputBytes": "19964592", "shuffleOutputBytesSpilled": "0", "slotMs": "3208", "startMs": "1665777752554", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$150, $151, $152", "FROM __stage11_output" ] }, { "kind": "READ", "substeps": [ "$170, $171, $172", "FROM __stage0E_output" ] }, { "kind": "COMPUTE", "substeps": [ "$70 := case_no_value(not(is_null($1520)), $1520, $1523)", "$71 := case_no_value(not(is_null($1521)), $1521, $1524)" ] }, { "kind": "JOIN", "substeps": [ "$1520 := $150, $1521 := $151, $1522 := $152, $1523 := $170, $1524 := $171, $1525 := $172", "FULL OUTER HASH JOIN EACH WITH EACH ON $150 = $170, $151 = $171" ] }, { "kind": "WRITE", "substeps": [ "$70, $71, $1522, $1525", "TO __stage12_output" ] } ], "waitMsAvg": "2", "waitMsMax": "4", "waitRatioAvg": 0.002430133657351154, "waitRatioMax": 0.004860267314702308, "writeMsAvg": "7", "writeMsMax": "14", "writeRatioAvg": 0.00850546780072904, "writeRatioMax": 0.01701093560145808 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.010935601458080195, "computeRatioMax": 0.010935601458080195, "endMs": "1665777752678", "id": "19", "name": "S13: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "37", "startMs": "1665777752641", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$380, $381, $1671, $1670", "FROM __SHUFFLE25" ] }, { "kind": "COMPUTE", "substeps": [ "$130 := coalesce($1691, 0)", "$131 := coalesce($1691, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$180 := MAX($1680) OVER (PARTITION BY $1683 ORDER BY $1682 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)", "$181 := MAX($1681) OVER (PARTITION BY $1683 ORDER BY $1682 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1670 ASC, $1671 ASC" ] }, { "kind": "WRITE", "substeps": [ "$130, $131, $180, $181, $1690", "TO __stage13_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002430133657351154, "waitRatioMax": 0.002430133657351154, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.023086269744835967, "writeRatioMax": 0.023086269744835967 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.013365735115431349, "computeRatioMax": 0.013365735115431349, "endMs": "1665777752690", "id": "20", "name": "S14: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665777752655", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$550, $650, $651, $652, $653", "FROM __SHUFFLE23" ] }, { "kind": "COMPUTE", "substeps": [ "$230 := coalesce($1630, 0)", "$231 := coalesce($1630, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$330 := MAX($1622) OVER (PARTITION BY $1621, $1620 ORDER BY $1624 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)", "$331 := MAX($1623) OVER (PARTITION BY $1621, $1620 ORDER BY $1624 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$650 ASC, $550 ASC, $653 ASC" ] }, { "kind": "WRITE", "substeps": [ "$230, $231, $330, $331, $1631", "TO __stage14_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.001215066828675577, "waitRatioMax": 0.001215066828675577, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.019441069258809233, "writeRatioMax": 0.019441069258809233 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "15", "computeRatioAvg": 0.00850546780072904, "computeRatioMax": 0.018226002430133656, "endMs": "1665777752754", "id": "21", "inputStages": [ "20" ], "name": "S15: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3037", "startMs": "1665777752701", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage14_output" ] } ], "waitMsAvg": "2", "waitMsMax": "5", "waitRatioAvg": 0.002430133657351154, "waitRatioMax": 0.006075334143377886, "writeMsAvg": "14", "writeMsMax": "27", "writeRatioAvg": 0.01701093560145808, "writeRatioMax": 0.032806804374240585 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "11", "computeRatioAvg": 0.00850546780072904, "computeRatioMax": 0.013365735115431349, "endMs": "1665777752768", "id": "22", "inputStages": [ "19" ], "name": "S16: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3212", "startMs": "1665777752703", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage13_output" ] } ], "waitMsAvg": "7", "waitMsMax": "9", "waitRatioAvg": 0.00850546780072904, "waitRatioMax": 0.010935601458080195, "writeMsAvg": "9", "writeMsMax": "19", "writeRatioAvg": 0.010935601458080195, "writeRatioMax": 0.023086269744835967 }, { "completedParallelInputs": "101", "computeMsAvg": "14", "computeMsMax": "22", "computeRatioAvg": 0.01701093560145808, "computeRatioMax": 0.026731470230862697, "endMs": "1665777752769", "id": "23", "inputStages": [ "22", "18", "21" ], "name": "S17: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "610617", "recordsWritten": "10000", "shuffleOutputBytes": "668048", "shuffleOutputBytesSpilled": "0", "slotMs": "3561", "startMs": "1665777752718", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70, $71, $1522, $1525", "FROM __stage12_output" ] }, { "kind": "READ", "substeps": [ "$110, $1600, $1601, $1602, $1603, $1605", "FROM __SHUFFLE22" ] }, { "kind": "READ", "substeps": [ "$230, $231, $330, $331, $1631", "FROM __stage15_output" ] }, { "kind": "READ", "substeps": [ "$130, $131, $180, $181, $1690", "FROM __stage16_output" ] }, { "kind": "SORT", "substeps": [ "$52 ASC, $53 ASC", "LIMIT 100" ] }, { "kind": "FILTER", "substeps": [ "greater($51, $50)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$60 := MAX($1532) OVER (PARTITION BY $1530 ORDER BY $1531 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)", "$61 := MAX($1533) OVER (PARTITION BY $1530 ORDER BY $1531 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$100 ASC, $101 ASC" ] }, { "kind": "COMPUTE", "substeps": [ "$90 := if(equal($1701, -1), if(equal($1700, -1), NULL, $1702), ...)", "$91 := if(equal($1701, -1), if(equal($1700, -1), NULL, $1703), ...)" ] }, { "kind": "JOIN", "substeps": [ "$1700 := $1640, $1701 := $1641, $1702 := $1646, $1703 := $1647, $1704 := $1642, $1705 := $1643, $1706 := $1644, $1707 := $1645, $1708 := $180, $1709 := $181", "LEFT OUTER HASH JOIN EACH WITH ALL ON $120 = $130, $121 = $131, $1641 = $1690" ] }, { "kind": "COMPUTE", "substeps": [ "$120 := coalesce($1642, 0)", "$121 := coalesce($1642, 1)" ] }, { "kind": "JOIN", "substeps": [ "$1640 := $222, $1641 := $223, $1642 := $640, $1643 := $641, $1644 := $642, $1645 := $643, $1646 := $330, $1647 := $331", "LEFT OUTER HASH JOIN EACH WITH ALL ON $220 = $230, $221 = $231, $222 = $1631" ] }, { "kind": "COMPUTE", "substeps": [ "$220 := coalesce($640, 0)", "$221 := coalesce($640, 1)", "$222 := if(or($490, $320), -1, $370)", "$223 := if($490, -1, if($320, $321, subtract($321, 1)))" ] }, { "kind": "COMPUTE", "substeps": [ "$320 := equal(mod(add($370, 1), 16384), 0)", "$321 := div($370, 16384)" ] }, { "kind": "COMPUTE", "substeps": [ "$370 := if($491, subtract($644, 1), $540)" ] }, { "kind": "COMPUTE", "substeps": [ "$490 := less($540, 0)", "$491 := greater_or_equal($540, $644)" ] }, { "kind": "COMPUTE", "substeps": [ "$540 := $645" ] }, { "kind": "WRITE", "substeps": [ "$1710, $1711, $1712, $1713, $1714, $1715", "TO __stage17_output" ] } ], "waitMsAvg": "11", "waitMsMax": "13", "waitRatioAvg": 0.013365735115431349, "waitRatioMax": 0.015795868772782502, "writeMsAvg": "11", "writeMsMax": "25", "writeRatioAvg": 0.013365735115431349, "writeRatioMax": 0.030376670716889428 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.01701093560145808, "computeRatioMax": 0.01701093560145808, "endMs": "1665777752870", "id": "24", "inputStages": [ "23" ], "name": "S18: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "10000", "recordsWritten": "100", "shuffleOutputBytes": "6696", "shuffleOutputBytesSpilled": "0", "slotMs": "141", "startMs": "1665777752728", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1710, $1711, $1712, $1713, $1714, $1715", "FROM __stage17_output" ] }, { "kind": "SORT", "substeps": [ "$1712 ASC, $1713 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$1720, $1721, $1722, $1723, $1724, $1725", "TO __stage18_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002430133657351154, "waitRatioMax": 0.002430133657351154, "writeMsAvg": "5", "writeMsMax": "5", "writeRatioAvg": 0.006075334143377886, "writeRatioMax": 0.006075334143377886 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "2", "completedUnits": "9", "elapsedMs": "612", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "1866" }, { "activeUnits": "1", "completedUnits": "1021", "elapsedMs": "1479", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "34113" } ], "totalBytesBilled": "114294784", "totalBytesProcessed": "113826808", "totalPartitionsProcessed": "0", "totalSlotMs": "34113", "transferredBytes": "0" }, "startTime": "1665777751458", "totalBytesProcessed": "113826808", "totalSlotMs": "34113" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anonde3a2ad9_eb1b_499f_88ba_72b7ce989720" }, "priority": "INTERACTIVE", "query": "-- start query 51 in stream 0 using template query51.tpl\n\n/*\nCompute the count of store sales resulting from promotions, \nthe count of all store sales and \ntheir ratio for specific categories in a particular time zone and for a given year and month.\n*/\n\nWITH web_v1 as (\nselect\n ws_item_sk item_sk, d_date,\n sum(sum(ws_sales_price))\n over (partition by ws_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom web_sales\n ,date_dim\nwhere ws_sold_date_sk=d_date_sk\n and d_month_seq between 1200 and 1200+11\n and ws_item_sk is not NULL\ngroup by ws_item_sk, d_date),\nstore_v1 as (\nselect\n ss_item_sk item_sk, d_date,\n sum(sum(ss_sales_price))\n over (partition by ss_item_sk order by d_date rows between unbounded preceding and current row) cume_sales\nfrom store_sales\n ,date_dim\nwhere ss_sold_date_sk=d_date_sk\n and d_month_seq between 1200 and 1200+11\n and ss_item_sk is not NULL\ngroup by ss_item_sk, d_date)\nselect *\nfrom (select item_sk\n ,d_date\n ,web_sales\n ,store_sales\n ,max(web_sales)\n over (partition by item_sk order by d_date rows between unbounded preceding and current row) web_cumulative\n ,max(store_sales)\n over (partition by item_sk order by d_date rows between unbounded preceding and current row) store_cumulative\n from (select case when web.item_sk is not null then web.item_sk else store.item_sk end item_sk\n ,case when web.d_date is not null then web.d_date else store.d_date end d_date\n ,web.cume_sales web_sales\n ,store.cume_sales store_sales\n from web_v1 web full outer join store_v1 store on (web.item_sk = store.item_sk\n and web.d_date = store.d_date)\n )x )y\nwhere web_cumulative > store_cumulative\norder by item_sk\n ,d_date\nlimit 100\n;\n\n-- end query 51 in stream 0 using template query51.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "+hGIvWo9FVpFcph1v+YFPg==", "id": "test-project-364309:europe-west1.query51_1665777754", "jobReference": { "jobId": "query51_1665777754", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query51_1665777754?location=europe-west1", "statistics": { "creationTime": "1665777755464", "endTime": "1665777757372", "finalExecutionDurationMs": "1678", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "113826808", "performanceInsights": { "avgPreviousExecutionMs": "1493" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.008397480755773267, "computeRatioMax": 0.008397480755773267, "endMs": "1665777755661", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.004198740377886634, "readRatioMax": 0.004198740377886634, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "5124", "shuffleOutputBytesSpilled": "0", "slotMs": "31", "startMs": "1665777755627", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $31:d_date, $32:d_month_seq", "FROM date_dim", "WHERE between($32, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$30, $31", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006997900629811056, "waitRatioMax": 0.0006997900629811056, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.005598320503848845, "writeRatioMax": 0.005598320503848845 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.006298110566829951, "computeRatioMax": 0.006298110566829951, "endMs": "1665777755698", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.004198740377886634, "readRatioMax": 0.004198740377886634, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "5124", "shuffleOutputBytesSpilled": "0", "slotMs": "36", "startMs": "1665777755658", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_date, $12:d_month_seq", "FROM date_dim", "WHERE between($12, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006997900629811056, "waitRatioMax": 0.0006997900629811056, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.009097270818754374, "writeRatioMax": 0.009097270818754374 }, { "completedParallelInputs": "6", "computeMsAvg": "239", "computeMsMax": "270", "computeRatioAvg": 0.16724982505248426, "computeRatioMax": 0.18894331700489853, "endMs": "1665777755894", "id": "4", "inputStages": [ "0" ], "name": "S04: Join+", "parallelInputs": "6", "readMsAvg": "12", "readMsMax": "13", "readRatioAvg": 0.008397480755773267, "readRatioMax": 0.009097270818754374, "recordsRead": "2882600", "recordsWritten": "543984", "shuffleOutputBytes": "16663712", "shuffleOutputBytesSpilled": "0", "slotMs": "1426", "startMs": "1665777755691", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ss_sold_date_sk, $21:ss_item_sk, $22:ss_sales_price", "FROM store_sales", "WHERE not(is_null($21))" ] }, { "kind": "READ", "substeps": [ "$30, $31", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1310 := $1300, $1311 := $1302", "$440 := SUM($1301)" ] }, { "kind": "JOIN", "substeps": [ "$1300 := $21, $1301 := $22, $1302 := $31", "INNER HASH JOIN EACH WITH ALL ON $20 = $30" ] }, { "kind": "WRITE", "substeps": [ "$1310, $1311, $440", "TO __stage04_output", "BY HASH($1310, $1311)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006997900629811056, "waitRatioMax": 0.0006997900629811056, "writeMsAvg": "22", "writeMsMax": "23", "writeRatioAvg": 0.015395381385584325, "writeRatioMax": 0.01609517144856543 }, { "completedParallelInputs": "1", "computeMsAvg": "511", "computeMsMax": "511", "computeRatioAvg": 0.357592722183345, "computeRatioMax": 0.357592722183345, "endMs": "1665777756005", "id": "5", "inputStages": [ "2" ], "name": "S05: Join+", "parallelInputs": "1", "readMsAvg": "14", "readMsMax": "14", "readRatioAvg": 0.00979706088173548, "readRatioMax": 0.00979706088173548, "recordsRead": "719750", "recordsWritten": "138313", "shuffleOutputBytes": "4287431", "shuffleOutputBytesSpilled": "0", "slotMs": "441", "startMs": "1665777755719", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:ws_sold_date_sk, $2:ws_item_sk, $3:ws_sales_price", "FROM web_sales", "WHERE not(is_null($2))" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage02_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1090 := $1080, $1091 := $1082", "$390 := SUM($1081)" ] }, { "kind": "JOIN", "substeps": [ "$1080 := $2, $1081 := $3, $1082 := $11", "INNER HASH JOIN EACH WITH ALL ON $1 = $10" ] }, { "kind": "WRITE", "substeps": [ "$1090, $1091, $390", "TO __stage05_output", "BY HASH($1090, $1091)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006997900629811056, "waitRatioMax": 0.0006997900629811056, "writeMsAvg": "23", "writeMsMax": "23", "writeRatioAvg": 0.01609517144856543, "writeRatioMax": 0.01609517144856543 }, { "completedParallelInputs": "1", "computeMsAvg": "1429", "computeMsMax": "1429", "computeRatioAvg": 1, "computeRatioMax": 1, "endMs": "1665777756677", "id": "6", "inputStages": [ "4" ], "name": "S06: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "543984", "recordsWritten": "499071", "shuffleOutputBytes": "15303153", "shuffleOutputBytesSpilled": "0", "slotMs": "1060", "startMs": "1665777755917", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1310, $1311, $440", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1320 := $1310, $1321 := $1311", "$270 := SUM($440)" ] }, { "kind": "WRITE", "substeps": [ "$1320, $1321, $270", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006997900629811056, "waitRatioMax": 0.0006997900629811056, "writeMsAvg": "28", "writeMsMax": "28", "writeRatioAvg": 0.01959412176347096, "writeRatioMax": 0.01959412176347096 }, { "completedParallelInputs": "1", "computeMsAvg": "246", "computeMsMax": "246", "computeRatioAvg": 0.172148355493352, "computeRatioMax": 0.172148355493352, "endMs": "1665777756181", "id": "7", "inputStages": [ "5" ], "name": "S07: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "138313", "recordsWritten": "138313", "shuffleOutputBytes": "4287431", "shuffleOutputBytesSpilled": "0", "slotMs": "212", "startMs": "1665777756031", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1090, $1091, $390", "FROM __stage05_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $1100 := $1090, $1101 := $1091", "$240 := SUM($390)" ] }, { "kind": "WRITE", "substeps": [ "$1100, $1101, $240", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006997900629811056, "waitRatioMax": 0.0006997900629811056, "writeMsAvg": "23", "writeMsMax": "23", "writeRatioAvg": 0.01609517144856543, "writeRatioMax": 0.01609517144856543 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.00489853044086774, "computeRatioMax": 0.00489853044086774, "endMs": "1665777756903", "id": "8", "name": "S08: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "30", "startMs": "1665777756869", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$850, $1481, $1480", "FROM __SHUFFLE17" ] }, { "kind": "COMPUTE", "substeps": [ "$480 := coalesce($1501, 0)", "$481 := coalesce($1501, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$510 := SUM($1490) OVER (PARTITION BY $1492 ORDER BY $1491 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1480 ASC, $1481 ASC" ] }, { "kind": "WRITE", "substeps": [ "$480, $481, $510, $1500", "TO __stage08_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006997900629811056, "waitRatioMax": 0.0006997900629811056, "writeMsAvg": "28", "writeMsMax": "28", "writeRatioAvg": 0.01959412176347096, "writeRatioMax": 0.01959412176347096 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.00489853044086774, "computeRatioMax": 0.00489853044086774, "endMs": "1665777756918", "id": "9", "name": "S09: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665777756885", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$960, $1040, $1041, $1042", "FROM __SHUFFLE15" ] }, { "kind": "COMPUTE", "substeps": [ "$620 := coalesce($1440, 0)", "$621 := coalesce($1440, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$740 := SUM($1432) OVER (PARTITION BY $1431, $1430 ORDER BY $1433 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1040 ASC, $960 ASC, $1042 ASC" ] }, { "kind": "WRITE", "substeps": [ "$620, $621, $740, $1441", "TO __stage09_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006997900629811056, "waitRatioMax": 0.0006997900629811056, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.012596221133659902, "writeRatioMax": 0.012596221133659902 }, { "completedParallelInputs": "1", "computeMsAvg": "4", "computeMsMax": "4", "computeRatioAvg": 0.0027991602519244225, "computeRatioMax": 0.0027991602519244225, "endMs": "1665777756932", "id": "10", "name": "S0A: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "22", "startMs": "1665777756898", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$800, $1261, $1260", "FROM __SHUFFLE8" ] }, { "kind": "COMPUTE", "substeps": [ "$430 := coalesce($1281, 0)", "$431 := coalesce($1281, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$500 := SUM($1270) OVER (PARTITION BY $1272 ORDER BY $1271 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1260 ASC, $1261 ASC" ] }, { "kind": "WRITE", "substeps": [ "$430, $431, $500, $1280", "TO __stage0A_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006997900629811056, "waitRatioMax": 0.0006997900629811056, "writeMsAvg": "30", "writeMsMax": "30", "writeRatioAvg": 0.02099370188943317, "writeRatioMax": 0.02099370188943317 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.006298110566829951, "computeRatioMax": 0.006298110566829951, "endMs": "1665777756946", "id": "11", "name": "S0B: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "27", "startMs": "1665777756912", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$910, $1000, $1001, $1002", "FROM __SHUFFLE6" ] }, { "kind": "COMPUTE", "substeps": [ "$590 := coalesce($1220, 0)", "$591 := coalesce($1220, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$700 := SUM($1212) OVER (PARTITION BY $1211, $1210 ORDER BY $1213 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1000 ASC, $910 ASC, $1002 ASC" ] }, { "kind": "WRITE", "substeps": [ "$590, $591, $700, $1221", "TO __stage0B_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006997900629811056, "waitRatioMax": 0.0006997900629811056, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.011896431070678797, "writeRatioMax": 0.011896431070678797 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "14", "computeRatioAvg": 0.00489853044086774, "computeRatioMax": 0.00979706088173548, "endMs": "1665777756996", "id": "12", "inputStages": [ "9" ], "name": "S0C: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3051", "startMs": "1665777756932", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage09_output" ] } ], "waitMsAvg": "2", "waitMsMax": "4", "waitRatioAvg": 0.0013995801259622112, "waitRatioMax": 0.0027991602519244225, "writeMsAvg": "14", "writeMsMax": "19", "writeRatioAvg": 0.00979706088173548, "writeRatioMax": 0.013296011196641007 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "15", "computeRatioAvg": 0.00489853044086774, "computeRatioMax": 0.010496850944716585, "endMs": "1665777756999", "id": "13", "inputStages": [ "8" ], "name": "S0D: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "2878", "startMs": "1665777756933", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage08_output" ] } ], "waitMsAvg": "3", "waitMsMax": "4", "waitRatioAvg": 0.002099370188943317, "waitRatioMax": 0.0027991602519244225, "writeMsAvg": "14", "writeMsMax": "18", "writeRatioAvg": 0.00979706088173548, "writeRatioMax": 0.012596221133659902 }, { "completedParallelInputs": "101", "computeMsAvg": "18", "computeMsMax": "28", "computeRatioAvg": 0.012596221133659902, "computeRatioMax": 0.01959412176347096, "endMs": "1665777757001", "id": "14", "inputStages": [ "12", "13", "6" ], "name": "S0E: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "499071", "recordsWritten": "499071", "shuffleOutputBytes": "15467793", "shuffleOutputBytesSpilled": "0", "slotMs": "2876", "startMs": "1665777756946", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1320, $1321, $270", "FROM __stage06_output" ] }, { "kind": "READ", "substeps": [ "$460, $1400, $1401, $1402, $1404", "FROM __SHUFFLE14" ] }, { "kind": "READ", "substeps": [ "$620, $621, $740, $1441", "FROM __stage0C_output" ] }, { "kind": "READ", "substeps": [ "$480, $481, $510, $1500", "FROM __stage0D_output" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$200 := SUM($1332) OVER (PARTITION BY $1330 ORDER BY $1331 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$450 ASC, $451 ASC" ] }, { "kind": "COMPUTE", "substeps": [ "$290 := if(equal($1511, -1), if(equal($1510, -1), NULL, $1512), ...)" ] }, { "kind": "JOIN", "substeps": [ "$1510 := $1450, $1511 := $1451, $1512 := $1454, $1513 := $1452, $1514 := $1453, $1515 := $510", "LEFT OUTER HASH JOIN EACH WITH ALL ON $470 = $480, $471 = $481, $1451 = $1500" ] }, { "kind": "COMPUTE", "substeps": [ "$470 := coalesce($1452, 0)", "$471 := coalesce($1452, 1)" ] }, { "kind": "JOIN", "substeps": [ "$1450 := $612, $1451 := $613, $1452 := $1030, $1453 := $1031, $1454 := $740", "LEFT OUTER HASH JOIN EACH WITH ALL ON $610 = $620, $611 = $621, $612 = $1441" ] }, { "kind": "COMPUTE", "substeps": [ "$610 := coalesce($1030, 0)", "$611 := coalesce($1030, 1)", "$612 := if(or($870, $730), -1, $840)", "$613 := if($870, -1, if($730, $731, subtract($731, 1)))" ] }, { "kind": "COMPUTE", "substeps": [ "$730 := equal(mod(add($840, 1), 16384), 0)", "$731 := div($840, 16384)" ] }, { "kind": "COMPUTE", "substeps": [ "$840 := if($871, subtract($1032, 1), $950)" ] }, { "kind": "COMPUTE", "substeps": [ "$870 := less($950, 0)", "$871 := greater_or_equal($950, $1032)" ] }, { "kind": "COMPUTE", "substeps": [ "$950 := $1033" ] }, { "kind": "WRITE", "substeps": [ "$170, $171, $172", "TO __stage0E_output" ] } ], "waitMsAvg": "2", "waitMsMax": "8", "waitRatioAvg": 0.0013995801259622112, "waitRatioMax": 0.005598320503848845, "writeMsAvg": "9", "writeMsMax": "18", "writeRatioAvg": 0.006298110566829951, "writeRatioMax": 0.012596221133659902 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "16", "computeRatioAvg": 0.00489853044086774, "computeRatioMax": 0.01119664100769769, "endMs": "1665777757018", "id": "15", "inputStages": [ "11" ], "name": "S0F: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3056", "startMs": "1665777756959", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0B_output" ] } ], "waitMsAvg": "2", "waitMsMax": "5", "waitRatioAvg": 0.0013995801259622112, "waitRatioMax": 0.0034989503149055285, "writeMsAvg": "17", "writeMsMax": "29", "writeRatioAvg": 0.011896431070678797, "writeRatioMax": 0.020293911826452064 }, { "completedParallelInputs": "100", "computeMsAvg": "7", "computeMsMax": "17", "computeRatioAvg": 0.00489853044086774, "computeRatioMax": 0.011896431070678797, "endMs": "1665777757018", "id": "16", "inputStages": [ "10" ], "name": "S10: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "2412", "startMs": "1665777756961", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0A_output" ] } ], "waitMsAvg": "4", "waitMsMax": "5", "waitRatioAvg": 0.0027991602519244225, "waitRatioMax": 0.0034989503149055285, "writeMsAvg": "12", "writeMsMax": "19", "writeRatioAvg": 0.008397480755773267, "writeRatioMax": 0.013296011196641007 }, { "completedParallelInputs": "101", "computeMsAvg": "12", "computeMsMax": "25", "computeRatioAvg": 0.008397480755773267, "computeRatioMax": 0.01749475157452764, "endMs": "1665777757030", "id": "17", "inputStages": [ "16", "15", "7" ], "name": "S11: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "138313", "recordsWritten": "138313", "shuffleOutputBytes": "4287687", "shuffleOutputBytesSpilled": "0", "slotMs": "3571", "startMs": "1665777756990", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1100, $1101, $240", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$410, $1180, $1181, $1182, $1184", "FROM __SHUFFLE5" ] }, { "kind": "READ", "substeps": [ "$590, $591, $700, $1221", "FROM __stage0F_output" ] }, { "kind": "READ", "substeps": [ "$430, $431, $500, $1280", "FROM __stage10_output" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$190 := SUM($1112) OVER (PARTITION BY $1110 ORDER BY $1111 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$400 ASC, $401 ASC" ] }, { "kind": "COMPUTE", "substeps": [ "$260 := if(equal($1291, -1), if(equal($1290, -1), NULL, $1292), ...)" ] }, { "kind": "JOIN", "substeps": [ "$1290 := $1230, $1291 := $1231, $1292 := $1234, $1293 := $1232, $1294 := $1233, $1295 := $500", "LEFT OUTER HASH JOIN EACH WITH ALL ON $420 = $430, $421 = $431, $1231 = $1280" ] }, { "kind": "COMPUTE", "substeps": [ "$420 := coalesce($1232, 0)", "$421 := coalesce($1232, 1)" ] }, { "kind": "JOIN", "substeps": [ "$1230 := $582, $1231 := $583, $1232 := $990, $1233 := $991, $1234 := $700", "LEFT OUTER HASH JOIN EACH WITH ALL ON $580 = $590, $581 = $591, $582 = $1221" ] }, { "kind": "COMPUTE", "substeps": [ "$580 := coalesce($990, 0)", "$581 := coalesce($990, 1)", "$582 := if(or($860, $690), -1, $790)", "$583 := if($860, -1, if($690, $691, subtract($691, 1)))" ] }, { "kind": "COMPUTE", "substeps": [ "$690 := equal(mod(add($790, 1), 16384), 0)", "$691 := div($790, 16384)" ] }, { "kind": "COMPUTE", "substeps": [ "$790 := if($861, subtract($992, 1), $900)" ] }, { "kind": "COMPUTE", "substeps": [ "$860 := less($900, 0)", "$861 := greater_or_equal($900, $992)" ] }, { "kind": "COMPUTE", "substeps": [ "$900 := $993" ] }, { "kind": "WRITE", "substeps": [ "$150, $151, $152", "TO __stage11_output" ] } ], "waitMsAvg": "3", "waitMsMax": "4", "waitRatioAvg": 0.002099370188943317, "waitRatioMax": 0.0027991602519244225, "writeMsAvg": "13", "writeMsMax": "17", "writeRatioAvg": 0.009097270818754374, "writeRatioMax": 0.011896431070678797 }, { "completedParallelInputs": "100", "computeMsAvg": "20", "computeMsMax": "32", "computeRatioAvg": 0.013995801259622114, "computeRatioMax": 0.02239328201539538, "endMs": "1665777757104", "id": "18", "inputStages": [ "17", "14" ], "name": "S12: Join+", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "637384", "recordsWritten": "610617", "shuffleOutputBytes": "19964592", "shuffleOutputBytesSpilled": "0", "slotMs": "3376", "startMs": "1665777757050", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$150, $151, $152", "FROM __stage11_output" ] }, { "kind": "READ", "substeps": [ "$170, $171, $172", "FROM __stage0E_output" ] }, { "kind": "COMPUTE", "substeps": [ "$70 := case_no_value(not(is_null($1520)), $1520, $1523)", "$71 := case_no_value(not(is_null($1521)), $1521, $1524)" ] }, { "kind": "JOIN", "substeps": [ "$1520 := $150, $1521 := $151, $1522 := $152, $1523 := $170, $1524 := $171, $1525 := $172", "FULL OUTER HASH JOIN EACH WITH EACH ON $150 = $170, $151 = $171" ] }, { "kind": "WRITE", "substeps": [ "$70, $71, $1522, $1525", "TO __stage12_output" ] } ], "waitMsAvg": "3", "waitMsMax": "4", "waitRatioAvg": 0.002099370188943317, "waitRatioMax": 0.0027991602519244225, "writeMsAvg": "7", "writeMsMax": "12", "writeRatioAvg": 0.00489853044086774, "writeRatioMax": 0.008397480755773267 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.00489853044086774, "computeRatioMax": 0.00489853044086774, "endMs": "1665777757165", "id": "19", "name": "S13: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "35", "startMs": "1665777757128", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$380, $381, $1671, $1670", "FROM __SHUFFLE25" ] }, { "kind": "COMPUTE", "substeps": [ "$130 := coalesce($1691, 0)", "$131 := coalesce($1691, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$180 := MAX($1680) OVER (PARTITION BY $1683 ORDER BY $1682 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)", "$181 := MAX($1681) OVER (PARTITION BY $1683 ORDER BY $1682 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$1670 ASC, $1671 ASC" ] }, { "kind": "WRITE", "substeps": [ "$130, $131, $180, $181, $1690", "TO __stage13_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006997900629811056, "waitRatioMax": 0.0006997900629811056, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.013296011196641007, "writeRatioMax": 0.013296011196641007 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.00489853044086774, "computeRatioMax": 0.00489853044086774, "endMs": "1665777757177", "id": "20", "name": "S14: Input", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "25", "startMs": "1665777757142", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$550, $650, $651, $652, $653", "FROM __SHUFFLE23" ] }, { "kind": "COMPUTE", "substeps": [ "$230 := coalesce($1630, 0)", "$231 := coalesce($1630, 1)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$330 := MAX($1622) OVER (PARTITION BY $1621, $1620 ORDER BY $1624 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)", "$331 := MAX($1623) OVER (PARTITION BY $1621, $1620 ORDER BY $1624 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$650 ASC, $550 ASC, $653 ASC" ] }, { "kind": "WRITE", "substeps": [ "$230, $231, $330, $331, $1631", "TO __stage14_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006997900629811056, "waitRatioMax": 0.0006997900629811056, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.012596221133659902, "writeRatioMax": 0.012596221133659902 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "16", "computeRatioAvg": 0.005598320503848845, "computeRatioMax": 0.01119664100769769, "endMs": "1665777757249", "id": "21", "inputStages": [ "20" ], "name": "S15: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3583", "startMs": "1665777757194", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage14_output" ] } ], "waitMsAvg": "2", "waitMsMax": "6", "waitRatioAvg": 0.0013995801259622112, "waitRatioMax": 0.004198740377886634, "writeMsAvg": "19", "writeMsMax": "32", "writeRatioAvg": 0.013296011196641007, "writeRatioMax": 0.02239328201539538 }, { "completedParallelInputs": "99", "computeMsAvg": "7", "computeMsMax": "13", "computeRatioAvg": 0.00489853044086774, "computeRatioMax": 0.009097270818754374, "endMs": "1665777757249", "id": "22", "inputStages": [ "19" ], "name": "S16: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "0", "recordsWritten": "0", "shuffleOutputBytes": "0", "shuffleOutputBytesSpilled": "0", "slotMs": "3191", "startMs": "1665777757195", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage13_output" ] } ], "waitMsAvg": "6", "waitMsMax": "7", "waitRatioAvg": 0.004198740377886634, "waitRatioMax": 0.00489853044086774, "writeMsAvg": "15", "writeMsMax": "29", "writeRatioAvg": 0.010496850944716585, "writeRatioMax": 0.020293911826452064 }, { "completedParallelInputs": "101", "computeMsAvg": "14", "computeMsMax": "21", "computeRatioAvg": 0.00979706088173548, "computeRatioMax": 0.01469559132260322, "endMs": "1665777757249", "id": "23", "inputStages": [ "18", "21", "22" ], "name": "S17: Join+", "parallelInputs": "101", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "610617", "recordsWritten": "10000", "shuffleOutputBytes": "668048", "shuffleOutputBytesSpilled": "0", "slotMs": "3646", "startMs": "1665777757203", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70, $71, $1522, $1525", "FROM __stage12_output" ] }, { "kind": "READ", "substeps": [ "$110, $1600, $1601, $1602, $1603, $1605", "FROM __SHUFFLE22" ] }, { "kind": "READ", "substeps": [ "$230, $231, $330, $331, $1631", "FROM __stage15_output" ] }, { "kind": "READ", "substeps": [ "$130, $131, $180, $181, $1690", "FROM __stage16_output" ] }, { "kind": "SORT", "substeps": [ "$52 ASC, $53 ASC", "LIMIT 100" ] }, { "kind": "FILTER", "substeps": [ "greater($51, $50)" ] }, { "kind": "ANALYTIC_FUNCTION", "substeps": [ "$60 := MAX($1532) OVER (PARTITION BY $1530 ORDER BY $1531 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)", "$61 := MAX($1533) OVER (PARTITION BY $1530 ORDER BY $1531 ASC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)" ] }, { "kind": "SORT", "substeps": [ "$100 ASC, $101 ASC" ] }, { "kind": "COMPUTE", "substeps": [ "$90 := if(equal($1701, -1), if(equal($1700, -1), NULL, $1702), ...)", "$91 := if(equal($1701, -1), if(equal($1700, -1), NULL, $1703), ...)" ] }, { "kind": "JOIN", "substeps": [ "$1700 := $1640, $1701 := $1641, $1702 := $1646, $1703 := $1647, $1704 := $1642, $1705 := $1643, $1706 := $1644, $1707 := $1645, $1708 := $180, $1709 := $181", "LEFT OUTER HASH JOIN EACH WITH ALL ON $120 = $130, $121 = $131, $1641 = $1690" ] }, { "kind": "COMPUTE", "substeps": [ "$120 := coalesce($1642, 0)", "$121 := coalesce($1642, 1)" ] }, { "kind": "JOIN", "substeps": [ "$1640 := $222, $1641 := $223, $1642 := $640, $1643 := $641, $1644 := $642, $1645 := $643, $1646 := $330, $1647 := $331", "LEFT OUTER HASH JOIN EACH WITH ALL ON $220 = $230, $221 = $231, $222 = $1631" ] }, { "kind": "COMPUTE", "substeps": [ "$220 := coalesce($640, 0)", "$221 := coalesce($640, 1)", "$222 := if(or($490, $320), -1, $370)", "$223 := if($490, -1, if($320, $321, subtract($321, 1)))" ] }, { "kind": "COMPUTE", "substeps": [ "$320 := equal(mod(add($370, 1), 16384), 0)", "$321 := div($370, 16384)" ] }, { "kind": "COMPUTE", "substeps": [ "$370 := if($491, subtract($644, 1), $540)" ] }, { "kind": "COMPUTE", "substeps": [ "$490 := less($540, 0)", "$491 := greater_or_equal($540, $644)" ] }, { "kind": "COMPUTE", "substeps": [ "$540 := $645" ] }, { "kind": "WRITE", "substeps": [ "$1710, $1711, $1712, $1713, $1714, $1715", "TO __stage17_output" ] } ], "waitMsAvg": "7", "waitMsMax": "8", "waitRatioAvg": 0.00489853044086774, "waitRatioMax": 0.005598320503848845, "writeMsAvg": "19", "writeMsMax": "34", "writeRatioAvg": 0.013296011196641007, "writeRatioMax": 0.023792862141357594 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.006997900629811057, "computeRatioMax": 0.006997900629811057, "endMs": "1665777757262", "id": "24", "inputStages": [ "23" ], "name": "S18: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "10000", "recordsWritten": "100", "shuffleOutputBytes": "6696", "shuffleOutputBytesSpilled": "0", "slotMs": "21", "startMs": "1665777757218", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1710, $1711, $1712, $1713, $1714, $1715", "FROM __stage17_output" ] }, { "kind": "SORT", "substeps": [ "$1712 ASC, $1713 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$1720, $1721, $1722, $1723, $1724, $1725", "TO __stage18_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006997900629811056, "waitRatioMax": 0.0006997900629811056, "writeMsAvg": "4", "writeMsMax": "4", "writeRatioAvg": 0.0027991602519244225, "writeRatioMax": 0.0027991602519244225 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "2", "completedUnits": "9", "elapsedMs": "616", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "2009" }, { "activeUnits": "0", "completedUnits": "1020", "elapsedMs": "1803", "estimatedRunnableUnits": "0", "pendingUnits": "1", "totalSlotMs": "34954" } ], "totalBytesBilled": "114294784", "totalBytesProcessed": "113826808", "totalPartitionsProcessed": "0", "totalSlotMs": "34954", "transferredBytes": "0" }, "startTime": "1665777755512", "totalBytesProcessed": "113826808", "totalSlotMs": "34954" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
