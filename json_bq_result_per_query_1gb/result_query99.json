{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon64e1d51f_dfbc_4e9a_a4f1_a5c320408a65" }, "priority": "INTERACTIVE", "query": "-- start query 99 in stream 0 using template query99.tpl\n\n/*\nFor catalog sales, create a report showing the counts of orders shipped \n within 30 days, \n from 31 to 60 days, \n from 61 to 90 days, \n from 91 to 120 days and \n over 120 days \nwithin a given year, grouped by warehouse, call center and shipping mode.\n*/\n\nselect \n substr(w_warehouse_name,1,20) w_w_name\n ,sm_type\n ,cc_name\n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end) as days_30 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and \n (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end ) as days_31_60 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and \n (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end) as days_61_90 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end) as days_91_120 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 120) then 1 else 0 end) as days_gt_120\nfrom\n catalog_sales\n ,warehouse\n ,ship_mode\n ,call_center\n ,date_dim\nwhere\n d_month_seq between 1200 and 1200 + 11\nand cs_ship_date_sk = d_date_sk\nand cs_warehouse_sk = w_warehouse_sk\nand cs_ship_mode_sk = sm_ship_mode_sk\nand cs_call_center_sk = cc_call_center_sk\ngroup by\n w_w_name\n ,sm_type\n ,cc_name\norder by w_w_name\n ,sm_type\n ,cc_name\nlimit 100\n;\n\n-- end query 99 in stream 0 using template query99.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "qq+5x670q54TcqRqbA4BhA==", "id": "test-project-364309:europe-west1.query99_1665768537", "jobReference": { "jobId": "query99_1665768537", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query99_1665768537?location=europe-west1", "statistics": { "creationTime": "1665768538025", "endTime": "1665768538677", "finalExecutionDurationMs": "413", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "58545543", "performanceInsights": { "avgPreviousExecutionMs": "366" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.0391304347826087, "computeRatioMax": 0.0391304347826087, "endMs": "1665768538277", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.034782608695652174, "readRatioMax": 0.034782608695652174, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "3294", "shuffleOutputBytesSpilled": "0", "slotMs": "48", "startMs": "1665768538220", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_month_seq", "FROM date_dim", "WHERE between($11, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$10", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004347826086956522, "waitRatioMax": 0.004347826086956522, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.06086956521739131, "writeRatioMax": 0.06086956521739131 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.0391304347826087, "computeRatioMax": 0.0391304347826087, "endMs": "1665768538275", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.017391304347826087, "readRatioMax": 0.017391304347826087, "recordsRead": "6", "recordsWritten": "6", "shuffleOutputBytes": "155", "shuffleOutputBytesSpilled": "0", "slotMs": "36", "startMs": "1665768538235", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:cc_call_center_sk, $2:cc_name", "FROM call_center" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004347826086956522, "waitRatioMax": 0.004347826086956522, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.07391304347826087, "writeRatioMax": 0.07391304347826087 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.04782608695652174, "computeRatioMax": 0.04782608695652174, "endMs": "1665768538291", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.034782608695652174, "readRatioMax": 0.034782608695652174, "recordsRead": "20", "recordsWritten": "20", "shuffleOutputBytes": "430", "shuffleOutputBytesSpilled": "0", "slotMs": "29", "startMs": "1665768538259", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:sm_ship_mode_sk, $21:sm_type", "FROM ship_mode" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004347826086956522, "waitRatioMax": 0.004347826086956522, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.06956521739130435, "writeRatioMax": 0.06956521739130435 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.06086956521739131, "computeRatioMax": 0.06086956521739131, "endMs": "1665768538316", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.021739130434782608, "readRatioMax": 0.021739130434782608, "recordsRead": "5", "recordsWritten": "5", "shuffleOutputBytes": "136", "shuffleOutputBytesSpilled": "0", "slotMs": "48", "startMs": "1665768538277", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:w_warehouse_sk, $41:w_warehouse_name", "FROM warehouse" ] }, { "kind": "WRITE", "substeps": [ "$40, $41", "TO __stage03_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004347826086956522, "waitRatioMax": 0.004347826086956522, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.06956521739130435, "writeRatioMax": 0.06956521739130435 }, { "completedParallelInputs": "5", "computeMsAvg": "203", "computeMsMax": "230", "computeRatioAvg": 0.8826086956521739, "computeRatioMax": 1, "endMs": "1665768538531", "id": "5", "inputStages": [ "2", "0", "1", "3" ], "name": "S05: Join+", "parallelInputs": "5", "readMsAvg": "11", "readMsMax": "15", "readRatioAvg": 0.04782608695652174, "readRatioMax": 0.06521739130434782, "recordsRead": "1443533", "recordsWritten": "450", "shuffleOutputBytes": "41265", "shuffleOutputBytesSpilled": "0", "slotMs": "1003", "startMs": "1665768538329", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:cs_sold_date_sk, $31:cs_ship_date_sk, $32:cs_call_center_sk, $33:cs_ship_mode_sk, $34:cs_warehouse_sk", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$40, $41", "FROM __stage03_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$10", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $120 := $75, $121 := $111, $122 := $110", "$60 := SUM($74)", "$61 := SUM($73)", "$62 := SUM($72)", "$63 := SUM($71)", "$64 := SUM($70)" ] }, { "kind": "COMPUTE", "substeps": [ "$70 := case_no_value(greater(subtract($113, $112), 120), 1, 0)", "$71 := case_no_value(and(greater(subtract($113, $112), 90), less_or_equal(subtract($113, $112), 120)), 1, 0)", "$72 := case_no_value(and(greater(subtract($113, $112), 60), less_or_equal(subtract($113, $112), 90)), 1, 0)", "$73 := case_no_value(and(greater(subtract($113, $112), 30), less_or_equal(subtract($113, $112), 60)), 1, 0)", "$74 := case_no_value(less_or_equal(subtract($113, $112), 30), 1, 0)", "$75 := substr($114, 1, 20)" ] }, { "kind": "JOIN", "substeps": [ "$110 := $104, $111 := $100, $112 := $101, $113 := $102, $114 := $103", "INNER HASH JOIN EACH WITH ALL ON $102 = $10" ] }, { "kind": "JOIN", "substeps": [ "$100 := $94, $101 := $90, $102 := $91, $103 := $93, $104 := $2", "INNER HASH JOIN EACH WITH ALL ON $92 = $1" ] }, { "kind": "JOIN", "substeps": [ "$90 := $80, $91 := $81, $92 := $82, $93 := $84, $94 := $21", "INNER HASH JOIN EACH WITH ALL ON $83 = $20" ] }, { "kind": "JOIN", "substeps": [ "$80 := $30, $81 := $31, $82 := $32, $83 := $33, $84 := $41", "INNER HASH JOIN EACH WITH ALL ON $34 = $40" ] }, { "kind": "WRITE", "substeps": [ "$122, $121, $60, $61, $62, $63, $64, $120", "TO __stage05_output", "BY HASH($120, $121, $122)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004347826086956522, "waitRatioMax": 0.004347826086956522, "writeMsAvg": "6", "writeMsMax": "8", "writeRatioAvg": 0.02608695652173913, "writeRatioMax": 0.034782608695652174 }, { "completedParallelInputs": "1", "computeMsAvg": "5", "computeMsMax": "5", "computeRatioAvg": 0.021739130434782608, "computeRatioMax": 0.021739130434782608, "endMs": "1665768538548", "id": "6", "inputStages": [ "5" ], "name": "S06: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "450", "recordsWritten": "90", "shuffleOutputBytes": "8253", "shuffleOutputBytesSpilled": "0", "slotMs": "10", "startMs": "1665768538536", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$122, $121, $60, $61, $62, $63, $64, $120", "FROM __stage05_output" ] }, { "kind": "SORT", "substeps": [ "$130 ASC, $131 ASC, $132 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $130 := $120, $131 := $121, $132 := $122", "$50 := SUM($60)", "$51 := SUM($61)", "$52 := SUM($62)", "$53 := SUM($63)", "$54 := SUM($64)" ] }, { "kind": "WRITE", "substeps": [ "$140, $141, $142, $143, $144, $145, $146, $147", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004347826086956522, "waitRatioMax": 0.004347826086956522, "writeMsAvg": "1", "writeMsMax": "1", "writeRatioAvg": 0.004347826086956522, "writeRatioMax": 0.004347826086956522 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.05652173913043478, "computeRatioMax": 0.05652173913043478, "endMs": "1665768538597", "id": "7", "inputStages": [ "6" ], "name": "S07: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "90", "recordsWritten": "90", "shuffleOutputBytes": "8253", "shuffleOutputBytesSpilled": "0", "slotMs": "48", "startMs": "1665768538551", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$140, $141, $142, $143, $144, $145, $146, $147", "FROM __stage06_output" ] }, { "kind": "SORT", "substeps": [ "$147 ASC, $141 ASC, $140 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$150, $151, $152, $153, $154, $155, $156, $157", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004347826086956522, "waitRatioMax": 0.004347826086956522, "writeMsAvg": "22", "writeMsMax": "22", "writeRatioAvg": 0.09565217391304348, "writeRatioMax": 0.09565217391304348 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "ship_mode" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "call_center" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "warehouse" } ], "statementType": "SELECT", "timeline": [ { "completedUnits": "11", "elapsedMs": "520", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "1225" } ], "totalBytesBilled": "58720256", "totalBytesProcessed": "58545543", "totalPartitionsProcessed": "0", "totalSlotMs": "1225", "transferredBytes": "0" }, "startTime": "1665768538107", "totalBytesProcessed": "58545543", "totalSlotMs": "1225" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon17dfc3ba_4810_45d8_959c_81fe16e8edca" }, "priority": "INTERACTIVE", "query": "-- start query 99 in stream 0 using template query99.tpl\n\n/*\nFor catalog sales, create a report showing the counts of orders shipped \n within 30 days, \n from 31 to 60 days, \n from 61 to 90 days, \n from 91 to 120 days and \n over 120 days \nwithin a given year, grouped by warehouse, call center and shipping mode.\n*/\n\nselect \n substr(w_warehouse_name,1,20) w_w_name\n ,sm_type\n ,cc_name\n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end) as days_30 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and \n (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end ) as days_31_60 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and \n (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end) as days_61_90 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end) as days_91_120 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 120) then 1 else 0 end) as days_gt_120\nfrom\n catalog_sales\n ,warehouse\n ,ship_mode\n ,call_center\n ,date_dim\nwhere\n d_month_seq between 1200 and 1200 + 11\nand cs_ship_date_sk = d_date_sk\nand cs_warehouse_sk = w_warehouse_sk\nand cs_ship_mode_sk = sm_ship_mode_sk\nand cs_call_center_sk = cc_call_center_sk\ngroup by\n w_w_name\n ,sm_type\n ,cc_name\norder by w_w_name\n ,sm_type\n ,cc_name\nlimit 100\n;\n\n-- end query 99 in stream 0 using template query99.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "kpgh8SIDK/EIRN2FgJO5YA==", "id": "test-project-364309:europe-west1.query99_1665778912", "jobReference": { "jobId": "query99_1665778912", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query99_1665778912?location=europe-west1", "statistics": { "creationTime": "1665778912841", "endTime": "1665778913495", "finalExecutionDurationMs": "452", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "58545543", "performanceInsights": { "avgPreviousExecutionMs": "378" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.046263345195729534, "computeRatioMax": 0.046263345195729534, "endMs": "1665778913034", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.03202846975088968, "readRatioMax": 0.03202846975088968, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "3294", "shuffleOutputBytesSpilled": "0", "slotMs": "37", "startMs": "1665778912997", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_month_seq", "FROM date_dim", "WHERE between($11, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$10", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0035587188612099642, "waitRatioMax": 0.0035587188612099642, "writeMsAvg": "7", "writeMsMax": "7", "writeRatioAvg": 0.02491103202846975, "writeRatioMax": 0.02491103202846975 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.028469750889679714, "computeRatioMax": 0.028469750889679714, "endMs": "1665778913067", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.017793594306049824, "readRatioMax": 0.017793594306049824, "recordsRead": "6", "recordsWritten": "6", "shuffleOutputBytes": "155", "shuffleOutputBytesSpilled": "0", "slotMs": "43", "startMs": "1665778913023", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:cc_call_center_sk, $2:cc_name", "FROM call_center" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0035587188612099642, "waitRatioMax": 0.0035587188612099642, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.06761565836298933, "writeRatioMax": 0.06761565836298933 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.02491103202846975, "computeRatioMax": 0.02491103202846975, "endMs": "1665778913085", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.021352313167259787, "readRatioMax": 0.021352313167259787, "recordsRead": "20", "recordsWritten": "20", "shuffleOutputBytes": "430", "shuffleOutputBytesSpilled": "0", "slotMs": "39", "startMs": "1665778913042", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:sm_ship_mode_sk, $21:sm_type", "FROM ship_mode" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage02_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0071174377224199285, "waitRatioMax": 0.0071174377224199285, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.05693950177935943, "writeRatioMax": 0.05693950177935943 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.03202846975088968, "computeRatioMax": 0.03202846975088968, "endMs": "1665778913092", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.021352313167259787, "readRatioMax": 0.021352313167259787, "recordsRead": "5", "recordsWritten": "5", "shuffleOutputBytes": "136", "shuffleOutputBytesSpilled": "0", "slotMs": "33", "startMs": "1665778913059", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:w_warehouse_sk, $41:w_warehouse_name", "FROM warehouse" ] }, { "kind": "WRITE", "substeps": [ "$40, $41", "TO __stage03_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0035587188612099642, "waitRatioMax": 0.0035587188612099642, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.06405693950177936, "writeRatioMax": 0.06405693950177936 }, { "completedParallelInputs": "5", "computeMsAvg": "217", "computeMsMax": "281", "computeRatioAvg": 0.7722419928825622, "computeRatioMax": 1, "endMs": "1665778913346", "id": "5", "inputStages": [ "2", "0", "3", "1" ], "name": "S05: Join+", "parallelInputs": "5", "readMsAvg": "10", "readMsMax": "12", "readRatioAvg": 0.03558718861209965, "readRatioMax": 0.042704626334519574, "recordsRead": "1443533", "recordsWritten": "450", "shuffleOutputBytes": "41265", "shuffleOutputBytesSpilled": "0", "slotMs": "1056", "startMs": "1665778913100", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:cs_sold_date_sk, $31:cs_ship_date_sk, $32:cs_call_center_sk, $33:cs_ship_mode_sk, $34:cs_warehouse_sk", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$40, $41", "FROM __stage03_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$10", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $120 := $75, $121 := $111, $122 := $110", "$60 := SUM($74)", "$61 := SUM($73)", "$62 := SUM($72)", "$63 := SUM($71)", "$64 := SUM($70)" ] }, { "kind": "COMPUTE", "substeps": [ "$70 := case_no_value(greater(subtract($113, $112), 120), 1, 0)", "$71 := case_no_value(and(greater(subtract($113, $112), 90), less_or_equal(subtract($113, $112), 120)), 1, 0)", "$72 := case_no_value(and(greater(subtract($113, $112), 60), less_or_equal(subtract($113, $112), 90)), 1, 0)", "$73 := case_no_value(and(greater(subtract($113, $112), 30), less_or_equal(subtract($113, $112), 60)), 1, 0)", "$74 := case_no_value(less_or_equal(subtract($113, $112), 30), 1, 0)", "$75 := substr($114, 1, 20)" ] }, { "kind": "JOIN", "substeps": [ "$110 := $104, $111 := $100, $112 := $101, $113 := $102, $114 := $103", "INNER HASH JOIN EACH WITH ALL ON $102 = $10" ] }, { "kind": "JOIN", "substeps": [ "$100 := $94, $101 := $90, $102 := $91, $103 := $93, $104 := $2", "INNER HASH JOIN EACH WITH ALL ON $92 = $1" ] }, { "kind": "JOIN", "substeps": [ "$90 := $80, $91 := $81, $92 := $82, $93 := $84, $94 := $21", "INNER HASH JOIN EACH WITH ALL ON $83 = $20" ] }, { "kind": "JOIN", "substeps": [ "$80 := $30, $81 := $31, $82 := $32, $83 := $33, $84 := $41", "INNER HASH JOIN EACH WITH ALL ON $34 = $40" ] }, { "kind": "WRITE", "substeps": [ "$122, $121, $60, $61, $62, $63, $64, $120", "TO __stage05_output", "BY HASH($120, $121, $122)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0071174377224199285, "waitRatioMax": 0.0071174377224199285, "writeMsAvg": "5", "writeMsMax": "6", "writeRatioAvg": 0.017793594306049824, "writeRatioMax": 0.021352313167259787 }, { "completedParallelInputs": "1", "computeMsAvg": "6", "computeMsMax": "6", "computeRatioAvg": 0.021352313167259787, "computeRatioMax": 0.021352313167259787, "endMs": "1665778913373", "id": "6", "inputStages": [ "5" ], "name": "S06: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "450", "recordsWritten": "90", "shuffleOutputBytes": "8253", "shuffleOutputBytesSpilled": "0", "slotMs": "10", "startMs": "1665778913363", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$122, $121, $60, $61, $62, $63, $64, $120", "FROM __stage05_output" ] }, { "kind": "SORT", "substeps": [ "$130 ASC, $131 ASC, $132 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $130 := $120, $131 := $121, $132 := $122", "$50 := SUM($60)", "$51 := SUM($61)", "$52 := SUM($62)", "$53 := SUM($63)", "$54 := SUM($64)" ] }, { "kind": "WRITE", "substeps": [ "$140, $141, $142, $143, $144, $145, $146, $147", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0035587188612099642, "waitRatioMax": 0.0035587188612099642, "writeMsAvg": "1", "writeMsMax": "1", "writeRatioAvg": 0.0035587188612099642, "writeRatioMax": 0.0035587188612099642 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.0498220640569395, "computeRatioMax": 0.0498220640569395, "endMs": "1665778913415", "id": "7", "inputStages": [ "6" ], "name": "S07: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "90", "recordsWritten": "90", "shuffleOutputBytes": "8253", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665778913379", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$140, $141, $142, $143, $144, $145, $146, $147", "FROM __stage06_output" ] }, { "kind": "SORT", "substeps": [ "$147 ASC, $141 ASC, $140 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$150, $151, $152, $153, $154, $155, $156, $157", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0035587188612099642, "waitRatioMax": 0.0035587188612099642, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.05338078291814947, "writeRatioMax": 0.05338078291814947 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "ship_mode" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "call_center" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "warehouse" } ], "statementType": "SELECT", "timeline": [ { "completedUnits": "11", "elapsedMs": "543", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "1252" } ], "totalBytesBilled": "58720256", "totalBytesProcessed": "58545543", "totalPartitionsProcessed": "0", "totalSlotMs": "1252", "transferredBytes": "0" }, "startTime": "1665778912903", "totalBytesProcessed": "58545543", "totalSlotMs": "1252" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon31774647_cc73_4330_9162_b073836d8227" }, "priority": "INTERACTIVE", "query": "-- start query 99 in stream 0 using template query99.tpl\n\n/*\nFor catalog sales, create a report showing the counts of orders shipped \n within 30 days, \n from 31 to 60 days, \n from 61 to 90 days, \n from 91 to 120 days and \n over 120 days \nwithin a given year, grouped by warehouse, call center and shipping mode.\n*/\n\nselect \n substr(w_warehouse_name,1,20) w_w_name\n ,sm_type\n ,cc_name\n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end) as days_30 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and \n (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end ) as days_31_60 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and \n (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end) as days_61_90 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end) as days_91_120 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 120) then 1 else 0 end) as days_gt_120\nfrom\n catalog_sales\n ,warehouse\n ,ship_mode\n ,call_center\n ,date_dim\nwhere\n d_month_seq between 1200 and 1200 + 11\nand cs_ship_date_sk = d_date_sk\nand cs_warehouse_sk = w_warehouse_sk\nand cs_ship_mode_sk = sm_ship_mode_sk\nand cs_call_center_sk = cc_call_center_sk\ngroup by\n w_w_name\n ,sm_type\n ,cc_name\norder by w_w_name\n ,sm_type\n ,cc_name\nlimit 100\n;\n\n-- end query 99 in stream 0 using template query99.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "MlBxvwupUU+xSuvQcVva/g==", "id": "test-project-364309:europe-west1.query99_1665778914", "jobReference": { "jobId": "query99_1665778914", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query99_1665778914?location=europe-west1", "statistics": { "creationTime": "1665778915124", "endTime": "1665778915713", "finalExecutionDurationMs": "357", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "58545543", "performanceInsights": { "avgPreviousExecutionMs": "393" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "17", "computeMsMax": "17", "computeRatioAvg": 0.09497206703910614, "computeRatioMax": 0.09497206703910614, "endMs": "1665778915343", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "11", "readMsMax": "11", "readRatioAvg": 0.061452513966480445, "readRatioMax": 0.061452513966480445, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "3294", "shuffleOutputBytesSpilled": "0", "slotMs": "47", "startMs": "1665778915297", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_month_seq", "FROM date_dim", "WHERE between($11, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$10", "TO __stage00_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0111731843575419, "waitRatioMax": 0.0111731843575419, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.0446927374301676, "writeRatioMax": 0.0446927374301676 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.05027932960893855, "computeRatioMax": 0.05027932960893855, "endMs": "1665778915351", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.0223463687150838, "readRatioMax": 0.0223463687150838, "recordsRead": "6", "recordsWritten": "6", "shuffleOutputBytes": "155", "shuffleOutputBytesSpilled": "0", "slotMs": "28", "startMs": "1665778915313", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:cc_call_center_sk, $2:cc_name", "FROM call_center" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage01_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0111731843575419, "waitRatioMax": 0.0111731843575419, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.09497206703910614, "writeRatioMax": 0.09497206703910614 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.0446927374301676, "computeRatioMax": 0.0446927374301676, "endMs": "1665778915372", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.027932960893854747, "readRatioMax": 0.027932960893854747, "recordsRead": "20", "recordsWritten": "20", "shuffleOutputBytes": "430", "shuffleOutputBytesSpilled": "0", "slotMs": "38", "startMs": "1665778915330", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:sm_ship_mode_sk, $21:sm_type", "FROM ship_mode" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage02_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0111731843575419, "waitRatioMax": 0.0111731843575419, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.1005586592178771, "writeRatioMax": 0.1005586592178771 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.0670391061452514, "computeRatioMax": 0.0670391061452514, "endMs": "1665778915390", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.0335195530726257, "readRatioMax": 0.0335195530726257, "recordsRead": "5", "recordsWritten": "5", "shuffleOutputBytes": "136", "shuffleOutputBytesSpilled": "0", "slotMs": "37", "startMs": "1665778915348", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:w_warehouse_sk, $41:w_warehouse_name", "FROM warehouse" ] }, { "kind": "WRITE", "substeps": [ "$40, $41", "TO __stage03_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0111731843575419, "waitRatioMax": 0.0111731843575419, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.09497206703910614, "writeRatioMax": 0.09497206703910614 }, { "completedParallelInputs": "5", "computeMsAvg": "159", "computeMsMax": "179", "computeRatioAvg": 0.888268156424581, "computeRatioMax": 1, "endMs": "1665778915541", "id": "5", "inputStages": [ "0", "1", "2", "3" ], "name": "S05: Join+", "parallelInputs": "5", "readMsAvg": "10", "readMsMax": "13", "readRatioAvg": 0.055865921787709494, "readRatioMax": 0.07262569832402235, "recordsRead": "1443533", "recordsWritten": "450", "shuffleOutputBytes": "41265", "shuffleOutputBytesSpilled": "0", "slotMs": "776", "startMs": "1665778915406", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:cs_sold_date_sk, $31:cs_ship_date_sk, $32:cs_call_center_sk, $33:cs_ship_mode_sk, $34:cs_warehouse_sk", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$40, $41", "FROM __stage03_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$10", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $120 := $75, $121 := $111, $122 := $110", "$60 := SUM($74)", "$61 := SUM($73)", "$62 := SUM($72)", "$63 := SUM($71)", "$64 := SUM($70)" ] }, { "kind": "COMPUTE", "substeps": [ "$70 := case_no_value(greater(subtract($113, $112), 120), 1, 0)", "$71 := case_no_value(and(greater(subtract($113, $112), 90), less_or_equal(subtract($113, $112), 120)), 1, 0)", "$72 := case_no_value(and(greater(subtract($113, $112), 60), less_or_equal(subtract($113, $112), 90)), 1, 0)", "$73 := case_no_value(and(greater(subtract($113, $112), 30), less_or_equal(subtract($113, $112), 60)), 1, 0)", "$74 := case_no_value(less_or_equal(subtract($113, $112), 30), 1, 0)", "$75 := substr($114, 1, 20)" ] }, { "kind": "JOIN", "substeps": [ "$110 := $104, $111 := $100, $112 := $101, $113 := $102, $114 := $103", "INNER HASH JOIN EACH WITH ALL ON $102 = $10" ] }, { "kind": "JOIN", "substeps": [ "$100 := $94, $101 := $90, $102 := $91, $103 := $93, $104 := $2", "INNER HASH JOIN EACH WITH ALL ON $92 = $1" ] }, { "kind": "JOIN", "substeps": [ "$90 := $80, $91 := $81, $92 := $82, $93 := $84, $94 := $21", "INNER HASH JOIN EACH WITH ALL ON $83 = $20" ] }, { "kind": "JOIN", "substeps": [ "$80 := $30, $81 := $31, $82 := $32, $83 := $33, $84 := $41", "INNER HASH JOIN EACH WITH ALL ON $34 = $40" ] }, { "kind": "WRITE", "substeps": [ "$122, $121, $60, $61, $62, $63, $64, $120", "TO __stage05_output", "BY HASH($120, $121, $122)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0111731843575419, "waitRatioMax": 0.0111731843575419, "writeMsAvg": "5", "writeMsMax": "7", "writeRatioAvg": 0.027932960893854747, "writeRatioMax": 0.03910614525139665 }, { "completedParallelInputs": "1", "computeMsAvg": "5", "computeMsMax": "5", "computeRatioAvg": 0.027932960893854747, "computeRatioMax": 0.027932960893854747, "endMs": "1665778915563", "id": "6", "inputStages": [ "5" ], "name": "S06: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "450", "recordsWritten": "90", "shuffleOutputBytes": "8253", "shuffleOutputBytesSpilled": "0", "slotMs": "10", "startMs": "1665778915553", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$122, $121, $60, $61, $62, $63, $64, $120", "FROM __stage05_output" ] }, { "kind": "SORT", "substeps": [ "$130 ASC, $131 ASC, $132 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $130 := $120, $131 := $121, $132 := $122", "$50 := SUM($60)", "$51 := SUM($61)", "$52 := SUM($62)", "$53 := SUM($63)", "$54 := SUM($64)" ] }, { "kind": "WRITE", "substeps": [ "$140, $141, $142, $143, $144, $145, $146, $147", "TO __stage06_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0111731843575419, "waitRatioMax": 0.0111731843575419, "writeMsAvg": "1", "writeMsMax": "1", "writeRatioAvg": 0.00558659217877095, "writeRatioMax": 0.00558659217877095 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.0782122905027933, "computeRatioMax": 0.0782122905027933, "endMs": "1665778915608", "id": "7", "inputStages": [ "6" ], "name": "S07: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "90", "recordsWritten": "90", "shuffleOutputBytes": "8253", "shuffleOutputBytesSpilled": "0", "slotMs": "42", "startMs": "1665778915569", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$140, $141, $142, $143, $144, $145, $146, $147", "FROM __stage06_output" ] }, { "kind": "SORT", "substeps": [ "$147 ASC, $141 ASC, $140 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$150, $151, $152, $153, $154, $155, $156, $157", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00558659217877095, "waitRatioMax": 0.00558659217877095, "writeMsAvg": "28", "writeMsMax": "28", "writeRatioAvg": 0.1564245810055866, "writeRatioMax": 0.1564245810055866 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "ship_mode" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "call_center" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "warehouse" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" } ], "statementType": "SELECT", "timeline": [ { "completedUnits": "11", "elapsedMs": "474", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "998" } ], "totalBytesBilled": "58720256", "totalBytesProcessed": "58545543", "totalPartitionsProcessed": "0", "totalSlotMs": "998", "transferredBytes": "0" }, "startTime": "1665778915185", "totalBytesProcessed": "58545543", "totalSlotMs": "998" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon68c52ac6_8d1e_4c95_9907_81689957096c" }, "priority": "INTERACTIVE", "query": "-- start query 99 in stream 0 using template query99.tpl\n\n/*\nFor catalog sales, create a report showing the counts of orders shipped \n within 30 days, \n from 31 to 60 days, \n from 61 to 90 days, \n from 91 to 120 days and \n over 120 days \nwithin a given year, grouped by warehouse, call center and shipping mode.\n*/\n\nselect \n substr(w_warehouse_name,1,20) w_w_name\n ,sm_type\n ,cc_name\n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end) as days_30 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and \n (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end ) as days_31_60 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and \n (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end) as days_61_90 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end) as days_91_120 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 120) then 1 else 0 end) as days_gt_120\nfrom\n catalog_sales\n ,warehouse\n ,ship_mode\n ,call_center\n ,date_dim\nwhere\n d_month_seq between 1200 and 1200 + 11\nand cs_ship_date_sk = d_date_sk\nand cs_warehouse_sk = w_warehouse_sk\nand cs_ship_mode_sk = sm_ship_mode_sk\nand cs_call_center_sk = cc_call_center_sk\ngroup by\n w_w_name\n ,sm_type\n ,cc_name\norder by w_w_name\n ,sm_type\n ,cc_name\nlimit 100\n;\n\n-- end query 99 in stream 0 using template query99.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "ZbVHztsvcJJQY82gogsPMw==", "id": "test-project-364309:europe-west1.query99_1665778916", "jobReference": { "jobId": "query99_1665778916", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query99_1665778916?location=europe-west1", "statistics": { "creationTime": "1665778917322", "endTime": "1665778917867", "finalExecutionDurationMs": "341", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "58545543", "performanceInsights": { "avgPreviousExecutionMs": "387" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.04484304932735426, "computeRatioMax": 0.04484304932735426, "endMs": "1665778917509", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.03139013452914798, "readRatioMax": 0.03139013452914798, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "3294", "shuffleOutputBytesSpilled": "0", "slotMs": "35", "startMs": "1665778917473", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_month_seq", "FROM date_dim", "WHERE between($11, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$10", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004484304932735426, "waitRatioMax": 0.004484304932735426, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.03587443946188341, "writeRatioMax": 0.03587443946188341 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.03139013452914798, "computeRatioMax": 0.03139013452914798, "endMs": "1665778917527", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.017937219730941704, "readRatioMax": 0.017937219730941704, "recordsRead": "6", "recordsWritten": "6", "shuffleOutputBytes": "155", "shuffleOutputBytesSpilled": "0", "slotMs": "42", "startMs": "1665778917487", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:cc_call_center_sk, $2:cc_name", "FROM call_center" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004484304932735426, "waitRatioMax": 0.004484304932735426, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.07174887892376682, "writeRatioMax": 0.07174887892376682 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.04035874439461883, "computeRatioMax": 0.04035874439461883, "endMs": "1665778917537", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.026905829596412557, "readRatioMax": 0.026905829596412557, "recordsRead": "20", "recordsWritten": "20", "shuffleOutputBytes": "430", "shuffleOutputBytesSpilled": "0", "slotMs": "39", "startMs": "1665778917499", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:sm_ship_mode_sk, $21:sm_type", "FROM ship_mode" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004484304932735426, "waitRatioMax": 0.004484304932735426, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.06726457399103139, "writeRatioMax": 0.06726457399103139 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.04035874439461883, "computeRatioMax": 0.04035874439461883, "endMs": "1665778917557", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.02242152466367713, "readRatioMax": 0.02242152466367713, "recordsRead": "5", "recordsWritten": "5", "shuffleOutputBytes": "136", "shuffleOutputBytesSpilled": "0", "slotMs": "45", "startMs": "1665778917514", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:w_warehouse_sk, $41:w_warehouse_name", "FROM warehouse" ] }, { "kind": "WRITE", "substeps": [ "$40, $41", "TO __stage03_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.008968609865470852, "waitRatioMax": 0.008968609865470852, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.07623318385650224, "writeRatioMax": 0.07623318385650224 }, { "completedParallelInputs": "5", "computeMsAvg": "189", "computeMsMax": "223", "computeRatioAvg": 0.8475336322869955, "computeRatioMax": 1, "endMs": "1665778917716", "id": "5", "inputStages": [ "2", "1", "3", "0" ], "name": "S05: Join+", "parallelInputs": "5", "readMsAvg": "11", "readMsMax": "16", "readRatioAvg": 0.04932735426008968, "readRatioMax": 0.07174887892376682, "recordsRead": "1443533", "recordsWritten": "450", "shuffleOutputBytes": "41265", "shuffleOutputBytesSpilled": "0", "slotMs": "877", "startMs": "1665778917567", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:cs_sold_date_sk, $31:cs_ship_date_sk, $32:cs_call_center_sk, $33:cs_ship_mode_sk, $34:cs_warehouse_sk", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$40, $41", "FROM __stage03_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$10", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $120 := $75, $121 := $111, $122 := $110", "$60 := SUM($74)", "$61 := SUM($73)", "$62 := SUM($72)", "$63 := SUM($71)", "$64 := SUM($70)" ] }, { "kind": "COMPUTE", "substeps": [ "$70 := case_no_value(greater(subtract($113, $112), 120), 1, 0)", "$71 := case_no_value(and(greater(subtract($113, $112), 90), less_or_equal(subtract($113, $112), 120)), 1, 0)", "$72 := case_no_value(and(greater(subtract($113, $112), 60), less_or_equal(subtract($113, $112), 90)), 1, 0)", "$73 := case_no_value(and(greater(subtract($113, $112), 30), less_or_equal(subtract($113, $112), 60)), 1, 0)", "$74 := case_no_value(less_or_equal(subtract($113, $112), 30), 1, 0)", "$75 := substr($114, 1, 20)" ] }, { "kind": "JOIN", "substeps": [ "$110 := $104, $111 := $100, $112 := $101, $113 := $102, $114 := $103", "INNER HASH JOIN EACH WITH ALL ON $102 = $10" ] }, { "kind": "JOIN", "substeps": [ "$100 := $94, $101 := $90, $102 := $91, $103 := $93, $104 := $2", "INNER HASH JOIN EACH WITH ALL ON $92 = $1" ] }, { "kind": "JOIN", "substeps": [ "$90 := $80, $91 := $81, $92 := $82, $93 := $84, $94 := $21", "INNER HASH JOIN EACH WITH ALL ON $83 = $20" ] }, { "kind": "JOIN", "substeps": [ "$80 := $30, $81 := $31, $82 := $32, $83 := $33, $84 := $41", "INNER HASH JOIN EACH WITH ALL ON $34 = $40" ] }, { "kind": "WRITE", "substeps": [ "$122, $121, $60, $61, $62, $63, $64, $120", "TO __stage05_output", "BY HASH($120, $121, $122)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004484304932735426, "waitRatioMax": 0.004484304932735426, "writeMsAvg": "5", "writeMsMax": "6", "writeRatioAvg": 0.02242152466367713, "writeRatioMax": 0.026905829596412557 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.03139013452914798, "computeRatioMax": 0.03139013452914798, "endMs": "1665778917730", "id": "6", "inputStages": [ "5" ], "name": "S06: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "450", "recordsWritten": "90", "shuffleOutputBytes": "8253", "shuffleOutputBytesSpilled": "0", "slotMs": "8", "startMs": "1665778917721", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$122, $121, $60, $61, $62, $63, $64, $120", "FROM __stage05_output" ] }, { "kind": "SORT", "substeps": [ "$130 ASC, $131 ASC, $132 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $130 := $120, $131 := $121, $132 := $122", "$50 := SUM($60)", "$51 := SUM($61)", "$52 := SUM($62)", "$53 := SUM($63)", "$54 := SUM($64)" ] }, { "kind": "WRITE", "substeps": [ "$140, $141, $142, $143, $144, $145, $146, $147", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004484304932735426, "waitRatioMax": 0.004484304932735426, "writeMsAvg": "0", "writeMsMax": "0", "writeRatioAvg": 0, "writeRatioMax": 0 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.053811659192825115, "computeRatioMax": 0.053811659192825115, "endMs": "1665778917774", "id": "7", "inputStages": [ "6" ], "name": "S07: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "90", "recordsWritten": "90", "shuffleOutputBytes": "8253", "shuffleOutputBytesSpilled": "0", "slotMs": "28", "startMs": "1665778917738", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$140, $141, $142, $143, $144, $145, $146, $147", "FROM __stage06_output" ] }, { "kind": "SORT", "substeps": [ "$147 ASC, $141 ASC, $140 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$150, $151, $152, $153, $154, $155, $156, $157", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004484304932735426, "waitRatioMax": 0.004484304932735426, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.06278026905829596, "writeRatioMax": 0.06278026905829596 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "warehouse" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "ship_mode" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "call_center" } ], "statementType": "SELECT", "timeline": [ { "completedUnits": "11", "elapsedMs": "451", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "1077" } ], "totalBytesBilled": "58720256", "totalBytesProcessed": "58545543", "totalPartitionsProcessed": "0", "totalSlotMs": "1077", "transferredBytes": "0" }, "startTime": "1665778917371", "totalBytesProcessed": "58545543", "totalSlotMs": "1077" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anonb91473b2_79ce_41fe_8f36_27f0dbb924b9" }, "priority": "INTERACTIVE", "query": "-- start query 99 in stream 0 using template query99.tpl\n\n/*\nFor catalog sales, create a report showing the counts of orders shipped \n within 30 days, \n from 31 to 60 days, \n from 61 to 90 days, \n from 91 to 120 days and \n over 120 days \nwithin a given year, grouped by warehouse, call center and shipping mode.\n*/\n\nselect \n substr(w_warehouse_name,1,20) w_w_name\n ,sm_type\n ,cc_name\n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end) as days_30 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and \n (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end ) as days_31_60 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and \n (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end) as days_61_90 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end) as days_91_120 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 120) then 1 else 0 end) as days_gt_120\nfrom\n catalog_sales\n ,warehouse\n ,ship_mode\n ,call_center\n ,date_dim\nwhere\n d_month_seq between 1200 and 1200 + 11\nand cs_ship_date_sk = d_date_sk\nand cs_warehouse_sk = w_warehouse_sk\nand cs_ship_mode_sk = sm_ship_mode_sk\nand cs_call_center_sk = cc_call_center_sk\ngroup by\n w_w_name\n ,sm_type\n ,cc_name\norder by w_w_name\n ,sm_type\n ,cc_name\nlimit 100\n;\n\n-- end query 99 in stream 0 using template query99.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "xZAvr/XWlmPVaaj1NleL7Q==", "id": "test-project-364309:europe-west1.query99_1665778919", "jobReference": { "jobId": "query99_1665778919", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query99_1665778919?location=europe-west1", "statistics": { "creationTime": "1665778920172", "endTime": "1665778920823", "finalExecutionDurationMs": "432", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "58545543", "performanceInsights": { "avgPreviousExecutionMs": "380" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.059907834101382486, "computeRatioMax": 0.059907834101382486, "endMs": "1665778920501", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.02304147465437788, "readRatioMax": 0.02304147465437788, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "3294", "shuffleOutputBytesSpilled": "0", "slotMs": "155", "startMs": "1665778920335", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_month_seq", "FROM date_dim", "WHERE between($11, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$10", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004608294930875576, "waitRatioMax": 0.004608294930875576, "writeMsAvg": "154", "writeMsMax": "154", "writeRatioAvg": 0.7096774193548387, "writeRatioMax": 0.7096774193548387 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.055299539170506916, "computeRatioMax": 0.055299539170506916, "endMs": "1665778920392", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.03686635944700461, "readRatioMax": 0.03686635944700461, "recordsRead": "6", "recordsWritten": "6", "shuffleOutputBytes": "155", "shuffleOutputBytesSpilled": "0", "slotMs": "38", "startMs": "1665778920350", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:cc_call_center_sk, $2:cc_name", "FROM call_center" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004608294930875576, "waitRatioMax": 0.004608294930875576, "writeMsAvg": "9", "writeMsMax": "9", "writeRatioAvg": 0.041474654377880185, "writeRatioMax": 0.041474654377880185 }, { "completedParallelInputs": "1", "computeMsAvg": "17", "computeMsMax": "17", "computeRatioAvg": 0.07834101382488479, "computeRatioMax": 0.07834101382488479, "endMs": "1665778920413", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "11", "readMsMax": "11", "readRatioAvg": 0.05069124423963134, "readRatioMax": 0.05069124423963134, "recordsRead": "20", "recordsWritten": "20", "shuffleOutputBytes": "430", "shuffleOutputBytesSpilled": "0", "slotMs": "45", "startMs": "1665778920365", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:sm_ship_mode_sk, $21:sm_type", "FROM ship_mode" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage02_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.009216589861751152, "waitRatioMax": 0.009216589861751152, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.06451612903225806, "writeRatioMax": 0.06451612903225806 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.041474654377880185, "computeRatioMax": 0.041474654377880185, "endMs": "1665778920422", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.018433179723502304, "readRatioMax": 0.018433179723502304, "recordsRead": "5", "recordsWritten": "5", "shuffleOutputBytes": "136", "shuffleOutputBytesSpilled": "0", "slotMs": "42", "startMs": "1665778920380", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:w_warehouse_sk, $41:w_warehouse_name", "FROM warehouse" ] }, { "kind": "WRITE", "substeps": [ "$40, $41", "TO __stage03_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.009216589861751152, "waitRatioMax": 0.009216589861751152, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.08294930875576037, "writeRatioMax": 0.08294930875576037 }, { "completedParallelInputs": "5", "computeMsAvg": "200", "computeMsMax": "217", "computeRatioAvg": 0.9216589861751152, "computeRatioMax": 1, "endMs": "1665778920659", "id": "6", "inputStages": [ "3", "0", "2", "1" ], "name": "S06: Join+", "parallelInputs": "5", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.041474654377880185, "readRatioMax": 0.041474654377880185, "recordsRead": "1443533", "recordsWritten": "450", "shuffleOutputBytes": "41265", "shuffleOutputBytesSpilled": "0", "slotMs": "868", "startMs": "1665778920518", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:cs_sold_date_sk, $31:cs_ship_date_sk, $32:cs_call_center_sk, $33:cs_ship_mode_sk, $34:cs_warehouse_sk", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$40, $41", "FROM __stage03_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$10", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $120 := $75, $121 := $111, $122 := $110", "$60 := SUM($74)", "$61 := SUM($73)", "$62 := SUM($72)", "$63 := SUM($71)", "$64 := SUM($70)" ] }, { "kind": "COMPUTE", "substeps": [ "$70 := case_no_value(greater(subtract($113, $112), 120), 1, 0)", "$71 := case_no_value(and(greater(subtract($113, $112), 90), less_or_equal(subtract($113, $112), 120)), 1, 0)", "$72 := case_no_value(and(greater(subtract($113, $112), 60), less_or_equal(subtract($113, $112), 90)), 1, 0)", "$73 := case_no_value(and(greater(subtract($113, $112), 30), less_or_equal(subtract($113, $112), 60)), 1, 0)", "$74 := case_no_value(less_or_equal(subtract($113, $112), 30), 1, 0)", "$75 := substr($114, 1, 20)" ] }, { "kind": "JOIN", "substeps": [ "$110 := $104, $111 := $100, $112 := $101, $113 := $102, $114 := $103", "INNER HASH JOIN EACH WITH ALL ON $102 = $10" ] }, { "kind": "JOIN", "substeps": [ "$100 := $94, $101 := $90, $102 := $91, $103 := $93, $104 := $2", "INNER HASH JOIN EACH WITH ALL ON $92 = $1" ] }, { "kind": "JOIN", "substeps": [ "$90 := $80, $91 := $81, $92 := $82, $93 := $84, $94 := $21", "INNER HASH JOIN EACH WITH ALL ON $83 = $20" ] }, { "kind": "JOIN", "substeps": [ "$80 := $30, $81 := $31, $82 := $32, $83 := $33, $84 := $41", "INNER HASH JOIN EACH WITH ALL ON $34 = $40" ] }, { "kind": "WRITE", "substeps": [ "$122, $121, $60, $61, $62, $63, $64, $120", "TO __stage06_output", "BY HASH($120, $121, $122)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004608294930875576, "waitRatioMax": 0.004608294930875576, "writeMsAvg": "4", "writeMsMax": "4", "writeRatioAvg": 0.018433179723502304, "writeRatioMax": 0.018433179723502304 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.03225806451612903, "computeRatioMax": 0.03225806451612903, "endMs": "1665778920685", "id": "7", "inputStages": [ "6" ], "name": "S07: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "450", "recordsWritten": "90", "shuffleOutputBytes": "8253", "shuffleOutputBytesSpilled": "0", "slotMs": "12", "startMs": "1665778920673", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$122, $121, $60, $61, $62, $63, $64, $120", "FROM __stage06_output" ] }, { "kind": "SORT", "substeps": [ "$130 ASC, $131 ASC, $132 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $130 := $120, $131 := $121, $132 := $122", "$50 := SUM($60)", "$51 := SUM($61)", "$52 := SUM($62)", "$53 := SUM($63)", "$54 := SUM($64)" ] }, { "kind": "WRITE", "substeps": [ "$140, $141, $142, $143, $144, $145, $146, $147", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004608294930875576, "waitRatioMax": 0.004608294930875576, "writeMsAvg": "1", "writeMsMax": "1", "writeRatioAvg": 0.004608294930875576, "writeRatioMax": 0.004608294930875576 }, { "completedParallelInputs": "1", "computeMsAvg": "19", "computeMsMax": "19", "computeRatioAvg": 0.08755760368663594, "computeRatioMax": 0.08755760368663594, "endMs": "1665778920732", "id": "8", "inputStages": [ "7" ], "name": "S08: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "90", "recordsWritten": "90", "shuffleOutputBytes": "8253", "shuffleOutputBytesSpilled": "0", "slotMs": "49", "startMs": "1665778920688", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$140, $141, $142, $143, $144, $145, $146, $147", "FROM __stage07_output" ] }, { "kind": "SORT", "substeps": [ "$147 ASC, $141 ASC, $140 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$150, $151, $152, $153, $154, $155, $156, $157", "TO __stage08_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.004608294930875576, "waitRatioMax": 0.004608294930875576, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.06912442396313365, "writeRatioMax": 0.06912442396313365 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "warehouse" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "ship_mode" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "call_center" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" } ], "statementType": "SELECT", "timeline": [ { "completedUnits": "11", "elapsedMs": "533", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "1244" } ], "totalBytesBilled": "58720256", "totalBytesProcessed": "58545543", "totalPartitionsProcessed": "0", "totalSlotMs": "1244", "transferredBytes": "0" }, "startTime": "1665778920236", "totalBytesProcessed": "58545543", "totalSlotMs": "1244" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon0bdafc7a_b95b_454c_b2c5_fd7a383dd5e1" }, "priority": "INTERACTIVE", "query": "-- start query 99 in stream 0 using template query99.tpl\n\n/*\nFor catalog sales, create a report showing the counts of orders shipped \n within 30 days, \n from 31 to 60 days, \n from 61 to 90 days, \n from 91 to 120 days and \n over 120 days \nwithin a given year, grouped by warehouse, call center and shipping mode.\n*/\n\nselect \n substr(w_warehouse_name,1,20) w_w_name\n ,sm_type\n ,cc_name\n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end) as days_30 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and \n (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end ) as days_31_60 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and \n (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end) as days_61_90 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and\n (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end) as days_91_120 \n ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 120) then 1 else 0 end) as days_gt_120\nfrom\n catalog_sales\n ,warehouse\n ,ship_mode\n ,call_center\n ,date_dim\nwhere\n d_month_seq between 1200 and 1200 + 11\nand cs_ship_date_sk = d_date_sk\nand cs_warehouse_sk = w_warehouse_sk\nand cs_ship_mode_sk = sm_ship_mode_sk\nand cs_call_center_sk = cc_call_center_sk\ngroup by\n w_w_name\n ,sm_type\n ,cc_name\norder by w_w_name\n ,sm_type\n ,cc_name\nlimit 100\n;\n\n-- end query 99 in stream 0 using template query99.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "Kwr/Jk5JTYJziTHh+Gm/HA==", "id": "test-project-364309:europe-west1.query99_1665778922", "jobReference": { "jobId": "query99_1665778922", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query99_1665778922?location=europe-west1", "statistics": { "creationTime": "1665778922861", "endTime": "1665778923553", "finalExecutionDurationMs": "464", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "58545543", "performanceInsights": { "avgPreviousExecutionMs": "387" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "15", "computeMsMax": "15", "computeRatioAvg": 0.05263157894736842, "computeRatioMax": 0.05263157894736842, "endMs": "1665778923057", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.028070175438596492, "readRatioMax": 0.028070175438596492, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "3294", "shuffleOutputBytesSpilled": "0", "slotMs": "39", "startMs": "1665778923025", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_month_seq", "FROM date_dim", "WHERE between($11, 1200, 1211)" ] }, { "kind": "WRITE", "substeps": [ "$10", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0035087719298245615, "waitRatioMax": 0.0035087719298245615, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.05263157894736842, "writeRatioMax": 0.05263157894736842 }, { "completedParallelInputs": "1", "computeMsAvg": "15", "computeMsMax": "15", "computeRatioAvg": 0.05263157894736842, "computeRatioMax": 0.05263157894736842, "endMs": "1665778923091", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.02456140350877193, "readRatioMax": 0.02456140350877193, "recordsRead": "6", "recordsWritten": "6", "shuffleOutputBytes": "155", "shuffleOutputBytesSpilled": "0", "slotMs": "57", "startMs": "1665778923040", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:cc_call_center_sk, $2:cc_name", "FROM call_center" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0035087719298245615, "waitRatioMax": 0.0035087719298245615, "writeMsAvg": "21", "writeMsMax": "21", "writeRatioAvg": 0.07368421052631578, "writeRatioMax": 0.07368421052631578 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.042105263157894736, "computeRatioMax": 0.042105263157894736, "endMs": "1665778923085", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "13", "readMsMax": "13", "readRatioAvg": 0.0456140350877193, "readRatioMax": 0.0456140350877193, "recordsRead": "20", "recordsWritten": "20", "shuffleOutputBytes": "430", "shuffleOutputBytesSpilled": "0", "slotMs": "34", "startMs": "1665778923056", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:sm_ship_mode_sk, $21:sm_type", "FROM ship_mode" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0035087719298245615, "waitRatioMax": 0.0035087719298245615, "writeMsAvg": "7", "writeMsMax": "7", "writeRatioAvg": 0.02456140350877193, "writeRatioMax": 0.02456140350877193 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.03859649122807018, "computeRatioMax": 0.03859649122807018, "endMs": "1665778923113", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.017543859649122806, "readRatioMax": 0.017543859649122806, "recordsRead": "5", "recordsWritten": "5", "shuffleOutputBytes": "136", "shuffleOutputBytesSpilled": "0", "slotMs": "38", "startMs": "1665778923071", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:w_warehouse_sk, $41:w_warehouse_name", "FROM warehouse" ] }, { "kind": "WRITE", "substeps": [ "$40, $41", "TO __stage03_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0035087719298245615, "waitRatioMax": 0.0035087719298245615, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.04912280701754386, "writeRatioMax": 0.04912280701754386 }, { "completedParallelInputs": "5", "computeMsAvg": "213", "computeMsMax": "285", "computeRatioAvg": 0.7473684210526316, "computeRatioMax": 1, "endMs": "1665778923383", "id": "5", "inputStages": [ "2", "1", "3", "0" ], "name": "S05: Join+", "parallelInputs": "5", "readMsAvg": "16", "readMsMax": "27", "readRatioAvg": 0.056140350877192984, "readRatioMax": 0.09473684210526316, "recordsRead": "1443533", "recordsWritten": "450", "shuffleOutputBytes": "41265", "shuffleOutputBytesSpilled": "0", "slotMs": "1152", "startMs": "1665778923123", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:cs_sold_date_sk, $31:cs_ship_date_sk, $32:cs_call_center_sk, $33:cs_ship_mode_sk, $34:cs_warehouse_sk", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$40, $41", "FROM __stage03_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$10", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $120 := $75, $121 := $111, $122 := $110", "$60 := SUM($74)", "$61 := SUM($73)", "$62 := SUM($72)", "$63 := SUM($71)", "$64 := SUM($70)" ] }, { "kind": "COMPUTE", "substeps": [ "$70 := case_no_value(greater(subtract($113, $112), 120), 1, 0)", "$71 := case_no_value(and(greater(subtract($113, $112), 90), less_or_equal(subtract($113, $112), 120)), 1, 0)", "$72 := case_no_value(and(greater(subtract($113, $112), 60), less_or_equal(subtract($113, $112), 90)), 1, 0)", "$73 := case_no_value(and(greater(subtract($113, $112), 30), less_or_equal(subtract($113, $112), 60)), 1, 0)", "$74 := case_no_value(less_or_equal(subtract($113, $112), 30), 1, 0)", "$75 := substr($114, 1, 20)" ] }, { "kind": "JOIN", "substeps": [ "$110 := $104, $111 := $100, $112 := $101, $113 := $102, $114 := $103", "INNER HASH JOIN EACH WITH ALL ON $102 = $10" ] }, { "kind": "JOIN", "substeps": [ "$100 := $94, $101 := $90, $102 := $91, $103 := $93, $104 := $2", "INNER HASH JOIN EACH WITH ALL ON $92 = $1" ] }, { "kind": "JOIN", "substeps": [ "$90 := $80, $91 := $81, $92 := $82, $93 := $84, $94 := $21", "INNER HASH JOIN EACH WITH ALL ON $83 = $20" ] }, { "kind": "JOIN", "substeps": [ "$80 := $30, $81 := $31, $82 := $32, $83 := $33, $84 := $41", "INNER HASH JOIN EACH WITH ALL ON $34 = $40" ] }, { "kind": "WRITE", "substeps": [ "$122, $121, $60, $61, $62, $63, $64, $120", "TO __stage05_output", "BY HASH($120, $121, $122)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0035087719298245615, "waitRatioMax": 0.0035087719298245615, "writeMsAvg": "11", "writeMsMax": "32", "writeRatioAvg": 0.03859649122807018, "writeRatioMax": 0.11228070175438597 }, { "completedParallelInputs": "1", "computeMsAvg": "5", "computeMsMax": "5", "computeRatioAvg": 0.017543859649122806, "computeRatioMax": 0.017543859649122806, "endMs": "1665778923398", "id": "6", "inputStages": [ "5" ], "name": "S06: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "450", "recordsWritten": "90", "shuffleOutputBytes": "8253", "shuffleOutputBytesSpilled": "0", "slotMs": "6", "startMs": "1665778923391", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$122, $121, $60, $61, $62, $63, $64, $120", "FROM __stage05_output" ] }, { "kind": "SORT", "substeps": [ "$130 ASC, $131 ASC, $132 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $130 := $120, $131 := $121, $132 := $122", "$50 := SUM($60)", "$51 := SUM($61)", "$52 := SUM($62)", "$53 := SUM($63)", "$54 := SUM($64)" ] }, { "kind": "WRITE", "substeps": [ "$140, $141, $142, $143, $144, $145, $146, $147", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0035087719298245615, "waitRatioMax": 0.0035087719298245615, "writeMsAvg": "0", "writeMsMax": "0", "writeRatioAvg": 0, "writeRatioMax": 0 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.03508771929824561, "computeRatioMax": 0.03508771929824561, "endMs": "1665778923443", "id": "7", "inputStages": [ "6" ], "name": "S07: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "90", "recordsWritten": "90", "shuffleOutputBytes": "8253", "shuffleOutputBytesSpilled": "0", "slotMs": "36", "startMs": "1665778923407", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$140, $141, $142, $143, $144, $145, $146, $147", "FROM __stage06_output" ] }, { "kind": "SORT", "substeps": [ "$147 ASC, $141 ASC, $140 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$150, $151, $152, $153, $154, $155, $156, $157", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0035087719298245615, "waitRatioMax": 0.0035087719298245615, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.05263157894736842, "writeRatioMax": 0.05263157894736842 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "ship_mode" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "call_center" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "warehouse" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" } ], "statementType": "SELECT", "timeline": [ { "completedUnits": "11", "elapsedMs": "574", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "1398" } ], "totalBytesBilled": "58720256", "totalBytesProcessed": "58545543", "totalPartitionsProcessed": "0", "totalSlotMs": "1398", "transferredBytes": "0" }, "startTime": "1665778922918", "totalBytesProcessed": "58545543", "totalSlotMs": "1398" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
