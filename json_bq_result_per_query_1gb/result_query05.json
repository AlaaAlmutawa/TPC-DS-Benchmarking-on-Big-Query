{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anonf89b227f_11b2_41f8_9250_076a801c5925" }, "priority": "INTERACTIVE", "query": "-- start query 5 in stream 0 using template query5.tpl\nwith ssr as\n (select s_store_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ss_store_sk as store_sk,\n ss_sold_date_sk as date_sk,\n ss_ext_sales_price as sales_price,\n ss_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from store_sales\n union all\n select sr_store_sk as store_sk,\n sr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n sr_return_amt as return_amt,\n sr_net_loss as net_loss\n from store_returns\n ) salesreturns,\n date_dim,\n store\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date) \n and (cast('2000-08-23'+14 as date))--add the 14 days manually\n and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select cs_catalog_page_sk as page_sk,\n cs_sold_date_sk as date_sk,\n cs_ext_sales_price as sales_price,\n cs_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from catalog_sales\n union all\n select cr_catalog_page_sk as page_sk,\n cr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n cr_return_amount as return_amt,\n cr_net_loss as net_loss\n from catalog_returns\n ) salesreturns,\n date_dim,\n catalog_page\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23'+14 as date))\n and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ws_web_site_sk as wsr_web_site_sk,\n ws_sold_date_sk as date_sk,\n ws_ext_sales_price as sales_price,\n ws_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from web_sales\n union all\n select ws_web_site_sk as wsr_web_site_sk,\n wr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n wr_return_amt as return_amt,\n wr_net_loss as net_loss\n from web_returns left outer join web_sales on\n ( wr_item_sk = ws_item_sk\n and wr_order_number = ws_order_number)\n ) salesreturns,\n date_dim,\n web_site\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23' as date) + 14 )\n and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n select channel\n , id\n , sum(sales) as sales\n , sum(returns) as returns\n , sum(profit) as profit\n from \n (select 'store channel' as channel\n , 'store' || s_store_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from ssr\n union all\n select 'catalog channel' as channel\n , 'catalog_page' || cp_catalog_page_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from csr\n union all\n select 'web channel' as channel\n , 'web_site' || web_site_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from wsr\n ) x\n group by rollup (channel, id)\n order by channel\n ,id\n limit 100\n ;\n\n-- end query 5 in stream 0 using template query5.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "acgoeBkF2V2gUjt3GCn8Vw==", "id": "test-project-364309:europe-west1.query05_1665768210", "jobReference": { "jobId": "query05_1665768210", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query05_1665768210?location=europe-west1", "statistics": { "creationTime": "1665768211600", "endTime": "1665768212794", "finalExecutionDurationMs": "918", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "272493208", "performanceInsights": { "avgPreviousExecutionMs": "957" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.008225616921269096, "computeRatioMax": 0.008225616921269096, "endMs": "1665768211854", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.004700352526439483, "readRatioMax": 0.004700352526439483, "recordsRead": "30", "recordsWritten": "30", "shuffleOutputBytes": "900", "shuffleOutputBytesSpilled": "0", "slotMs": "35", "startMs": "1665768211826", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:web_site_sk, $21:web_site_id", "FROM web_site" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011750881316098707, "waitRatioMax": 0.0011750881316098707, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.021151586368977675, "writeRatioMax": 0.021151586368977675 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.01527614571092832, "computeRatioMax": 0.01527614571092832, "endMs": "1665768211878", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.008225616921269096, "readRatioMax": 0.008225616921269096, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "27", "startMs": "1665768211842", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:d_date_sk, $51:d_date", "FROM date_dim", "WHERE between($51, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$50", "TO __stage01_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0023501762632197414, "waitRatioMax": 0.0023501762632197414, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.009400705052878966, "writeRatioMax": 0.009400705052878966 }, { "completedParallelInputs": "1", "computeMsAvg": "378", "computeMsMax": "378", "computeRatioAvg": 0.44418331374853115, "computeRatioMax": 0.44418331374853115, "endMs": "1665768212135", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "13", "readMsMax": "13", "readRatioAvg": 0.01527614571092832, "readRatioMax": 0.01527614571092832, "recordsRead": "719384", "recordsWritten": "719384", "shuffleOutputBytes": "19421880", "shuffleOutputBytesSpilled": "0", "slotMs": "330", "startMs": "1665768211857", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$120:ws_item_sk, $121:ws_web_site_sk, $122:ws_order_number", "FROM web_sales" ] }, { "kind": "WRITE", "substeps": [ "$120, $121, $122", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011750881316098707, "waitRatioMax": 0.0011750881316098707, "writeMsAvg": "31", "writeMsMax": "31", "writeRatioAvg": 0.036427732079905996, "writeRatioMax": 0.036427732079905996 }, { "completedParallelInputs": "1", "computeMsAvg": "17", "computeMsMax": "17", "computeRatioAvg": 0.0199764982373678, "computeRatioMax": 0.0199764982373678, "endMs": "1665768211912", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.005875440658049354, "readRatioMax": 0.005875440658049354, "recordsRead": "11718", "recordsWritten": "11718", "shuffleOutputBytes": "351540", "shuffleOutputBytesSpilled": "0", "slotMs": "35", "startMs": "1665768211873", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:cp_catalog_page_sk, $11:cp_catalog_page_id", "FROM catalog_page" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage03_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011750881316098707, "waitRatioMax": 0.0011750881316098707, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.01645123384253819, "writeRatioMax": 0.01645123384253819 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.01410105757931845, "computeRatioMax": 0.01410105757931845, "endMs": "1665768211936", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.007050528789659225, "readRatioMax": 0.007050528789659225, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "41", "startMs": "1665768211892", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_date_sk, $41:d_date", "FROM date_dim", "WHERE between($41, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$40", "TO __stage04_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011750881316098707, "waitRatioMax": 0.0011750881316098707, "writeMsAvg": "29", "writeMsMax": "29", "writeRatioAvg": 0.03407755581668625, "writeRatioMax": 0.03407755581668625 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.009400705052878966, "computeRatioMax": 0.009400705052878966, "endMs": "1665768211966", "id": "6", "name": "S06: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.005875440658049354, "readRatioMax": 0.005875440658049354, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "360", "shuffleOutputBytesSpilled": "0", "slotMs": "41", "startMs": "1665768211925", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:s_store_sk, $2:s_store_id", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage06_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0023501762632197414, "waitRatioMax": 0.0023501762632197414, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.022326674500587545, "writeRatioMax": 0.022326674500587545 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.01527614571092832, "computeRatioMax": 0.01527614571092832, "endMs": "1665768211982", "id": "7", "name": "S07: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.010575793184488837, "readRatioMax": 0.010575793184488837, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "34", "startMs": "1665768211943", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $31:d_date", "FROM date_dim", "WHERE between($31, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$30", "TO __stage07_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0023501762632197414, "waitRatioMax": 0.0023501762632197414, "writeMsAvg": "7", "writeMsMax": "7", "writeRatioAvg": 0.008225616921269096, "writeRatioMax": 0.008225616921269096 }, { "completedParallelInputs": "6", "computeMsAvg": "163", "computeMsMax": "236", "computeRatioAvg": 0.19153936545240893, "computeRatioMax": 0.2773207990599295, "endMs": "1665768212113", "id": "9", "inputStages": [ "4", "3" ], "name": "S09: Join+", "parallelInputs": "6", "readMsAvg": "16", "readMsMax": "18", "readRatioAvg": 0.01880141010575793, "readRatioMax": 0.021151586368977675, "recordsRead": "1656013", "recordsWritten": "2182", "shuffleOutputBytes": "194118", "shuffleOutputBytesSpilled": "0", "slotMs": "864", "startMs": "1665768211967", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:cs_sold_date_sk, $81:cs_catalog_page_sk, $82:cs_ext_sales_price, $83:cs_net_profit", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$90:cr_returned_date_sk, $91:cr_catalog_page_sk, $92:cr_return_amount, $93:cr_net_loss", "FROM catalog_returns" ] }, { "kind": "READ", "substeps": [ "$40", "FROM __stage04_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage03_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $440 := $434", "$270 := SUM($430)", "$271 := SUM($431)", "$272 := SUM($432)", "$273 := SUM($433)" ] }, { "kind": "JOIN", "substeps": [ "$430 := $421, $431 := $422, $432 := $423, $433 := $424, $434 := $11", "INNER HASH JOIN EACH WITH ALL ON $420 = $10" ] }, { "kind": "JOIN", "substeps": [ "$420 := $300, $421 := $302, $422 := $303, $423 := $304, $424 := $305", "INNER HASH JOIN EACH WITH ALL ON $301 = $40" ] }, { "kind": "COMPUTE", "substeps": [ "$340 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$350 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$440, $270, $271, $272, $273", "TO __stage09_output", "BY HASH($440)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011750881316098707, "waitRatioMax": 0.0011750881316098707, "writeMsAvg": "4", "writeMsMax": "5", "writeRatioAvg": 0.004700352526439483, "writeRatioMax": 0.005875440658049354 }, { "completedParallelInputs": "7", "computeMsAvg": "198", "computeMsMax": "232", "computeRatioAvg": 0.23266745005875442, "computeRatioMax": 0.27262044653349, "endMs": "1665768212180", "id": "10", "inputStages": [ "7", "6" ], "name": "S0A: Join+", "parallelInputs": "7", "readMsAvg": "20", "readMsMax": "28", "readRatioAvg": 0.023501762632197415, "readRatioMax": 0.03290246768507638, "recordsRead": "3168107", "recordsWritten": "42", "shuffleOutputBytes": "3738", "shuffleOutputBytesSpilled": "0", "slotMs": "1611", "startMs": "1665768211998", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:ss_sold_date_sk, $61:ss_store_sk, $62:ss_ext_sales_price, $63:ss_net_profit", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$70:sr_returned_date_sk, $71:sr_store_sk, $72:sr_return_amt, $73:sr_net_loss", "FROM store_returns" ] }, { "kind": "READ", "substeps": [ "$30", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $400 := $394", "$260 := SUM($390)", "$261 := SUM($391)", "$262 := SUM($392)", "$263 := SUM($393)" ] }, { "kind": "JOIN", "substeps": [ "$390 := $381, $391 := $382, $392 := $383, $393 := $384, $394 := $2", "INNER HASH JOIN EACH WITH ALL ON $380 = $1" ] }, { "kind": "JOIN", "substeps": [ "$380 := $290, $381 := $292, $382 := $293, $383 := $294, $384 := $295", "INNER HASH JOIN EACH WITH ALL ON $291 = $30" ] }, { "kind": "COMPUTE", "substeps": [ "$320 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$330 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$400, $260, $261, $262, $263", "TO __stage0A_output", "BY HASH($400)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0023501762632197414, "waitRatioMax": 0.0023501762632197414, "writeMsAvg": "6", "writeMsMax": "8", "writeRatioAvg": 0.007050528789659225, "writeRatioMax": 0.009400705052878966 }, { "completedParallelInputs": "2", "computeMsAvg": "655", "computeMsMax": "851", "computeRatioAvg": 0.7696827262044653, "computeRatioMax": 1, "endMs": "1665768212572", "id": "11", "inputStages": [ "1", "2", "0" ], "name": "S0B: Join+", "parallelInputs": "2", "readMsAvg": "17", "readMsMax": "24", "readRatioAvg": 0.0199764982373678, "readRatioMax": 0.0282021151586369, "recordsRead": "1510621", "recordsWritten": "30", "shuffleOutputBytes": "2670", "shuffleOutputBytesSpilled": "0", "slotMs": "1159", "startMs": "1665768212224", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$100:ws_sold_date_sk, $101:ws_web_site_sk, $102:ws_ext_sales_price, $103:ws_net_profit", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$110:wr_returned_date_sk, $111:wr_item_sk, $112:wr_order_number, $113:wr_return_amt, $114:wr_net_loss", "FROM web_returns" ] }, { "kind": "READ", "substeps": [ "$120, $121, $122", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$50", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $490 := $484", "$280 := SUM($480)", "$281 := SUM($481)", "$282 := SUM($482)", "$283 := SUM($483)" ] }, { "kind": "JOIN", "substeps": [ "$480 := $471, $481 := $472, $482 := $473, $483 := $474, $484 := $21", "INNER HASH JOIN EACH WITH ALL ON $470 = $20" ] }, { "kind": "JOIN", "substeps": [ "$470 := $310, $471 := $312, $472 := $313, $473 := $314, $474 := $315", "INNER HASH JOIN EACH WITH ALL ON $311 = $50" ] }, { "kind": "COMPUTE", "substeps": [ "$360 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$370 := NUMERIC<...>" ] }, { "kind": "JOIN", "substeps": [ "$460 := $110, $461 := $113, $462 := $114, $463 := $121", "LEFT OUTER HASH JOIN EACH WITH ALL ON $111 = $120, $112 = $122" ] }, { "kind": "WRITE", "substeps": [ "$490, $280, $281, $282, $283", "TO __stage0B_output", "BY HASH($490)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011750881316098707, "waitRatioMax": 0.0011750881316098707, "writeMsAvg": "7", "writeMsMax": "7", "writeRatioAvg": 0.008225616921269096, "writeRatioMax": 0.008225616921269096 }, { "completedParallelInputs": "3", "computeMsAvg": "11", "computeMsMax": "17", "computeRatioAvg": 0.012925969447708578, "computeRatioMax": 0.0199764982373678, "endMs": "1665768212634", "id": "12", "inputStages": [ "10", "11", "9" ], "name": "S0C: Aggregate+", "parallelInputs": "3", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "2254", "recordsWritten": "686", "shuffleOutputBytes": "77073", "shuffleOutputBytesSpilled": "0", "slotMs": "93", "startMs": "1665768212594", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$400, $260, $261, $262, $263", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$440, $270, $271, $272, $273", "FROM __stage09_output" ] }, { "kind": "READ", "substeps": [ "$490, $280, $281, $282, $283", "FROM __stage0B_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $510 := $150, $511 := $151, $512 := $170", "$140 := SUM($182)", "$141 := SUM($183)", "$142 := SUM($184)" ] }, { "kind": "COMPUTE", "substeps": [ "$150 := if(equal(bitwise_and($190, 1), 0), NULL, $180)", "$151 := if(equal(bitwise_and($190, 2), 0), NULL, $181)" ] }, { "kind": "COMPUTE", "substeps": [ "$160 := ARRAY<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := 'store channel'", "$201 := concat('store', $410)", "$202 := subtract($231, $233)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $410 := $400", "$230 := SUM($260)", "$231 := SUM($261)", "$232 := SUM($262)", "$233 := SUM($263)" ] }, { "kind": "COMPUTE", "substeps": [ "$210 := 'catalog channel'", "$211 := concat('catalog_page', $450)", "$212 := subtract($241, $243)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $450 := $440", "$240 := SUM($270)", "$241 := SUM($271)", "$242 := SUM($272)", "$243 := SUM($273)" ] }, { "kind": "COMPUTE", "substeps": [ "$220 := 'web channel'", "$221 := concat('web_site', $500)", "$222 := subtract($251, $253)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $500 := $490", "$250 := SUM($280)", "$251 := SUM($281)", "$252 := SUM($282)", "$253 := SUM($283)" ] }, { "kind": "COMPUTE", "substeps": [ "$170 := subtract($191, 1)" ] }, { "kind": "WRITE", "substeps": [ "$140, $141, $142, $510, $511, $512", "TO __stage0C_output", "BY HASH($510, $511, $512)" ] } ], "waitMsAvg": "1", "waitMsMax": "2", "waitRatioAvg": 0.0011750881316098707, "waitRatioMax": 0.0023501762632197414, "writeMsAvg": "15", "writeMsMax": "17", "writeRatioAvg": 0.01762632197414806, "writeRatioMax": 0.0199764982373678 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.01527614571092832, "computeRatioMax": 0.01527614571092832, "endMs": "1665768212682", "id": "13", "inputStages": [ "12" ], "name": "S0D: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "686", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "37", "startMs": "1665768212644", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$140, $141, $142, $510, $511, $512", "FROM __stage0C_output" ] }, { "kind": "SORT", "substeps": [ "$520 ASC, $521 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $520 := $510, $521 := $511, $522 := $512", "$130 := SUM($140)", "$131 := SUM($141)", "$132 := SUM($142)" ] }, { "kind": "WRITE", "substeps": [ "$530, $531, $532, $533, $534", "TO __stage0D_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0023501762632197414, "waitRatioMax": 0.0023501762632197414, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.01762632197414806, "writeRatioMax": 0.01762632197414806 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.008225616921269096, "computeRatioMax": 0.008225616921269096, "endMs": "1665768212702", "id": "14", "inputStages": [ "13" ], "name": "S0E: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "30", "startMs": "1665768212660", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$530, $531, $532, $533, $534", "FROM __stage0D_output" ] }, { "kind": "SORT", "substeps": [ "$533 ASC, $534 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$540, $541, $542, $543, $544", "TO __stage0E_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011750881316098707, "waitRatioMax": 0.0011750881316098707, "writeMsAvg": "7", "writeMsMax": "7", "writeRatioAvg": 0.008225616921269096, "writeRatioMax": 0.008225616921269096 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_page" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_site" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "2", "completedUnits": "20", "elapsedMs": "656", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "3051" }, { "activeUnits": "2", "completedUnits": "27", "elapsedMs": "1081", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "4372" } ], "totalBytesBilled": "272629760", "totalBytesProcessed": "272493208", "totalPartitionsProcessed": "0", "totalSlotMs": "4372", "transferredBytes": "0" }, "startTime": "1665768211671", "totalBytesProcessed": "272493208", "totalSlotMs": "4372" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon02719f05_512f_49f5_9d62_9e25a0fe4e37" }, "priority": "INTERACTIVE", "query": "-- start query 5 in stream 0 using template query5.tpl\nwith ssr as\n (select s_store_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ss_store_sk as store_sk,\n ss_sold_date_sk as date_sk,\n ss_ext_sales_price as sales_price,\n ss_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from store_sales\n union all\n select sr_store_sk as store_sk,\n sr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n sr_return_amt as return_amt,\n sr_net_loss as net_loss\n from store_returns\n ) salesreturns,\n date_dim,\n store\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date) \n and (cast('2000-08-23'+14 as date))--add the 14 days manually\n and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select cs_catalog_page_sk as page_sk,\n cs_sold_date_sk as date_sk,\n cs_ext_sales_price as sales_price,\n cs_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from catalog_sales\n union all\n select cr_catalog_page_sk as page_sk,\n cr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n cr_return_amount as return_amt,\n cr_net_loss as net_loss\n from catalog_returns\n ) salesreturns,\n date_dim,\n catalog_page\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23'+14 as date))\n and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ws_web_site_sk as wsr_web_site_sk,\n ws_sold_date_sk as date_sk,\n ws_ext_sales_price as sales_price,\n ws_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from web_sales\n union all\n select ws_web_site_sk as wsr_web_site_sk,\n wr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n wr_return_amt as return_amt,\n wr_net_loss as net_loss\n from web_returns left outer join web_sales on\n ( wr_item_sk = ws_item_sk\n and wr_order_number = ws_order_number)\n ) salesreturns,\n date_dim,\n web_site\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23' as date) + 14 )\n and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n select channel\n , id\n , sum(sales) as sales\n , sum(returns) as returns\n , sum(profit) as profit\n from \n (select 'store channel' as channel\n , 'store' || s_store_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from ssr\n union all\n select 'catalog channel' as channel\n , 'catalog_page' || cp_catalog_page_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from csr\n union all\n select 'web channel' as channel\n , 'web_site' || web_site_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from wsr\n ) x\n group by rollup (channel, id)\n order by channel\n ,id\n limit 100\n ;\n\n-- end query 5 in stream 0 using template query5.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "1CfuMNfczBBG795HeDEBnQ==", "id": "test-project-364309:europe-west1.query05_1665776466", "jobReference": { "jobId": "query05_1665776466", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query05_1665776466?location=europe-west1", "statistics": { "creationTime": "1665776466782", "endTime": "1665776468154", "finalExecutionDurationMs": "1044", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "272493208", "performanceInsights": { "avgPreviousExecutionMs": "955" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.011347517730496455, "computeRatioMax": 0.011347517730496455, "endMs": "1665776467074", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.011347517730496455, "readRatioMax": 0.011347517730496455, "recordsRead": "30", "recordsWritten": "30", "shuffleOutputBytes": "900", "shuffleOutputBytesSpilled": "0", "slotMs": "34", "startMs": "1665776467035", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:web_site_sk, $21:web_site_id", "FROM web_site" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage00_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0028368794326241137, "waitRatioMax": 0.0028368794326241137, "writeMsAvg": "10", "writeMsMax": "10", "writeRatioAvg": 0.014184397163120567, "writeRatioMax": 0.014184397163120567 }, { "completedParallelInputs": "1", "computeMsAvg": "17", "computeMsMax": "17", "computeRatioAvg": 0.024113475177304965, "computeRatioMax": 0.024113475177304965, "endMs": "1665776467101", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.011347517730496455, "readRatioMax": 0.011347517730496455, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "50", "startMs": "1665776467057", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:d_date_sk, $51:d_date", "FROM date_dim", "WHERE between($51, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$50", "TO __stage01_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.00425531914893617, "waitRatioMax": 0.00425531914893617, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.019858156028368795, "writeRatioMax": 0.019858156028368795 }, { "completedParallelInputs": "1", "computeMsAvg": "417", "computeMsMax": "417", "computeRatioAvg": 0.5914893617021276, "computeRatioMax": 0.5914893617021276, "endMs": "1665776467353", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "15", "readMsMax": "15", "readRatioAvg": 0.02127659574468085, "readRatioMax": 0.02127659574468085, "recordsRead": "719384", "recordsWritten": "719384", "shuffleOutputBytes": "19421880", "shuffleOutputBytesSpilled": "0", "slotMs": "411", "startMs": "1665776467073", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$120:ws_item_sk, $121:ws_web_site_sk, $122:ws_order_number", "FROM web_sales" ] }, { "kind": "WRITE", "substeps": [ "$120, $121, $122", "TO __stage02_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0028368794326241137, "waitRatioMax": 0.0028368794326241137, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.02695035460992908, "writeRatioMax": 0.02695035460992908 }, { "completedParallelInputs": "1", "computeMsAvg": "17", "computeMsMax": "17", "computeRatioAvg": 0.024113475177304965, "computeRatioMax": 0.024113475177304965, "endMs": "1665776467140", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "10", "readMsMax": "10", "readRatioAvg": 0.014184397163120567, "readRatioMax": 0.014184397163120567, "recordsRead": "11718", "recordsWritten": "11718", "shuffleOutputBytes": "351540", "shuffleOutputBytesSpilled": "0", "slotMs": "34", "startMs": "1665776467096", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:cp_catalog_page_sk, $11:cp_catalog_page_id", "FROM catalog_page" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage03_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0028368794326241137, "waitRatioMax": 0.0028368794326241137, "writeMsAvg": "10", "writeMsMax": "10", "writeRatioAvg": 0.014184397163120567, "writeRatioMax": 0.014184397163120567 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.018439716312056736, "computeRatioMax": 0.018439716312056736, "endMs": "1665776467153", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "10", "readMsMax": "10", "readRatioAvg": 0.014184397163120567, "readRatioMax": 0.014184397163120567, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "44", "startMs": "1665776467115", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_date_sk, $41:d_date", "FROM date_dim", "WHERE between($41, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$40", "TO __stage04_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0014184397163120568, "waitRatioMax": 0.0014184397163120568, "writeMsAvg": "6", "writeMsMax": "6", "writeRatioAvg": 0.00851063829787234, "writeRatioMax": 0.00851063829787234 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.018439716312056736, "computeRatioMax": 0.018439716312056736, "endMs": "1665776467220", "id": "6", "name": "S06: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.011347517730496455, "readRatioMax": 0.011347517730496455, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "360", "shuffleOutputBytesSpilled": "0", "slotMs": "50", "startMs": "1665776467160", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:s_store_sk, $2:s_store_id", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage06_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0028368794326241137, "waitRatioMax": 0.0028368794326241137, "writeMsAvg": "27", "writeMsMax": "27", "writeRatioAvg": 0.03829787234042553, "writeRatioMax": 0.03829787234042553 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.019858156028368795, "computeRatioMax": 0.019858156028368795, "endMs": "1665776467222", "id": "7", "name": "S07: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.009929078014184398, "readRatioMax": 0.009929078014184398, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "43", "startMs": "1665776467183", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $31:d_date", "FROM date_dim", "WHERE between($31, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$30", "TO __stage07_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0028368794326241137, "waitRatioMax": 0.0028368794326241137, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.011347517730496455, "writeRatioMax": 0.011347517730496455 }, { "completedParallelInputs": "6", "computeMsAvg": "128", "computeMsMax": "182", "computeRatioAvg": 0.18156028368794327, "computeRatioMax": 0.2581560283687943, "endMs": "1665776467339", "id": "9", "inputStages": [ "3", "4" ], "name": "S09: Join+", "parallelInputs": "6", "readMsAvg": "16", "readMsMax": "20", "readRatioAvg": 0.02269503546099291, "readRatioMax": 0.028368794326241134, "recordsRead": "1656013", "recordsWritten": "2182", "shuffleOutputBytes": "194118", "shuffleOutputBytesSpilled": "0", "slotMs": "867", "startMs": "1665776467213", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:cs_sold_date_sk, $81:cs_catalog_page_sk, $82:cs_ext_sales_price, $83:cs_net_profit", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$90:cr_returned_date_sk, $91:cr_catalog_page_sk, $92:cr_return_amount, $93:cr_net_loss", "FROM catalog_returns" ] }, { "kind": "READ", "substeps": [ "$40", "FROM __stage04_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage03_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $440 := $434", "$270 := SUM($430)", "$271 := SUM($431)", "$272 := SUM($432)", "$273 := SUM($433)" ] }, { "kind": "JOIN", "substeps": [ "$430 := $421, $431 := $422, $432 := $423, $433 := $424, $434 := $11", "INNER HASH JOIN EACH WITH ALL ON $420 = $10" ] }, { "kind": "JOIN", "substeps": [ "$420 := $300, $421 := $302, $422 := $303, $423 := $304, $424 := $305", "INNER HASH JOIN EACH WITH ALL ON $301 = $40" ] }, { "kind": "COMPUTE", "substeps": [ "$340 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$350 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$440, $270, $271, $272, $273", "TO __stage09_output", "BY HASH($440)" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.0028368794326241137, "waitRatioMax": 0.00425531914893617, "writeMsAvg": "5", "writeMsMax": "6", "writeRatioAvg": 0.0070921985815602835, "writeRatioMax": 0.00851063829787234 }, { "completedParallelInputs": "7", "computeMsAvg": "208", "computeMsMax": "253", "computeRatioAvg": 0.2950354609929078, "computeRatioMax": 0.3588652482269504, "endMs": "1665776467415", "id": "10", "inputStages": [ "6", "7" ], "name": "S0A: Join+", "parallelInputs": "7", "readMsAvg": "15", "readMsMax": "18", "readRatioAvg": 0.02127659574468085, "readRatioMax": 0.02553191489361702, "recordsRead": "3168107", "recordsWritten": "42", "shuffleOutputBytes": "3738", "shuffleOutputBytesSpilled": "0", "slotMs": "1418", "startMs": "1665776467248", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:ss_sold_date_sk, $61:ss_store_sk, $62:ss_ext_sales_price, $63:ss_net_profit", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$70:sr_returned_date_sk, $71:sr_store_sk, $72:sr_return_amt, $73:sr_net_loss", "FROM store_returns" ] }, { "kind": "READ", "substeps": [ "$30", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $400 := $394", "$260 := SUM($390)", "$261 := SUM($391)", "$262 := SUM($392)", "$263 := SUM($393)" ] }, { "kind": "JOIN", "substeps": [ "$390 := $381, $391 := $382, $392 := $383, $393 := $384, $394 := $2", "INNER HASH JOIN EACH WITH ALL ON $380 = $1" ] }, { "kind": "JOIN", "substeps": [ "$380 := $290, $381 := $292, $382 := $293, $383 := $294, $384 := $295", "INNER HASH JOIN EACH WITH ALL ON $291 = $30" ] }, { "kind": "COMPUTE", "substeps": [ "$320 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$330 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$400, $260, $261, $262, $263", "TO __stage0A_output", "BY HASH($400)" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.0028368794326241137, "waitRatioMax": 0.00425531914893617, "writeMsAvg": "4", "writeMsMax": "5", "writeRatioAvg": 0.005673758865248227, "writeRatioMax": 0.0070921985815602835 }, { "completedParallelInputs": "2", "computeMsAvg": "545", "computeMsMax": "705", "computeRatioAvg": 0.7730496453900709, "computeRatioMax": 1, "endMs": "1665776467814", "id": "11", "inputStages": [ "1", "2", "0" ], "name": "S0B: Join+", "parallelInputs": "2", "readMsAvg": "18", "readMsMax": "23", "readRatioAvg": 0.02553191489361702, "readRatioMax": 0.032624113475177303, "recordsRead": "1510621", "recordsWritten": "30", "shuffleOutputBytes": "2670", "shuffleOutputBytesSpilled": "0", "slotMs": "1090", "startMs": "1665776467400", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$100:ws_sold_date_sk, $101:ws_web_site_sk, $102:ws_ext_sales_price, $103:ws_net_profit", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$110:wr_returned_date_sk, $111:wr_item_sk, $112:wr_order_number, $113:wr_return_amt, $114:wr_net_loss", "FROM web_returns" ] }, { "kind": "READ", "substeps": [ "$120, $121, $122", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$50", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $490 := $484", "$280 := SUM($480)", "$281 := SUM($481)", "$282 := SUM($482)", "$283 := SUM($483)" ] }, { "kind": "JOIN", "substeps": [ "$480 := $471, $481 := $472, $482 := $473, $483 := $474, $484 := $21", "INNER HASH JOIN EACH WITH ALL ON $470 = $20" ] }, { "kind": "JOIN", "substeps": [ "$470 := $310, $471 := $312, $472 := $313, $473 := $314, $474 := $315", "INNER HASH JOIN EACH WITH ALL ON $311 = $50" ] }, { "kind": "COMPUTE", "substeps": [ "$360 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$370 := NUMERIC<...>" ] }, { "kind": "JOIN", "substeps": [ "$460 := $110, $461 := $113, $462 := $114, $463 := $121", "LEFT OUTER HASH JOIN EACH WITH ALL ON $111 = $120, $112 = $122" ] }, { "kind": "WRITE", "substeps": [ "$490, $280, $281, $282, $283", "TO __stage0B_output", "BY HASH($490)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0028368794326241137, "waitRatioMax": 0.0028368794326241137, "writeMsAvg": "6", "writeMsMax": "7", "writeRatioAvg": 0.00851063829787234, "writeRatioMax": 0.009929078014184398 }, { "completedParallelInputs": "3", "computeMsAvg": "20", "computeMsMax": "25", "computeRatioAvg": 0.028368794326241134, "computeRatioMax": 0.03546099290780142, "endMs": "1665776467929", "id": "12", "inputStages": [ "11", "9", "10" ], "name": "S0C: Aggregate+", "parallelInputs": "3", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "2254", "recordsWritten": "686", "shuffleOutputBytes": "77073", "shuffleOutputBytesSpilled": "0", "slotMs": "198", "startMs": "1665776467866", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$400, $260, $261, $262, $263", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$440, $270, $271, $272, $273", "FROM __stage09_output" ] }, { "kind": "READ", "substeps": [ "$490, $280, $281, $282, $283", "FROM __stage0B_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $510 := $150, $511 := $151, $512 := $170", "$140 := SUM($182)", "$141 := SUM($183)", "$142 := SUM($184)" ] }, { "kind": "COMPUTE", "substeps": [ "$150 := if(equal(bitwise_and($190, 1), 0), NULL, $180)", "$151 := if(equal(bitwise_and($190, 2), 0), NULL, $181)" ] }, { "kind": "COMPUTE", "substeps": [ "$160 := ARRAY<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := 'store channel'", "$201 := concat('store', $410)", "$202 := subtract($231, $233)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $410 := $400", "$230 := SUM($260)", "$231 := SUM($261)", "$232 := SUM($262)", "$233 := SUM($263)" ] }, { "kind": "COMPUTE", "substeps": [ "$210 := 'catalog channel'", "$211 := concat('catalog_page', $450)", "$212 := subtract($241, $243)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $450 := $440", "$240 := SUM($270)", "$241 := SUM($271)", "$242 := SUM($272)", "$243 := SUM($273)" ] }, { "kind": "COMPUTE", "substeps": [ "$220 := 'web channel'", "$221 := concat('web_site', $500)", "$222 := subtract($251, $253)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $500 := $490", "$250 := SUM($280)", "$251 := SUM($281)", "$252 := SUM($282)", "$253 := SUM($283)" ] }, { "kind": "COMPUTE", "substeps": [ "$170 := subtract($191, 1)" ] }, { "kind": "WRITE", "substeps": [ "$140, $141, $142, $510, $511, $512", "TO __stage0C_output", "BY HASH($510, $511, $512)" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.0028368794326241137, "waitRatioMax": 0.00425531914893617, "writeMsAvg": "29", "writeMsMax": "30", "writeRatioAvg": 0.04113475177304964, "writeRatioMax": 0.0425531914893617 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.011347517730496455, "computeRatioMax": 0.011347517730496455, "endMs": "1665776467988", "id": "13", "inputStages": [ "12" ], "name": "S0D: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "686", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "52", "startMs": "1665776467938", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$140, $141, $142, $510, $511, $512", "FROM __stage0C_output" ] }, { "kind": "SORT", "substeps": [ "$520 ASC, $521 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $520 := $510, $521 := $511, $522 := $512", "$130 := SUM($140)", "$131 := SUM($141)", "$132 := SUM($142)" ] }, { "kind": "WRITE", "substeps": [ "$530, $531, $532, $533, $534", "TO __stage0D_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.00425531914893617, "waitRatioMax": 0.00425531914893617, "writeMsAvg": "20", "writeMsMax": "20", "writeRatioAvg": 0.028368794326241134, "writeRatioMax": 0.028368794326241134 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.018439716312056736, "computeRatioMax": 0.018439716312056736, "endMs": "1665776468020", "id": "14", "inputStages": [ "13" ], "name": "S0E: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "51", "startMs": "1665776467966", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$530, $531, $532, $533, $534", "FROM __stage0D_output" ] }, { "kind": "SORT", "substeps": [ "$533 ASC, $534 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$540, $541, $542, $543, $544", "TO __stage0E_output" ] } ], "waitMsAvg": "4", "waitMsMax": "4", "waitRatioAvg": 0.005673758865248227, "waitRatioMax": 0.005673758865248227, "writeMsAvg": "20", "writeMsMax": "20", "writeRatioAvg": 0.028368794326241134, "writeRatioMax": 0.028368794326241134 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_page" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_site" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "2", "completedUnits": "20", "elapsedMs": "678", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "3000" }, { "activeUnits": "2", "completedUnits": "27", "elapsedMs": "1240", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "4392" } ], "totalBytesBilled": "272629760", "totalBytesProcessed": "272493208", "totalPartitionsProcessed": "0", "totalSlotMs": "4392", "transferredBytes": "0" }, "startTime": "1665776466859", "totalBytesProcessed": "272493208", "totalSlotMs": "4392" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anonb4ab08a0_64bd_416a_b2e0_1781360b2fd7" }, "priority": "INTERACTIVE", "query": "-- start query 5 in stream 0 using template query5.tpl\nwith ssr as\n (select s_store_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ss_store_sk as store_sk,\n ss_sold_date_sk as date_sk,\n ss_ext_sales_price as sales_price,\n ss_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from store_sales\n union all\n select sr_store_sk as store_sk,\n sr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n sr_return_amt as return_amt,\n sr_net_loss as net_loss\n from store_returns\n ) salesreturns,\n date_dim,\n store\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date) \n and (cast('2000-08-23'+14 as date))--add the 14 days manually\n and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select cs_catalog_page_sk as page_sk,\n cs_sold_date_sk as date_sk,\n cs_ext_sales_price as sales_price,\n cs_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from catalog_sales\n union all\n select cr_catalog_page_sk as page_sk,\n cr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n cr_return_amount as return_amt,\n cr_net_loss as net_loss\n from catalog_returns\n ) salesreturns,\n date_dim,\n catalog_page\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23'+14 as date))\n and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ws_web_site_sk as wsr_web_site_sk,\n ws_sold_date_sk as date_sk,\n ws_ext_sales_price as sales_price,\n ws_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from web_sales\n union all\n select ws_web_site_sk as wsr_web_site_sk,\n wr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n wr_return_amt as return_amt,\n wr_net_loss as net_loss\n from web_returns left outer join web_sales on\n ( wr_item_sk = ws_item_sk\n and wr_order_number = ws_order_number)\n ) salesreturns,\n date_dim,\n web_site\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23' as date) + 14 )\n and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n select channel\n , id\n , sum(sales) as sales\n , sum(returns) as returns\n , sum(profit) as profit\n from \n (select 'store channel' as channel\n , 'store' || s_store_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from ssr\n union all\n select 'catalog channel' as channel\n , 'catalog_page' || cp_catalog_page_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from csr\n union all\n select 'web channel' as channel\n , 'web_site' || web_site_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from wsr\n ) x\n group by rollup (channel, id)\n order by channel\n ,id\n limit 100\n ;\n\n-- end query 5 in stream 0 using template query5.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "pzvlkNYBfQqyj6tcbt4pvA==", "id": "test-project-364309:europe-west1.query05_1665776469", "jobReference": { "jobId": "query05_1665776469", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query05_1665776469?location=europe-west1", "statistics": { "creationTime": "1665776469944", "endTime": "1665776471474", "finalExecutionDurationMs": "1236", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "272493208", "performanceInsights": { "avgPreviousExecutionMs": "956" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.012790697674418604, "computeRatioMax": 0.012790697674418604, "endMs": "1665776470231", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.005813953488372093, "readRatioMax": 0.005813953488372093, "recordsRead": "30", "recordsWritten": "30", "shuffleOutputBytes": "900", "shuffleOutputBytesSpilled": "0", "slotMs": "36", "startMs": "1665776470190", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:web_site_sk, $21:web_site_id", "FROM web_site" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011627906976744186, "waitRatioMax": 0.0011627906976744186, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.019767441860465116, "writeRatioMax": 0.019767441860465116 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.01627906976744186, "computeRatioMax": 0.01627906976744186, "endMs": "1665776470250", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.009302325581395349, "readRatioMax": 0.009302325581395349, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "49", "startMs": "1665776470210", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:d_date_sk, $51:d_date", "FROM date_dim", "WHERE between($51, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$50", "TO __stage01_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002325581395348837, "waitRatioMax": 0.002325581395348837, "writeMsAvg": "11", "writeMsMax": "11", "writeRatioAvg": 0.012790697674418604, "writeRatioMax": 0.012790697674418604 }, { "completedParallelInputs": "1", "computeMsAvg": "426", "computeMsMax": "426", "computeRatioAvg": 0.49534883720930234, "computeRatioMax": 0.49534883720930234, "endMs": "1665776470587", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "11", "readMsMax": "11", "readRatioAvg": 0.012790697674418604, "readRatioMax": 0.012790697674418604, "recordsRead": "719384", "recordsWritten": "719384", "shuffleOutputBytes": "19421880", "shuffleOutputBytesSpilled": "0", "slotMs": "459", "startMs": "1665776470227", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$120:ws_item_sk, $121:ws_web_site_sk, $122:ws_order_number", "FROM web_sales" ] }, { "kind": "WRITE", "substeps": [ "$120, $121, $122", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011627906976744186, "waitRatioMax": 0.0011627906976744186, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.019767441860465116, "writeRatioMax": 0.019767441860465116 }, { "completedParallelInputs": "1", "computeMsAvg": "16", "computeMsMax": "16", "computeRatioAvg": 0.018604651162790697, "computeRatioMax": 0.018604651162790697, "endMs": "1665776470289", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.010465116279069767, "readRatioMax": 0.010465116279069767, "recordsRead": "11718", "recordsWritten": "11718", "shuffleOutputBytes": "351540", "shuffleOutputBytesSpilled": "0", "slotMs": "53", "startMs": "1665776470243", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:cp_catalog_page_sk, $11:cp_catalog_page_id", "FROM catalog_page" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage03_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011627906976744186, "waitRatioMax": 0.0011627906976744186, "writeMsAvg": "10", "writeMsMax": "10", "writeRatioAvg": 0.011627906976744186, "writeRatioMax": 0.011627906976744186 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.01627906976744186, "computeRatioMax": 0.01627906976744186, "endMs": "1665776470302", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.009302325581395349, "readRatioMax": 0.009302325581395349, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "52", "startMs": "1665776470262", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_date_sk, $41:d_date", "FROM date_dim", "WHERE between($41, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$40", "TO __stage04_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011627906976744186, "waitRatioMax": 0.0011627906976744186, "writeMsAvg": "9", "writeMsMax": "9", "writeRatioAvg": 0.010465116279069767, "writeRatioMax": 0.010465116279069767 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.015116279069767442, "computeRatioMax": 0.015116279069767442, "endMs": "1665776470341", "id": "6", "name": "S06: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.00813953488372093, "readRatioMax": 0.00813953488372093, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "360", "shuffleOutputBytesSpilled": "0", "slotMs": "54", "startMs": "1665776470301", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:s_store_sk, $2:s_store_id", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage06_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002325581395348837, "waitRatioMax": 0.002325581395348837, "writeMsAvg": "11", "writeMsMax": "11", "writeRatioAvg": 0.012790697674418604, "writeRatioMax": 0.012790697674418604 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.013953488372093023, "computeRatioMax": 0.013953488372093023, "endMs": "1665776470361", "id": "7", "name": "S07: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.0069767441860465115, "readRatioMax": 0.0069767441860465115, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "58", "startMs": "1665776470319", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $31:d_date", "FROM date_dim", "WHERE between($31, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$30", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011627906976744186, "waitRatioMax": 0.0011627906976744186, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.018604651162790697, "writeRatioMax": 0.018604651162790697 }, { "completedParallelInputs": "6", "computeMsAvg": "144", "computeMsMax": "177", "computeRatioAvg": 0.16744186046511628, "computeRatioMax": 0.2058139534883721, "endMs": "1665776470477", "id": "9", "inputStages": [ "4", "3" ], "name": "S09: Join+", "parallelInputs": "6", "readMsAvg": "17", "readMsMax": "29", "readRatioAvg": 0.019767441860465116, "readRatioMax": 0.03372093023255814, "recordsRead": "1656013", "recordsWritten": "2182", "shuffleOutputBytes": "194118", "shuffleOutputBytesSpilled": "0", "slotMs": "964", "startMs": "1665776470340", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:cs_sold_date_sk, $81:cs_catalog_page_sk, $82:cs_ext_sales_price, $83:cs_net_profit", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$90:cr_returned_date_sk, $91:cr_catalog_page_sk, $92:cr_return_amount, $93:cr_net_loss", "FROM catalog_returns" ] }, { "kind": "READ", "substeps": [ "$40", "FROM __stage04_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage03_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $440 := $434", "$270 := SUM($430)", "$271 := SUM($431)", "$272 := SUM($432)", "$273 := SUM($433)" ] }, { "kind": "JOIN", "substeps": [ "$430 := $421, $431 := $422, $432 := $423, $433 := $424, $434 := $11", "INNER HASH JOIN EACH WITH ALL ON $420 = $10" ] }, { "kind": "JOIN", "substeps": [ "$420 := $300, $421 := $302, $422 := $303, $423 := $304, $424 := $305", "INNER HASH JOIN EACH WITH ALL ON $301 = $40" ] }, { "kind": "COMPUTE", "substeps": [ "$340 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$350 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$440, $270, $271, $272, $273", "TO __stage09_output", "BY HASH($440)" ] } ], "waitMsAvg": "1", "waitMsMax": "2", "waitRatioAvg": 0.0011627906976744186, "waitRatioMax": 0.002325581395348837, "writeMsAvg": "4", "writeMsMax": "6", "writeRatioAvg": 0.004651162790697674, "writeRatioMax": 0.0069767441860465115 }, { "completedParallelInputs": "7", "computeMsAvg": "210", "computeMsMax": "292", "computeRatioAvg": 0.2441860465116279, "computeRatioMax": 0.3395348837209302, "endMs": "1665776470560", "id": "10", "inputStages": [ "7", "6" ], "name": "S0A: Join+", "parallelInputs": "7", "readMsAvg": "18", "readMsMax": "28", "readRatioAvg": 0.020930232558139535, "readRatioMax": 0.03255813953488372, "recordsRead": "3168107", "recordsWritten": "42", "shuffleOutputBytes": "3738", "shuffleOutputBytesSpilled": "0", "slotMs": "1672", "startMs": "1665776470373", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:ss_sold_date_sk, $61:ss_store_sk, $62:ss_ext_sales_price, $63:ss_net_profit", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$70:sr_returned_date_sk, $71:sr_store_sk, $72:sr_return_amt, $73:sr_net_loss", "FROM store_returns" ] }, { "kind": "READ", "substeps": [ "$30", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $400 := $394", "$260 := SUM($390)", "$261 := SUM($391)", "$262 := SUM($392)", "$263 := SUM($393)" ] }, { "kind": "JOIN", "substeps": [ "$390 := $381, $391 := $382, $392 := $383, $393 := $384, $394 := $2", "INNER HASH JOIN EACH WITH ALL ON $380 = $1" ] }, { "kind": "JOIN", "substeps": [ "$380 := $290, $381 := $292, $382 := $293, $383 := $294, $384 := $295", "INNER HASH JOIN EACH WITH ALL ON $291 = $30" ] }, { "kind": "COMPUTE", "substeps": [ "$320 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$330 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$400, $260, $261, $262, $263", "TO __stage0A_output", "BY HASH($400)" ] } ], "waitMsAvg": "1", "waitMsMax": "2", "waitRatioAvg": 0.0011627906976744186, "waitRatioMax": 0.002325581395348837, "writeMsAvg": "7", "writeMsMax": "21", "writeRatioAvg": 0.00813953488372093, "writeRatioMax": 0.02441860465116279 }, { "completedParallelInputs": "2", "computeMsAvg": "592", "computeMsMax": "860", "computeRatioAvg": 0.6883720930232559, "computeRatioMax": 1, "endMs": "1665776471178", "id": "11", "inputStages": [ "2", "1", "0" ], "name": "S0B: Join+", "parallelInputs": "2", "readMsAvg": "23", "readMsMax": "28", "readRatioAvg": 0.026744186046511628, "readRatioMax": 0.03255813953488372, "recordsRead": "1510621", "recordsWritten": "30", "shuffleOutputBytes": "2670", "shuffleOutputBytesSpilled": "0", "slotMs": "944", "startMs": "1665776470660", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$100:ws_sold_date_sk, $101:ws_web_site_sk, $102:ws_ext_sales_price, $103:ws_net_profit", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$110:wr_returned_date_sk, $111:wr_item_sk, $112:wr_order_number, $113:wr_return_amt, $114:wr_net_loss", "FROM web_returns" ] }, { "kind": "READ", "substeps": [ "$120, $121, $122", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$50", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $490 := $484", "$280 := SUM($480)", "$281 := SUM($481)", "$282 := SUM($482)", "$283 := SUM($483)" ] }, { "kind": "JOIN", "substeps": [ "$480 := $471, $481 := $472, $482 := $473, $483 := $474, $484 := $21", "INNER HASH JOIN EACH WITH ALL ON $470 = $20" ] }, { "kind": "JOIN", "substeps": [ "$470 := $310, $471 := $312, $472 := $313, $473 := $314, $474 := $315", "INNER HASH JOIN EACH WITH ALL ON $311 = $50" ] }, { "kind": "COMPUTE", "substeps": [ "$360 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$370 := NUMERIC<...>" ] }, { "kind": "JOIN", "substeps": [ "$460 := $110, $461 := $113, $462 := $114, $463 := $121", "LEFT OUTER HASH JOIN EACH WITH ALL ON $111 = $120, $112 = $122" ] }, { "kind": "WRITE", "substeps": [ "$490, $280, $281, $282, $283", "TO __stage0B_output", "BY HASH($490)" ] } ], "waitMsAvg": "1", "waitMsMax": "2", "waitRatioAvg": 0.0011627906976744186, "waitRatioMax": 0.002325581395348837, "writeMsAvg": "9", "writeMsMax": "10", "writeRatioAvg": 0.010465116279069767, "writeRatioMax": 0.011627906976744186 }, { "completedParallelInputs": "3", "computeMsAvg": "12", "computeMsMax": "14", "computeRatioAvg": 0.013953488372093023, "computeRatioMax": 0.01627906976744186, "endMs": "1665776471315", "id": "12", "inputStages": [ "11", "9", "10" ], "name": "S0C: Aggregate+", "parallelInputs": "3", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "2254", "recordsWritten": "686", "shuffleOutputBytes": "77073", "shuffleOutputBytesSpilled": "0", "slotMs": "172", "startMs": "1665776471257", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$400, $260, $261, $262, $263", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$440, $270, $271, $272, $273", "FROM __stage09_output" ] }, { "kind": "READ", "substeps": [ "$490, $280, $281, $282, $283", "FROM __stage0B_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $510 := $150, $511 := $151, $512 := $170", "$140 := SUM($182)", "$141 := SUM($183)", "$142 := SUM($184)" ] }, { "kind": "COMPUTE", "substeps": [ "$150 := if(equal(bitwise_and($190, 1), 0), NULL, $180)", "$151 := if(equal(bitwise_and($190, 2), 0), NULL, $181)" ] }, { "kind": "COMPUTE", "substeps": [ "$160 := ARRAY<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := 'store channel'", "$201 := concat('store', $410)", "$202 := subtract($231, $233)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $410 := $400", "$230 := SUM($260)", "$231 := SUM($261)", "$232 := SUM($262)", "$233 := SUM($263)" ] }, { "kind": "COMPUTE", "substeps": [ "$210 := 'catalog channel'", "$211 := concat('catalog_page', $450)", "$212 := subtract($241, $243)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $450 := $440", "$240 := SUM($270)", "$241 := SUM($271)", "$242 := SUM($272)", "$243 := SUM($273)" ] }, { "kind": "COMPUTE", "substeps": [ "$220 := 'web channel'", "$221 := concat('web_site', $500)", "$222 := subtract($251, $253)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $500 := $490", "$250 := SUM($280)", "$251 := SUM($281)", "$252 := SUM($282)", "$253 := SUM($283)" ] }, { "kind": "COMPUTE", "substeps": [ "$170 := subtract($191, 1)" ] }, { "kind": "WRITE", "substeps": [ "$140, $141, $142, $510, $511, $512", "TO __stage0C_output", "BY HASH($510, $511, $512)" ] } ], "waitMsAvg": "1", "waitMsMax": "2", "waitRatioAvg": 0.0011627906976744186, "waitRatioMax": 0.002325581395348837, "writeMsAvg": "33", "writeMsMax": "44", "writeRatioAvg": 0.03837209302325582, "writeRatioMax": 0.05116279069767442 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.009302325581395349, "computeRatioMax": 0.009302325581395349, "endMs": "1665776471352", "id": "13", "inputStages": [ "12" ], "name": "S0D: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "686", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "34", "startMs": "1665776471319", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$140, $141, $142, $510, $511, $512", "FROM __stage0C_output" ] }, { "kind": "SORT", "substeps": [ "$520 ASC, $521 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $520 := $510, $521 := $511, $522 := $512", "$130 := SUM($140)", "$131 := SUM($141)", "$132 := SUM($142)" ] }, { "kind": "WRITE", "substeps": [ "$530, $531, $532, $533, $534", "TO __stage0D_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002325581395348837, "waitRatioMax": 0.002325581395348837, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.015116279069767442, "writeRatioMax": 0.015116279069767442 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.015116279069767442, "computeRatioMax": 0.015116279069767442, "endMs": "1665776471378", "id": "14", "inputStages": [ "13" ], "name": "S0E: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "48", "startMs": "1665776471336", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$530, $531, $532, $533, $534", "FROM __stage0D_output" ] }, { "kind": "SORT", "substeps": [ "$533 ASC, $534 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$540, $541, $542, $543, $544", "TO __stage0E_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002325581395348837, "waitRatioMax": 0.002325581395348837, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.009302325581395349, "writeRatioMax": 0.009302325581395349 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_page" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_site" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_returns" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "2", "completedUnits": "20", "elapsedMs": "689", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "3525" }, { "activeUnits": "0", "completedUnits": "27", "elapsedMs": "1424", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "4725" } ], "totalBytesBilled": "272629760", "totalBytesProcessed": "272493208", "totalPartitionsProcessed": "0", "totalSlotMs": "4725", "transferredBytes": "0" }, "startTime": "1665776470003", "totalBytesProcessed": "272493208", "totalSlotMs": "4725" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anonb62d7608_581f_43ba_8713_823c16759be1" }, "priority": "INTERACTIVE", "query": "-- start query 5 in stream 0 using template query5.tpl\nwith ssr as\n (select s_store_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ss_store_sk as store_sk,\n ss_sold_date_sk as date_sk,\n ss_ext_sales_price as sales_price,\n ss_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from store_sales\n union all\n select sr_store_sk as store_sk,\n sr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n sr_return_amt as return_amt,\n sr_net_loss as net_loss\n from store_returns\n ) salesreturns,\n date_dim,\n store\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date) \n and (cast('2000-08-23'+14 as date))--add the 14 days manually\n and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select cs_catalog_page_sk as page_sk,\n cs_sold_date_sk as date_sk,\n cs_ext_sales_price as sales_price,\n cs_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from catalog_sales\n union all\n select cr_catalog_page_sk as page_sk,\n cr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n cr_return_amount as return_amt,\n cr_net_loss as net_loss\n from catalog_returns\n ) salesreturns,\n date_dim,\n catalog_page\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23'+14 as date))\n and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ws_web_site_sk as wsr_web_site_sk,\n ws_sold_date_sk as date_sk,\n ws_ext_sales_price as sales_price,\n ws_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from web_sales\n union all\n select ws_web_site_sk as wsr_web_site_sk,\n wr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n wr_return_amt as return_amt,\n wr_net_loss as net_loss\n from web_returns left outer join web_sales on\n ( wr_item_sk = ws_item_sk\n and wr_order_number = ws_order_number)\n ) salesreturns,\n date_dim,\n web_site\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23' as date) + 14 )\n and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n select channel\n , id\n , sum(sales) as sales\n , sum(returns) as returns\n , sum(profit) as profit\n from \n (select 'store channel' as channel\n , 'store' || s_store_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from ssr\n union all\n select 'catalog channel' as channel\n , 'catalog_page' || cp_catalog_page_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from csr\n union all\n select 'web channel' as channel\n , 'web_site' || web_site_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from wsr\n ) x\n group by rollup (channel, id)\n order by channel\n ,id\n limit 100\n ;\n\n-- end query 5 in stream 0 using template query5.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "62tA0xUji3ZEoUheKOaBpA==", "id": "test-project-364309:europe-west1.query05_1665776473", "jobReference": { "jobId": "query05_1665776473", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query05_1665776473?location=europe-west1", "statistics": { "creationTime": "1665776474287", "endTime": "1665776475645", "finalExecutionDurationMs": "1022", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "272493208", "performanceInsights": { "avgPreviousExecutionMs": "960" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.01227830832196453, "computeRatioMax": 0.01227830832196453, "endMs": "1665776474594", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.005457025920873124, "readRatioMax": 0.005457025920873124, "recordsRead": "30", "recordsWritten": "30", "shuffleOutputBytes": "900", "shuffleOutputBytesSpilled": "0", "slotMs": "57", "startMs": "1665776474548", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:web_site_sk, $21:web_site_id", "FROM web_site" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage00_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.004092769440654843, "waitRatioMax": 0.004092769440654843, "writeMsAvg": "20", "writeMsMax": "20", "writeRatioAvg": 0.027285129604365622, "writeRatioMax": 0.027285129604365622 }, { "completedParallelInputs": "1", "computeMsAvg": "19", "computeMsMax": "19", "computeRatioAvg": 0.02592087312414734, "computeRatioMax": 0.02592087312414734, "endMs": "1665776474611", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.009549795361527967, "readRatioMax": 0.009549795361527967, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "55", "startMs": "1665776474572", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:d_date_sk, $51:d_date", "FROM date_dim", "WHERE between($51, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$50", "TO __stage01_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.004092769440654843, "waitRatioMax": 0.004092769440654843, "writeMsAvg": "9", "writeMsMax": "9", "writeRatioAvg": 0.01227830832196453, "writeRatioMax": 0.01227830832196453 }, { "completedParallelInputs": "1", "computeMsAvg": "332", "computeMsMax": "332", "computeRatioAvg": 0.4529331514324693, "computeRatioMax": 0.4529331514324693, "endMs": "1665776474809", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "12", "readMsMax": "12", "readRatioAvg": 0.01637107776261937, "readRatioMax": 0.01637107776261937, "recordsRead": "719384", "recordsWritten": "719384", "shuffleOutputBytes": "19421880", "shuffleOutputBytesSpilled": "0", "slotMs": "336", "startMs": "1665776474592", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$120:ws_item_sk, $121:ws_web_site_sk, $122:ws_order_number", "FROM web_sales" ] }, { "kind": "WRITE", "substeps": [ "$120, $121, $122", "TO __stage02_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.004092769440654843, "waitRatioMax": 0.004092769440654843, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.019099590723055934, "writeRatioMax": 0.019099590723055934 }, { "completedParallelInputs": "1", "computeMsAvg": "20", "computeMsMax": "20", "computeRatioAvg": 0.027285129604365622, "computeRatioMax": 0.027285129604365622, "endMs": "1665776474643", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.008185538881309686, "readRatioMax": 0.008185538881309686, "recordsRead": "11718", "recordsWritten": "11718", "shuffleOutputBytes": "351540", "shuffleOutputBytesSpilled": "0", "slotMs": "49", "startMs": "1665776474611", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:cp_catalog_page_sk, $11:cp_catalog_page_id", "FROM catalog_page" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage03_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002728512960436562, "waitRatioMax": 0.002728512960436562, "writeMsAvg": "12", "writeMsMax": "12", "writeRatioAvg": 0.01637107776261937, "writeRatioMax": 0.01637107776261937 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.009549795361527967, "computeRatioMax": 0.009549795361527967, "endMs": "1665776474658", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.005457025920873124, "readRatioMax": 0.005457025920873124, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "28", "startMs": "1665776474630", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_date_sk, $41:d_date", "FROM date_dim", "WHERE between($41, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$40", "TO __stage04_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002728512960436562, "waitRatioMax": 0.002728512960436562, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.020463847203274217, "writeRatioMax": 0.020463847203274217 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.009549795361527967, "computeRatioMax": 0.009549795361527967, "endMs": "1665776474717", "id": "6", "name": "S06: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.005457025920873124, "readRatioMax": 0.005457025920873124, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "360", "shuffleOutputBytesSpilled": "0", "slotMs": "45", "startMs": "1665776474673", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:s_store_sk, $2:s_store_id", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage06_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.004092769440654843, "waitRatioMax": 0.004092769440654843, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.02455661664392906, "writeRatioMax": 0.02455661664392906 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.015006821282401092, "computeRatioMax": 0.015006821282401092, "endMs": "1665776474727", "id": "7", "name": "S07: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.009549795361527967, "readRatioMax": 0.009549795361527967, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "37", "startMs": "1665776474691", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $31:d_date", "FROM date_dim", "WHERE between($31, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$30", "TO __stage07_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002728512960436562, "waitRatioMax": 0.002728512960436562, "writeMsAvg": "7", "writeMsMax": "7", "writeRatioAvg": 0.009549795361527967, "writeRatioMax": 0.009549795361527967 }, { "completedParallelInputs": "6", "computeMsAvg": "135", "computeMsMax": "172", "computeRatioAvg": 0.18417462482946795, "computeRatioMax": 0.23465211459754434, "endMs": "1665776474830", "id": "9", "inputStages": [ "3", "4" ], "name": "S09: Join+", "parallelInputs": "6", "readMsAvg": "16", "readMsMax": "21", "readRatioAvg": 0.021828103683492497, "readRatioMax": 0.0286493860845839, "recordsRead": "1656013", "recordsWritten": "2182", "shuffleOutputBytes": "194118", "shuffleOutputBytesSpilled": "0", "slotMs": "806", "startMs": "1665776474717", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:cs_sold_date_sk, $81:cs_catalog_page_sk, $82:cs_ext_sales_price, $83:cs_net_profit", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$90:cr_returned_date_sk, $91:cr_catalog_page_sk, $92:cr_return_amount, $93:cr_net_loss", "FROM catalog_returns" ] }, { "kind": "READ", "substeps": [ "$40", "FROM __stage04_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage03_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $440 := $434", "$270 := SUM($430)", "$271 := SUM($431)", "$272 := SUM($432)", "$273 := SUM($433)" ] }, { "kind": "JOIN", "substeps": [ "$430 := $421, $431 := $422, $432 := $423, $433 := $424, $434 := $11", "INNER HASH JOIN EACH WITH ALL ON $420 = $10" ] }, { "kind": "JOIN", "substeps": [ "$420 := $300, $421 := $302, $422 := $303, $423 := $304, $424 := $305", "INNER HASH JOIN EACH WITH ALL ON $301 = $40" ] }, { "kind": "COMPUTE", "substeps": [ "$340 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$350 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$440, $270, $271, $272, $273", "TO __stage09_output", "BY HASH($440)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002728512960436562, "waitRatioMax": 0.002728512960436562, "writeMsAvg": "4", "writeMsMax": "5", "writeRatioAvg": 0.005457025920873124, "writeRatioMax": 0.0068212824010914054 }, { "completedParallelInputs": "7", "computeMsAvg": "191", "computeMsMax": "241", "computeRatioAvg": 0.2605729877216917, "computeRatioMax": 0.32878581173260574, "endMs": "1665776474900", "id": "10", "inputStages": [ "7", "6" ], "name": "S0A: Join+", "parallelInputs": "7", "readMsAvg": "18", "readMsMax": "24", "readRatioAvg": 0.02455661664392906, "readRatioMax": 0.03274215552523874, "recordsRead": "3168107", "recordsWritten": "42", "shuffleOutputBytes": "3738", "shuffleOutputBytesSpilled": "0", "slotMs": "1350", "startMs": "1665776474740", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:ss_sold_date_sk, $61:ss_store_sk, $62:ss_ext_sales_price, $63:ss_net_profit", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$70:sr_returned_date_sk, $71:sr_store_sk, $72:sr_return_amt, $73:sr_net_loss", "FROM store_returns" ] }, { "kind": "READ", "substeps": [ "$30", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $400 := $394", "$260 := SUM($390)", "$261 := SUM($391)", "$262 := SUM($392)", "$263 := SUM($393)" ] }, { "kind": "JOIN", "substeps": [ "$390 := $381, $391 := $382, $392 := $383, $393 := $384, $394 := $2", "INNER HASH JOIN EACH WITH ALL ON $380 = $1" ] }, { "kind": "JOIN", "substeps": [ "$380 := $290, $381 := $292, $382 := $293, $383 := $294, $384 := $295", "INNER HASH JOIN EACH WITH ALL ON $291 = $30" ] }, { "kind": "COMPUTE", "substeps": [ "$320 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$330 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$400, $260, $261, $262, $263", "TO __stage0A_output", "BY HASH($400)" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.004092769440654843, "waitRatioMax": 0.004092769440654843, "writeMsAvg": "5", "writeMsMax": "7", "writeRatioAvg": 0.0068212824010914054, "writeRatioMax": 0.009549795361527967 }, { "completedParallelInputs": "2", "computeMsAvg": "492", "computeMsMax": "733", "computeRatioAvg": 0.6712141882673943, "computeRatioMax": 1, "endMs": "1665776475317", "id": "11", "inputStages": [ "1", "2", "0" ], "name": "S0B: Join+", "parallelInputs": "2", "readMsAvg": "18", "readMsMax": "25", "readRatioAvg": 0.02455661664392906, "readRatioMax": 0.034106412005457026, "recordsRead": "1510621", "recordsWritten": "30", "shuffleOutputBytes": "2670", "shuffleOutputBytesSpilled": "0", "slotMs": "924", "startMs": "1665776474841", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$100:ws_sold_date_sk, $101:ws_web_site_sk, $102:ws_ext_sales_price, $103:ws_net_profit", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$110:wr_returned_date_sk, $111:wr_item_sk, $112:wr_order_number, $113:wr_return_amt, $114:wr_net_loss", "FROM web_returns" ] }, { "kind": "READ", "substeps": [ "$120, $121, $122", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$50", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $490 := $484", "$280 := SUM($480)", "$281 := SUM($481)", "$282 := SUM($482)", "$283 := SUM($483)" ] }, { "kind": "JOIN", "substeps": [ "$480 := $471, $481 := $472, $482 := $473, $483 := $474, $484 := $21", "INNER HASH JOIN EACH WITH ALL ON $470 = $20" ] }, { "kind": "JOIN", "substeps": [ "$470 := $310, $471 := $312, $472 := $313, $473 := $314, $474 := $315", "INNER HASH JOIN EACH WITH ALL ON $311 = $50" ] }, { "kind": "COMPUTE", "substeps": [ "$360 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$370 := NUMERIC<...>" ] }, { "kind": "JOIN", "substeps": [ "$460 := $110, $461 := $113, $462 := $114, $463 := $121", "LEFT OUTER HASH JOIN EACH WITH ALL ON $111 = $120, $112 = $122" ] }, { "kind": "WRITE", "substeps": [ "$490, $280, $281, $282, $283", "TO __stage0B_output", "BY HASH($490)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002728512960436562, "waitRatioMax": 0.002728512960436562, "writeMsAvg": "6", "writeMsMax": "7", "writeRatioAvg": 0.008185538881309686, "writeRatioMax": 0.009549795361527967 }, { "completedParallelInputs": "3", "computeMsAvg": "14", "computeMsMax": "18", "computeRatioAvg": 0.019099590723055934, "computeRatioMax": 0.02455661664392906, "endMs": "1665776475432", "id": "12", "inputStages": [ "11", "10", "9" ], "name": "S0C: Aggregate+", "parallelInputs": "3", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "2254", "recordsWritten": "686", "shuffleOutputBytes": "77073", "shuffleOutputBytesSpilled": "0", "slotMs": "156", "startMs": "1665776475389", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$400, $260, $261, $262, $263", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$440, $270, $271, $272, $273", "FROM __stage09_output" ] }, { "kind": "READ", "substeps": [ "$490, $280, $281, $282, $283", "FROM __stage0B_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $510 := $150, $511 := $151, $512 := $170", "$140 := SUM($182)", "$141 := SUM($183)", "$142 := SUM($184)" ] }, { "kind": "COMPUTE", "substeps": [ "$150 := if(equal(bitwise_and($190, 1), 0), NULL, $180)", "$151 := if(equal(bitwise_and($190, 2), 0), NULL, $181)" ] }, { "kind": "COMPUTE", "substeps": [ "$160 := ARRAY<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := 'store channel'", "$201 := concat('store', $410)", "$202 := subtract($231, $233)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $410 := $400", "$230 := SUM($260)", "$231 := SUM($261)", "$232 := SUM($262)", "$233 := SUM($263)" ] }, { "kind": "COMPUTE", "substeps": [ "$210 := 'catalog channel'", "$211 := concat('catalog_page', $450)", "$212 := subtract($241, $243)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $450 := $440", "$240 := SUM($270)", "$241 := SUM($271)", "$242 := SUM($272)", "$243 := SUM($273)" ] }, { "kind": "COMPUTE", "substeps": [ "$220 := 'web channel'", "$221 := concat('web_site', $500)", "$222 := subtract($251, $253)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $500 := $490", "$250 := SUM($280)", "$251 := SUM($281)", "$252 := SUM($282)", "$253 := SUM($283)" ] }, { "kind": "COMPUTE", "substeps": [ "$170 := subtract($191, 1)" ] }, { "kind": "WRITE", "substeps": [ "$140, $141, $142, $510, $511, $512", "TO __stage0C_output", "BY HASH($510, $511, $512)" ] } ], "waitMsAvg": "3", "waitMsMax": "4", "waitRatioAvg": 0.004092769440654843, "waitRatioMax": 0.005457025920873124, "writeMsAvg": "17", "writeMsMax": "23", "writeRatioAvg": 0.023192360163710776, "writeRatioMax": 0.03137789904502047 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.013642564802182811, "computeRatioMax": 0.013642564802182811, "endMs": "1665776475488", "id": "13", "inputStages": [ "12" ], "name": "S0D: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "686", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "34", "startMs": "1665776475448", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$140, $141, $142, $510, $511, $512", "FROM __stage0C_output" ] }, { "kind": "SORT", "substeps": [ "$520 ASC, $521 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $520 := $510, $521 := $511, $522 := $512", "$130 := SUM($140)", "$131 := SUM($141)", "$132 := SUM($142)" ] }, { "kind": "WRITE", "substeps": [ "$530, $531, $532, $533, $534", "TO __stage0D_output" ] } ], "waitMsAvg": "5", "waitMsMax": "5", "waitRatioAvg": 0.0068212824010914054, "waitRatioMax": 0.0068212824010914054, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.020463847203274217, "writeRatioMax": 0.020463847203274217 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.015006821282401092, "computeRatioMax": 0.015006821282401092, "endMs": "1665776475509", "id": "14", "inputStages": [ "13" ], "name": "S0E: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "58", "startMs": "1665776475467", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$530, $531, $532, $533, $534", "FROM __stage0D_output" ] }, { "kind": "SORT", "substeps": [ "$533 ASC, $534 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$540, $541, $542, $543, $544", "TO __stage0E_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002728512960436562, "waitRatioMax": 0.002728512960436562, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.010914051841746248, "writeRatioMax": 0.010914051841746248 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_page" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_site" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_returns" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "1", "completedUnits": "21", "elapsedMs": "697", "estimatedRunnableUnits": "0", "pendingUnits": "1", "totalSlotMs": "3106" }, { "activeUnits": "1", "completedUnits": "27", "elapsedMs": "1243", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "3941" } ], "totalBytesBilled": "272629760", "totalBytesProcessed": "272493208", "totalPartitionsProcessed": "0", "totalSlotMs": "3941", "transferredBytes": "0" }, "startTime": "1665776474353", "totalBytesProcessed": "272493208", "totalSlotMs": "3941" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anonec784a4d_5873_4af3_a7a9_f4effa71d694" }, "priority": "INTERACTIVE", "query": "-- start query 5 in stream 0 using template query5.tpl\nwith ssr as\n (select s_store_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ss_store_sk as store_sk,\n ss_sold_date_sk as date_sk,\n ss_ext_sales_price as sales_price,\n ss_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from store_sales\n union all\n select sr_store_sk as store_sk,\n sr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n sr_return_amt as return_amt,\n sr_net_loss as net_loss\n from store_returns\n ) salesreturns,\n date_dim,\n store\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date) \n and (cast('2000-08-23'+14 as date))--add the 14 days manually\n and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select cs_catalog_page_sk as page_sk,\n cs_sold_date_sk as date_sk,\n cs_ext_sales_price as sales_price,\n cs_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from catalog_sales\n union all\n select cr_catalog_page_sk as page_sk,\n cr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n cr_return_amount as return_amt,\n cr_net_loss as net_loss\n from catalog_returns\n ) salesreturns,\n date_dim,\n catalog_page\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23'+14 as date))\n and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ws_web_site_sk as wsr_web_site_sk,\n ws_sold_date_sk as date_sk,\n ws_ext_sales_price as sales_price,\n ws_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from web_sales\n union all\n select ws_web_site_sk as wsr_web_site_sk,\n wr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n wr_return_amt as return_amt,\n wr_net_loss as net_loss\n from web_returns left outer join web_sales on\n ( wr_item_sk = ws_item_sk\n and wr_order_number = ws_order_number)\n ) salesreturns,\n date_dim,\n web_site\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23' as date) + 14 )\n and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n select channel\n , id\n , sum(sales) as sales\n , sum(returns) as returns\n , sum(profit) as profit\n from \n (select 'store channel' as channel\n , 'store' || s_store_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from ssr\n union all\n select 'catalog channel' as channel\n , 'catalog_page' || cp_catalog_page_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from csr\n union all\n select 'web channel' as channel\n , 'web_site' || web_site_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from wsr\n ) x\n group by rollup (channel, id)\n order by channel\n ,id\n limit 100\n ;\n\n-- end query 5 in stream 0 using template query5.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "LEPMH2uLyYfv0QCxlSsuQg==", "id": "test-project-364309:europe-west1.query05_1665776476", "jobReference": { "jobId": "query05_1665776476", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query05_1665776476?location=europe-west1", "statistics": { "creationTime": "1665776477373", "endTime": "1665776479693", "finalExecutionDurationMs": "2031", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "272493208", "performanceInsights": { "avgPreviousExecutionMs": "960" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.005008347245409015, "computeRatioMax": 0.005008347245409015, "endMs": "1665776477645", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.0038953811908736783, "readRatioMax": 0.0038953811908736783, "recordsRead": "30", "recordsWritten": "30", "shuffleOutputBytes": "900", "shuffleOutputBytesSpilled": "0", "slotMs": "43", "startMs": "1665776477609", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:web_site_sk, $21:web_site_id", "FROM web_site" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage00_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0011129660545353367, "waitRatioMax": 0.0011129660545353367, "writeMsAvg": "9", "writeMsMax": "9", "writeRatioAvg": 0.005008347245409015, "writeRatioMax": 0.005008347245409015 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.0077907623817473565, "computeRatioMax": 0.0077907623817473565, "endMs": "1665776477667", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "10", "readMsMax": "10", "readRatioAvg": 0.005564830272676683, "readRatioMax": 0.005564830272676683, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "47", "startMs": "1665776477626", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:d_date_sk, $51:d_date", "FROM date_dim", "WHERE between($51, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$50", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005564830272676684, "waitRatioMax": 0.0005564830272676684, "writeMsAvg": "9", "writeMsMax": "9", "writeRatioAvg": 0.005008347245409015, "writeRatioMax": 0.005008347245409015 }, { "completedParallelInputs": "1", "computeMsAvg": "564", "computeMsMax": "564", "computeRatioAvg": 0.31385642737896496, "computeRatioMax": 0.31385642737896496, "endMs": "1665776478071", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "13", "readMsMax": "13", "readRatioAvg": 0.007234279354479688, "readRatioMax": 0.007234279354479688, "recordsRead": "719384", "recordsWritten": "719384", "shuffleOutputBytes": "19421880", "shuffleOutputBytesSpilled": "0", "slotMs": "735", "startMs": "1665776477639", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$120:ws_item_sk, $121:ws_web_site_sk, $122:ws_order_number", "FROM web_sales" ] }, { "kind": "WRITE", "substeps": [ "$120, $121, $122", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005564830272676684, "waitRatioMax": 0.0005564830272676684, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.010573177518085699, "writeRatioMax": 0.010573177518085699 }, { "completedParallelInputs": "1", "computeMsAvg": "16", "computeMsMax": "16", "computeRatioAvg": 0.008903728436282694, "computeRatioMax": 0.008903728436282694, "endMs": "1665776477692", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.00333889816360601, "readRatioMax": 0.00333889816360601, "recordsRead": "11718", "recordsWritten": "11718", "shuffleOutputBytes": "351540", "shuffleOutputBytesSpilled": "0", "slotMs": "47", "startMs": "1665776477654", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:cp_catalog_page_sk, $11:cp_catalog_page_id", "FROM catalog_page" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage03_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005564830272676684, "waitRatioMax": 0.0005564830272676684, "writeMsAvg": "9", "writeMsMax": "9", "writeRatioAvg": 0.005008347245409015, "writeRatioMax": 0.005008347245409015 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.00667779632721202, "computeRatioMax": 0.00667779632721202, "endMs": "1665776477715", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.0038953811908736783, "readRatioMax": 0.0038953811908736783, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "38", "startMs": "1665776477672", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_date_sk, $41:d_date", "FROM date_dim", "WHERE between($41, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$40", "TO __stage04_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005564830272676684, "waitRatioMax": 0.0005564830272676684, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.0077907623817473565, "writeRatioMax": 0.0077907623817473565 }, { "completedParallelInputs": "1", "computeMsAvg": "16", "computeMsMax": "16", "computeRatioAvg": 0.008903728436282694, "computeRatioMax": 0.008903728436282694, "endMs": "1665776477736", "id": "6", "name": "S06: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.0038953811908736783, "readRatioMax": 0.0038953811908736783, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "360", "shuffleOutputBytesSpilled": "0", "slotMs": "45", "startMs": "1665776477701", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:s_store_sk, $2:s_store_id", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005564830272676684, "waitRatioMax": 0.0005564830272676684, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.01001669449081803, "writeRatioMax": 0.01001669449081803 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.0077907623817473565, "computeRatioMax": 0.0077907623817473565, "endMs": "1665776477742", "id": "7", "name": "S07: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.00333889816360601, "readRatioMax": 0.00333889816360601, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "40", "startMs": "1665776477715", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $31:d_date", "FROM date_dim", "WHERE between($31, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$30", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005564830272676684, "waitRatioMax": 0.0005564830272676684, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.0077907623817473565, "writeRatioMax": 0.0077907623817473565 }, { "completedParallelInputs": "6", "computeMsAvg": "141", "computeMsMax": "185", "computeRatioAvg": 0.07846410684474124, "computeRatioMax": 0.10294936004451864, "endMs": "1665776477911", "id": "9", "inputStages": [ "4", "3" ], "name": "S09: Join+", "parallelInputs": "6", "readMsAvg": "18", "readMsMax": "25", "readRatioAvg": 0.01001669449081803, "readRatioMax": 0.013912075681691708, "recordsRead": "1656013", "recordsWritten": "2182", "shuffleOutputBytes": "194118", "shuffleOutputBytesSpilled": "0", "slotMs": "1086", "startMs": "1665776477734", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:cs_sold_date_sk, $81:cs_catalog_page_sk, $82:cs_ext_sales_price, $83:cs_net_profit", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$90:cr_returned_date_sk, $91:cr_catalog_page_sk, $92:cr_return_amount, $93:cr_net_loss", "FROM catalog_returns" ] }, { "kind": "READ", "substeps": [ "$40", "FROM __stage04_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage03_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $440 := $434", "$270 := SUM($430)", "$271 := SUM($431)", "$272 := SUM($432)", "$273 := SUM($433)" ] }, { "kind": "JOIN", "substeps": [ "$430 := $421, $431 := $422, $432 := $423, $433 := $424, $434 := $11", "INNER HASH JOIN EACH WITH ALL ON $420 = $10" ] }, { "kind": "JOIN", "substeps": [ "$420 := $300, $421 := $302, $422 := $303, $423 := $304, $424 := $305", "INNER HASH JOIN EACH WITH ALL ON $301 = $40" ] }, { "kind": "COMPUTE", "substeps": [ "$340 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$350 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$440, $270, $271, $272, $273", "TO __stage09_output", "BY HASH($440)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005564830272676684, "waitRatioMax": 0.0005564830272676684, "writeMsAvg": "6", "writeMsMax": "12", "writeRatioAvg": 0.00333889816360601, "writeRatioMax": 0.00667779632721202 }, { "completedParallelInputs": "7", "computeMsAvg": "203", "computeMsMax": "265", "computeRatioAvg": 0.11296605453533667, "computeRatioMax": 0.14746800222593212, "endMs": "1665776477976", "id": "10", "inputStages": [ "7", "6" ], "name": "S0A: Join+", "parallelInputs": "7", "readMsAvg": "24", "readMsMax": "43", "readRatioAvg": 0.01335559265442404, "readRatioMax": 0.023928770172509738, "recordsRead": "3168107", "recordsWritten": "42", "shuffleOutputBytes": "3738", "shuffleOutputBytesSpilled": "0", "slotMs": "1706", "startMs": "1665776477751", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:ss_sold_date_sk, $61:ss_store_sk, $62:ss_ext_sales_price, $63:ss_net_profit", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$70:sr_returned_date_sk, $71:sr_store_sk, $72:sr_return_amt, $73:sr_net_loss", "FROM store_returns" ] }, { "kind": "READ", "substeps": [ "$30", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $400 := $394", "$260 := SUM($390)", "$261 := SUM($391)", "$262 := SUM($392)", "$263 := SUM($393)" ] }, { "kind": "JOIN", "substeps": [ "$390 := $381, $391 := $382, $392 := $383, $393 := $384, $394 := $2", "INNER HASH JOIN EACH WITH ALL ON $380 = $1" ] }, { "kind": "JOIN", "substeps": [ "$380 := $290, $381 := $292, $382 := $293, $383 := $294, $384 := $295", "INNER HASH JOIN EACH WITH ALL ON $291 = $30" ] }, { "kind": "COMPUTE", "substeps": [ "$320 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$330 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$400, $260, $261, $262, $263", "TO __stage0A_output", "BY HASH($400)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005564830272676684, "waitRatioMax": 0.0005564830272676684, "writeMsAvg": "7", "writeMsMax": "15", "writeRatioAvg": 0.0038953811908736783, "writeRatioMax": 0.008347245409015025 }, { "completedParallelInputs": "2", "computeMsAvg": "1065", "computeMsMax": "1797", "computeRatioAvg": 0.5926544240400667, "computeRatioMax": 1, "endMs": "1665776479274", "id": "11", "inputStages": [ "0", "1", "2" ], "name": "S0B: Join+", "parallelInputs": "2", "readMsAvg": "16", "readMsMax": "18", "readRatioAvg": 0.008903728436282694, "readRatioMax": 0.01001669449081803, "recordsRead": "1510621", "recordsWritten": "30", "shuffleOutputBytes": "2670", "shuffleOutputBytesSpilled": "0", "slotMs": "2386", "startMs": "1665776478153", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$100:ws_sold_date_sk, $101:ws_web_site_sk, $102:ws_ext_sales_price, $103:ws_net_profit", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$110:wr_returned_date_sk, $111:wr_item_sk, $112:wr_order_number, $113:wr_return_amt, $114:wr_net_loss", "FROM web_returns" ] }, { "kind": "READ", "substeps": [ "$120, $121, $122", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$50", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $490 := $484", "$280 := SUM($480)", "$281 := SUM($481)", "$282 := SUM($482)", "$283 := SUM($483)" ] }, { "kind": "JOIN", "substeps": [ "$480 := $471, $481 := $472, $482 := $473, $483 := $474, $484 := $21", "INNER HASH JOIN EACH WITH ALL ON $470 = $20" ] }, { "kind": "JOIN", "substeps": [ "$470 := $310, $471 := $312, $472 := $313, $473 := $314, $474 := $315", "INNER HASH JOIN EACH WITH ALL ON $311 = $50" ] }, { "kind": "COMPUTE", "substeps": [ "$360 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$370 := NUMERIC<...>" ] }, { "kind": "JOIN", "substeps": [ "$460 := $110, $461 := $113, $462 := $114, $463 := $121", "LEFT OUTER HASH JOIN EACH WITH ALL ON $111 = $120, $112 = $122" ] }, { "kind": "WRITE", "substeps": [ "$490, $280, $281, $282, $283", "TO __stage0B_output", "BY HASH($490)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005564830272676684, "waitRatioMax": 0.0005564830272676684, "writeMsAvg": "9", "writeMsMax": "11", "writeRatioAvg": 0.005008347245409015, "writeRatioMax": 0.006121313299944352 }, { "completedParallelInputs": "3", "computeMsAvg": "12", "computeMsMax": "15", "computeRatioAvg": 0.00667779632721202, "computeRatioMax": 0.008347245409015025, "endMs": "1665776479534", "id": "12", "inputStages": [ "11", "9", "10" ], "name": "S0C: Aggregate+", "parallelInputs": "3", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "2254", "recordsWritten": "686", "shuffleOutputBytes": "77073", "shuffleOutputBytesSpilled": "0", "slotMs": "131", "startMs": "1665776479496", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$400, $260, $261, $262, $263", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$440, $270, $271, $272, $273", "FROM __stage09_output" ] }, { "kind": "READ", "substeps": [ "$490, $280, $281, $282, $283", "FROM __stage0B_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $510 := $150, $511 := $151, $512 := $170", "$140 := SUM($182)", "$141 := SUM($183)", "$142 := SUM($184)" ] }, { "kind": "COMPUTE", "substeps": [ "$150 := if(equal(bitwise_and($190, 1), 0), NULL, $180)", "$151 := if(equal(bitwise_and($190, 2), 0), NULL, $181)" ] }, { "kind": "COMPUTE", "substeps": [ "$160 := ARRAY<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := 'store channel'", "$201 := concat('store', $410)", "$202 := subtract($231, $233)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $410 := $400", "$230 := SUM($260)", "$231 := SUM($261)", "$232 := SUM($262)", "$233 := SUM($263)" ] }, { "kind": "COMPUTE", "substeps": [ "$210 := 'catalog channel'", "$211 := concat('catalog_page', $450)", "$212 := subtract($241, $243)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $450 := $440", "$240 := SUM($270)", "$241 := SUM($271)", "$242 := SUM($272)", "$243 := SUM($273)" ] }, { "kind": "COMPUTE", "substeps": [ "$220 := 'web channel'", "$221 := concat('web_site', $500)", "$222 := subtract($251, $253)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $500 := $490", "$250 := SUM($280)", "$251 := SUM($281)", "$252 := SUM($282)", "$253 := SUM($283)" ] }, { "kind": "COMPUTE", "substeps": [ "$170 := subtract($191, 1)" ] }, { "kind": "WRITE", "substeps": [ "$140, $141, $142, $510, $511, $512", "TO __stage0C_output", "BY HASH($510, $511, $512)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005564830272676684, "waitRatioMax": 0.0005564830272676684, "writeMsAvg": "13", "writeMsMax": "15", "writeRatioAvg": 0.007234279354479688, "writeRatioMax": 0.008347245409015025 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.005564830272676683, "computeRatioMax": 0.005564830272676683, "endMs": "1665776479583", "id": "13", "inputStages": [ "12" ], "name": "S0D: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "686", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "37", "startMs": "1665776479546", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$140, $141, $142, $510, $511, $512", "FROM __stage0C_output" ] }, { "kind": "SORT", "substeps": [ "$520 ASC, $521 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $520 := $510, $521 := $511, $522 := $512", "$130 := SUM($140)", "$131 := SUM($141)", "$132 := SUM($142)" ] }, { "kind": "WRITE", "substeps": [ "$530, $531, $532, $533, $534", "TO __stage0D_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005564830272676684, "waitRatioMax": 0.0005564830272676684, "writeMsAvg": "27", "writeMsMax": "27", "writeRatioAvg": 0.015025041736227046, "writeRatioMax": 0.015025041736227046 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.005564830272676683, "computeRatioMax": 0.005564830272676683, "endMs": "1665776479604", "id": "14", "inputStages": [ "13" ], "name": "S0E: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "54", "startMs": "1665776479563", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$530, $531, $532, $533, $534", "FROM __stage0D_output" ] }, { "kind": "SORT", "substeps": [ "$533 ASC, $534 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$540, $541, $542, $543, $544", "TO __stage0E_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005564830272676684, "waitRatioMax": 0.0005564830272676684, "writeMsAvg": "5", "writeMsMax": "5", "writeRatioAvg": 0.0027824151363383415, "writeRatioMax": 0.0027824151363383415 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_page" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_site" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_returns" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "0", "completedUnits": "20", "elapsedMs": "674", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "3791" }, { "activeUnits": "1", "completedUnits": "27", "elapsedMs": "2206", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "6401" } ], "totalBytesBilled": "272629760", "totalBytesProcessed": "272493208", "totalPartitionsProcessed": "0", "totalSlotMs": "6401", "transferredBytes": "0" }, "startTime": "1665776477436", "totalBytesProcessed": "272493208", "totalSlotMs": "6401" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon52471244_f4d4_4082_95f9_646a8221f8fd" }, "priority": "INTERACTIVE", "query": "-- start query 5 in stream 0 using template query5.tpl\nwith ssr as\n (select s_store_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ss_store_sk as store_sk,\n ss_sold_date_sk as date_sk,\n ss_ext_sales_price as sales_price,\n ss_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from store_sales\n union all\n select sr_store_sk as store_sk,\n sr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n sr_return_amt as return_amt,\n sr_net_loss as net_loss\n from store_returns\n ) salesreturns,\n date_dim,\n store\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date) \n and (cast('2000-08-23'+14 as date))--add the 14 days manually\n and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select cs_catalog_page_sk as page_sk,\n cs_sold_date_sk as date_sk,\n cs_ext_sales_price as sales_price,\n cs_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from catalog_sales\n union all\n select cr_catalog_page_sk as page_sk,\n cr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n cr_return_amount as return_amt,\n cr_net_loss as net_loss\n from catalog_returns\n ) salesreturns,\n date_dim,\n catalog_page\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23'+14 as date))\n and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ws_web_site_sk as wsr_web_site_sk,\n ws_sold_date_sk as date_sk,\n ws_ext_sales_price as sales_price,\n ws_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from web_sales\n union all\n select ws_web_site_sk as wsr_web_site_sk,\n wr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n wr_return_amt as return_amt,\n wr_net_loss as net_loss\n from web_returns left outer join web_sales on\n ( wr_item_sk = ws_item_sk\n and wr_order_number = ws_order_number)\n ) salesreturns,\n date_dim,\n web_site\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23' as date) + 14 )\n and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n select channel\n , id\n , sum(sales) as sales\n , sum(returns) as returns\n , sum(profit) as profit\n from \n (select 'store channel' as channel\n , 'store' || s_store_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from ssr\n union all\n select 'catalog channel' as channel\n , 'catalog_page' || cp_catalog_page_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from csr\n union all\n select 'web channel' as channel\n , 'web_site' || web_site_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from wsr\n ) x\n group by rollup (channel, id)\n order by channel\n ,id\n limit 100\n ;\n\n-- end query 5 in stream 0 using template query5.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "811DpW9vS8n9AEEIBN+2vQ==", "id": "test-project-364309:europe-west1.query05_1665776480", "jobReference": { "jobId": "query05_1665776480", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query05_1665776480?location=europe-west1", "statistics": { "creationTime": "1665776481480", "endTime": "1665776482629", "finalExecutionDurationMs": "873", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "272493208", "performanceInsights": { "avgPreviousExecutionMs": "973" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.01277139208173691, "computeRatioMax": 0.01277139208173691, "endMs": "1665776481749", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.005108556832694764, "readRatioMax": 0.005108556832694764, "recordsRead": "30", "recordsWritten": "30", "shuffleOutputBytes": "900", "shuffleOutputBytesSpilled": "0", "slotMs": "72", "startMs": "1665776481708", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:web_site_sk, $21:web_site_id", "FROM web_site" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage00_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002554278416347382, "waitRatioMax": 0.002554278416347382, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.021711366538952746, "writeRatioMax": 0.021711366538952746 }, { "completedParallelInputs": "1", "computeMsAvg": "18", "computeMsMax": "18", "computeRatioAvg": 0.022988505747126436, "computeRatioMax": 0.022988505747126436, "endMs": "1665776481776", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.008939974457215836, "readRatioMax": 0.008939974457215836, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "61", "startMs": "1665776481731", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:d_date_sk, $51:d_date", "FROM date_dim", "WHERE between($51, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$50", "TO __stage01_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.0038314176245210726, "waitRatioMax": 0.0038314176245210726, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.019157088122605363, "writeRatioMax": 0.019157088122605363 }, { "completedParallelInputs": "1", "computeMsAvg": "438", "computeMsMax": "438", "computeRatioAvg": 0.5593869731800766, "computeRatioMax": 0.5593869731800766, "endMs": "1665776482008", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.010217113665389528, "readRatioMax": 0.010217113665389528, "recordsRead": "719384", "recordsWritten": "719384", "shuffleOutputBytes": "19421880", "shuffleOutputBytesSpilled": "0", "slotMs": "592", "startMs": "1665776481759", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$120:ws_item_sk, $121:ws_web_site_sk, $122:ws_order_number", "FROM web_sales" ] }, { "kind": "WRITE", "substeps": [ "$120, $121, $122", "TO __stage02_output" ] } ], "waitMsAvg": "4", "waitMsMax": "4", "waitRatioAvg": 0.005108556832694764, "waitRatioMax": 0.005108556832694764, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.017879948914431672, "writeRatioMax": 0.017879948914431672 }, { "completedParallelInputs": "1", "computeMsAvg": "21", "computeMsMax": "21", "computeRatioAvg": 0.02681992337164751, "computeRatioMax": 0.02681992337164751, "endMs": "1665776481828", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.007662835249042145, "readRatioMax": 0.007662835249042145, "recordsRead": "11718", "recordsWritten": "11718", "shuffleOutputBytes": "351540", "shuffleOutputBytesSpilled": "0", "slotMs": "86", "startMs": "1665776481782", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:cp_catalog_page_sk, $11:cp_catalog_page_id", "FROM catalog_page" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage03_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002554278416347382, "waitRatioMax": 0.002554278416347382, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.021711366538952746, "writeRatioMax": 0.021711366538952746 }, { "completedParallelInputs": "1", "computeMsAvg": "19", "computeMsMax": "19", "computeRatioAvg": 0.024265644955300127, "computeRatioMax": 0.024265644955300127, "endMs": "1665776481851", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "11", "readMsMax": "11", "readRatioAvg": 0.0140485312899106, "readRatioMax": 0.0140485312899106, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "82", "startMs": "1665776481803", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_date_sk, $41:d_date", "FROM date_dim", "WHERE between($41, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$40", "TO __stage04_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002554278416347382, "waitRatioMax": 0.002554278416347382, "writeMsAvg": "10", "writeMsMax": "10", "writeRatioAvg": 0.01277139208173691, "writeRatioMax": 0.01277139208173691 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.008939974457215836, "computeRatioMax": 0.008939974457215836, "endMs": "1665776481901", "id": "6", "name": "S06: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.005108556832694764, "readRatioMax": 0.005108556832694764, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "360", "shuffleOutputBytesSpilled": "0", "slotMs": "77", "startMs": "1665776481850", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:s_store_sk, $2:s_store_id", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage06_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002554278416347382, "waitRatioMax": 0.002554278416347382, "writeMsAvg": "30", "writeMsMax": "30", "writeRatioAvg": 0.038314176245210725, "writeRatioMax": 0.038314176245210725 }, { "completedParallelInputs": "1", "computeMsAvg": "18", "computeMsMax": "18", "computeRatioAvg": 0.022988505747126436, "computeRatioMax": 0.022988505747126436, "endMs": "1665776481929", "id": "7", "name": "S07: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.008939974457215836, "readRatioMax": 0.008939974457215836, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "80", "startMs": "1665776481883", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $31:d_date", "FROM date_dim", "WHERE between($31, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$30", "TO __stage07_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002554278416347382, "waitRatioMax": 0.002554278416347382, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.017879948914431672, "writeRatioMax": 0.017879948914431672 }, { "completedParallelInputs": "6", "computeMsAvg": "147", "computeMsMax": "190", "computeRatioAvg": 0.18773946360153257, "computeRatioMax": 0.24265644955300128, "endMs": "1665776482046", "id": "9", "inputStages": [ "4", "3" ], "name": "S09: Join+", "parallelInputs": "6", "readMsAvg": "19", "readMsMax": "29", "readRatioAvg": 0.024265644955300127, "readRatioMax": 0.037037037037037035, "recordsRead": "1656013", "recordsWritten": "2182", "shuffleOutputBytes": "194118", "shuffleOutputBytesSpilled": "0", "slotMs": "1016", "startMs": "1665776481913", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:cs_sold_date_sk, $81:cs_catalog_page_sk, $82:cs_ext_sales_price, $83:cs_net_profit", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$90:cr_returned_date_sk, $91:cr_catalog_page_sk, $92:cr_return_amount, $93:cr_net_loss", "FROM catalog_returns" ] }, { "kind": "READ", "substeps": [ "$40", "FROM __stage04_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage03_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $440 := $434", "$270 := SUM($430)", "$271 := SUM($431)", "$272 := SUM($432)", "$273 := SUM($433)" ] }, { "kind": "JOIN", "substeps": [ "$430 := $421, $431 := $422, $432 := $423, $433 := $424, $434 := $11", "INNER HASH JOIN EACH WITH ALL ON $420 = $10" ] }, { "kind": "JOIN", "substeps": [ "$420 := $300, $421 := $302, $422 := $303, $423 := $304, $424 := $305", "INNER HASH JOIN EACH WITH ALL ON $301 = $40" ] }, { "kind": "COMPUTE", "substeps": [ "$340 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$350 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$440, $270, $271, $272, $273", "TO __stage09_output", "BY HASH($440)" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.002554278416347382, "waitRatioMax": 0.0038314176245210726, "writeMsAvg": "6", "writeMsMax": "9", "writeRatioAvg": 0.007662835249042145, "writeRatioMax": 0.011494252873563218 }, { "completedParallelInputs": "7", "computeMsAvg": "194", "computeMsMax": "255", "computeRatioAvg": 0.24776500638569604, "computeRatioMax": 0.32567049808429116, "endMs": "1665776482145", "id": "10", "inputStages": [ "7", "6" ], "name": "S0A: Join+", "parallelInputs": "7", "readMsAvg": "16", "readMsMax": "23", "readRatioAvg": 0.020434227330779056, "readRatioMax": 0.02937420178799489, "recordsRead": "3168107", "recordsWritten": "42", "shuffleOutputBytes": "3738", "shuffleOutputBytesSpilled": "0", "slotMs": "1396", "startMs": "1665776481966", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:ss_sold_date_sk, $61:ss_store_sk, $62:ss_ext_sales_price, $63:ss_net_profit", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$70:sr_returned_date_sk, $71:sr_store_sk, $72:sr_return_amt, $73:sr_net_loss", "FROM store_returns" ] }, { "kind": "READ", "substeps": [ "$30", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $400 := $394", "$260 := SUM($390)", "$261 := SUM($391)", "$262 := SUM($392)", "$263 := SUM($393)" ] }, { "kind": "JOIN", "substeps": [ "$390 := $381, $391 := $382, $392 := $383, $393 := $384, $394 := $2", "INNER HASH JOIN EACH WITH ALL ON $380 = $1" ] }, { "kind": "JOIN", "substeps": [ "$380 := $290, $381 := $292, $382 := $293, $383 := $294, $384 := $295", "INNER HASH JOIN EACH WITH ALL ON $291 = $30" ] }, { "kind": "COMPUTE", "substeps": [ "$320 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$330 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$400, $260, $261, $262, $263", "TO __stage0A_output", "BY HASH($400)" ] } ], "waitMsAvg": "5", "waitMsMax": "5", "waitRatioAvg": 0.006385696040868455, "waitRatioMax": 0.006385696040868455, "writeMsAvg": "4", "writeMsMax": "5", "writeRatioAvg": 0.005108556832694764, "writeRatioMax": 0.006385696040868455 }, { "completedParallelInputs": "2", "computeMsAvg": "514", "computeMsMax": "783", "computeRatioAvg": 0.6564495530012772, "computeRatioMax": 1, "endMs": "1665776482361", "id": "11", "inputStages": [ "2", "0", "1" ], "name": "S0B: Join+", "parallelInputs": "2", "readMsAvg": "17", "readMsMax": "22", "readRatioAvg": 0.021711366538952746, "readRatioMax": 0.0280970625798212, "recordsRead": "1510621", "recordsWritten": "30", "shuffleOutputBytes": "2670", "shuffleOutputBytesSpilled": "0", "slotMs": "1045", "startMs": "1665776482040", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$100:ws_sold_date_sk, $101:ws_web_site_sk, $102:ws_ext_sales_price, $103:ws_net_profit", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$110:wr_returned_date_sk, $111:wr_item_sk, $112:wr_order_number, $113:wr_return_amt, $114:wr_net_loss", "FROM web_returns" ] }, { "kind": "READ", "substeps": [ "$120, $121, $122", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$50", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $490 := $484", "$280 := SUM($480)", "$281 := SUM($481)", "$282 := SUM($482)", "$283 := SUM($483)" ] }, { "kind": "JOIN", "substeps": [ "$480 := $471, $481 := $472, $482 := $473, $483 := $474, $484 := $21", "INNER HASH JOIN EACH WITH ALL ON $470 = $20" ] }, { "kind": "JOIN", "substeps": [ "$470 := $310, $471 := $312, $472 := $313, $473 := $314, $474 := $315", "INNER HASH JOIN EACH WITH ALL ON $311 = $50" ] }, { "kind": "COMPUTE", "substeps": [ "$360 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$370 := NUMERIC<...>" ] }, { "kind": "JOIN", "substeps": [ "$460 := $110, $461 := $113, $462 := $114, $463 := $121", "LEFT OUTER HASH JOIN EACH WITH ALL ON $111 = $120, $112 = $122" ] }, { "kind": "WRITE", "substeps": [ "$490, $280, $281, $282, $283", "TO __stage0B_output", "BY HASH($490)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002554278416347382, "waitRatioMax": 0.002554278416347382, "writeMsAvg": "7", "writeMsMax": "7", "writeRatioAvg": 0.008939974457215836, "writeRatioMax": 0.008939974457215836 }, { "completedParallelInputs": "3", "computeMsAvg": "13", "computeMsMax": "16", "computeRatioAvg": 0.016602809706257982, "computeRatioMax": 0.020434227330779056, "endMs": "1665776482456", "id": "12", "inputStages": [ "9", "10", "11" ], "name": "S0C: Aggregate+", "parallelInputs": "3", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "2254", "recordsWritten": "686", "shuffleOutputBytes": "77073", "shuffleOutputBytesSpilled": "0", "slotMs": "171", "startMs": "1665776482400", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$400, $260, $261, $262, $263", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$440, $270, $271, $272, $273", "FROM __stage09_output" ] }, { "kind": "READ", "substeps": [ "$490, $280, $281, $282, $283", "FROM __stage0B_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $510 := $150, $511 := $151, $512 := $170", "$140 := SUM($182)", "$141 := SUM($183)", "$142 := SUM($184)" ] }, { "kind": "COMPUTE", "substeps": [ "$150 := if(equal(bitwise_and($190, 1), 0), NULL, $180)", "$151 := if(equal(bitwise_and($190, 2), 0), NULL, $181)" ] }, { "kind": "COMPUTE", "substeps": [ "$160 := ARRAY<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := 'store channel'", "$201 := concat('store', $410)", "$202 := subtract($231, $233)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $410 := $400", "$230 := SUM($260)", "$231 := SUM($261)", "$232 := SUM($262)", "$233 := SUM($263)" ] }, { "kind": "COMPUTE", "substeps": [ "$210 := 'catalog channel'", "$211 := concat('catalog_page', $450)", "$212 := subtract($241, $243)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $450 := $440", "$240 := SUM($270)", "$241 := SUM($271)", "$242 := SUM($272)", "$243 := SUM($273)" ] }, { "kind": "COMPUTE", "substeps": [ "$220 := 'web channel'", "$221 := concat('web_site', $500)", "$222 := subtract($251, $253)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $500 := $490", "$250 := SUM($280)", "$251 := SUM($281)", "$252 := SUM($282)", "$253 := SUM($283)" ] }, { "kind": "COMPUTE", "substeps": [ "$170 := subtract($191, 1)" ] }, { "kind": "WRITE", "substeps": [ "$140, $141, $142, $510, $511, $512", "TO __stage0C_output", "BY HASH($510, $511, $512)" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.002554278416347382, "waitRatioMax": 0.0038314176245210726, "writeMsAvg": "14", "writeMsMax": "15", "writeRatioAvg": 0.017879948914431672, "writeRatioMax": 0.019157088122605363 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.010217113665389528, "computeRatioMax": 0.010217113665389528, "endMs": "1665776482504", "id": "13", "inputStages": [ "12" ], "name": "S0D: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "686", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "31", "startMs": "1665776482467", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$140, $141, $142, $510, $511, $512", "FROM __stage0C_output" ] }, { "kind": "SORT", "substeps": [ "$520 ASC, $521 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $520 := $510, $521 := $511, $522 := $512", "$130 := SUM($140)", "$131 := SUM($141)", "$132 := SUM($142)" ] }, { "kind": "WRITE", "substeps": [ "$530, $531, $532, $533, $534", "TO __stage0D_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.001277139208173691, "waitRatioMax": 0.001277139208173691, "writeMsAvg": "28", "writeMsMax": "28", "writeRatioAvg": 0.035759897828863345, "writeRatioMax": 0.035759897828863345 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.008939974457215836, "computeRatioMax": 0.008939974457215836, "endMs": "1665776482527", "id": "14", "inputStages": [ "13" ], "name": "S0E: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "45", "startMs": "1665776482487", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$530, $531, $532, $533, $534", "FROM __stage0D_output" ] }, { "kind": "SORT", "substeps": [ "$533 ASC, $534 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$540, $541, $542, $543, $544", "TO __stage0E_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002554278416347382, "waitRatioMax": 0.002554278416347382, "writeMsAvg": "21", "writeMsMax": "21", "writeRatioAvg": 0.02681992337164751, "writeRatioMax": 0.02681992337164751 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_page" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_site" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "2", "completedUnits": "20", "elapsedMs": "675", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "3600" }, { "activeUnits": "2", "completedUnits": "27", "elapsedMs": "1049", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "4850" } ], "totalBytesBilled": "272629760", "totalBytesProcessed": "272493208", "totalPartitionsProcessed": "0", "totalSlotMs": "4850", "transferredBytes": "0" }, "startTime": "1665776481535", "totalBytesProcessed": "272493208", "totalSlotMs": "4850" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon9c0396a7_b5f3_4d2e_b4da_5949c4ca7024" }, "priority": "INTERACTIVE", "query": "-- start query 5 in stream 0 using template query5.tpl\nwith ssr as\n (select s_store_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ss_store_sk as store_sk,\n ss_sold_date_sk as date_sk,\n ss_ext_sales_price as sales_price,\n ss_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from store_sales\n union all\n select sr_store_sk as store_sk,\n sr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n sr_return_amt as return_amt,\n sr_net_loss as net_loss\n from store_returns\n ) salesreturns,\n date_dim,\n store\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date) \n and (cast('2000-08-23'+14 as date))--add the 14 days manually\n and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select cs_catalog_page_sk as page_sk,\n cs_sold_date_sk as date_sk,\n cs_ext_sales_price as sales_price,\n cs_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from catalog_sales\n union all\n select cr_catalog_page_sk as page_sk,\n cr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n cr_return_amount as return_amt,\n cr_net_loss as net_loss\n from catalog_returns\n ) salesreturns,\n date_dim,\n catalog_page\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23'+14 as date))\n and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ws_web_site_sk as wsr_web_site_sk,\n ws_sold_date_sk as date_sk,\n ws_ext_sales_price as sales_price,\n ws_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from web_sales\n union all\n select ws_web_site_sk as wsr_web_site_sk,\n wr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n wr_return_amt as return_amt,\n wr_net_loss as net_loss\n from web_returns left outer join web_sales on\n ( wr_item_sk = ws_item_sk\n and wr_order_number = ws_order_number)\n ) salesreturns,\n date_dim,\n web_site\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23' as date) + 14 )\n and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n select channel\n , id\n , sum(sales) as sales\n , sum(returns) as returns\n , sum(profit) as profit\n from \n (select 'store channel' as channel\n , 'store' || s_store_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from ssr\n union all\n select 'catalog channel' as channel\n , 'catalog_page' || cp_catalog_page_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from csr\n union all\n select 'web channel' as channel\n , 'web_site' || web_site_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from wsr\n ) x\n group by rollup (channel, id)\n order by channel\n ,id\n limit 100\n ;\n\n-- end query 5 in stream 0 using template query5.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "vRTIjbszAvjqDvD6qdszPw==", "id": "test-project-364309:europe-west1.query05_1665776734", "jobReference": { "jobId": "query05_1665776734", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query05_1665776734?location=europe-west1", "statistics": { "creationTime": "1665776734619", "endTime": "1665776736080", "finalExecutionDurationMs": "1138", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "272493208", "performanceInsights": { "avgPreviousExecutionMs": "972" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.007526881720430108, "computeRatioMax": 0.007526881720430108, "endMs": "1665776734911", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.0064516129032258064, "readRatioMax": 0.0064516129032258064, "recordsRead": "30", "recordsWritten": "30", "shuffleOutputBytes": "900", "shuffleOutputBytesSpilled": "0", "slotMs": "26", "startMs": "1665776734880", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:web_site_sk, $21:web_site_id", "FROM web_site" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage00_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002150537634408602, "waitRatioMax": 0.002150537634408602, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.01935483870967742, "writeRatioMax": 0.01935483870967742 }, { "completedParallelInputs": "1", "computeMsAvg": "16", "computeMsMax": "16", "computeRatioAvg": 0.017204301075268817, "computeRatioMax": 0.017204301075268817, "endMs": "1665776734934", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.0064516129032258064, "readRatioMax": 0.0064516129032258064, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "39", "startMs": "1665776734895", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:d_date_sk, $51:d_date", "FROM date_dim", "WHERE between($51, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$50", "TO __stage01_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002150537634408602, "waitRatioMax": 0.002150537634408602, "writeMsAvg": "12", "writeMsMax": "12", "writeRatioAvg": 0.012903225806451613, "writeRatioMax": 0.012903225806451613 }, { "completedParallelInputs": "1", "computeMsAvg": "394", "computeMsMax": "394", "computeRatioAvg": 0.4236559139784946, "computeRatioMax": 0.4236559139784946, "endMs": "1665776735229", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "15", "readMsMax": "15", "readRatioAvg": 0.016129032258064516, "readRatioMax": 0.016129032258064516, "recordsRead": "719384", "recordsWritten": "719384", "shuffleOutputBytes": "19421880", "shuffleOutputBytesSpilled": "0", "slotMs": "417", "startMs": "1665776734909", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$120:ws_item_sk, $121:ws_web_site_sk, $122:ws_order_number", "FROM web_sales" ] }, { "kind": "WRITE", "substeps": [ "$120, $121, $122", "TO __stage02_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002150537634408602, "waitRatioMax": 0.002150537634408602, "writeMsAvg": "21", "writeMsMax": "21", "writeRatioAvg": 0.02258064516129032, "writeRatioMax": 0.02258064516129032 }, { "completedParallelInputs": "1", "computeMsAvg": "21", "computeMsMax": "21", "computeRatioAvg": 0.02258064516129032, "computeRatioMax": 0.02258064516129032, "endMs": "1665776734956", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.005376344086021506, "readRatioMax": 0.005376344086021506, "recordsRead": "11718", "recordsWritten": "11718", "shuffleOutputBytes": "351540", "shuffleOutputBytesSpilled": "0", "slotMs": "39", "startMs": "1665776734924", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:cp_catalog_page_sk, $11:cp_catalog_page_id", "FROM catalog_page" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage03_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002150537634408602, "waitRatioMax": 0.002150537634408602, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.016129032258064516, "writeRatioMax": 0.016129032258064516 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.015053763440860216, "computeRatioMax": 0.015053763440860216, "endMs": "1665776734979", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.0064516129032258064, "readRatioMax": 0.0064516129032258064, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "38", "startMs": "1665776734942", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_date_sk, $41:d_date", "FROM date_dim", "WHERE between($41, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$40", "TO __stage04_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002150537634408602, "waitRatioMax": 0.002150537634408602, "writeMsAvg": "9", "writeMsMax": "9", "writeRatioAvg": 0.00967741935483871, "writeRatioMax": 0.00967741935483871 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.008602150537634409, "computeRatioMax": 0.008602150537634409, "endMs": "1665776735009", "id": "6", "name": "S06: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.005376344086021506, "readRatioMax": 0.005376344086021506, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "360", "shuffleOutputBytesSpilled": "0", "slotMs": "38", "startMs": "1665776734968", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:s_store_sk, $2:s_store_id", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage06_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002150537634408602, "waitRatioMax": 0.002150537634408602, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.01935483870967742, "writeRatioMax": 0.01935483870967742 }, { "completedParallelInputs": "1", "computeMsAvg": "18", "computeMsMax": "18", "computeRatioAvg": 0.01935483870967742, "computeRatioMax": 0.01935483870967742, "endMs": "1665776735027", "id": "7", "name": "S07: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.007526881720430108, "readRatioMax": 0.007526881720430108, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "44", "startMs": "1665776734984", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $31:d_date", "FROM date_dim", "WHERE between($31, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$30", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.001075268817204301, "waitRatioMax": 0.001075268817204301, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.016129032258064516, "writeRatioMax": 0.016129032258064516 }, { "completedParallelInputs": "6", "computeMsAvg": "130", "computeMsMax": "180", "computeRatioAvg": 0.13978494623655913, "computeRatioMax": 0.1935483870967742, "endMs": "1665776735119", "id": "9", "inputStages": [ "4", "3" ], "name": "S09: Join+", "parallelInputs": "6", "readMsAvg": "18", "readMsMax": "26", "readRatioAvg": 0.01935483870967742, "readRatioMax": 0.02795698924731183, "recordsRead": "1656013", "recordsWritten": "2182", "shuffleOutputBytes": "194118", "shuffleOutputBytesSpilled": "0", "slotMs": "812", "startMs": "1665776735003", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:cs_sold_date_sk, $81:cs_catalog_page_sk, $82:cs_ext_sales_price, $83:cs_net_profit", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$90:cr_returned_date_sk, $91:cr_catalog_page_sk, $92:cr_return_amount, $93:cr_net_loss", "FROM catalog_returns" ] }, { "kind": "READ", "substeps": [ "$40", "FROM __stage04_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage03_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $440 := $434", "$270 := SUM($430)", "$271 := SUM($431)", "$272 := SUM($432)", "$273 := SUM($433)" ] }, { "kind": "JOIN", "substeps": [ "$430 := $421, $431 := $422, $432 := $423, $433 := $424, $434 := $11", "INNER HASH JOIN EACH WITH ALL ON $420 = $10" ] }, { "kind": "JOIN", "substeps": [ "$420 := $300, $421 := $302, $422 := $303, $423 := $304, $424 := $305", "INNER HASH JOIN EACH WITH ALL ON $301 = $40" ] }, { "kind": "COMPUTE", "substeps": [ "$340 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$350 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$440, $270, $271, $272, $273", "TO __stage09_output", "BY HASH($440)" ] } ], "waitMsAvg": "1", "waitMsMax": "2", "waitRatioAvg": 0.001075268817204301, "waitRatioMax": 0.002150537634408602, "writeMsAvg": "5", "writeMsMax": "6", "writeRatioAvg": 0.005376344086021506, "writeRatioMax": 0.0064516129032258064 }, { "completedParallelInputs": "7", "computeMsAvg": "214", "computeMsMax": "253", "computeRatioAvg": 0.23010752688172043, "computeRatioMax": 0.27204301075268816, "endMs": "1665776735200", "id": "10", "inputStages": [ "7", "6" ], "name": "S0A: Join+", "parallelInputs": "7", "readMsAvg": "13", "readMsMax": "19", "readRatioAvg": 0.013978494623655914, "readRatioMax": 0.02043010752688172, "recordsRead": "3168107", "recordsWritten": "42", "shuffleOutputBytes": "3738", "shuffleOutputBytesSpilled": "0", "slotMs": "1241", "startMs": "1665776735041", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:ss_sold_date_sk, $61:ss_store_sk, $62:ss_ext_sales_price, $63:ss_net_profit", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$70:sr_returned_date_sk, $71:sr_store_sk, $72:sr_return_amt, $73:sr_net_loss", "FROM store_returns" ] }, { "kind": "READ", "substeps": [ "$30", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $400 := $394", "$260 := SUM($390)", "$261 := SUM($391)", "$262 := SUM($392)", "$263 := SUM($393)" ] }, { "kind": "JOIN", "substeps": [ "$390 := $381, $391 := $382, $392 := $383, $393 := $384, $394 := $2", "INNER HASH JOIN EACH WITH ALL ON $380 = $1" ] }, { "kind": "JOIN", "substeps": [ "$380 := $290, $381 := $292, $382 := $293, $383 := $294, $384 := $295", "INNER HASH JOIN EACH WITH ALL ON $291 = $30" ] }, { "kind": "COMPUTE", "substeps": [ "$320 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$330 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$400, $260, $261, $262, $263", "TO __stage0A_output", "BY HASH($400)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002150537634408602, "waitRatioMax": 0.002150537634408602, "writeMsAvg": "4", "writeMsMax": "6", "writeRatioAvg": 0.004301075268817204, "writeRatioMax": 0.0064516129032258064 }, { "completedParallelInputs": "2", "computeMsAvg": "598", "computeMsMax": "930", "computeRatioAvg": 0.6430107526881721, "computeRatioMax": 1, "endMs": "1665776735791", "id": "11", "inputStages": [ "0", "1", "2" ], "name": "S0B: Join+", "parallelInputs": "2", "readMsAvg": "17", "readMsMax": "22", "readRatioAvg": 0.01827956989247312, "readRatioMax": 0.023655913978494623, "recordsRead": "1510621", "recordsWritten": "30", "shuffleOutputBytes": "2670", "shuffleOutputBytesSpilled": "0", "slotMs": "833", "startMs": "1665776735271", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$100:ws_sold_date_sk, $101:ws_web_site_sk, $102:ws_ext_sales_price, $103:ws_net_profit", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$110:wr_returned_date_sk, $111:wr_item_sk, $112:wr_order_number, $113:wr_return_amt, $114:wr_net_loss", "FROM web_returns" ] }, { "kind": "READ", "substeps": [ "$120, $121, $122", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$50", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $490 := $484", "$280 := SUM($480)", "$281 := SUM($481)", "$282 := SUM($482)", "$283 := SUM($483)" ] }, { "kind": "JOIN", "substeps": [ "$480 := $471, $481 := $472, $482 := $473, $483 := $474, $484 := $21", "INNER HASH JOIN EACH WITH ALL ON $470 = $20" ] }, { "kind": "JOIN", "substeps": [ "$470 := $310, $471 := $312, $472 := $313, $473 := $314, $474 := $315", "INNER HASH JOIN EACH WITH ALL ON $311 = $50" ] }, { "kind": "COMPUTE", "substeps": [ "$360 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$370 := NUMERIC<...>" ] }, { "kind": "JOIN", "substeps": [ "$460 := $110, $461 := $113, $462 := $114, $463 := $121", "LEFT OUTER HASH JOIN EACH WITH ALL ON $111 = $120, $112 = $122" ] }, { "kind": "WRITE", "substeps": [ "$490, $280, $281, $282, $283", "TO __stage0B_output", "BY HASH($490)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.001075268817204301, "waitRatioMax": 0.001075268817204301, "writeMsAvg": "7", "writeMsMax": "8", "writeRatioAvg": 0.007526881720430108, "writeRatioMax": 0.008602150537634409 }, { "completedParallelInputs": "3", "computeMsAvg": "12", "computeMsMax": "13", "computeRatioAvg": 0.012903225806451613, "computeRatioMax": 0.013978494623655914, "endMs": "1665776735909", "id": "12", "inputStages": [ "11", "9", "10" ], "name": "S0C: Aggregate+", "parallelInputs": "3", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "2254", "recordsWritten": "686", "shuffleOutputBytes": "77073", "shuffleOutputBytesSpilled": "0", "slotMs": "103", "startMs": "1665776735870", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$400, $260, $261, $262, $263", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$440, $270, $271, $272, $273", "FROM __stage09_output" ] }, { "kind": "READ", "substeps": [ "$490, $280, $281, $282, $283", "FROM __stage0B_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $510 := $150, $511 := $151, $512 := $170", "$140 := SUM($182)", "$141 := SUM($183)", "$142 := SUM($184)" ] }, { "kind": "COMPUTE", "substeps": [ "$150 := if(equal(bitwise_and($190, 1), 0), NULL, $180)", "$151 := if(equal(bitwise_and($190, 2), 0), NULL, $181)" ] }, { "kind": "COMPUTE", "substeps": [ "$160 := ARRAY<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := 'store channel'", "$201 := concat('store', $410)", "$202 := subtract($231, $233)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $410 := $400", "$230 := SUM($260)", "$231 := SUM($261)", "$232 := SUM($262)", "$233 := SUM($263)" ] }, { "kind": "COMPUTE", "substeps": [ "$210 := 'catalog channel'", "$211 := concat('catalog_page', $450)", "$212 := subtract($241, $243)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $450 := $440", "$240 := SUM($270)", "$241 := SUM($271)", "$242 := SUM($272)", "$243 := SUM($273)" ] }, { "kind": "COMPUTE", "substeps": [ "$220 := 'web channel'", "$221 := concat('web_site', $500)", "$222 := subtract($251, $253)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $500 := $490", "$250 := SUM($280)", "$251 := SUM($281)", "$252 := SUM($282)", "$253 := SUM($283)" ] }, { "kind": "COMPUTE", "substeps": [ "$170 := subtract($191, 1)" ] }, { "kind": "WRITE", "substeps": [ "$140, $141, $142, $510, $511, $512", "TO __stage0C_output", "BY HASH($510, $511, $512)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002150537634408602, "waitRatioMax": 0.002150537634408602, "writeMsAvg": "14", "writeMsMax": "15", "writeRatioAvg": 0.015053763440860216, "writeRatioMax": 0.016129032258064516 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.008602150537634409, "computeRatioMax": 0.008602150537634409, "endMs": "1665776735957", "id": "13", "inputStages": [ "12" ], "name": "S0D: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "686", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665776735919", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$140, $141, $142, $510, $511, $512", "FROM __stage0C_output" ] }, { "kind": "SORT", "substeps": [ "$520 ASC, $521 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $520 := $510, $521 := $511, $522 := $512", "$130 := SUM($140)", "$131 := SUM($141)", "$132 := SUM($142)" ] }, { "kind": "WRITE", "substeps": [ "$530, $531, $532, $533, $534", "TO __stage0D_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.002150537634408602, "waitRatioMax": 0.002150537634408602, "writeMsAvg": "28", "writeMsMax": "28", "writeRatioAvg": 0.030107526881720432, "writeRatioMax": 0.030107526881720432 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.00967741935483871, "computeRatioMax": 0.00967741935483871, "endMs": "1665776735979", "id": "14", "inputStages": [ "13" ], "name": "S0E: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "35", "startMs": "1665776735939", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$530, $531, $532, $533, $534", "FROM __stage0D_output" ] }, { "kind": "SORT", "substeps": [ "$533 ASC, $534 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$540, $541, $542, $543, $544", "TO __stage0E_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.0032258064516129032, "waitRatioMax": 0.0032258064516129032, "writeMsAvg": "7", "writeMsMax": "7", "writeRatioAvg": 0.007526881720430108, "writeRatioMax": 0.007526881720430108 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_page" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_site" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "2", "completedUnits": "20", "elapsedMs": "672", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "2726" }, { "activeUnits": "2", "completedUnits": "27", "elapsedMs": "1308", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "3731" } ], "totalBytesBilled": "272629760", "totalBytesProcessed": "272493208", "totalPartitionsProcessed": "0", "totalSlotMs": "3731", "transferredBytes": "0" }, "startTime": "1665776734710", "totalBytesProcessed": "272493208", "totalSlotMs": "3731" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anonab6fb842_1448_4295_9858_f3ad16495337" }, "priority": "INTERACTIVE", "query": "-- start query 5 in stream 0 using template query5.tpl\nwith ssr as\n (select s_store_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ss_store_sk as store_sk,\n ss_sold_date_sk as date_sk,\n ss_ext_sales_price as sales_price,\n ss_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from store_sales\n union all\n select sr_store_sk as store_sk,\n sr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n sr_return_amt as return_amt,\n sr_net_loss as net_loss\n from store_returns\n ) salesreturns,\n date_dim,\n store\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date) \n and (cast('2000-08-23'+14 as date))--add the 14 days manually\n and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select cs_catalog_page_sk as page_sk,\n cs_sold_date_sk as date_sk,\n cs_ext_sales_price as sales_price,\n cs_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from catalog_sales\n union all\n select cr_catalog_page_sk as page_sk,\n cr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n cr_return_amount as return_amt,\n cr_net_loss as net_loss\n from catalog_returns\n ) salesreturns,\n date_dim,\n catalog_page\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23'+14 as date))\n and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ws_web_site_sk as wsr_web_site_sk,\n ws_sold_date_sk as date_sk,\n ws_ext_sales_price as sales_price,\n ws_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from web_sales\n union all\n select ws_web_site_sk as wsr_web_site_sk,\n wr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n wr_return_amt as return_amt,\n wr_net_loss as net_loss\n from web_returns left outer join web_sales on\n ( wr_item_sk = ws_item_sk\n and wr_order_number = ws_order_number)\n ) salesreturns,\n date_dim,\n web_site\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23' as date) + 14 )\n and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n select channel\n , id\n , sum(sales) as sales\n , sum(returns) as returns\n , sum(profit) as profit\n from \n (select 'store channel' as channel\n , 'store' || s_store_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from ssr\n union all\n select 'catalog channel' as channel\n , 'catalog_page' || cp_catalog_page_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from csr\n union all\n select 'web channel' as channel\n , 'web_site' || web_site_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from wsr\n ) x\n group by rollup (channel, id)\n order by channel\n ,id\n limit 100\n ;\n\n-- end query 5 in stream 0 using template query5.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "VOstXT8UX9TEwUNL62buwQ==", "id": "test-project-364309:europe-west1.query05_1665776737", "jobReference": { "jobId": "query05_1665776737", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query05_1665776737?location=europe-west1", "statistics": { "creationTime": "1665776737672", "endTime": "1665776739130", "finalExecutionDurationMs": "1193", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "272493208", "performanceInsights": { "avgPreviousExecutionMs": "974" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.009027081243731194, "computeRatioMax": 0.009027081243731194, "endMs": "1665776737942", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.0050150451354062184, "readRatioMax": 0.0050150451354062184, "recordsRead": "30", "recordsWritten": "30", "shuffleOutputBytes": "900", "shuffleOutputBytesSpilled": "0", "slotMs": "35", "startMs": "1665776737896", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:web_site_sk, $21:web_site_id", "FROM web_site" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage00_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0020060180541624875, "waitRatioMax": 0.0020060180541624875, "writeMsAvg": "20", "writeMsMax": "20", "writeRatioAvg": 0.020060180541624874, "writeRatioMax": 0.020060180541624874 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.013039117352056168, "computeRatioMax": 0.013039117352056168, "endMs": "1665776737956", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.0050150451354062184, "readRatioMax": 0.0050150451354062184, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "37", "startMs": "1665776737917", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:d_date_sk, $51:d_date", "FROM date_dim", "WHERE between($51, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$50", "TO __stage01_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0020060180541624875, "waitRatioMax": 0.0020060180541624875, "writeMsAvg": "24", "writeMsMax": "24", "writeRatioAvg": 0.024072216649949848, "writeRatioMax": 0.024072216649949848 }, { "completedParallelInputs": "1", "computeMsAvg": "317", "computeMsMax": "317", "computeRatioAvg": 0.31795386158475425, "computeRatioMax": 0.31795386158475425, "endMs": "1665776738195", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "11", "readMsMax": "11", "readRatioAvg": 0.011033099297893681, "readRatioMax": 0.011033099297893681, "recordsRead": "719384", "recordsWritten": "719384", "shuffleOutputBytes": "19421880", "shuffleOutputBytesSpilled": "0", "slotMs": "336", "startMs": "1665776737936", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$120:ws_item_sk, $121:ws_web_site_sk, $122:ws_order_number", "FROM web_sales" ] }, { "kind": "WRITE", "substeps": [ "$120, $121, $122", "TO __stage02_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0020060180541624875, "waitRatioMax": 0.0020060180541624875, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.015045135406218655, "writeRatioMax": 0.015045135406218655 }, { "completedParallelInputs": "1", "computeMsAvg": "19", "computeMsMax": "19", "computeRatioAvg": 0.01905717151454363, "computeRatioMax": 0.01905717151454363, "endMs": "1665776737991", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "16", "readMsMax": "16", "readRatioAvg": 0.0160481444332999, "readRatioMax": 0.0160481444332999, "recordsRead": "11718", "recordsWritten": "11718", "shuffleOutputBytes": "351540", "shuffleOutputBytesSpilled": "0", "slotMs": "39", "startMs": "1665776737955", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:cp_catalog_page_sk, $11:cp_catalog_page_id", "FROM catalog_page" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage03_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0020060180541624875, "waitRatioMax": 0.0020060180541624875, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.00802407221664995, "writeRatioMax": 0.00802407221664995 }, { "completedParallelInputs": "1", "computeMsAvg": "15", "computeMsMax": "15", "computeRatioAvg": 0.015045135406218655, "computeRatioMax": 0.015045135406218655, "endMs": "1665776738014", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.007021063189568706, "readRatioMax": 0.007021063189568706, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "39", "startMs": "1665776737973", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_date_sk, $41:d_date", "FROM date_dim", "WHERE between($41, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$40", "TO __stage04_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0010030090270812437, "waitRatioMax": 0.0010030090270812437, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.014042126379137413, "writeRatioMax": 0.014042126379137413 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.00802407221664995, "computeRatioMax": 0.00802407221664995, "endMs": "1665776738061", "id": "6", "name": "S06: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.004012036108324975, "readRatioMax": 0.004012036108324975, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "360", "shuffleOutputBytesSpilled": "0", "slotMs": "49", "startMs": "1665776738007", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:s_store_sk, $2:s_store_id", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0010030090270812437, "waitRatioMax": 0.0010030090270812437, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.01805416248746239, "writeRatioMax": 0.01805416248746239 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.011033099297893681, "computeRatioMax": 0.011033099297893681, "endMs": "1665776738079", "id": "7", "name": "S07: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.0050150451354062184, "readRatioMax": 0.0050150451354062184, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "48", "startMs": "1665776738027", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $31:d_date", "FROM date_dim", "WHERE between($31, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$30", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0010030090270812437, "waitRatioMax": 0.0010030090270812437, "writeMsAvg": "25", "writeMsMax": "25", "writeRatioAvg": 0.025075225677031094, "writeRatioMax": 0.025075225677031094 }, { "completedParallelInputs": "6", "computeMsAvg": "139", "computeMsMax": "209", "computeRatioAvg": 0.13941825476429287, "computeRatioMax": 0.20962888665997995, "endMs": "1665776738200", "id": "9", "inputStages": [ "4", "3" ], "name": "S09: Join+", "parallelInputs": "6", "readMsAvg": "20", "readMsMax": "32", "readRatioAvg": 0.020060180541624874, "readRatioMax": 0.0320962888665998, "recordsRead": "1656013", "recordsWritten": "2182", "shuffleOutputBytes": "194118", "shuffleOutputBytesSpilled": "0", "slotMs": "847", "startMs": "1665776738058", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:cs_sold_date_sk, $81:cs_catalog_page_sk, $82:cs_ext_sales_price, $83:cs_net_profit", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$90:cr_returned_date_sk, $91:cr_catalog_page_sk, $92:cr_return_amount, $93:cr_net_loss", "FROM catalog_returns" ] }, { "kind": "READ", "substeps": [ "$40", "FROM __stage04_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage03_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $440 := $434", "$270 := SUM($430)", "$271 := SUM($431)", "$272 := SUM($432)", "$273 := SUM($433)" ] }, { "kind": "JOIN", "substeps": [ "$430 := $421, $431 := $422, $432 := $423, $433 := $424, $434 := $11", "INNER HASH JOIN EACH WITH ALL ON $420 = $10" ] }, { "kind": "JOIN", "substeps": [ "$420 := $300, $421 := $302, $422 := $303, $423 := $304, $424 := $305", "INNER HASH JOIN EACH WITH ALL ON $301 = $40" ] }, { "kind": "COMPUTE", "substeps": [ "$340 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$350 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$440, $270, $271, $272, $273", "TO __stage09_output", "BY HASH($440)" ] } ], "waitMsAvg": "1", "waitMsMax": "2", "waitRatioAvg": 0.0010030090270812437, "waitRatioMax": 0.0020060180541624875, "writeMsAvg": "4", "writeMsMax": "5", "writeRatioAvg": 0.004012036108324975, "writeRatioMax": 0.0050150451354062184 }, { "completedParallelInputs": "7", "computeMsAvg": "181", "computeMsMax": "217", "computeRatioAvg": 0.1815446339017051, "computeRatioMax": 0.2176529588766299, "endMs": "1665776738257", "id": "10", "inputStages": [ "7", "6" ], "name": "S0A: Join+", "parallelInputs": "7", "readMsAvg": "24", "readMsMax": "35", "readRatioAvg": 0.024072216649949848, "readRatioMax": 0.03510531594784353, "recordsRead": "3168107", "recordsWritten": "42", "shuffleOutputBytes": "3738", "shuffleOutputBytesSpilled": "0", "slotMs": "1339", "startMs": "1665776738094", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:ss_sold_date_sk, $61:ss_store_sk, $62:ss_ext_sales_price, $63:ss_net_profit", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$70:sr_returned_date_sk, $71:sr_store_sk, $72:sr_return_amt, $73:sr_net_loss", "FROM store_returns" ] }, { "kind": "READ", "substeps": [ "$30", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $400 := $394", "$260 := SUM($390)", "$261 := SUM($391)", "$262 := SUM($392)", "$263 := SUM($393)" ] }, { "kind": "JOIN", "substeps": [ "$390 := $381, $391 := $382, $392 := $383, $393 := $384, $394 := $2", "INNER HASH JOIN EACH WITH ALL ON $380 = $1" ] }, { "kind": "JOIN", "substeps": [ "$380 := $290, $381 := $292, $382 := $293, $383 := $294, $384 := $295", "INNER HASH JOIN EACH WITH ALL ON $291 = $30" ] }, { "kind": "COMPUTE", "substeps": [ "$320 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$330 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$400, $260, $261, $262, $263", "TO __stage0A_output", "BY HASH($400)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0020060180541624875, "waitRatioMax": 0.0020060180541624875, "writeMsAvg": "5", "writeMsMax": "9", "writeRatioAvg": 0.0050150451354062184, "writeRatioMax": 0.009027081243731194 }, { "completedParallelInputs": "2", "computeMsAvg": "707", "computeMsMax": "997", "computeRatioAvg": 0.7091273821464393, "computeRatioMax": 1, "endMs": "1665776738897", "id": "11", "inputStages": [ "1", "2", "0" ], "name": "S0B: Join+", "parallelInputs": "2", "readMsAvg": "17", "readMsMax": "20", "readRatioAvg": 0.017051153460381142, "readRatioMax": 0.020060180541624874, "recordsRead": "1510621", "recordsWritten": "30", "shuffleOutputBytes": "2670", "shuffleOutputBytesSpilled": "0", "slotMs": "1195", "startMs": "1665776738269", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$100:ws_sold_date_sk, $101:ws_web_site_sk, $102:ws_ext_sales_price, $103:ws_net_profit", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$110:wr_returned_date_sk, $111:wr_item_sk, $112:wr_order_number, $113:wr_return_amt, $114:wr_net_loss", "FROM web_returns" ] }, { "kind": "READ", "substeps": [ "$120, $121, $122", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$50", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $490 := $484", "$280 := SUM($480)", "$281 := SUM($481)", "$282 := SUM($482)", "$283 := SUM($483)" ] }, { "kind": "JOIN", "substeps": [ "$480 := $471, $481 := $472, $482 := $473, $483 := $474, $484 := $21", "INNER HASH JOIN EACH WITH ALL ON $470 = $20" ] }, { "kind": "JOIN", "substeps": [ "$470 := $310, $471 := $312, $472 := $313, $473 := $314, $474 := $315", "INNER HASH JOIN EACH WITH ALL ON $311 = $50" ] }, { "kind": "COMPUTE", "substeps": [ "$360 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$370 := NUMERIC<...>" ] }, { "kind": "JOIN", "substeps": [ "$460 := $110, $461 := $113, $462 := $114, $463 := $121", "LEFT OUTER HASH JOIN EACH WITH ALL ON $111 = $120, $112 = $122" ] }, { "kind": "WRITE", "substeps": [ "$490, $280, $281, $282, $283", "TO __stage0B_output", "BY HASH($490)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0020060180541624875, "waitRatioMax": 0.0020060180541624875, "writeMsAvg": "7", "writeMsMax": "9", "writeRatioAvg": 0.007021063189568706, "writeRatioMax": 0.009027081243731194 }, { "completedParallelInputs": "3", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.009027081243731194, "computeRatioMax": 0.009027081243731194, "endMs": "1665776738963", "id": "12", "inputStages": [ "10", "11", "9" ], "name": "S0C: Aggregate+", "parallelInputs": "3", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "2254", "recordsWritten": "686", "shuffleOutputBytes": "77073", "shuffleOutputBytesSpilled": "0", "slotMs": "106", "startMs": "1665776738926", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$400, $260, $261, $262, $263", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$440, $270, $271, $272, $273", "FROM __stage09_output" ] }, { "kind": "READ", "substeps": [ "$490, $280, $281, $282, $283", "FROM __stage0B_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $510 := $150, $511 := $151, $512 := $170", "$140 := SUM($182)", "$141 := SUM($183)", "$142 := SUM($184)" ] }, { "kind": "COMPUTE", "substeps": [ "$150 := if(equal(bitwise_and($190, 1), 0), NULL, $180)", "$151 := if(equal(bitwise_and($190, 2), 0), NULL, $181)" ] }, { "kind": "COMPUTE", "substeps": [ "$160 := ARRAY<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := 'store channel'", "$201 := concat('store', $410)", "$202 := subtract($231, $233)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $410 := $400", "$230 := SUM($260)", "$231 := SUM($261)", "$232 := SUM($262)", "$233 := SUM($263)" ] }, { "kind": "COMPUTE", "substeps": [ "$210 := 'catalog channel'", "$211 := concat('catalog_page', $450)", "$212 := subtract($241, $243)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $450 := $440", "$240 := SUM($270)", "$241 := SUM($271)", "$242 := SUM($272)", "$243 := SUM($273)" ] }, { "kind": "COMPUTE", "substeps": [ "$220 := 'web channel'", "$221 := concat('web_site', $500)", "$222 := subtract($251, $253)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $500 := $490", "$250 := SUM($280)", "$251 := SUM($281)", "$252 := SUM($282)", "$253 := SUM($283)" ] }, { "kind": "COMPUTE", "substeps": [ "$170 := subtract($191, 1)" ] }, { "kind": "WRITE", "substeps": [ "$140, $141, $142, $510, $511, $512", "TO __stage0C_output", "BY HASH($510, $511, $512)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0020060180541624875, "waitRatioMax": 0.0020060180541624875, "writeMsAvg": "27", "writeMsMax": "28", "writeRatioAvg": 0.02708124373119358, "writeRatioMax": 0.028084252758274825 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.010030090270812437, "computeRatioMax": 0.010030090270812437, "endMs": "1665776739023", "id": "13", "inputStages": [ "12" ], "name": "S0D: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "686", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "40", "startMs": "1665776738976", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$140, $141, $142, $510, $511, $512", "FROM __stage0C_output" ] }, { "kind": "SORT", "substeps": [ "$520 ASC, $521 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $520 := $510, $521 := $511, $522 := $512", "$130 := SUM($140)", "$131 := SUM($141)", "$132 := SUM($142)" ] }, { "kind": "WRITE", "substeps": [ "$530, $531, $532, $533, $534", "TO __stage0D_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0010030090270812437, "waitRatioMax": 0.0010030090270812437, "writeMsAvg": "33", "writeMsMax": "33", "writeRatioAvg": 0.033099297893681046, "writeRatioMax": 0.033099297893681046 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.013039117352056168, "computeRatioMax": 0.013039117352056168, "endMs": "1665776739042", "id": "14", "inputStages": [ "13" ], "name": "S0E: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "41", "startMs": "1665776739000", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$530, $531, $532, $533, $534", "FROM __stage0D_output" ] }, { "kind": "SORT", "substeps": [ "$533 ASC, $534 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$540, $541, $542, $543, $544", "TO __stage0E_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0020060180541624875, "waitRatioMax": 0.0020060180541624875, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.00802407221664995, "writeRatioMax": 0.00802407221664995 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_page" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_site" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "2", "completedUnits": "20", "elapsedMs": "666", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "2904" }, { "activeUnits": "2", "completedUnits": "27", "elapsedMs": "1356", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "4191" } ], "totalBytesBilled": "272629760", "totalBytesProcessed": "272493208", "totalPartitionsProcessed": "0", "totalSlotMs": "4191", "transferredBytes": "0" }, "startTime": "1665776737732", "totalBytesProcessed": "272493208", "totalSlotMs": "4191" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anonc4d1872f_3fb5_452b_a801_6b607cf3d35c" }, "priority": "INTERACTIVE", "query": "-- start query 5 in stream 0 using template query5.tpl\nwith ssr as\n (select s_store_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ss_store_sk as store_sk,\n ss_sold_date_sk as date_sk,\n ss_ext_sales_price as sales_price,\n ss_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from store_sales\n union all\n select sr_store_sk as store_sk,\n sr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n sr_return_amt as return_amt,\n sr_net_loss as net_loss\n from store_returns\n ) salesreturns,\n date_dim,\n store\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date) \n and (cast('2000-08-23'+14 as date))--add the 14 days manually\n and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select cs_catalog_page_sk as page_sk,\n cs_sold_date_sk as date_sk,\n cs_ext_sales_price as sales_price,\n cs_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from catalog_sales\n union all\n select cr_catalog_page_sk as page_sk,\n cr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n cr_return_amount as return_amt,\n cr_net_loss as net_loss\n from catalog_returns\n ) salesreturns,\n date_dim,\n catalog_page\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23'+14 as date))\n and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ws_web_site_sk as wsr_web_site_sk,\n ws_sold_date_sk as date_sk,\n ws_ext_sales_price as sales_price,\n ws_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from web_sales\n union all\n select ws_web_site_sk as wsr_web_site_sk,\n wr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n wr_return_amt as return_amt,\n wr_net_loss as net_loss\n from web_returns left outer join web_sales on\n ( wr_item_sk = ws_item_sk\n and wr_order_number = ws_order_number)\n ) salesreturns,\n date_dim,\n web_site\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23' as date) + 14 )\n and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n select channel\n , id\n , sum(sales) as sales\n , sum(returns) as returns\n , sum(profit) as profit\n from \n (select 'store channel' as channel\n , 'store' || s_store_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from ssr\n union all\n select 'catalog channel' as channel\n , 'catalog_page' || cp_catalog_page_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from csr\n union all\n select 'web channel' as channel\n , 'web_site' || web_site_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from wsr\n ) x\n group by rollup (channel, id)\n order by channel\n ,id\n limit 100\n ;\n\n-- end query 5 in stream 0 using template query5.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "1Q9CuvMnB1jxaLC1XWZAYg==", "id": "test-project-364309:europe-west1.query05_1665776741", "jobReference": { "jobId": "query05_1665776741", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query05_1665776741?location=europe-west1", "statistics": { "creationTime": "1665776741614", "endTime": "1665776742945", "finalExecutionDurationMs": "1058", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "272493208", "performanceInsights": { "avgPreviousExecutionMs": "976" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "6", "computeMsMax": "6", "computeRatioAvg": 0.007168458781362007, "computeRatioMax": 0.007168458781362007, "endMs": "1665776741870", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.0047789725209080045, "readRatioMax": 0.0047789725209080045, "recordsRead": "30", "recordsWritten": "30", "shuffleOutputBytes": "900", "shuffleOutputBytesSpilled": "0", "slotMs": "19", "startMs": "1665776741845", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:web_site_sk, $21:web_site_id", "FROM web_site" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage00_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0023894862604540022, "waitRatioMax": 0.0023894862604540022, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.02031063321385902, "writeRatioMax": 0.02031063321385902 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.013142174432497013, "computeRatioMax": 0.013142174432497013, "endMs": "1665776741885", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.007168458781362007, "readRatioMax": 0.007168458781362007, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "25", "startMs": "1665776741860", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:d_date_sk, $51:d_date", "FROM date_dim", "WHERE between($51, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$50", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011947431302270011, "waitRatioMax": 0.0011947431302270011, "writeMsAvg": "11", "writeMsMax": "11", "writeRatioAvg": 0.013142174432497013, "writeRatioMax": 0.013142174432497013 }, { "completedParallelInputs": "1", "computeMsAvg": "597", "computeMsMax": "597", "computeRatioAvg": 0.7132616487455197, "computeRatioMax": 0.7132616487455197, "endMs": "1665776742238", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "11", "readMsMax": "11", "readRatioAvg": 0.013142174432497013, "readRatioMax": 0.013142174432497013, "recordsRead": "719384", "recordsWritten": "719384", "shuffleOutputBytes": "19421880", "shuffleOutputBytesSpilled": "0", "slotMs": "523", "startMs": "1665776741873", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$120:ws_item_sk, $121:ws_web_site_sk, $122:ws_order_number", "FROM web_sales" ] }, { "kind": "WRITE", "substeps": [ "$120, $121, $122", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011947431302270011, "waitRatioMax": 0.0011947431302270011, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.017921146953405017, "writeRatioMax": 0.017921146953405017 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.016726403823178016, "computeRatioMax": 0.016726403823178016, "endMs": "1665776741930", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.0047789725209080045, "readRatioMax": 0.0047789725209080045, "recordsRead": "11718", "recordsWritten": "11718", "shuffleOutputBytes": "351540", "shuffleOutputBytesSpilled": "0", "slotMs": "35", "startMs": "1665776741886", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:cp_catalog_page_sk, $11:cp_catalog_page_id", "FROM catalog_page" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage03_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011947431302270011, "waitRatioMax": 0.0011947431302270011, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.02031063321385902, "writeRatioMax": 0.02031063321385902 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.013142174432497013, "computeRatioMax": 0.013142174432497013, "endMs": "1665776741943", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.007168458781362007, "readRatioMax": 0.007168458781362007, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665776741903", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_date_sk, $41:d_date", "FROM date_dim", "WHERE between($41, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$40", "TO __stage04_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0023894862604540022, "waitRatioMax": 0.0023894862604540022, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.017921146953405017, "writeRatioMax": 0.017921146953405017 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.009557945041816009, "computeRatioMax": 0.009557945041816009, "endMs": "1665776741962", "id": "6", "name": "S06: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.005973715651135006, "readRatioMax": 0.005973715651135006, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "360", "shuffleOutputBytesSpilled": "0", "slotMs": "26", "startMs": "1665776741930", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:s_store_sk, $2:s_store_id", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage06_output" ] } ], "waitMsAvg": "0", "waitMsMax": "0", "waitRatioAvg": 0, "waitRatioMax": 0, "writeMsAvg": "20", "writeMsMax": "20", "writeRatioAvg": 0.023894862604540025, "writeRatioMax": 0.023894862604540025 }, { "completedParallelInputs": "1", "computeMsAvg": "15", "computeMsMax": "15", "computeRatioAvg": 0.017921146953405017, "computeRatioMax": 0.017921146953405017, "endMs": "1665776741974", "id": "7", "name": "S07: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.007168458781362007, "readRatioMax": 0.007168458781362007, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "30", "startMs": "1665776741946", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $31:d_date", "FROM date_dim", "WHERE between($31, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$30", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011947431302270011, "waitRatioMax": 0.0011947431302270011, "writeMsAvg": "9", "writeMsMax": "9", "writeRatioAvg": 0.010752688172043012, "writeRatioMax": 0.010752688172043012 }, { "completedParallelInputs": "6", "computeMsAvg": "152", "computeMsMax": "213", "computeRatioAvg": 0.1816009557945042, "computeRatioMax": 0.25448028673835127, "endMs": "1665776742101", "id": "9", "inputStages": [ "4", "3" ], "name": "S09: Join+", "parallelInputs": "6", "readMsAvg": "18", "readMsMax": "22", "readRatioAvg": 0.021505376344086023, "readRatioMax": 0.026284348864994027, "recordsRead": "1656013", "recordsWritten": "2182", "shuffleOutputBytes": "194118", "shuffleOutputBytesSpilled": "0", "slotMs": "839", "startMs": "1665776741962", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:cs_sold_date_sk, $81:cs_catalog_page_sk, $82:cs_ext_sales_price, $83:cs_net_profit", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$90:cr_returned_date_sk, $91:cr_catalog_page_sk, $92:cr_return_amount, $93:cr_net_loss", "FROM catalog_returns" ] }, { "kind": "READ", "substeps": [ "$40", "FROM __stage04_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage03_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $440 := $434", "$270 := SUM($430)", "$271 := SUM($431)", "$272 := SUM($432)", "$273 := SUM($433)" ] }, { "kind": "JOIN", "substeps": [ "$430 := $421, $431 := $422, $432 := $423, $433 := $424, $434 := $11", "INNER HASH JOIN EACH WITH ALL ON $420 = $10" ] }, { "kind": "JOIN", "substeps": [ "$420 := $300, $421 := $302, $422 := $303, $423 := $304, $424 := $305", "INNER HASH JOIN EACH WITH ALL ON $301 = $40" ] }, { "kind": "COMPUTE", "substeps": [ "$340 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$350 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$440, $270, $271, $272, $273", "TO __stage09_output", "BY HASH($440)" ] } ], "waitMsAvg": "0", "waitMsMax": "1", "waitRatioAvg": 0, "waitRatioMax": 0.0011947431302270011, "writeMsAvg": "4", "writeMsMax": "5", "writeRatioAvg": 0.0047789725209080045, "writeRatioMax": 0.005973715651135006 }, { "completedParallelInputs": "7", "computeMsAvg": "185", "computeMsMax": "248", "computeRatioAvg": 0.22102747909199522, "computeRatioMax": 0.2962962962962963, "endMs": "1665776742136", "id": "10", "inputStages": [ "7", "6" ], "name": "S0A: Join+", "parallelInputs": "7", "readMsAvg": "16", "readMsMax": "22", "readRatioAvg": 0.019115890083632018, "readRatioMax": 0.026284348864994027, "recordsRead": "3168107", "recordsWritten": "42", "shuffleOutputBytes": "3738", "shuffleOutputBytesSpilled": "0", "slotMs": "1163", "startMs": "1665776741979", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:ss_sold_date_sk, $61:ss_store_sk, $62:ss_ext_sales_price, $63:ss_net_profit", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$70:sr_returned_date_sk, $71:sr_store_sk, $72:sr_return_amt, $73:sr_net_loss", "FROM store_returns" ] }, { "kind": "READ", "substeps": [ "$30", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $400 := $394", "$260 := SUM($390)", "$261 := SUM($391)", "$262 := SUM($392)", "$263 := SUM($393)" ] }, { "kind": "JOIN", "substeps": [ "$390 := $381, $391 := $382, $392 := $383, $393 := $384, $394 := $2", "INNER HASH JOIN EACH WITH ALL ON $380 = $1" ] }, { "kind": "JOIN", "substeps": [ "$380 := $290, $381 := $292, $382 := $293, $383 := $294, $384 := $295", "INNER HASH JOIN EACH WITH ALL ON $291 = $30" ] }, { "kind": "COMPUTE", "substeps": [ "$320 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$330 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$400, $260, $261, $262, $263", "TO __stage0A_output", "BY HASH($400)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011947431302270011, "waitRatioMax": 0.0011947431302270011, "writeMsAvg": "4", "writeMsMax": "5", "writeRatioAvg": 0.0047789725209080045, "writeRatioMax": 0.005973715651135006 }, { "completedParallelInputs": "2", "computeMsAvg": "560", "computeMsMax": "837", "computeRatioAvg": 0.6690561529271206, "computeRatioMax": 1, "endMs": "1665776742727", "id": "11", "inputStages": [ "0", "2", "1" ], "name": "S0B: Join+", "parallelInputs": "2", "readMsAvg": "19", "readMsMax": "25", "readRatioAvg": 0.022700119474313024, "readRatioMax": 0.02986857825567503, "recordsRead": "1510621", "recordsWritten": "30", "shuffleOutputBytes": "2670", "shuffleOutputBytesSpilled": "0", "slotMs": "943", "startMs": "1665776742274", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$100:ws_sold_date_sk, $101:ws_web_site_sk, $102:ws_ext_sales_price, $103:ws_net_profit", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$110:wr_returned_date_sk, $111:wr_item_sk, $112:wr_order_number, $113:wr_return_amt, $114:wr_net_loss", "FROM web_returns" ] }, { "kind": "READ", "substeps": [ "$120, $121, $122", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$50", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $490 := $484", "$280 := SUM($480)", "$281 := SUM($481)", "$282 := SUM($482)", "$283 := SUM($483)" ] }, { "kind": "JOIN", "substeps": [ "$480 := $471, $481 := $472, $482 := $473, $483 := $474, $484 := $21", "INNER HASH JOIN EACH WITH ALL ON $470 = $20" ] }, { "kind": "JOIN", "substeps": [ "$470 := $310, $471 := $312, $472 := $313, $473 := $314, $474 := $315", "INNER HASH JOIN EACH WITH ALL ON $311 = $50" ] }, { "kind": "COMPUTE", "substeps": [ "$360 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$370 := NUMERIC<...>" ] }, { "kind": "JOIN", "substeps": [ "$460 := $110, $461 := $113, $462 := $114, $463 := $121", "LEFT OUTER HASH JOIN EACH WITH ALL ON $111 = $120, $112 = $122" ] }, { "kind": "WRITE", "substeps": [ "$490, $280, $281, $282, $283", "TO __stage0B_output", "BY HASH($490)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011947431302270011, "waitRatioMax": 0.0011947431302270011, "writeMsAvg": "7", "writeMsMax": "8", "writeRatioAvg": 0.008363201911589008, "writeRatioMax": 0.009557945041816009 }, { "completedParallelInputs": "3", "computeMsAvg": "14", "computeMsMax": "15", "computeRatioAvg": 0.016726403823178016, "computeRatioMax": 0.017921146953405017, "endMs": "1665776742819", "id": "12", "inputStages": [ "11", "9", "10" ], "name": "S0C: Aggregate+", "parallelInputs": "3", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "2254", "recordsWritten": "686", "shuffleOutputBytes": "77073", "shuffleOutputBytesSpilled": "0", "slotMs": "110", "startMs": "1665776742780", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$400, $260, $261, $262, $263", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$440, $270, $271, $272, $273", "FROM __stage09_output" ] }, { "kind": "READ", "substeps": [ "$490, $280, $281, $282, $283", "FROM __stage0B_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $510 := $150, $511 := $151, $512 := $170", "$140 := SUM($182)", "$141 := SUM($183)", "$142 := SUM($184)" ] }, { "kind": "COMPUTE", "substeps": [ "$150 := if(equal(bitwise_and($190, 1), 0), NULL, $180)", "$151 := if(equal(bitwise_and($190, 2), 0), NULL, $181)" ] }, { "kind": "COMPUTE", "substeps": [ "$160 := ARRAY<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := 'store channel'", "$201 := concat('store', $410)", "$202 := subtract($231, $233)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $410 := $400", "$230 := SUM($260)", "$231 := SUM($261)", "$232 := SUM($262)", "$233 := SUM($263)" ] }, { "kind": "COMPUTE", "substeps": [ "$210 := 'catalog channel'", "$211 := concat('catalog_page', $450)", "$212 := subtract($241, $243)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $450 := $440", "$240 := SUM($270)", "$241 := SUM($271)", "$242 := SUM($272)", "$243 := SUM($273)" ] }, { "kind": "COMPUTE", "substeps": [ "$220 := 'web channel'", "$221 := concat('web_site', $500)", "$222 := subtract($251, $253)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $500 := $490", "$250 := SUM($280)", "$251 := SUM($281)", "$252 := SUM($282)", "$253 := SUM($283)" ] }, { "kind": "COMPUTE", "substeps": [ "$170 := subtract($191, 1)" ] }, { "kind": "WRITE", "substeps": [ "$140, $141, $142, $510, $511, $512", "TO __stage0C_output", "BY HASH($510, $511, $512)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0023894862604540022, "waitRatioMax": 0.0023894862604540022, "writeMsAvg": "14", "writeMsMax": "15", "writeRatioAvg": 0.016726403823178016, "writeRatioMax": 0.017921146953405017 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.014336917562724014, "computeRatioMax": 0.014336917562724014, "endMs": "1665776742863", "id": "13", "inputStages": [ "12" ], "name": "S0D: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "686", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "37", "startMs": "1665776742828", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$140, $141, $142, $510, $511, $512", "FROM __stage0C_output" ] }, { "kind": "SORT", "substeps": [ "$520 ASC, $521 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $520 := $510, $521 := $511, $522 := $512", "$130 := SUM($140)", "$131 := SUM($141)", "$132 := SUM($142)" ] }, { "kind": "WRITE", "substeps": [ "$530, $531, $532, $533, $534", "TO __stage0D_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0023894862604540022, "waitRatioMax": 0.0023894862604540022, "writeMsAvg": "12", "writeMsMax": "12", "writeRatioAvg": 0.014336917562724014, "writeRatioMax": 0.014336917562724014 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.015531660692951015, "computeRatioMax": 0.015531660692951015, "endMs": "1665776742871", "id": "14", "inputStages": [ "13" ], "name": "S0E: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "29", "startMs": "1665776742841", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$530, $531, $532, $533, $534", "FROM __stage0D_output" ] }, { "kind": "SORT", "substeps": [ "$533 ASC, $534 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$540, $541, $542, $543, $544", "TO __stage0E_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0011947431302270011, "waitRatioMax": 0.0011947431302270011, "writeMsAvg": "7", "writeMsMax": "7", "writeRatioAvg": 0.008363201911589008, "writeRatioMax": 0.008363201911589008 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_page" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_site" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "2", "completedUnits": "20", "elapsedMs": "673", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "2747" }, { "activeUnits": "2", "completedUnits": "27", "elapsedMs": "1226", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "3868" } ], "totalBytesBilled": "272629760", "totalBytesProcessed": "272493208", "totalPartitionsProcessed": "0", "totalSlotMs": "3868", "transferredBytes": "0" }, "startTime": "1665776741673", "totalBytesProcessed": "272493208", "totalSlotMs": "3868" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anonfd48df79_b482_49b0_940e_a709e7e24a93" }, "priority": "INTERACTIVE", "query": "-- start query 5 in stream 0 using template query5.tpl\nwith ssr as\n (select s_store_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ss_store_sk as store_sk,\n ss_sold_date_sk as date_sk,\n ss_ext_sales_price as sales_price,\n ss_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from store_sales\n union all\n select sr_store_sk as store_sk,\n sr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n sr_return_amt as return_amt,\n sr_net_loss as net_loss\n from store_returns\n ) salesreturns,\n date_dim,\n store\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date) \n and (cast('2000-08-23'+14 as date))--add the 14 days manually\n and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select cs_catalog_page_sk as page_sk,\n cs_sold_date_sk as date_sk,\n cs_ext_sales_price as sales_price,\n cs_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from catalog_sales\n union all\n select cr_catalog_page_sk as page_sk,\n cr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n cr_return_amount as return_amt,\n cr_net_loss as net_loss\n from catalog_returns\n ) salesreturns,\n date_dim,\n catalog_page\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23'+14 as date))\n and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ws_web_site_sk as wsr_web_site_sk,\n ws_sold_date_sk as date_sk,\n ws_ext_sales_price as sales_price,\n ws_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from web_sales\n union all\n select ws_web_site_sk as wsr_web_site_sk,\n wr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n wr_return_amt as return_amt,\n wr_net_loss as net_loss\n from web_returns left outer join web_sales on\n ( wr_item_sk = ws_item_sk\n and wr_order_number = ws_order_number)\n ) salesreturns,\n date_dim,\n web_site\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23' as date) + 14 )\n and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n select channel\n , id\n , sum(sales) as sales\n , sum(returns) as returns\n , sum(profit) as profit\n from \n (select 'store channel' as channel\n , 'store' || s_store_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from ssr\n union all\n select 'catalog channel' as channel\n , 'catalog_page' || cp_catalog_page_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from csr\n union all\n select 'web channel' as channel\n , 'web_site' || web_site_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from wsr\n ) x\n group by rollup (channel, id)\n order by channel\n ,id\n limit 100\n ;\n\n-- end query 5 in stream 0 using template query5.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "ezBYYOhNt52PWrmICiyi+g==", "id": "test-project-364309:europe-west1.query05_1665776744", "jobReference": { "jobId": "query05_1665776744", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query05_1665776744?location=europe-west1", "statistics": { "creationTime": "1665776745531", "endTime": "1665776746640", "finalExecutionDurationMs": "845", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "272493208", "performanceInsights": { "avgPreviousExecutionMs": "977" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.011782032400589101, "computeRatioMax": 0.011782032400589101, "endMs": "1665776745771", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.008836524300441826, "readRatioMax": 0.008836524300441826, "recordsRead": "30", "recordsWritten": "30", "shuffleOutputBytes": "900", "shuffleOutputBytesSpilled": "0", "slotMs": "26", "startMs": "1665776745744", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:web_site_sk, $21:web_site_id", "FROM web_site" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0014727540500736377, "waitRatioMax": 0.0014727540500736377, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.020618556701030927, "writeRatioMax": 0.020618556701030927 }, { "completedParallelInputs": "1", "computeMsAvg": "15", "computeMsMax": "15", "computeRatioAvg": 0.022091310751104567, "computeRatioMax": 0.022091310751104567, "endMs": "1665776745790", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.011782032400589101, "readRatioMax": 0.011782032400589101, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "26", "startMs": "1665776745758", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:d_date_sk, $51:d_date", "FROM date_dim", "WHERE between($51, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$50", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0014727540500736377, "waitRatioMax": 0.0014727540500736377, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.01914580265095729, "writeRatioMax": 0.01914580265095729 }, { "completedParallelInputs": "1", "computeMsAvg": "393", "computeMsMax": "393", "computeRatioAvg": 0.5787923416789397, "computeRatioMax": 0.5787923416789397, "endMs": "1665776746018", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "10", "readMsMax": "10", "readRatioAvg": 0.014727540500736377, "readRatioMax": 0.014727540500736377, "recordsRead": "719384", "recordsWritten": "719384", "shuffleOutputBytes": "19421880", "shuffleOutputBytesSpilled": "0", "slotMs": "330", "startMs": "1665776745771", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$120:ws_item_sk, $121:ws_web_site_sk, $122:ws_order_number", "FROM web_sales" ] }, { "kind": "WRITE", "substeps": [ "$120, $121, $122", "TO __stage02_output" ] } ], "waitMsAvg": "0", "waitMsMax": "0", "waitRatioAvg": 0, "waitRatioMax": 0, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.022091310751104567, "writeRatioMax": 0.022091310751104567 }, { "completedParallelInputs": "1", "computeMsAvg": "19", "computeMsMax": "19", "computeRatioAvg": 0.027982326951399118, "computeRatioMax": 0.027982326951399118, "endMs": "1665776745829", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.010309278350515464, "readRatioMax": 0.010309278350515464, "recordsRead": "11718", "recordsWritten": "11718", "shuffleOutputBytes": "351540", "shuffleOutputBytesSpilled": "0", "slotMs": "46", "startMs": "1665776745784", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:cp_catalog_page_sk, $11:cp_catalog_page_id", "FROM catalog_page" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage03_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0014727540500736377, "waitRatioMax": 0.0014727540500736377, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.01914580265095729, "writeRatioMax": 0.01914580265095729 }, { "completedParallelInputs": "1", "computeMsAvg": "15", "computeMsMax": "15", "computeRatioAvg": 0.022091310751104567, "computeRatioMax": 0.022091310751104567, "endMs": "1665776745843", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.008836524300441826, "readRatioMax": 0.008836524300441826, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "41", "startMs": "1665776745804", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_date_sk, $41:d_date", "FROM date_dim", "WHERE between($41, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$40", "TO __stage04_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0014727540500736377, "waitRatioMax": 0.0014727540500736377, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.011782032400589101, "writeRatioMax": 0.011782032400589101 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.016200294550810016, "computeRatioMax": 0.016200294550810016, "endMs": "1665776745871", "id": "6", "name": "S06: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.010309278350515464, "readRatioMax": 0.010309278350515464, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "360", "shuffleOutputBytesSpilled": "0", "slotMs": "41", "startMs": "1665776745829", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:s_store_sk, $2:s_store_id", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage06_output" ] } ], "waitMsAvg": "0", "waitMsMax": "0", "waitRatioAvg": 0, "waitRatioMax": 0, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.022091310751104567, "writeRatioMax": 0.022091310751104567 }, { "completedParallelInputs": "1", "computeMsAvg": "19", "computeMsMax": "19", "computeRatioAvg": 0.027982326951399118, "computeRatioMax": 0.027982326951399118, "endMs": "1665776745890", "id": "7", "name": "S07: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.008836524300441826, "readRatioMax": 0.008836524300441826, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "48", "startMs": "1665776745848", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $31:d_date", "FROM date_dim", "WHERE between($31, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$30", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0014727540500736377, "waitRatioMax": 0.0014727540500736377, "writeMsAvg": "12", "writeMsMax": "12", "writeRatioAvg": 0.017673048600883652, "writeRatioMax": 0.017673048600883652 }, { "completedParallelInputs": "6", "computeMsAvg": "133", "computeMsMax": "155", "computeRatioAvg": 0.1958762886597938, "computeRatioMax": 0.22827687776141384, "endMs": "1665776746016", "id": "9", "inputStages": [ "3", "4" ], "name": "S09: Join+", "parallelInputs": "6", "readMsAvg": "22", "readMsMax": "36", "readRatioAvg": 0.03240058910162003, "readRatioMax": 0.053019145802650956, "recordsRead": "1656013", "recordsWritten": "2182", "shuffleOutputBytes": "194118", "shuffleOutputBytesSpilled": "0", "slotMs": "879", "startMs": "1665776745872", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:cs_sold_date_sk, $81:cs_catalog_page_sk, $82:cs_ext_sales_price, $83:cs_net_profit", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$90:cr_returned_date_sk, $91:cr_catalog_page_sk, $92:cr_return_amount, $93:cr_net_loss", "FROM catalog_returns" ] }, { "kind": "READ", "substeps": [ "$40", "FROM __stage04_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage03_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $440 := $434", "$270 := SUM($430)", "$271 := SUM($431)", "$272 := SUM($432)", "$273 := SUM($433)" ] }, { "kind": "JOIN", "substeps": [ "$430 := $421, $431 := $422, $432 := $423, $433 := $424, $434 := $11", "INNER HASH JOIN EACH WITH ALL ON $420 = $10" ] }, { "kind": "JOIN", "substeps": [ "$420 := $300, $421 := $302, $422 := $303, $423 := $304, $424 := $305", "INNER HASH JOIN EACH WITH ALL ON $301 = $40" ] }, { "kind": "COMPUTE", "substeps": [ "$340 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$350 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$440, $270, $271, $272, $273", "TO __stage09_output", "BY HASH($440)" ] } ], "waitMsAvg": "1", "waitMsMax": "2", "waitRatioAvg": 0.0014727540500736377, "waitRatioMax": 0.0029455081001472753, "writeMsAvg": "5", "writeMsMax": "7", "writeRatioAvg": 0.007363770250368188, "writeRatioMax": 0.010309278350515464 }, { "completedParallelInputs": "7", "computeMsAvg": "204", "computeMsMax": "277", "computeRatioAvg": 0.3004418262150221, "computeRatioMax": 0.40795287187039764, "endMs": "1665776746089", "id": "10", "inputStages": [ "7", "6" ], "name": "S0A: Join+", "parallelInputs": "7", "readMsAvg": "20", "readMsMax": "29", "readRatioAvg": 0.029455081001472753, "readRatioMax": 0.042709867452135494, "recordsRead": "3168107", "recordsWritten": "42", "shuffleOutputBytes": "3738", "shuffleOutputBytesSpilled": "0", "slotMs": "1373", "startMs": "1665776745906", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:ss_sold_date_sk, $61:ss_store_sk, $62:ss_ext_sales_price, $63:ss_net_profit", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$70:sr_returned_date_sk, $71:sr_store_sk, $72:sr_return_amt, $73:sr_net_loss", "FROM store_returns" ] }, { "kind": "READ", "substeps": [ "$30", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $400 := $394", "$260 := SUM($390)", "$261 := SUM($391)", "$262 := SUM($392)", "$263 := SUM($393)" ] }, { "kind": "JOIN", "substeps": [ "$390 := $381, $391 := $382, $392 := $383, $393 := $384, $394 := $2", "INNER HASH JOIN EACH WITH ALL ON $380 = $1" ] }, { "kind": "JOIN", "substeps": [ "$380 := $290, $381 := $292, $382 := $293, $383 := $294, $384 := $295", "INNER HASH JOIN EACH WITH ALL ON $291 = $30" ] }, { "kind": "COMPUTE", "substeps": [ "$320 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$330 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$400, $260, $261, $262, $263", "TO __stage0A_output", "BY HASH($400)" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.004418262150220913, "waitRatioMax": 0.004418262150220913, "writeMsAvg": "5", "writeMsMax": "7", "writeRatioAvg": 0.007363770250368188, "writeRatioMax": 0.010309278350515464 }, { "completedParallelInputs": "2", "computeMsAvg": "484", "computeMsMax": "679", "computeRatioAvg": 0.7128129602356407, "computeRatioMax": 1, "endMs": "1665776746440", "id": "11", "inputStages": [ "0", "2", "1" ], "name": "S0B: Join+", "parallelInputs": "2", "readMsAvg": "21", "readMsMax": "30", "readRatioAvg": 0.030927835051546393, "readRatioMax": 0.044182621502209134, "recordsRead": "1510621", "recordsWritten": "30", "shuffleOutputBytes": "2670", "shuffleOutputBytesSpilled": "0", "slotMs": "862", "startMs": "1665776746043", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$100:ws_sold_date_sk, $101:ws_web_site_sk, $102:ws_ext_sales_price, $103:ws_net_profit", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$110:wr_returned_date_sk, $111:wr_item_sk, $112:wr_order_number, $113:wr_return_amt, $114:wr_net_loss", "FROM web_returns" ] }, { "kind": "READ", "substeps": [ "$120, $121, $122", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$50", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $490 := $484", "$280 := SUM($480)", "$281 := SUM($481)", "$282 := SUM($482)", "$283 := SUM($483)" ] }, { "kind": "JOIN", "substeps": [ "$480 := $471, $481 := $472, $482 := $473, $483 := $474, $484 := $21", "INNER HASH JOIN EACH WITH ALL ON $470 = $20" ] }, { "kind": "JOIN", "substeps": [ "$470 := $310, $471 := $312, $472 := $313, $473 := $314, $474 := $315", "INNER HASH JOIN EACH WITH ALL ON $311 = $50" ] }, { "kind": "COMPUTE", "substeps": [ "$360 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$370 := NUMERIC<...>" ] }, { "kind": "JOIN", "substeps": [ "$460 := $110, $461 := $113, $462 := $114, $463 := $121", "LEFT OUTER HASH JOIN EACH WITH ALL ON $111 = $120, $112 = $122" ] }, { "kind": "WRITE", "substeps": [ "$490, $280, $281, $282, $283", "TO __stage0B_output", "BY HASH($490)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0029455081001472753, "waitRatioMax": 0.0029455081001472753, "writeMsAvg": "7", "writeMsMax": "9", "writeRatioAvg": 0.010309278350515464, "writeRatioMax": 0.013254786450662739 }, { "completedParallelInputs": "3", "computeMsAvg": "15", "computeMsMax": "18", "computeRatioAvg": 0.022091310751104567, "computeRatioMax": 0.026509572901325478, "endMs": "1665776746512", "id": "12", "inputStages": [ "9", "11", "10" ], "name": "S0C: Aggregate+", "parallelInputs": "3", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "2254", "recordsWritten": "686", "shuffleOutputBytes": "77073", "shuffleOutputBytesSpilled": "0", "slotMs": "112", "startMs": "1665776746469", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$400, $260, $261, $262, $263", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$440, $270, $271, $272, $273", "FROM __stage09_output" ] }, { "kind": "READ", "substeps": [ "$490, $280, $281, $282, $283", "FROM __stage0B_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $510 := $150, $511 := $151, $512 := $170", "$140 := SUM($182)", "$141 := SUM($183)", "$142 := SUM($184)" ] }, { "kind": "COMPUTE", "substeps": [ "$150 := if(equal(bitwise_and($190, 1), 0), NULL, $180)", "$151 := if(equal(bitwise_and($190, 2), 0), NULL, $181)" ] }, { "kind": "COMPUTE", "substeps": [ "$160 := ARRAY<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := 'store channel'", "$201 := concat('store', $410)", "$202 := subtract($231, $233)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $410 := $400", "$230 := SUM($260)", "$231 := SUM($261)", "$232 := SUM($262)", "$233 := SUM($263)" ] }, { "kind": "COMPUTE", "substeps": [ "$210 := 'catalog channel'", "$211 := concat('catalog_page', $450)", "$212 := subtract($241, $243)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $450 := $440", "$240 := SUM($270)", "$241 := SUM($271)", "$242 := SUM($272)", "$243 := SUM($273)" ] }, { "kind": "COMPUTE", "substeps": [ "$220 := 'web channel'", "$221 := concat('web_site', $500)", "$222 := subtract($251, $253)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $500 := $490", "$250 := SUM($280)", "$251 := SUM($281)", "$252 := SUM($282)", "$253 := SUM($283)" ] }, { "kind": "COMPUTE", "substeps": [ "$170 := subtract($191, 1)" ] }, { "kind": "WRITE", "substeps": [ "$140, $141, $142, $510, $511, $512", "TO __stage0C_output", "BY HASH($510, $511, $512)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0014727540500736377, "waitRatioMax": 0.0014727540500736377, "writeMsAvg": "17", "writeMsMax": "21", "writeRatioAvg": 0.025036818851251842, "writeRatioMax": 0.030927835051546393 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.020618556701030927, "computeRatioMax": 0.020618556701030927, "endMs": "1665776746550", "id": "13", "inputStages": [ "12" ], "name": "S0D: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "686", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "30", "startMs": "1665776746521", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$140, $141, $142, $510, $511, $512", "FROM __stage0C_output" ] }, { "kind": "SORT", "substeps": [ "$520 ASC, $521 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $520 := $510, $521 := $511, $522 := $512", "$130 := SUM($140)", "$131 := SUM($141)", "$132 := SUM($142)" ] }, { "kind": "WRITE", "substeps": [ "$530, $531, $532, $533, $534", "TO __stage0D_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0029455081001472753, "waitRatioMax": 0.0029455081001472753, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.023564064801178203, "writeRatioMax": 0.023564064801178203 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.017673048600883652, "computeRatioMax": 0.017673048600883652, "endMs": "1665776746561", "id": "14", "inputStages": [ "13" ], "name": "S0E: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "24", "startMs": "1665776746534", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$530, $531, $532, $533, $534", "FROM __stage0D_output" ] }, { "kind": "SORT", "substeps": [ "$533 ASC, $534 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$540, $541, $542, $543, $544", "TO __stage0E_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0014727540500736377, "waitRatioMax": 0.0014727540500736377, "writeMsAvg": "7", "writeMsMax": "7", "writeRatioAvg": 0.010309278350515464, "writeRatioMax": 0.010309278350515464 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_page" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_site" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "1", "completedUnits": "21", "elapsedMs": "641", "estimatedRunnableUnits": "0", "pendingUnits": "1", "totalSlotMs": "3295" }, { "activeUnits": "1", "completedUnits": "27", "elapsedMs": "987", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "3905" } ], "totalBytesBilled": "272629760", "totalBytesProcessed": "272493208", "totalPartitionsProcessed": "0", "totalSlotMs": "3905", "transferredBytes": "0" }, "startTime": "1665776745604", "totalBytesProcessed": "272493208", "totalSlotMs": "3905" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon3223156a_1edd_42e2_8de4_e622aaf33d8f" }, "priority": "INTERACTIVE", "query": "-- start query 5 in stream 0 using template query5.tpl\nwith ssr as\n (select s_store_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ss_store_sk as store_sk,\n ss_sold_date_sk as date_sk,\n ss_ext_sales_price as sales_price,\n ss_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from store_sales\n union all\n select sr_store_sk as store_sk,\n sr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n sr_return_amt as return_amt,\n sr_net_loss as net_loss\n from store_returns\n ) salesreturns,\n date_dim,\n store\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date) \n and (cast('2000-08-23'+14 as date))--add the 14 days manually\n and store_sk = s_store_sk\n group by s_store_id)\n ,\n csr as\n (select cp_catalog_page_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select cs_catalog_page_sk as page_sk,\n cs_sold_date_sk as date_sk,\n cs_ext_sales_price as sales_price,\n cs_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from catalog_sales\n union all\n select cr_catalog_page_sk as page_sk,\n cr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n cr_return_amount as return_amt,\n cr_net_loss as net_loss\n from catalog_returns\n ) salesreturns,\n date_dim,\n catalog_page\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23'+14 as date))\n and page_sk = cp_catalog_page_sk\n group by cp_catalog_page_id)\n ,\n wsr as\n (select web_site_id,\n sum(sales_price) as sales,\n sum(profit) as profit,\n sum(return_amt) as returns,\n sum(net_loss) as profit_loss\n from\n ( select ws_web_site_sk as wsr_web_site_sk,\n ws_sold_date_sk as date_sk,\n ws_ext_sales_price as sales_price,\n ws_net_profit as profit,\n 0 as return_amt,\n 0 as net_loss\n from web_sales\n union all\n select ws_web_site_sk as wsr_web_site_sk,\n wr_returned_date_sk as date_sk,\n 0 as sales_price,\n 0 as profit,\n wr_return_amt as return_amt,\n wr_net_loss as net_loss\n from web_returns left outer join web_sales on\n ( wr_item_sk = ws_item_sk\n and wr_order_number = ws_order_number)\n ) salesreturns,\n date_dim,\n web_site\n where date_sk = d_date_sk\n and d_date between cast('2000-08-23' as date)\n and (cast('2000-08-23' as date) + 14 )\n and wsr_web_site_sk = web_site_sk\n group by web_site_id)\n select channel\n , id\n , sum(sales) as sales\n , sum(returns) as returns\n , sum(profit) as profit\n from \n (select 'store channel' as channel\n , 'store' || s_store_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from ssr\n union all\n select 'catalog channel' as channel\n , 'catalog_page' || cp_catalog_page_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from csr\n union all\n select 'web channel' as channel\n , 'web_site' || web_site_id as id\n , sales\n , returns\n , (profit - profit_loss) as profit\n from wsr\n ) x\n group by rollup (channel, id)\n order by channel\n ,id\n limit 100\n ;\n\n-- end query 5 in stream 0 using template query5.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "FMMG0gUOaQSEHZmCY8PwCA==", "id": "test-project-364309:europe-west1.query05_1665776747", "jobReference": { "jobId": "query05_1665776747", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query05_1665776747?location=europe-west1", "statistics": { "creationTime": "1665776748212", "endTime": "1665776749279", "finalExecutionDurationMs": "782", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "272493208", "performanceInsights": { "avgPreviousExecutionMs": "976" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.012237762237762238, "computeRatioMax": 0.012237762237762238, "endMs": "1665776748462", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.006993006993006993, "readRatioMax": 0.006993006993006993, "recordsRead": "30", "recordsWritten": "30", "shuffleOutputBytes": "900", "shuffleOutputBytesSpilled": "0", "slotMs": "21", "startMs": "1665776748435", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:web_site_sk, $21:web_site_id", "FROM web_site" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0017482517482517483, "waitRatioMax": 0.0017482517482517483, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.027972027972027972, "writeRatioMax": 0.027972027972027972 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.024475524475524476, "computeRatioMax": 0.024475524475524476, "endMs": "1665776748493", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.015734265734265736, "readRatioMax": 0.015734265734265736, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "38", "startMs": "1665776748448", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:d_date_sk, $51:d_date", "FROM date_dim", "WHERE between($51, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$50", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0017482517482517483, "waitRatioMax": 0.0017482517482517483, "writeMsAvg": "26", "writeMsMax": "26", "writeRatioAvg": 0.045454545454545456, "writeRatioMax": 0.045454545454545456 }, { "completedParallelInputs": "1", "computeMsAvg": "369", "computeMsMax": "369", "computeRatioAvg": 0.6451048951048951, "computeRatioMax": 0.6451048951048951, "endMs": "1665776748705", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "10", "readMsMax": "10", "readRatioAvg": 0.017482517482517484, "readRatioMax": 0.017482517482517484, "recordsRead": "719384", "recordsWritten": "719384", "shuffleOutputBytes": "19421880", "shuffleOutputBytesSpilled": "0", "slotMs": "276", "startMs": "1665776748462", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$120:ws_item_sk, $121:ws_web_site_sk, $122:ws_order_number", "FROM web_sales" ] }, { "kind": "WRITE", "substeps": [ "$120, $121, $122", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0017482517482517483, "waitRatioMax": 0.0017482517482517483, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.024475524475524476, "writeRatioMax": 0.024475524475524476 }, { "completedParallelInputs": "1", "computeMsAvg": "18", "computeMsMax": "18", "computeRatioAvg": 0.03146853146853147, "computeRatioMax": 0.03146853146853147, "endMs": "1665776748535", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.01048951048951049, "readRatioMax": 0.01048951048951049, "recordsRead": "11718", "recordsWritten": "11718", "shuffleOutputBytes": "351540", "shuffleOutputBytesSpilled": "0", "slotMs": "48", "startMs": "1665776748487", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:cp_catalog_page_sk, $11:cp_catalog_page_id", "FROM catalog_page" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage03_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0017482517482517483, "waitRatioMax": 0.0017482517482517483, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.026223776223776224, "writeRatioMax": 0.026223776223776224 }, { "completedParallelInputs": "1", "computeMsAvg": "26", "computeMsMax": "26", "computeRatioAvg": 0.045454545454545456, "computeRatioMax": 0.045454545454545456, "endMs": "1665776748577", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.015734265734265736, "readRatioMax": 0.015734265734265736, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "64", "startMs": "1665776748512", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_date_sk, $41:d_date", "FROM date_dim", "WHERE between($41, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$40", "TO __stage04_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0034965034965034965, "waitRatioMax": 0.0034965034965034965, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.027972027972027972, "writeRatioMax": 0.027972027972027972 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.017482517482517484, "computeRatioMax": 0.017482517482517484, "endMs": "1665776748583", "id": "6", "name": "S06: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.008741258741258742, "readRatioMax": 0.008741258741258742, "recordsRead": "12", "recordsWritten": "12", "shuffleOutputBytes": "360", "shuffleOutputBytesSpilled": "0", "slotMs": "31", "startMs": "1665776748541", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:s_store_sk, $2:s_store_id", "FROM store" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0017482517482517483, "waitRatioMax": 0.0017482517482517483, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.02972027972027972, "writeRatioMax": 0.02972027972027972 }, { "completedParallelInputs": "1", "computeMsAvg": "16", "computeMsMax": "16", "computeRatioAvg": 0.027972027972027972, "computeRatioMax": 0.027972027972027972, "endMs": "1665776748601", "id": "7", "name": "S07: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.012237762237762238, "readRatioMax": 0.012237762237762238, "recordsRead": "73049", "recordsWritten": "15", "shuffleOutputBytes": "135", "shuffleOutputBytesSpilled": "0", "slotMs": "42", "startMs": "1665776748556", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:d_date_sk, $31:d_date", "FROM date_dim", "WHERE between($31, 11192, 11206)" ] }, { "kind": "WRITE", "substeps": [ "$30", "TO __stage07_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0017482517482517483, "waitRatioMax": 0.0017482517482517483, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.026223776223776224, "writeRatioMax": 0.026223776223776224 }, { "completedParallelInputs": "6", "computeMsAvg": "144", "computeMsMax": "202", "computeRatioAvg": 0.2517482517482518, "computeRatioMax": 0.3531468531468531, "endMs": "1665776748719", "id": "9", "inputStages": [ "3", "4" ], "name": "S09: Join+", "parallelInputs": "6", "readMsAvg": "20", "readMsMax": "26", "readRatioAvg": 0.03496503496503497, "readRatioMax": 0.045454545454545456, "recordsRead": "1656013", "recordsWritten": "2182", "shuffleOutputBytes": "194118", "shuffleOutputBytesSpilled": "0", "slotMs": "761", "startMs": "1665776748583", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:cs_sold_date_sk, $81:cs_catalog_page_sk, $82:cs_ext_sales_price, $83:cs_net_profit", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$90:cr_returned_date_sk, $91:cr_catalog_page_sk, $92:cr_return_amount, $93:cr_net_loss", "FROM catalog_returns" ] }, { "kind": "READ", "substeps": [ "$40", "FROM __stage04_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage03_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $440 := $434", "$270 := SUM($430)", "$271 := SUM($431)", "$272 := SUM($432)", "$273 := SUM($433)" ] }, { "kind": "JOIN", "substeps": [ "$430 := $421, $431 := $422, $432 := $423, $433 := $424, $434 := $11", "INNER HASH JOIN EACH WITH ALL ON $420 = $10" ] }, { "kind": "JOIN", "substeps": [ "$420 := $300, $421 := $302, $422 := $303, $423 := $304, $424 := $305", "INNER HASH JOIN EACH WITH ALL ON $301 = $40" ] }, { "kind": "COMPUTE", "substeps": [ "$340 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$350 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$440, $270, $271, $272, $273", "TO __stage09_output", "BY HASH($440)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0017482517482517483, "waitRatioMax": 0.0017482517482517483, "writeMsAvg": "5", "writeMsMax": "7", "writeRatioAvg": 0.008741258741258742, "writeRatioMax": 0.012237762237762238 }, { "completedParallelInputs": "7", "computeMsAvg": "243", "computeMsMax": "308", "computeRatioAvg": 0.42482517482517484, "computeRatioMax": 0.5384615384615384, "endMs": "1665776748832", "id": "10", "inputStages": [ "6", "7" ], "name": "S0A: Join+", "parallelInputs": "7", "readMsAvg": "17", "readMsMax": "26", "readRatioAvg": 0.02972027972027972, "readRatioMax": 0.045454545454545456, "recordsRead": "3168107", "recordsWritten": "42", "shuffleOutputBytes": "3738", "shuffleOutputBytesSpilled": "0", "slotMs": "1473", "startMs": "1665776748611", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:ss_sold_date_sk, $61:ss_store_sk, $62:ss_ext_sales_price, $63:ss_net_profit", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$70:sr_returned_date_sk, $71:sr_store_sk, $72:sr_return_amt, $73:sr_net_loss", "FROM store_returns" ] }, { "kind": "READ", "substeps": [ "$30", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $400 := $394", "$260 := SUM($390)", "$261 := SUM($391)", "$262 := SUM($392)", "$263 := SUM($393)" ] }, { "kind": "JOIN", "substeps": [ "$390 := $381, $391 := $382, $392 := $383, $393 := $384, $394 := $2", "INNER HASH JOIN EACH WITH ALL ON $380 = $1" ] }, { "kind": "JOIN", "substeps": [ "$380 := $290, $381 := $292, $382 := $293, $383 := $294, $384 := $295", "INNER HASH JOIN EACH WITH ALL ON $291 = $30" ] }, { "kind": "COMPUTE", "substeps": [ "$320 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$330 := NUMERIC<...>" ] }, { "kind": "WRITE", "substeps": [ "$400, $260, $261, $262, $263", "TO __stage0A_output", "BY HASH($400)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0017482517482517483, "waitRatioMax": 0.0017482517482517483, "writeMsAvg": "4", "writeMsMax": "5", "writeRatioAvg": 0.006993006993006993, "writeRatioMax": 0.008741258741258742 }, { "completedParallelInputs": "2", "computeMsAvg": "416", "computeMsMax": "572", "computeRatioAvg": 0.7272727272727273, "computeRatioMax": 1, "endMs": "1665776749067", "id": "11", "inputStages": [ "0", "2", "1" ], "name": "S0B: Join+", "parallelInputs": "2", "readMsAvg": "20", "readMsMax": "30", "readRatioAvg": 0.03496503496503497, "readRatioMax": 0.05244755244755245, "recordsRead": "1510621", "recordsWritten": "30", "shuffleOutputBytes": "2670", "shuffleOutputBytesSpilled": "0", "slotMs": "737", "startMs": "1665776748740", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$100:ws_sold_date_sk, $101:ws_web_site_sk, $102:ws_ext_sales_price, $103:ws_net_profit", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$110:wr_returned_date_sk, $111:wr_item_sk, $112:wr_order_number, $113:wr_return_amt, $114:wr_net_loss", "FROM web_returns" ] }, { "kind": "READ", "substeps": [ "$120, $121, $122", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$50", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $490 := $484", "$280 := SUM($480)", "$281 := SUM($481)", "$282 := SUM($482)", "$283 := SUM($483)" ] }, { "kind": "JOIN", "substeps": [ "$480 := $471, $481 := $472, $482 := $473, $483 := $474, $484 := $21", "INNER HASH JOIN EACH WITH ALL ON $470 = $20" ] }, { "kind": "JOIN", "substeps": [ "$470 := $310, $471 := $312, $472 := $313, $473 := $314, $474 := $315", "INNER HASH JOIN EACH WITH ALL ON $311 = $50" ] }, { "kind": "COMPUTE", "substeps": [ "$360 := NUMERIC<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$370 := NUMERIC<...>" ] }, { "kind": "JOIN", "substeps": [ "$460 := $110, $461 := $113, $462 := $114, $463 := $121", "LEFT OUTER HASH JOIN EACH WITH ALL ON $111 = $120, $112 = $122" ] }, { "kind": "WRITE", "substeps": [ "$490, $280, $281, $282, $283", "TO __stage0B_output", "BY HASH($490)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0017482517482517483, "waitRatioMax": 0.0017482517482517483, "writeMsAvg": "6", "writeMsMax": "6", "writeRatioAvg": 0.01048951048951049, "writeRatioMax": 0.01048951048951049 }, { "completedParallelInputs": "3", "computeMsAvg": "11", "computeMsMax": "13", "computeRatioAvg": 0.019230769230769232, "computeRatioMax": 0.022727272727272728, "endMs": "1665776749123", "id": "12", "inputStages": [ "10", "11", "9" ], "name": "S0C: Aggregate+", "parallelInputs": "3", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "2254", "recordsWritten": "686", "shuffleOutputBytes": "77073", "shuffleOutputBytesSpilled": "0", "slotMs": "90", "startMs": "1665776749087", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$400, $260, $261, $262, $263", "FROM __stage0A_output" ] }, { "kind": "READ", "substeps": [ "$440, $270, $271, $272, $273", "FROM __stage09_output" ] }, { "kind": "READ", "substeps": [ "$490, $280, $281, $282, $283", "FROM __stage0B_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $510 := $150, $511 := $151, $512 := $170", "$140 := SUM($182)", "$141 := SUM($183)", "$142 := SUM($184)" ] }, { "kind": "COMPUTE", "substeps": [ "$150 := if(equal(bitwise_and($190, 1), 0), NULL, $180)", "$151 := if(equal(bitwise_and($190, 2), 0), NULL, $181)" ] }, { "kind": "COMPUTE", "substeps": [ "$160 := ARRAY<...>" ] }, { "kind": "COMPUTE", "substeps": [ "$200 := 'store channel'", "$201 := concat('store', $410)", "$202 := subtract($231, $233)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $410 := $400", "$230 := SUM($260)", "$231 := SUM($261)", "$232 := SUM($262)", "$233 := SUM($263)" ] }, { "kind": "COMPUTE", "substeps": [ "$210 := 'catalog channel'", "$211 := concat('catalog_page', $450)", "$212 := subtract($241, $243)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $450 := $440", "$240 := SUM($270)", "$241 := SUM($271)", "$242 := SUM($272)", "$243 := SUM($273)" ] }, { "kind": "COMPUTE", "substeps": [ "$220 := 'web channel'", "$221 := concat('web_site', $500)", "$222 := subtract($251, $253)" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $500 := $490", "$250 := SUM($280)", "$251 := SUM($281)", "$252 := SUM($282)", "$253 := SUM($283)" ] }, { "kind": "COMPUTE", "substeps": [ "$170 := subtract($191, 1)" ] }, { "kind": "WRITE", "substeps": [ "$140, $141, $142, $510, $511, $512", "TO __stage0C_output", "BY HASH($510, $511, $512)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0017482517482517483, "waitRatioMax": 0.0017482517482517483, "writeMsAvg": "13", "writeMsMax": "15", "writeRatioAvg": 0.022727272727272728, "writeRatioMax": 0.026223776223776224 }, { "completedParallelInputs": "1", "computeMsAvg": "6", "computeMsMax": "6", "computeRatioAvg": 0.01048951048951049, "computeRatioMax": 0.01048951048951049, "endMs": "1665776749170", "id": "13", "inputStages": [ "12" ], "name": "S0D: Sort+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "686", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "55", "startMs": "1665776749136", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$140, $141, $142, $510, $511, $512", "FROM __stage0C_output" ] }, { "kind": "SORT", "substeps": [ "$520 ASC, $521 ASC", "LIMIT 100" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $520 := $510, $521 := $511, $522 := $512", "$130 := SUM($140)", "$131 := SUM($141)", "$132 := SUM($142)" ] }, { "kind": "WRITE", "substeps": [ "$530, $531, $532, $533, $534", "TO __stage0D_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0017482517482517483, "waitRatioMax": 0.0017482517482517483, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.024475524475524476, "writeRatioMax": 0.024475524475524476 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.022727272727272728, "computeRatioMax": 0.022727272727272728, "endMs": "1665776749179", "id": "14", "inputStages": [ "13" ], "name": "S0E: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "10317", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665776749149", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$530, $531, $532, $533, $534", "FROM __stage0D_output" ] }, { "kind": "SORT", "substeps": [ "$533 ASC, $534 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$540, $541, $542, $543, $544", "TO __stage0E_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0017482517482517483, "waitRatioMax": 0.0017482517482517483, "writeMsAvg": "6", "writeMsMax": "6", "writeRatioAvg": 0.01048951048951049, "writeRatioMax": 0.01048951048951049 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_page" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_site" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "1", "completedUnits": "21", "elapsedMs": "656", "estimatedRunnableUnits": "0", "pendingUnits": "1", "totalSlotMs": "3218" }, { "activeUnits": "1", "completedUnits": "27", "elapsedMs": "942", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "3763" } ], "totalBytesBilled": "272629760", "totalBytesProcessed": "272493208", "totalPartitionsProcessed": "0", "totalSlotMs": "3763", "transferredBytes": "0" }, "startTime": "1665776748282", "totalBytesProcessed": "272493208", "totalSlotMs": "3763" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
