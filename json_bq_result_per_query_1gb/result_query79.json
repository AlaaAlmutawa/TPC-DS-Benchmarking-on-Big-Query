{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon7313b99b_f1ea_486c_aa42_5d1f22562a02" }, "priority": "INTERACTIVE", "query": "-- start query 79 in stream 0 using template query79.tpl\n\n/*\nCompute the per customer coupon amount and net profit of Monday shoppers. \nOnly purchases of three consecutive years made on Mondays in large stores by customers \nwith a certain dependent count and with a large vehicle count are considered.\n*/\n\nselect\n c_last_name,c_first_name,substr(s_city,1,30),ss_ticket_number,amt,profit\n from\n (select ss_ticket_number\n ,ss_customer_sk\n ,store.s_city\n ,sum(ss_coupon_amt) amt\n ,sum(ss_net_profit) profit\n from store_sales,date_dim,store,household_demographics\n where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n and store_sales.ss_store_sk = store.s_store_sk \n and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n and (household_demographics.hd_dep_count = 6 or household_demographics.hd_vehicle_count > 2)\n and date_dim.d_dow = 1\n and date_dim.d_year in (1999,1999+1,1999+2) \n and store.s_number_employees between 200 and 295\n group by ss_ticket_number,ss_customer_sk,ss_addr_sk,store.s_city) ms,customer\n where ss_customer_sk = c_customer_sk\n order by c_last_name,c_first_name,substr(s_city,1,30), profit\n limit 100\n;\n\n-- end query 79 in stream 0 using template query79.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "plzeGadcMh2v89fhEhLimw==", "id": "test-project-364309:europe-west1.query79_1665768479", "jobReference": { "jobId": "query79_1665768479", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query79_1665768479?location=europe-west1", "statistics": { "creationTime": "1665768479754", "endTime": "1665768480606", "finalExecutionDurationMs": "676", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "225339941", "performanceInsights": { "avgPreviousExecutionMs": "751" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.0186219739292365, "computeRatioMax": 0.0186219739292365, "endMs": "1665768479955", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.0074487895716946, "readRatioMax": 0.0074487895716946, "recordsRead": "7200", "recordsWritten": "2880", "shuffleOutputBytes": "25920", "shuffleOutputBytesSpilled": "0", "slotMs": "38", "startMs": "1665768479912", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:hd_demo_sk, $11:hd_dep_count, $12:hd_vehicle_count", "FROM household_demographics", "WHERE or(equal($11, 6), greater($12, 2))" ] }, { "kind": "WRITE", "substeps": [ "$10", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00186219739292365, "waitRatioMax": 0.00186219739292365, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.035381750465549346, "writeRatioMax": 0.035381750465549346 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.0260707635009311, "computeRatioMax": 0.0260707635009311, "endMs": "1665768479966", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.00931098696461825, "readRatioMax": 0.00931098696461825, "recordsRead": "12", "recordsWritten": "11", "shuffleOutputBytes": "226", "shuffleOutputBytesSpilled": "0", "slotMs": "37", "startMs": "1665768479928", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:s_store_sk, $32:s_city, $31:s_number_employees", "FROM store", "WHERE between($31, 200, 295)" ] }, { "kind": "WRITE", "substeps": [ "$30, $32", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00186219739292365, "waitRatioMax": 0.00186219739292365, "writeMsAvg": "12", "writeMsMax": "12", "writeRatioAvg": 0.0223463687150838, "writeRatioMax": 0.0223463687150838 }, { "completedParallelInputs": "1", "computeMsAvg": "15", "computeMsMax": "15", "computeRatioAvg": 0.027932960893854747, "computeRatioMax": 0.027932960893854747, "endMs": "1665768479973", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.01675977653631285, "readRatioMax": 0.01675977653631285, "recordsRead": "73049", "recordsWritten": "157", "shuffleOutputBytes": "1413", "shuffleOutputBytesSpilled": "0", "slotMs": "31", "startMs": "1665768479943", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_date_sk, $41:d_year, $42:d_dow", "FROM date_dim", "WHERE and(equal($42, 1), in($41, 1999, 2000, 2001))" ] }, { "kind": "WRITE", "substeps": [ "$40", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00186219739292365, "waitRatioMax": 0.00186219739292365, "writeMsAvg": "12", "writeMsMax": "12", "writeRatioAvg": 0.0223463687150838, "writeRatioMax": 0.0223463687150838 }, { "completedParallelInputs": "6", "computeMsAvg": "433", "computeMsMax": "537", "computeRatioAvg": 0.8063314711359404, "computeRatioMax": 1, "endMs": "1665768480333", "id": "4", "inputStages": [ "1", "2", "0" ], "name": "S04: Join+", "parallelInputs": "6", "readMsAvg": "33", "readMsMax": "43", "readRatioAvg": 0.061452513966480445, "readRatioMax": 0.08007448789571694, "recordsRead": "2898692", "recordsWritten": "35203", "shuffleOutputBytes": "2530306", "shuffleOutputBytesSpilled": "0", "slotMs": "2445", "startMs": "1665768479980", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ss_sold_date_sk, $21:ss_customer_sk, $22:ss_hdemo_sk, $23:ss_addr_sk, $24:ss_store_sk, $25:ss_ticket_number, $26:ss_coupon_amt, $27:ss_net_profit", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$40", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$30, $32", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$10", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $120 := $112, $121 := $110, $122 := $111, $123 := $115", "$70 := SUM($113)", "$71 := SUM($114)" ] }, { "kind": "JOIN", "substeps": [ "$110 := $90, $111 := $92, $112 := $93, $113 := $94, $114 := $95, $115 := $96", "INNER HASH JOIN EACH WITH ALL ON $91 = $10" ] }, { "kind": "JOIN", "substeps": [ "$90 := $80, $91 := $81, $92 := $82, $93 := $84, $94 := $85, $95 := $86, $96 := $32", "INNER HASH JOIN EACH WITH ALL ON $83 = $30" ] }, { "kind": "JOIN", "substeps": [ "$80 := $21, $81 := $22, $82 := $23, $83 := $24, $84 := $25, $85 := $26, $86 := $27", "INNER HASH JOIN EACH WITH ALL ON $20 = $40" ] }, { "kind": "WRITE", "substeps": [ "$121, $122, $120, $123, $70, $71", "TO __stage04_output", "BY HASH($120, $121, $122, $123)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00186219739292365, "waitRatioMax": 0.00186219739292365, "writeMsAvg": "7", "writeMsMax": "9", "writeRatioAvg": 0.01303538175046555, "writeRatioMax": 0.01675977653631285 }, { "completedParallelInputs": "1", "computeMsAvg": "58", "computeMsMax": "58", "computeRatioAvg": 0.10800744878957169, "computeRatioMax": 0.10800744878957169, "endMs": "1665768480421", "id": "6", "inputStages": [ "4" ], "name": "S06: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "35203", "recordsWritten": "7013", "shuffleOutputBytes": "441081", "shuffleOutputBytesSpilled": "0", "slotMs": "53", "startMs": "1665768480368", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$121, $122, $120, $123, $70, $71", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $130 := $120, $131 := $121, $132 := $122, $133 := $123", "$60 := SUM($70)", "$61 := SUM($71)" ] }, { "kind": "WRITE", "substeps": [ "$60, $61, $130, $131, $133", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.00186219739292365, "waitRatioMax": 0.00186219739292365, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.035381750465549346, "writeRatioMax": 0.035381750465549346 }, { "completedParallelInputs": "100", "computeMsAvg": "9", "computeMsMax": "16", "computeRatioAvg": 0.01675977653631285, "computeRatioMax": 0.0297951582867784, "endMs": "1665768480492", "id": "7", "inputStages": [ "6" ], "name": "S07: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "7013", "recordsWritten": "7013", "shuffleOutputBytes": "441081", "shuffleOutputBytesSpilled": "0", "slotMs": "3546", "startMs": "1665768480431", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "3", "waitRatioAvg": 0.00186219739292365, "waitRatioMax": 0.00558659217877095, "writeMsAvg": "16", "writeMsMax": "28", "writeRatioAvg": 0.0297951582867784, "writeRatioMax": 0.0521415270018622 }, { "completedParallelInputs": "1", "computeMsAvg": "54", "computeMsMax": "54", "computeRatioAvg": 0.1005586592178771, "computeRatioMax": 0.1005586592178771, "endMs": "1665768480519", "id": "8", "inputStages": [ "7" ], "name": "S08: Join+", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.01675977653631285, "readRatioMax": 0.01675977653631285, "recordsRead": "107013", "recordsWritten": "100", "shuffleOutputBytes": "5586", "shuffleOutputBytesSpilled": "0", "slotMs": "88", "startMs": "1665768480436", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:c_customer_sk, $2:c_first_name, $3:c_last_name", "FROM customer" ] }, { "kind": "READ", "substeps": [ "$60, $61, $130, $131, $133", "FROM __stage07_output" ] }, { "kind": "SORT", "substeps": [ "$145 ASC, $144 ASC, $50 ASC, $143 ASC", "LIMIT 100" ] }, { "kind": "COMPUTE", "substeps": [ "$50 := substr($141, 1, 30)" ] }, { "kind": "JOIN", "substeps": [ "$144 := $2, $145 := $3, $140 := $130, $141 := $133, $142 := $60, $143 := $61", "INNER HASH JOIN EACH WITH ALL ON $1 = $131" ] }, { "kind": "WRITE", "substeps": [ "$150, $151, $152, $153, $154, $155", "TO __stage08_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.00558659217877095, "waitRatioMax": 0.00558659217877095, "writeMsAvg": "1", "writeMsMax": "1", "writeRatioAvg": 0.00186219739292365, "writeRatioMax": 0.00186219739292365 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.020484171322160148, "computeRatioMax": 0.020484171322160148, "endMs": "1665768480530", "id": "9", "inputStages": [ "8" ], "name": "S09: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "5586", "shuffleOutputBytesSpilled": "0", "slotMs": "38", "startMs": "1665768480448", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$150, $151, $152, $153, $154, $155", "FROM __stage08_output" ] }, { "kind": "SORT", "substeps": [ "$151 ASC, $150 ASC, $153 ASC, $155 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$160, $161, $162, $163, $164, $165", "TO __stage09_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.00558659217877095, "waitRatioMax": 0.00558659217877095, "writeMsAvg": "6", "writeMsMax": "6", "writeRatioAvg": 0.0111731843575419, "writeRatioMax": 0.0111731843575419 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "household_demographics" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "customer" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "2", "completedUnits": "9", "elapsedMs": "614", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "2613" }, { "activeUnits": "2", "completedUnits": "112", "elapsedMs": "766", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "6340" } ], "totalBytesBilled": "225443840", "totalBytesProcessed": "225339941", "totalPartitionsProcessed": "0", "totalSlotMs": "6340", "transferredBytes": "0" }, "startTime": "1665768479799", "totalBytesProcessed": "225339941", "totalSlotMs": "6340" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon60a2d8f1_e69c_4672_a7d1_afa5eb0be345" }, "priority": "INTERACTIVE", "query": "-- start query 79 in stream 0 using template query79.tpl\n\n/*\nCompute the per customer coupon amount and net profit of Monday shoppers. \nOnly purchases of three consecutive years made on Mondays in large stores by customers \nwith a certain dependent count and with a large vehicle count are considered.\n*/\n\nselect\n c_last_name,c_first_name,substr(s_city,1,30),ss_ticket_number,amt,profit\n from\n (select ss_ticket_number\n ,ss_customer_sk\n ,store.s_city\n ,sum(ss_coupon_amt) amt\n ,sum(ss_net_profit) profit\n from store_sales,date_dim,store,household_demographics\n where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n and store_sales.ss_store_sk = store.s_store_sk \n and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n and (household_demographics.hd_dep_count = 6 or household_demographics.hd_vehicle_count > 2)\n and date_dim.d_dow = 1\n and date_dim.d_year in (1999,1999+1,1999+2) \n and store.s_number_employees between 200 and 295\n group by ss_ticket_number,ss_customer_sk,ss_addr_sk,store.s_city) ms,customer\n where ss_customer_sk = c_customer_sk\n order by c_last_name,c_first_name,substr(s_city,1,30), profit\n limit 100\n;\n\n-- end query 79 in stream 0 using template query79.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "ITKgvIyfraop0xm3Kvne6A==", "id": "test-project-364309:europe-west1.query79_1665778618", "jobReference": { "jobId": "query79_1665778618", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query79_1665778618?location=europe-west1", "statistics": { "creationTime": "1665778618907", "endTime": "1665778619871", "finalExecutionDurationMs": "765", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "225339941", "performanceInsights": { "avgPreviousExecutionMs": "732" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.015827338129496403, "computeRatioMax": 0.015827338129496403, "endMs": "1665778619098", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.007194244604316547, "readRatioMax": 0.007194244604316547, "recordsRead": "7200", "recordsWritten": "2880", "shuffleOutputBytes": "25920", "shuffleOutputBytesSpilled": "0", "slotMs": "43", "startMs": "1665778619056", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:hd_demo_sk, $11:hd_dep_count, $12:hd_vehicle_count", "FROM household_demographics", "WHERE or(equal($11, 6), greater($12, 2))" ] }, { "kind": "WRITE", "substeps": [ "$10", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0014388489208633094, "waitRatioMax": 0.0014388489208633094, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.02302158273381295, "writeRatioMax": 0.02302158273381295 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.015827338129496403, "computeRatioMax": 0.015827338129496403, "endMs": "1665778619115", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.007194244604316547, "readRatioMax": 0.007194244604316547, "recordsRead": "12", "recordsWritten": "11", "shuffleOutputBytes": "226", "shuffleOutputBytesSpilled": "0", "slotMs": "57", "startMs": "1665778619071", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:s_store_sk, $32:s_city, $31:s_number_employees", "FROM store", "WHERE between($31, 200, 295)" ] }, { "kind": "WRITE", "substeps": [ "$30, $32", "TO __stage01_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0028776978417266188, "waitRatioMax": 0.0028776978417266188, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.025899280575539568, "writeRatioMax": 0.025899280575539568 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.010071942446043165, "computeRatioMax": 0.010071942446043165, "endMs": "1665778619122", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.007194244604316547, "readRatioMax": 0.007194244604316547, "recordsRead": "73049", "recordsWritten": "157", "shuffleOutputBytes": "1413", "shuffleOutputBytesSpilled": "0", "slotMs": "26", "startMs": "1665778619086", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_date_sk, $41:d_year, $42:d_dow", "FROM date_dim", "WHERE and(equal($42, 1), in($41, 1999, 2000, 2001))" ] }, { "kind": "WRITE", "substeps": [ "$40", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0014388489208633094, "waitRatioMax": 0.0014388489208633094, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.01870503597122302, "writeRatioMax": 0.01870503597122302 }, { "completedParallelInputs": "6", "computeMsAvg": "410", "computeMsMax": "695", "computeRatioAvg": 0.5899280575539568, "computeRatioMax": 1, "endMs": "1665778619558", "id": "4", "inputStages": [ "2", "1", "0" ], "name": "S04: Join+", "parallelInputs": "6", "readMsAvg": "27", "readMsMax": "40", "readRatioAvg": 0.03884892086330935, "readRatioMax": 0.05755395683453238, "recordsRead": "2898692", "recordsWritten": "35203", "shuffleOutputBytes": "2530306", "shuffleOutputBytesSpilled": "0", "slotMs": "2605", "startMs": "1665778619129", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ss_sold_date_sk, $21:ss_customer_sk, $22:ss_hdemo_sk, $23:ss_addr_sk, $24:ss_store_sk, $25:ss_ticket_number, $26:ss_coupon_amt, $27:ss_net_profit", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$40", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$30, $32", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$10", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $120 := $112, $121 := $110, $122 := $111, $123 := $115", "$70 := SUM($113)", "$71 := SUM($114)" ] }, { "kind": "JOIN", "substeps": [ "$110 := $90, $111 := $92, $112 := $93, $113 := $94, $114 := $95, $115 := $96", "INNER HASH JOIN EACH WITH ALL ON $91 = $10" ] }, { "kind": "JOIN", "substeps": [ "$90 := $80, $91 := $81, $92 := $82, $93 := $84, $94 := $85, $95 := $86, $96 := $32", "INNER HASH JOIN EACH WITH ALL ON $83 = $30" ] }, { "kind": "JOIN", "substeps": [ "$80 := $21, $81 := $22, $82 := $23, $83 := $24, $84 := $25, $85 := $26, $86 := $27", "INNER HASH JOIN EACH WITH ALL ON $20 = $40" ] }, { "kind": "WRITE", "substeps": [ "$121, $122, $120, $123, $70, $71", "TO __stage04_output", "BY HASH($120, $121, $122, $123)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0014388489208633094, "waitRatioMax": 0.0014388489208633094, "writeMsAvg": "5", "writeMsMax": "6", "writeRatioAvg": 0.007194244604316547, "writeRatioMax": 0.008633093525179856 }, { "completedParallelInputs": "1", "computeMsAvg": "51", "computeMsMax": "51", "computeRatioAvg": 0.07338129496402877, "computeRatioMax": 0.07338129496402877, "endMs": "1665778619694", "id": "6", "inputStages": [ "4" ], "name": "S06: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "35203", "recordsWritten": "7013", "shuffleOutputBytes": "441081", "shuffleOutputBytesSpilled": "0", "slotMs": "93", "startMs": "1665778619623", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$121, $122, $120, $123, $70, $71", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $130 := $120, $131 := $121, $132 := $122, $133 := $123", "$60 := SUM($70)", "$61 := SUM($71)" ] }, { "kind": "WRITE", "substeps": [ "$60, $61, $130, $131, $133", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0014388489208633094, "waitRatioMax": 0.0014388489208633094, "writeMsAvg": "26", "writeMsMax": "26", "writeRatioAvg": 0.03741007194244604, "writeRatioMax": 0.03741007194244604 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "15", "computeRatioAvg": 0.011510791366906475, "computeRatioMax": 0.02158273381294964, "endMs": "1665778619756", "id": "7", "inputStages": [ "6" ], "name": "S07: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "7013", "recordsWritten": "7013", "shuffleOutputBytes": "441081", "shuffleOutputBytesSpilled": "0", "slotMs": "3765", "startMs": "1665778619704", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage06_output" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.0028776978417266188, "waitRatioMax": 0.004316546762589928, "writeMsAvg": "15", "writeMsMax": "25", "writeRatioAvg": 0.02158273381294964, "writeRatioMax": 0.03597122302158273 }, { "completedParallelInputs": "1", "computeMsAvg": "30", "computeMsMax": "30", "computeRatioAvg": 0.04316546762589928, "computeRatioMax": 0.04316546762589928, "endMs": "1665778619774", "id": "8", "inputStages": [ "7" ], "name": "S08: Join+", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.008633093525179856, "readRatioMax": 0.008633093525179856, "recordsRead": "107013", "recordsWritten": "100", "shuffleOutputBytes": "5586", "shuffleOutputBytesSpilled": "0", "slotMs": "63", "startMs": "1665778619708", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:c_customer_sk, $2:c_first_name, $3:c_last_name", "FROM customer" ] }, { "kind": "READ", "substeps": [ "$60, $61, $130, $131, $133", "FROM __stage07_output" ] }, { "kind": "SORT", "substeps": [ "$145 ASC, $144 ASC, $50 ASC, $143 ASC", "LIMIT 100" ] }, { "kind": "COMPUTE", "substeps": [ "$50 := substr($141, 1, 30)" ] }, { "kind": "JOIN", "substeps": [ "$144 := $2, $145 := $3, $140 := $130, $141 := $133, $142 := $60, $143 := $61", "INNER HASH JOIN EACH WITH ALL ON $1 = $131" ] }, { "kind": "WRITE", "substeps": [ "$150, $151, $152, $153, $154, $155", "TO __stage08_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.004316546762589928, "waitRatioMax": 0.004316546762589928, "writeMsAvg": "0", "writeMsMax": "0", "writeRatioAvg": 0, "writeRatioMax": 0 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.014388489208633094, "computeRatioMax": 0.014388489208633094, "endMs": "1665778619781", "id": "9", "inputStages": [ "8" ], "name": "S09: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "5586", "shuffleOutputBytesSpilled": "0", "slotMs": "37", "startMs": "1665778619721", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$150, $151, $152, $153, $154, $155", "FROM __stage08_output" ] }, { "kind": "SORT", "substeps": [ "$151 ASC, $150 ASC, $153 ASC, $155 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$160, $161, $162, $163, $164, $165", "TO __stage09_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0014388489208633094, "waitRatioMax": 0.0014388489208633094, "writeMsAvg": "4", "writeMsMax": "4", "writeRatioAvg": 0.0057553956834532375, "writeRatioMax": 0.0057553956834532375 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "household_demographics" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "customer" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "2", "completedUnits": "8", "elapsedMs": "596", "estimatedRunnableUnits": "0", "pendingUnits": "1", "totalSlotMs": "1958" }, { "activeUnits": "2", "completedUnits": "112", "elapsedMs": "857", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "6712" } ], "totalBytesBilled": "225443840", "totalBytesProcessed": "225339941", "totalPartitionsProcessed": "0", "totalSlotMs": "6712", "transferredBytes": "0" }, "startTime": "1665778618960", "totalBytesProcessed": "225339941", "totalSlotMs": "6712" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon6de7ba55_856f_474a_bbcc_b5eb56b200b6" }, "priority": "INTERACTIVE", "query": "-- start query 79 in stream 0 using template query79.tpl\n\n/*\nCompute the per customer coupon amount and net profit of Monday shoppers. \nOnly purchases of three consecutive years made on Mondays in large stores by customers \nwith a certain dependent count and with a large vehicle count are considered.\n*/\n\nselect\n c_last_name,c_first_name,substr(s_city,1,30),ss_ticket_number,amt,profit\n from\n (select ss_ticket_number\n ,ss_customer_sk\n ,store.s_city\n ,sum(ss_coupon_amt) amt\n ,sum(ss_net_profit) profit\n from store_sales,date_dim,store,household_demographics\n where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n and store_sales.ss_store_sk = store.s_store_sk \n and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n and (household_demographics.hd_dep_count = 6 or household_demographics.hd_vehicle_count > 2)\n and date_dim.d_dow = 1\n and date_dim.d_year in (1999,1999+1,1999+2) \n and store.s_number_employees between 200 and 295\n group by ss_ticket_number,ss_customer_sk,ss_addr_sk,store.s_city) ms,customer\n where ss_customer_sk = c_customer_sk\n order by c_last_name,c_first_name,substr(s_city,1,30), profit\n limit 100\n;\n\n-- end query 79 in stream 0 using template query79.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "b4MvgEoN5+9Nnhd3jbLRaA==", "id": "test-project-364309:europe-west1.query79_1665778621", "jobReference": { "jobId": "query79_1665778621", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query79_1665778621?location=europe-west1", "statistics": { "creationTime": "1665778621635", "endTime": "1665778622447", "finalExecutionDurationMs": "614", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "225339941", "performanceInsights": { "avgPreviousExecutionMs": "739" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.022222222222222223, "computeRatioMax": 0.022222222222222223, "endMs": "1665778621830", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.011111111111111112, "readRatioMax": 0.011111111111111112, "recordsRead": "7200", "recordsWritten": "2880", "shuffleOutputBytes": "25920", "shuffleOutputBytesSpilled": "0", "slotMs": "46", "startMs": "1665778621790", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:hd_demo_sk, $11:hd_dep_count, $12:hd_vehicle_count", "FROM household_demographics", "WHERE or(equal($11, 6), greater($12, 2))" ] }, { "kind": "WRITE", "substeps": [ "$10", "TO __stage00_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0044444444444444444, "waitRatioMax": 0.0044444444444444444, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.035555555555555556, "writeRatioMax": 0.035555555555555556 }, { "completedParallelInputs": "1", "computeMsAvg": "6", "computeMsMax": "6", "computeRatioAvg": 0.013333333333333334, "computeRatioMax": 0.013333333333333334, "endMs": "1665778621833", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.008888888888888889, "readRatioMax": 0.008888888888888889, "recordsRead": "12", "recordsWritten": "11", "shuffleOutputBytes": "226", "shuffleOutputBytesSpilled": "0", "slotMs": "27", "startMs": "1665778621807", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:s_store_sk, $32:s_city, $31:s_number_employees", "FROM store", "WHERE between($31, 200, 295)" ] }, { "kind": "WRITE", "substeps": [ "$30, $32", "TO __stage01_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0044444444444444444, "waitRatioMax": 0.0044444444444444444, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.03333333333333333, "writeRatioMax": 0.03333333333333333 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.02666666666666667, "computeRatioMax": 0.02666666666666667, "endMs": "1665778621867", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.013333333333333334, "readRatioMax": 0.013333333333333334, "recordsRead": "73049", "recordsWritten": "157", "shuffleOutputBytes": "1413", "shuffleOutputBytesSpilled": "0", "slotMs": "52", "startMs": "1665778621822", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_date_sk, $41:d_year, $42:d_dow", "FROM date_dim", "WHERE and(equal($42, 1), in($41, 1999, 2000, 2001))" ] }, { "kind": "WRITE", "substeps": [ "$40", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0022222222222222222, "waitRatioMax": 0.0022222222222222222, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.035555555555555556, "writeRatioMax": 0.035555555555555556 }, { "completedParallelInputs": "6", "computeMsAvg": "350", "computeMsMax": "450", "computeRatioAvg": 0.7777777777777778, "computeRatioMax": 1, "endMs": "1665778622153", "id": "4", "inputStages": [ "1", "2", "0" ], "name": "S04: Join+", "parallelInputs": "6", "readMsAvg": "25", "readMsMax": "28", "readRatioAvg": 0.05555555555555555, "readRatioMax": 0.06222222222222222, "recordsRead": "2898692", "recordsWritten": "35203", "shuffleOutputBytes": "2530306", "shuffleOutputBytesSpilled": "0", "slotMs": "2041", "startMs": "1665778621877", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ss_sold_date_sk, $21:ss_customer_sk, $22:ss_hdemo_sk, $23:ss_addr_sk, $24:ss_store_sk, $25:ss_ticket_number, $26:ss_coupon_amt, $27:ss_net_profit", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$40", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$30, $32", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$10", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $120 := $112, $121 := $110, $122 := $111, $123 := $115", "$70 := SUM($113)", "$71 := SUM($114)" ] }, { "kind": "JOIN", "substeps": [ "$110 := $90, $111 := $92, $112 := $93, $113 := $94, $114 := $95, $115 := $96", "INNER HASH JOIN EACH WITH ALL ON $91 = $10" ] }, { "kind": "JOIN", "substeps": [ "$90 := $80, $91 := $81, $92 := $82, $93 := $84, $94 := $85, $95 := $86, $96 := $32", "INNER HASH JOIN EACH WITH ALL ON $83 = $30" ] }, { "kind": "JOIN", "substeps": [ "$80 := $21, $81 := $22, $82 := $23, $83 := $24, $84 := $25, $85 := $26, $86 := $27", "INNER HASH JOIN EACH WITH ALL ON $20 = $40" ] }, { "kind": "WRITE", "substeps": [ "$121, $122, $120, $123, $70, $71", "TO __stage04_output", "BY HASH($120, $121, $122, $123)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0044444444444444444, "waitRatioMax": 0.0044444444444444444, "writeMsAvg": "5", "writeMsMax": "6", "writeRatioAvg": 0.011111111111111112, "writeRatioMax": 0.013333333333333334 }, { "completedParallelInputs": "1", "computeMsAvg": "40", "computeMsMax": "40", "computeRatioAvg": 0.08888888888888889, "computeRatioMax": 0.08888888888888889, "endMs": "1665778622249", "id": "6", "inputStages": [ "4" ], "name": "S06: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "35203", "recordsWritten": "7013", "shuffleOutputBytes": "441081", "shuffleOutputBytesSpilled": "0", "slotMs": "67", "startMs": "1665778622203", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$121, $122, $120, $123, $70, $71", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $130 := $120, $131 := $121, $132 := $122, $133 := $123", "$60 := SUM($70)", "$61 := SUM($71)" ] }, { "kind": "WRITE", "substeps": [ "$60, $61, $130, $131, $133", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0022222222222222222, "waitRatioMax": 0.0022222222222222222, "writeMsAvg": "22", "writeMsMax": "22", "writeRatioAvg": 0.04888888888888889, "writeRatioMax": 0.04888888888888889 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "16", "computeRatioAvg": 0.017777777777777778, "computeRatioMax": 0.035555555555555556, "endMs": "1665778622322", "id": "7", "inputStages": [ "6" ], "name": "S07: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "7013", "recordsWritten": "7013", "shuffleOutputBytes": "441081", "shuffleOutputBytesSpilled": "0", "slotMs": "4314", "startMs": "1665778622259", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage06_output" ] } ], "waitMsAvg": "4", "waitMsMax": "5", "waitRatioAvg": 0.008888888888888889, "waitRatioMax": 0.011111111111111112, "writeMsAvg": "15", "writeMsMax": "20", "writeRatioAvg": 0.03333333333333333, "writeRatioMax": 0.044444444444444446 }, { "completedParallelInputs": "1", "computeMsAvg": "30", "computeMsMax": "30", "computeRatioAvg": 0.06666666666666667, "computeRatioMax": 0.06666666666666667, "endMs": "1665778622344", "id": "8", "inputStages": [ "7" ], "name": "S08: Join+", "parallelInputs": "1", "readMsAvg": "10", "readMsMax": "10", "readRatioAvg": 0.022222222222222223, "readRatioMax": 0.022222222222222223, "recordsRead": "107013", "recordsWritten": "100", "shuffleOutputBytes": "5586", "shuffleOutputBytesSpilled": "0", "slotMs": "77", "startMs": "1665778622266", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:c_customer_sk, $2:c_first_name, $3:c_last_name", "FROM customer" ] }, { "kind": "READ", "substeps": [ "$60, $61, $130, $131, $133", "FROM __stage07_output" ] }, { "kind": "SORT", "substeps": [ "$145 ASC, $144 ASC, $50 ASC, $143 ASC", "LIMIT 100" ] }, { "kind": "COMPUTE", "substeps": [ "$50 := substr($141, 1, 30)" ] }, { "kind": "JOIN", "substeps": [ "$144 := $2, $145 := $3, $140 := $130, $141 := $133, $142 := $60, $143 := $61", "INNER HASH JOIN EACH WITH ALL ON $1 = $131" ] }, { "kind": "WRITE", "substeps": [ "$150, $151, $152, $153, $154, $155", "TO __stage08_output" ] } ], "waitMsAvg": "5", "waitMsMax": "5", "waitRatioAvg": 0.011111111111111112, "waitRatioMax": 0.011111111111111112, "writeMsAvg": "1", "writeMsMax": "1", "writeRatioAvg": 0.0022222222222222222, "writeRatioMax": 0.0022222222222222222 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.015555555555555555, "computeRatioMax": 0.015555555555555555, "endMs": "1665778622358", "id": "9", "inputStages": [ "8" ], "name": "S09: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "5586", "shuffleOutputBytesSpilled": "0", "slotMs": "57", "startMs": "1665778622277", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$150, $151, $152, $153, $154, $155", "FROM __stage08_output" ] }, { "kind": "SORT", "substeps": [ "$151 ASC, $150 ASC, $153 ASC, $155 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$160, $161, $162, $163, $164, $165", "TO __stage09_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.006666666666666667, "waitRatioMax": 0.006666666666666667, "writeMsAvg": "4", "writeMsMax": "4", "writeRatioAvg": 0.008888888888888889, "writeRatioMax": 0.008888888888888889 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "customer" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "household_demographics" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "102", "completedUnits": "10", "elapsedMs": "607", "estimatedRunnableUnits": "0", "pendingUnits": "102", "totalSlotMs": "2291" }, { "activeUnits": "102", "completedUnits": "112", "elapsedMs": "716", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "6633" } ], "totalBytesBilled": "225443840", "totalBytesProcessed": "225339941", "totalPartitionsProcessed": "0", "totalSlotMs": "6633", "transferredBytes": "0" }, "startTime": "1665778621684", "totalBytesProcessed": "225339941", "totalSlotMs": "6633" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anoncb564354_0781_4212_895b_47e9a52772fe" }, "priority": "INTERACTIVE", "query": "-- start query 79 in stream 0 using template query79.tpl\n\n/*\nCompute the per customer coupon amount and net profit of Monday shoppers. \nOnly purchases of three consecutive years made on Mondays in large stores by customers \nwith a certain dependent count and with a large vehicle count are considered.\n*/\n\nselect\n c_last_name,c_first_name,substr(s_city,1,30),ss_ticket_number,amt,profit\n from\n (select ss_ticket_number\n ,ss_customer_sk\n ,store.s_city\n ,sum(ss_coupon_amt) amt\n ,sum(ss_net_profit) profit\n from store_sales,date_dim,store,household_demographics\n where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n and store_sales.ss_store_sk = store.s_store_sk \n and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n and (household_demographics.hd_dep_count = 6 or household_demographics.hd_vehicle_count > 2)\n and date_dim.d_dow = 1\n and date_dim.d_year in (1999,1999+1,1999+2) \n and store.s_number_employees between 200 and 295\n group by ss_ticket_number,ss_customer_sk,ss_addr_sk,store.s_city) ms,customer\n where ss_customer_sk = c_customer_sk\n order by c_last_name,c_first_name,substr(s_city,1,30), profit\n limit 100\n;\n\n-- end query 79 in stream 0 using template query79.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "13sdBX1AzD1g9F/2OYGDPA==", "id": "test-project-364309:europe-west1.query79_1665778623", "jobReference": { "jobId": "query79_1665778623", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query79_1665778623?location=europe-west1", "statistics": { "creationTime": "1665778624077", "endTime": "1665778624974", "finalExecutionDurationMs": "674", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "225339941", "performanceInsights": { "avgPreviousExecutionMs": "718" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.02066115702479339, "computeRatioMax": 0.02066115702479339, "endMs": "1665778624283", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.010330578512396695, "readRatioMax": 0.010330578512396695, "recordsRead": "7200", "recordsWritten": "2880", "shuffleOutputBytes": "25920", "shuffleOutputBytesSpilled": "0", "slotMs": "26", "startMs": "1665778624250", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:hd_demo_sk, $11:hd_dep_count, $12:hd_vehicle_count", "FROM household_demographics", "WHERE or(equal($11, 6), greater($12, 2))" ] }, { "kind": "WRITE", "substeps": [ "$10", "TO __stage00_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.004132231404958678, "waitRatioMax": 0.004132231404958678, "writeMsAvg": "18", "writeMsMax": "18", "writeRatioAvg": 0.0371900826446281, "writeRatioMax": 0.0371900826446281 }, { "completedParallelInputs": "1", "computeMsAvg": "7", "computeMsMax": "7", "computeRatioAvg": 0.014462809917355372, "computeRatioMax": 0.014462809917355372, "endMs": "1665778624295", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.008264462809917356, "readRatioMax": 0.008264462809917356, "recordsRead": "12", "recordsWritten": "11", "shuffleOutputBytes": "226", "shuffleOutputBytesSpilled": "0", "slotMs": "31", "startMs": "1665778624264", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:s_store_sk, $32:s_city, $31:s_number_employees", "FROM store", "WHERE between($31, 200, 295)" ] }, { "kind": "WRITE", "substeps": [ "$30, $32", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.002066115702479339, "waitRatioMax": 0.002066115702479339, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.03925619834710744, "writeRatioMax": 0.03925619834710744 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.028925619834710745, "computeRatioMax": 0.028925619834710745, "endMs": "1665778624319", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.01652892561983471, "readRatioMax": 0.01652892561983471, "recordsRead": "73049", "recordsWritten": "157", "shuffleOutputBytes": "1413", "shuffleOutputBytesSpilled": "0", "slotMs": "33", "startMs": "1665778624286", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_date_sk, $41:d_year, $42:d_dow", "FROM date_dim", "WHERE and(equal($42, 1), in($41, 1999, 2000, 2001))" ] }, { "kind": "WRITE", "substeps": [ "$40", "TO __stage02_output" ] } ], "waitMsAvg": "5", "waitMsMax": "5", "waitRatioAvg": 0.010330578512396695, "waitRatioMax": 0.010330578512396695, "writeMsAvg": "5", "writeMsMax": "5", "writeRatioAvg": 0.010330578512396695, "writeRatioMax": 0.010330578512396695 }, { "completedParallelInputs": "6", "computeMsAvg": "411", "computeMsMax": "484", "computeRatioAvg": 0.8491735537190083, "computeRatioMax": 1, "endMs": "1665778624665", "id": "4", "inputStages": [ "2", "0", "1" ], "name": "S04: Join+", "parallelInputs": "6", "readMsAvg": "29", "readMsMax": "39", "readRatioAvg": 0.05991735537190083, "readRatioMax": 0.08057851239669421, "recordsRead": "2898692", "recordsWritten": "35203", "shuffleOutputBytes": "2530306", "shuffleOutputBytesSpilled": "0", "slotMs": "2374", "startMs": "1665778624335", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ss_sold_date_sk, $21:ss_customer_sk, $22:ss_hdemo_sk, $23:ss_addr_sk, $24:ss_store_sk, $25:ss_ticket_number, $26:ss_coupon_amt, $27:ss_net_profit", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$40", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$30, $32", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$10", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $120 := $112, $121 := $110, $122 := $111, $123 := $115", "$70 := SUM($113)", "$71 := SUM($114)" ] }, { "kind": "JOIN", "substeps": [ "$110 := $90, $111 := $92, $112 := $93, $113 := $94, $114 := $95, $115 := $96", "INNER HASH JOIN EACH WITH ALL ON $91 = $10" ] }, { "kind": "JOIN", "substeps": [ "$90 := $80, $91 := $81, $92 := $82, $93 := $84, $94 := $85, $95 := $86, $96 := $32", "INNER HASH JOIN EACH WITH ALL ON $83 = $30" ] }, { "kind": "JOIN", "substeps": [ "$80 := $21, $81 := $22, $82 := $23, $83 := $24, $84 := $25, $85 := $26, $86 := $27", "INNER HASH JOIN EACH WITH ALL ON $20 = $40" ] }, { "kind": "WRITE", "substeps": [ "$121, $122, $120, $123, $70, $71", "TO __stage04_output", "BY HASH($120, $121, $122, $123)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.002066115702479339, "waitRatioMax": 0.002066115702479339, "writeMsAvg": "6", "writeMsMax": "7", "writeRatioAvg": 0.012396694214876033, "writeRatioMax": 0.014462809917355372 }, { "completedParallelInputs": "1", "computeMsAvg": "37", "computeMsMax": "37", "computeRatioAvg": 0.07644628099173553, "computeRatioMax": 0.07644628099173553, "endMs": "1665778624768", "id": "6", "inputStages": [ "4" ], "name": "S06: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "35203", "recordsWritten": "7013", "shuffleOutputBytes": "441081", "shuffleOutputBytesSpilled": "0", "slotMs": "62", "startMs": "1665778624723", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$121, $122, $120, $123, $70, $71", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $130 := $120, $131 := $121, $132 := $122, $133 := $123", "$60 := SUM($70)", "$61 := SUM($71)" ] }, { "kind": "WRITE", "substeps": [ "$60, $61, $130, $131, $133", "TO __stage06_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.004132231404958678, "waitRatioMax": 0.004132231404958678, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.03925619834710744, "writeRatioMax": 0.03925619834710744 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "17", "computeRatioAvg": 0.01652892561983471, "computeRatioMax": 0.03512396694214876, "endMs": "1665778624836", "id": "7", "inputStages": [ "6" ], "name": "S07: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "7013", "recordsWritten": "7013", "shuffleOutputBytes": "441081", "shuffleOutputBytesSpilled": "0", "slotMs": "4410", "startMs": "1665778624775", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage06_output" ] } ], "waitMsAvg": "5", "waitMsMax": "9", "waitRatioAvg": 0.010330578512396695, "waitRatioMax": 0.01859504132231405, "writeMsAvg": "19", "writeMsMax": "30", "writeRatioAvg": 0.03925619834710744, "writeRatioMax": 0.06198347107438017 }, { "completedParallelInputs": "1", "computeMsAvg": "28", "computeMsMax": "28", "computeRatioAvg": 0.05785123966942149, "computeRatioMax": 0.05785123966942149, "endMs": "1665778624865", "id": "8", "inputStages": [ "7" ], "name": "S08: Join+", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.01859504132231405, "readRatioMax": 0.01859504132231405, "recordsRead": "107013", "recordsWritten": "100", "shuffleOutputBytes": "5586", "shuffleOutputBytesSpilled": "0", "slotMs": "78", "startMs": "1665778624785", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:c_customer_sk, $2:c_first_name, $3:c_last_name", "FROM customer" ] }, { "kind": "READ", "substeps": [ "$60, $61, $130, $131, $133", "FROM __stage07_output" ] }, { "kind": "SORT", "substeps": [ "$145 ASC, $144 ASC, $50 ASC, $143 ASC", "LIMIT 100" ] }, { "kind": "COMPUTE", "substeps": [ "$50 := substr($141, 1, 30)" ] }, { "kind": "JOIN", "substeps": [ "$144 := $2, $145 := $3, $140 := $130, $141 := $133, $142 := $60, $143 := $61", "INNER HASH JOIN EACH WITH ALL ON $1 = $131" ] }, { "kind": "WRITE", "substeps": [ "$150, $151, $152, $153, $154, $155", "TO __stage08_output" ] } ], "waitMsAvg": "9", "waitMsMax": "9", "waitRatioAvg": 0.01859504132231405, "waitRatioMax": 0.01859504132231405, "writeMsAvg": "1", "writeMsMax": "1", "writeRatioAvg": 0.002066115702479339, "writeRatioMax": 0.002066115702479339 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.02066115702479339, "computeRatioMax": 0.02066115702479339, "endMs": "1665778624875", "id": "9", "inputStages": [ "8" ], "name": "S09: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "5586", "shuffleOutputBytesSpilled": "0", "slotMs": "72", "startMs": "1665778624792", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$150, $151, $152, $153, $154, $155", "FROM __stage08_output" ] }, { "kind": "SORT", "substeps": [ "$151 ASC, $150 ASC, $153 ASC, $155 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$160, $161, $162, $163, $164, $165", "TO __stage09_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.002066115702479339, "waitRatioMax": 0.002066115702479339, "writeMsAvg": "7", "writeMsMax": "7", "writeRatioAvg": 0.014462809917355372, "writeRatioMax": 0.014462809917355372 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "customer" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "household_demographics" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "2", "completedUnits": "9", "elapsedMs": "608", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "2466" }, { "activeUnits": "2", "completedUnits": "112", "elapsedMs": "773", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "7091" } ], "totalBytesBilled": "225443840", "totalBytesProcessed": "225339941", "totalPartitionsProcessed": "0", "totalSlotMs": "7091", "transferredBytes": "0" }, "startTime": "1665778624142", "totalBytesProcessed": "225339941", "totalSlotMs": "7091" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon815f9e47_4814_49c6_8505_93e12fd69444" }, "priority": "INTERACTIVE", "query": "-- start query 79 in stream 0 using template query79.tpl\n\n/*\nCompute the per customer coupon amount and net profit of Monday shoppers. \nOnly purchases of three consecutive years made on Mondays in large stores by customers \nwith a certain dependent count and with a large vehicle count are considered.\n*/\n\nselect\n c_last_name,c_first_name,substr(s_city,1,30),ss_ticket_number,amt,profit\n from\n (select ss_ticket_number\n ,ss_customer_sk\n ,store.s_city\n ,sum(ss_coupon_amt) amt\n ,sum(ss_net_profit) profit\n from store_sales,date_dim,store,household_demographics\n where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n and store_sales.ss_store_sk = store.s_store_sk \n and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n and (household_demographics.hd_dep_count = 6 or household_demographics.hd_vehicle_count > 2)\n and date_dim.d_dow = 1\n and date_dim.d_year in (1999,1999+1,1999+2) \n and store.s_number_employees between 200 and 295\n group by ss_ticket_number,ss_customer_sk,ss_addr_sk,store.s_city) ms,customer\n where ss_customer_sk = c_customer_sk\n order by c_last_name,c_first_name,substr(s_city,1,30), profit\n limit 100\n;\n\n-- end query 79 in stream 0 using template query79.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "jlABPzTE18V9dVWCv0lApg==", "id": "test-project-364309:europe-west1.query79_1665778626", "jobReference": { "jobId": "query79_1665778626", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query79_1665778626?location=europe-west1", "statistics": { "creationTime": "1665778626757", "endTime": "1665778627635", "finalExecutionDurationMs": "677", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "225339941", "performanceInsights": { "avgPreviousExecutionMs": "712" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.022443890274314215, "computeRatioMax": 0.022443890274314215, "endMs": "1665778626953", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.012468827930174564, "readRatioMax": 0.012468827930174564, "recordsRead": "7200", "recordsWritten": "2880", "shuffleOutputBytes": "25920", "shuffleOutputBytesSpilled": "0", "slotMs": "30", "startMs": "1665778626911", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:hd_demo_sk, $11:hd_dep_count, $12:hd_vehicle_count", "FROM household_demographics", "WHERE or(equal($11, 6), greater($12, 2))" ] }, { "kind": "WRITE", "substeps": [ "$10", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0024937655860349127, "waitRatioMax": 0.0024937655860349127, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.0399002493765586, "writeRatioMax": 0.0399002493765586 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.0199501246882793, "computeRatioMax": 0.0199501246882793, "endMs": "1665778626969", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.012468827930174564, "readRatioMax": 0.012468827930174564, "recordsRead": "12", "recordsWritten": "11", "shuffleOutputBytes": "226", "shuffleOutputBytesSpilled": "0", "slotMs": "27", "startMs": "1665778626929", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:s_store_sk, $32:s_city, $31:s_number_employees", "FROM store", "WHERE between($31, 200, 295)" ] }, { "kind": "WRITE", "substeps": [ "$30, $32", "TO __stage01_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.004987531172069825, "waitRatioMax": 0.004987531172069825, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.03740648379052369, "writeRatioMax": 0.03740648379052369 }, { "completedParallelInputs": "1", "computeMsAvg": "20", "computeMsMax": "20", "computeRatioAvg": 0.04987531172069826, "computeRatioMax": 0.04987531172069826, "endMs": "1665778626995", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "14", "readMsMax": "14", "readRatioAvg": 0.034912718204488775, "readRatioMax": 0.034912718204488775, "recordsRead": "73049", "recordsWritten": "157", "shuffleOutputBytes": "1413", "shuffleOutputBytesSpilled": "0", "slotMs": "49", "startMs": "1665778626945", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_date_sk, $41:d_year, $42:d_dow", "FROM date_dim", "WHERE and(equal($42, 1), in($41, 1999, 2000, 2001))" ] }, { "kind": "WRITE", "substeps": [ "$40", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0024937655860349127, "waitRatioMax": 0.0024937655860349127, "writeMsAvg": "11", "writeMsMax": "11", "writeRatioAvg": 0.02743142144638404, "writeRatioMax": 0.02743142144638404 }, { "completedParallelInputs": "6", "computeMsAvg": "354", "computeMsMax": "401", "computeRatioAvg": 0.8827930174563591, "computeRatioMax": 1, "endMs": "1665778627328", "id": "4", "inputStages": [ "1", "0", "2" ], "name": "S04: Join+", "parallelInputs": "6", "readMsAvg": "25", "readMsMax": "42", "readRatioAvg": 0.06234413965087282, "readRatioMax": 0.10473815461346633, "recordsRead": "2898692", "recordsWritten": "35203", "shuffleOutputBytes": "2530306", "shuffleOutputBytesSpilled": "0", "slotMs": "2022", "startMs": "1665778627001", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ss_sold_date_sk, $21:ss_customer_sk, $22:ss_hdemo_sk, $23:ss_addr_sk, $24:ss_store_sk, $25:ss_ticket_number, $26:ss_coupon_amt, $27:ss_net_profit", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$40", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$30, $32", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$10", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $120 := $112, $121 := $110, $122 := $111, $123 := $115", "$70 := SUM($113)", "$71 := SUM($114)" ] }, { "kind": "JOIN", "substeps": [ "$110 := $90, $111 := $92, $112 := $93, $113 := $94, $114 := $95, $115 := $96", "INNER HASH JOIN EACH WITH ALL ON $91 = $10" ] }, { "kind": "JOIN", "substeps": [ "$90 := $80, $91 := $81, $92 := $82, $93 := $84, $94 := $85, $95 := $86, $96 := $32", "INNER HASH JOIN EACH WITH ALL ON $83 = $30" ] }, { "kind": "JOIN", "substeps": [ "$80 := $21, $81 := $22, $82 := $23, $83 := $24, $84 := $25, $85 := $26, $86 := $27", "INNER HASH JOIN EACH WITH ALL ON $20 = $40" ] }, { "kind": "WRITE", "substeps": [ "$121, $122, $120, $123, $70, $71", "TO __stage04_output", "BY HASH($120, $121, $122, $123)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0024937655860349127, "waitRatioMax": 0.0024937655860349127, "writeMsAvg": "5", "writeMsMax": "7", "writeRatioAvg": 0.012468827930174564, "writeRatioMax": 0.017456359102244388 }, { "completedParallelInputs": "1", "computeMsAvg": "47", "computeMsMax": "47", "computeRatioAvg": 0.1172069825436409, "computeRatioMax": 0.1172069825436409, "endMs": "1665778627434", "id": "6", "inputStages": [ "4" ], "name": "S06: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "35203", "recordsWritten": "7013", "shuffleOutputBytes": "441081", "shuffleOutputBytesSpilled": "0", "slotMs": "66", "startMs": "1665778627373", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$121, $122, $120, $123, $70, $71", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $130 := $120, $131 := $121, $132 := $122, $133 := $123", "$60 := SUM($70)", "$61 := SUM($71)" ] }, { "kind": "WRITE", "substeps": [ "$60, $61, $130, $131, $133", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0024937655860349127, "waitRatioMax": 0.0024937655860349127, "writeMsAvg": "20", "writeMsMax": "20", "writeRatioAvg": 0.04987531172069826, "writeRatioMax": 0.04987531172069826 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "16", "computeRatioAvg": 0.0199501246882793, "computeRatioMax": 0.0399002493765586, "endMs": "1665778627516", "id": "7", "inputStages": [ "6" ], "name": "S07: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "7013", "recordsWritten": "7013", "shuffleOutputBytes": "441081", "shuffleOutputBytesSpilled": "0", "slotMs": "4240", "startMs": "1665778627447", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage06_output" ] } ], "waitMsAvg": "2", "waitMsMax": "4", "waitRatioAvg": 0.004987531172069825, "waitRatioMax": 0.00997506234413965, "writeMsAvg": "23", "writeMsMax": "33", "writeRatioAvg": 0.057356608478802994, "writeRatioMax": 0.08229426433915212 }, { "completedParallelInputs": "1", "computeMsAvg": "43", "computeMsMax": "43", "computeRatioAvg": 0.10723192019950124, "computeRatioMax": 0.10723192019950124, "endMs": "1665778627534", "id": "8", "inputStages": [ "7" ], "name": "S08: Join+", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.022443890274314215, "readRatioMax": 0.022443890274314215, "recordsRead": "107013", "recordsWritten": "100", "shuffleOutputBytes": "5586", "shuffleOutputBytesSpilled": "0", "slotMs": "87", "startMs": "1665778627453", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:c_customer_sk, $2:c_first_name, $3:c_last_name", "FROM customer" ] }, { "kind": "READ", "substeps": [ "$60, $61, $130, $131, $133", "FROM __stage07_output" ] }, { "kind": "SORT", "substeps": [ "$145 ASC, $144 ASC, $50 ASC, $143 ASC", "LIMIT 100" ] }, { "kind": "COMPUTE", "substeps": [ "$50 := substr($141, 1, 30)" ] }, { "kind": "JOIN", "substeps": [ "$144 := $2, $145 := $3, $140 := $130, $141 := $133, $142 := $60, $143 := $61", "INNER HASH JOIN EACH WITH ALL ON $1 = $131" ] }, { "kind": "WRITE", "substeps": [ "$150, $151, $152, $153, $154, $155", "TO __stage08_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.007481296758104738, "waitRatioMax": 0.007481296758104738, "writeMsAvg": "1", "writeMsMax": "1", "writeRatioAvg": 0.0024937655860349127, "writeRatioMax": 0.0024937655860349127 }, { "completedParallelInputs": "1", "computeMsAvg": "5", "computeMsMax": "5", "computeRatioAvg": 0.012468827930174564, "computeRatioMax": 0.012468827930174564, "endMs": "1665778627539", "id": "9", "inputStages": [ "8" ], "name": "S09: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "5586", "shuffleOutputBytesSpilled": "0", "slotMs": "37", "startMs": "1665778627463", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$150, $151, $152, $153, $154, $155", "FROM __stage08_output" ] }, { "kind": "SORT", "substeps": [ "$151 ASC, $150 ASC, $153 ASC, $155 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$160, $161, $162, $163, $164, $165", "TO __stage09_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0024937655860349127, "waitRatioMax": 0.0024937655860349127, "writeMsAvg": "4", "writeMsMax": "4", "writeRatioAvg": 0.00997506234413965, "writeRatioMax": 0.00997506234413965 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "customer" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "household_demographics" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "2", "completedUnits": "9", "elapsedMs": "603", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "2153" }, { "activeUnits": "2", "completedUnits": "112", "elapsedMs": "770", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "6679" } ], "totalBytesBilled": "225443840", "totalBytesProcessed": "225339941", "totalPartitionsProcessed": "0", "totalSlotMs": "6679", "transferredBytes": "0" }, "startTime": "1665778626808", "totalBytesProcessed": "225339941", "totalSlotMs": "6679" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon7544ef2c_1a8f_467b_9241_482e725a9a31" }, "priority": "INTERACTIVE", "query": "-- start query 79 in stream 0 using template query79.tpl\n\n/*\nCompute the per customer coupon amount and net profit of Monday shoppers. \nOnly purchases of three consecutive years made on Mondays in large stores by customers \nwith a certain dependent count and with a large vehicle count are considered.\n*/\n\nselect\n c_last_name,c_first_name,substr(s_city,1,30),ss_ticket_number,amt,profit\n from\n (select ss_ticket_number\n ,ss_customer_sk\n ,store.s_city\n ,sum(ss_coupon_amt) amt\n ,sum(ss_net_profit) profit\n from store_sales,date_dim,store,household_demographics\n where store_sales.ss_sold_date_sk = date_dim.d_date_sk\n and store_sales.ss_store_sk = store.s_store_sk \n and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk\n and (household_demographics.hd_dep_count = 6 or household_demographics.hd_vehicle_count > 2)\n and date_dim.d_dow = 1\n and date_dim.d_year in (1999,1999+1,1999+2) \n and store.s_number_employees between 200 and 295\n group by ss_ticket_number,ss_customer_sk,ss_addr_sk,store.s_city) ms,customer\n where ss_customer_sk = c_customer_sk\n order by c_last_name,c_first_name,substr(s_city,1,30), profit\n limit 100\n;\n\n-- end query 79 in stream 0 using template query79.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "E5vUWl7qKZ/6ii6cXf8DKA==", "id": "test-project-364309:europe-west1.query79_1665778628", "jobReference": { "jobId": "query79_1665778628", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query79_1665778628?location=europe-west1", "statistics": { "creationTime": "1665778629240", "endTime": "1665778629998", "finalExecutionDurationMs": "566", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "225339941", "performanceInsights": { "avgPreviousExecutionMs": "707" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "15", "computeMsMax": "15", "computeRatioAvg": 0.031512605042016806, "computeRatioMax": 0.031512605042016806, "endMs": "1665778629422", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.014705882352941176, "readRatioMax": 0.014705882352941176, "recordsRead": "7200", "recordsWritten": "2880", "shuffleOutputBytes": "25920", "shuffleOutputBytesSpilled": "0", "slotMs": "46", "startMs": "1665778629383", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:hd_demo_sk, $11:hd_dep_count, $12:hd_vehicle_count", "FROM household_demographics", "WHERE or(equal($11, 6), greater($12, 2))" ] }, { "kind": "WRITE", "substeps": [ "$10", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0021008403361344537, "waitRatioMax": 0.0021008403361344537, "writeMsAvg": "9", "writeMsMax": "9", "writeRatioAvg": 0.018907563025210083, "writeRatioMax": 0.018907563025210083 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.02100840336134454, "computeRatioMax": 0.02100840336134454, "endMs": "1665778629440", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "4", "readMsMax": "4", "readRatioAvg": 0.008403361344537815, "readRatioMax": 0.008403361344537815, "recordsRead": "12", "recordsWritten": "11", "shuffleOutputBytes": "226", "shuffleOutputBytesSpilled": "0", "slotMs": "52", "startMs": "1665778629398", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:s_store_sk, $32:s_city, $31:s_number_employees", "FROM store", "WHERE between($31, 200, 295)" ] }, { "kind": "WRITE", "substeps": [ "$30, $32", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0021008403361344537, "waitRatioMax": 0.0021008403361344537, "writeMsAvg": "17", "writeMsMax": "17", "writeRatioAvg": 0.03571428571428571, "writeRatioMax": 0.03571428571428571 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.02100840336134454, "computeRatioMax": 0.02100840336134454, "endMs": "1665778629442", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.01680672268907563, "readRatioMax": 0.01680672268907563, "recordsRead": "73049", "recordsWritten": "157", "shuffleOutputBytes": "1413", "shuffleOutputBytesSpilled": "0", "slotMs": "34", "startMs": "1665778629411", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:d_date_sk, $41:d_year, $42:d_dow", "FROM date_dim", "WHERE and(equal($42, 1), in($41, 1999, 2000, 2001))" ] }, { "kind": "WRITE", "substeps": [ "$40", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0021008403361344537, "waitRatioMax": 0.0021008403361344537, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.031512605042016806, "writeRatioMax": 0.031512605042016806 }, { "completedParallelInputs": "6", "computeMsAvg": "398", "computeMsMax": "476", "computeRatioAvg": 0.8361344537815126, "computeRatioMax": 1, "endMs": "1665778629739", "id": "4", "inputStages": [ "2", "0", "1" ], "name": "S04: Join+", "parallelInputs": "6", "readMsAvg": "22", "readMsMax": "27", "readRatioAvg": 0.046218487394957986, "readRatioMax": 0.05672268907563025, "recordsRead": "2898692", "recordsWritten": "35203", "shuffleOutputBytes": "2530306", "shuffleOutputBytesSpilled": "0", "slotMs": "2061", "startMs": "1665778629450", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:ss_sold_date_sk, $21:ss_customer_sk, $22:ss_hdemo_sk, $23:ss_addr_sk, $24:ss_store_sk, $25:ss_ticket_number, $26:ss_coupon_amt, $27:ss_net_profit", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$40", "FROM __stage02_output" ] }, { "kind": "READ", "substeps": [ "$30, $32", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$10", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $120 := $112, $121 := $110, $122 := $111, $123 := $115", "$70 := SUM($113)", "$71 := SUM($114)" ] }, { "kind": "JOIN", "substeps": [ "$110 := $90, $111 := $92, $112 := $93, $113 := $94, $114 := $95, $115 := $96", "INNER HASH JOIN EACH WITH ALL ON $91 = $10" ] }, { "kind": "JOIN", "substeps": [ "$90 := $80, $91 := $81, $92 := $82, $93 := $84, $94 := $85, $95 := $86, $96 := $32", "INNER HASH JOIN EACH WITH ALL ON $83 = $30" ] }, { "kind": "JOIN", "substeps": [ "$80 := $21, $81 := $22, $82 := $23, $83 := $24, $84 := $25, $85 := $26, $86 := $27", "INNER HASH JOIN EACH WITH ALL ON $20 = $40" ] }, { "kind": "WRITE", "substeps": [ "$121, $122, $120, $123, $70, $71", "TO __stage04_output", "BY HASH($120, $121, $122, $123)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0021008403361344537, "waitRatioMax": 0.0021008403361344537, "writeMsAvg": "5", "writeMsMax": "6", "writeRatioAvg": 0.01050420168067227, "writeRatioMax": 0.012605042016806723 }, { "completedParallelInputs": "1", "computeMsAvg": "45", "computeMsMax": "45", "computeRatioAvg": 0.09453781512605042, "computeRatioMax": 0.09453781512605042, "endMs": "1665778629825", "id": "6", "inputStages": [ "4" ], "name": "S06: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "35203", "recordsWritten": "7013", "shuffleOutputBytes": "441081", "shuffleOutputBytesSpilled": "0", "slotMs": "58", "startMs": "1665778629778", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$121, $122, $120, $123, $70, $71", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $130 := $120, $131 := $121, $132 := $122, $133 := $123", "$60 := SUM($70)", "$61 := SUM($71)" ] }, { "kind": "WRITE", "substeps": [ "$60, $61, $130, $131, $133", "TO __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0021008403361344537, "waitRatioMax": 0.0021008403361344537, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.03991596638655462, "writeRatioMax": 0.03991596638655462 }, { "completedParallelInputs": "100", "computeMsAvg": "8", "computeMsMax": "14", "computeRatioAvg": 0.01680672268907563, "computeRatioMax": 0.029411764705882353, "endMs": "1665778629876", "id": "7", "inputStages": [ "6" ], "name": "S07: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "7013", "recordsWritten": "7013", "shuffleOutputBytes": "441081", "shuffleOutputBytesSpilled": "0", "slotMs": "3565", "startMs": "1665778629829", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage06_output" ] } ], "waitMsAvg": "1", "waitMsMax": "2", "waitRatioAvg": 0.0021008403361344537, "waitRatioMax": 0.004201680672268907, "writeMsAvg": "15", "writeMsMax": "19", "writeRatioAvg": 0.031512605042016806, "writeRatioMax": 0.03991596638655462 }, { "completedParallelInputs": "1", "computeMsAvg": "41", "computeMsMax": "41", "computeRatioAvg": 0.0861344537815126, "computeRatioMax": 0.0861344537815126, "endMs": "1665778629900", "id": "8", "inputStages": [ "7" ], "name": "S08: Join+", "parallelInputs": "1", "readMsAvg": "10", "readMsMax": "10", "readRatioAvg": 0.02100840336134454, "readRatioMax": 0.02100840336134454, "recordsRead": "107013", "recordsWritten": "100", "shuffleOutputBytes": "5586", "shuffleOutputBytesSpilled": "0", "slotMs": "80", "startMs": "1665778629834", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:c_customer_sk, $2:c_first_name, $3:c_last_name", "FROM customer" ] }, { "kind": "READ", "substeps": [ "$60, $61, $130, $131, $133", "FROM __stage07_output" ] }, { "kind": "SORT", "substeps": [ "$145 ASC, $144 ASC, $50 ASC, $143 ASC", "LIMIT 100" ] }, { "kind": "COMPUTE", "substeps": [ "$50 := substr($141, 1, 30)" ] }, { "kind": "JOIN", "substeps": [ "$144 := $2, $145 := $3, $140 := $130, $141 := $133, $142 := $60, $143 := $61", "INNER HASH JOIN EACH WITH ALL ON $1 = $131" ] }, { "kind": "WRITE", "substeps": [ "$150, $151, $152, $153, $154, $155", "TO __stage08_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.0063025210084033615, "waitRatioMax": 0.0063025210084033615, "writeMsAvg": "1", "writeMsMax": "1", "writeRatioAvg": 0.0021008403361344537, "writeRatioMax": 0.0021008403361344537 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.018907563025210083, "computeRatioMax": 0.018907563025210083, "endMs": "1665778629915", "id": "9", "inputStages": [ "8" ], "name": "S09: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "5586", "shuffleOutputBytesSpilled": "0", "slotMs": "48", "startMs": "1665778629842", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$150, $151, $152, $153, $154, $155", "FROM __stage08_output" ] }, { "kind": "SORT", "substeps": [ "$151 ASC, $150 ASC, $153 ASC, $155 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$160, $161, $162, $163, $164, $165", "TO __stage09_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0021008403361344537, "waitRatioMax": 0.0021008403361344537, "writeMsAvg": "5", "writeMsMax": "5", "writeRatioAvg": 0.01050420168067227, "writeRatioMax": 0.01050420168067227 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "household_demographics" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "customer" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "2", "completedUnits": "110", "elapsedMs": "593", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "5817" }, { "activeUnits": "2", "completedUnits": "112", "elapsedMs": "653", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "5946" } ], "totalBytesBilled": "225443840", "totalBytesProcessed": "225339941", "totalPartitionsProcessed": "0", "totalSlotMs": "5946", "transferredBytes": "0" }, "startTime": "1665778629291", "totalBytesProcessed": "225339941", "totalSlotMs": "5946" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
