{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon9b81d094_4652_48b5_926c_8bef10bd01a9" }, "priority": "INTERACTIVE", "query": "-- start query 78 in stream 0 using template query78.tpl\nwith ws as\n (select d_year AS ws_sold_year, ws_item_sk,\n ws_bill_customer_sk ws_customer_sk,\n sum(ws_quantity) ws_qty,\n sum(ws_wholesale_cost) ws_wc,\n sum(ws_sales_price) ws_sp\n from web_sales\n left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n join date_dim on ws_sold_date_sk = d_date_sk\n where wr_order_number is null\n group by d_year, ws_item_sk, ws_bill_customer_sk\n ),\ncs as\n (select d_year AS cs_sold_year, cs_item_sk,\n cs_bill_customer_sk cs_customer_sk,\n sum(cs_quantity) cs_qty,\n sum(cs_wholesale_cost) cs_wc,\n sum(cs_sales_price) cs_sp\n from catalog_sales\n left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n join date_dim on cs_sold_date_sk = d_date_sk\n where cr_order_number is null\n group by d_year, cs_item_sk, cs_bill_customer_sk\n ),\nss as\n (select d_year AS ss_sold_year, ss_item_sk,\n ss_customer_sk,\n sum(ss_quantity) ss_qty,\n sum(ss_wholesale_cost) ss_wc,\n sum(ss_sales_price) ss_sp\n from store_sales\n left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n join date_dim on ss_sold_date_sk = d_date_sk\n where sr_ticket_number is null\n group by d_year, ss_item_sk, ss_customer_sk\n )\n select\nss_sold_year, ss_item_sk, ss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2000\norder by \n ss_sold_year, \n ss_item_sk, \n ss_customer_sk,\n ss_qty desc, ss_wc desc, ss_sp desc,\n other_chan_qty,\n other_chan_wholesale_cost,\n other_chan_sales_price,\n ratio\nlimit 100\n;\n\n-- end query 78 in stream 0 using template query78.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "MZj99ECAVYuzxev6tVuTrQ==", "id": "test-project-364309:europe-west1.query78_1665768474", "jobReference": { "jobId": "query78_1665768474", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query78_1665768474?location=europe-west1", "statistics": { "creationTime": "1665768474639", "endTime": "1665768477352", "finalExecutionDurationMs": "2456", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "364518168", "performanceInsights": { "avgPreviousExecutionMs": "2943" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.00764525993883792, "computeRatioMax": 0.00764525993883792, "endMs": "1665768474888", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.0045871559633027525, "readRatioMax": 0.0045871559633027525, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "6588", "shuffleOutputBytesSpilled": "0", "slotMs": "34", "startMs": "1665768474846", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:d_date_sk, $21:d_year", "FROM date_dim", "WHERE equal($21, 2000)" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0007645259938837921, "waitRatioMax": 0.0007645259938837921, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.011467889908256881, "writeRatioMax": 0.011467889908256881 }, { "completedParallelInputs": "1", "computeMsAvg": "42", "computeMsMax": "42", "computeRatioAvg": 0.03211009174311927, "computeRatioMax": 0.03211009174311927, "endMs": "1665768474906", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.0061162079510703364, "readRatioMax": 0.0061162079510703364, "recordsRead": "71763", "recordsWritten": "71763", "shuffleOutputBytes": "1291734", "shuffleOutputBytesSpilled": "0", "slotMs": "51", "startMs": "1665768474860", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:wr_item_sk, $81:wr_order_number", "FROM web_returns" ] }, { "kind": "WRITE", "substeps": [ "$80, $81", "TO __stage01_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0015290519877675841, "waitRatioMax": 0.0015290519877675841, "writeMsAvg": "9", "writeMsMax": "9", "writeRatioAvg": 0.006880733944954129, "writeRatioMax": 0.006880733944954129 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.009938837920489297, "computeRatioMax": 0.009938837920489297, "endMs": "1665768474914", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.006880733944954129, "readRatioMax": 0.006880733944954129, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "6588", "shuffleOutputBytesSpilled": "0", "slotMs": "30", "startMs": "1665768474875", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_year", "FROM date_dim", "WHERE equal($11, 2000)" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0007645259938837921, "waitRatioMax": 0.0007645259938837921, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.0061162079510703364, "writeRatioMax": 0.0061162079510703364 }, { "completedParallelInputs": "1", "computeMsAvg": "208", "computeMsMax": "208", "computeRatioAvg": 0.15902140672782875, "computeRatioMax": 0.15902140672782875, "endMs": "1665768475074", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "11", "readMsMax": "11", "readRatioAvg": 0.008409785932721712, "readRatioMax": 0.008409785932721712, "recordsRead": "287514", "recordsWritten": "287514", "shuffleOutputBytes": "5175252", "shuffleOutputBytesSpilled": "0", "slotMs": "206", "startMs": "1665768474888", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:sr_item_sk, $61:sr_ticket_number", "FROM store_returns" ] }, { "kind": "WRITE", "substeps": [ "$60, $61", "TO __stage03_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0007645259938837921, "waitRatioMax": 0.0007645259938837921, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.010703363914373088, "writeRatioMax": 0.010703363914373088 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.00764525993883792, "computeRatioMax": 0.00764525993883792, "endMs": "1665768474943", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.0045871559633027525, "readRatioMax": 0.0045871559633027525, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "6588", "shuffleOutputBytesSpilled": "0", "slotMs": "37", "startMs": "1665768474903", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:d_date_sk, $2:d_year", "FROM date_dim", "WHERE equal($2, 2000)" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage04_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0007645259938837921, "waitRatioMax": 0.0007645259938837921, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.009938837920489297, "writeRatioMax": 0.009938837920489297 }, { "completedParallelInputs": "1", "computeMsAvg": "72", "computeMsMax": "72", "computeRatioAvg": 0.05504587155963303, "computeRatioMax": 0.05504587155963303, "endMs": "1665768474994", "id": "5", "name": "S05: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.005351681957186544, "readRatioMax": 0.005351681957186544, "recordsRead": "144067", "recordsWritten": "144067", "shuffleOutputBytes": "2593206", "shuffleOutputBytesSpilled": "0", "slotMs": "74", "startMs": "1665768474914", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:cr_item_sk, $41:cr_order_number", "FROM catalog_returns" ] }, { "kind": "WRITE", "substeps": [ "$40, $41", "TO __stage05_output" ] } ], "waitMsAvg": "0", "waitMsMax": "0", "waitRatioAvg": 0, "waitRatioMax": 0, "writeMsAvg": "11", "writeMsMax": "11", "writeRatioAvg": 0.008409785932721712, "writeRatioMax": 0.008409785932721712 }, { "completedParallelInputs": "1", "computeMsAvg": "1308", "computeMsMax": "1308", "computeRatioAvg": 1, "computeRatioMax": 1, "endMs": "1665768475586", "id": "6", "inputStages": [ "1", "0" ], "name": "S06: Join+", "parallelInputs": "1", "readMsAvg": "35", "readMsMax": "35", "readRatioAvg": 0.026758409785932722, "readRatioMax": 0.026758409785932722, "recordsRead": "791513", "recordsWritten": "128130", "shuffleOutputBytes": "8968372", "shuffleOutputBytesSpilled": "0", "slotMs": "776", "startMs": "1665768474918", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70:ws_sold_date_sk, $71:ws_item_sk, $72:ws_bill_customer_sk, $73:ws_order_number, $74:ws_quantity, $75:ws_wholesale_cost, $76:ws_sales_price", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$80, $81", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $240 := $235, $241 := $230, $242 := $231", "$150 := SUM($232)", "$151 := SUM($233)", "$152 := SUM($234)" ] }, { "kind": "JOIN", "substeps": [ "$230 := $211, $231 := $212, $232 := $213, $233 := $214, $234 := $215, $235 := $21", "INNER HASH JOIN EACH WITH ALL ON $210 = $20" ] }, { "kind": "FILTER", "substeps": [ "is_null($216)" ] }, { "kind": "JOIN", "substeps": [ "$210 := $70, $211 := $71, $212 := $72, $213 := $74, $214 := $75, $215 := $76, $216 := $81", "LEFT OUTER HASH JOIN EACH WITH ALL ON $73 = $81, $71 = $80" ] }, { "kind": "WRITE", "substeps": [ "$240, $241, $242, $150, $151, $152", "TO __stage06_output", "BY HASH($240, $241, $242)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0007645259938837921, "waitRatioMax": 0.0007645259938837921, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.0061162079510703364, "writeRatioMax": 0.0061162079510703364 }, { "completedParallelInputs": "5", "computeMsAvg": "639", "computeMsMax": "797", "computeRatioAvg": 0.48853211009174313, "computeRatioMax": 0.6093272171253823, "endMs": "1665768475489", "id": "7", "inputStages": [ "5", "4" ], "name": "S07: Join+", "parallelInputs": "5", "readMsAvg": "36", "readMsMax": "58", "readRatioAvg": 0.027522935779816515, "readRatioMax": 0.04434250764525994, "recordsRead": "2163713", "recordsWritten": "258782", "shuffleOutputBytes": "18084620", "shuffleOutputBytesSpilled": "0", "slotMs": "2929", "startMs": "1665768475019", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:cs_sold_date_sk, $31:cs_bill_customer_sk, $32:cs_item_sk, $33:cs_order_number, $34:cs_quantity, $35:cs_wholesale_cost, $36:cs_sales_price", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$40, $41", "FROM __stage05_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $300 := $295, $301 := $291, $302 := $290", "$130 := SUM($292)", "$131 := SUM($293)", "$132 := SUM($294)" ] }, { "kind": "JOIN", "substeps": [ "$290 := $271, $291 := $272, $292 := $273, $293 := $274, $294 := $275, $295 := $2", "INNER HASH JOIN EACH WITH ALL ON $270 = $1" ] }, { "kind": "FILTER", "substeps": [ "is_null($276)" ] }, { "kind": "JOIN", "substeps": [ "$270 := $30, $271 := $31, $272 := $32, $273 := $34, $274 := $35, $275 := $36, $276 := $41", "LEFT OUTER HASH JOIN EACH WITH ALL ON $33 = $41, $32 = $40" ] }, { "kind": "WRITE", "substeps": [ "$300, $302, $301, $130, $131, $132", "TO __stage07_output", "BY HASH($300, $301, $302)" ] } ], "waitMsAvg": "1", "waitMsMax": "2", "waitRatioAvg": 0.0007645259938837921, "waitRatioMax": 0.0015290519877675841, "writeMsAvg": "22", "writeMsMax": "24", "writeRatioAvg": 0.016819571865443424, "writeRatioMax": 0.01834862385321101 }, { "completedParallelInputs": "6", "computeMsAvg": "986", "computeMsMax": "1135", "computeRatioAvg": 0.753822629969419, "computeRatioMax": 0.867737003058104, "endMs": "1665768475773", "id": "8", "inputStages": [ "3", "2" ], "name": "S08: Join+", "parallelInputs": "6", "readMsAvg": "22", "readMsMax": "30", "readRatioAvg": 0.016819571865443424, "readRatioMax": 0.022935779816513763, "recordsRead": "4607684", "recordsWritten": "497119", "shuffleOutputBytes": "34277954", "shuffleOutputBytesSpilled": "0", "slotMs": "4554", "startMs": "1665768475137", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:ss_sold_date_sk, $51:ss_item_sk, $52:ss_customer_sk, $53:ss_ticket_number, $54:ss_quantity, $55:ss_wholesale_cost, $56:ss_sales_price", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$60, $61", "FROM __stage03_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage02_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $190 := $185, $191 := $180, $192 := $181", "$140 := SUM($182)", "$141 := SUM($183)", "$142 := SUM($184)" ] }, { "kind": "JOIN", "substeps": [ "$180 := $161, $181 := $162, $182 := $163, $183 := $164, $184 := $165, $185 := $11", "INNER HASH JOIN EACH WITH ALL ON $160 = $10" ] }, { "kind": "FILTER", "substeps": [ "is_null($166)" ] }, { "kind": "JOIN", "substeps": [ "$160 := $50, $161 := $51, $162 := $52, $163 := $54, $164 := $55, $165 := $56, $166 := $61", "LEFT OUTER HASH JOIN EACH WITH ALL ON $53 = $61, $51 = $60" ] }, { "kind": "WRITE", "substeps": [ "$190, $191, $192, $140, $141, $142", "TO __stage08_output", "BY HASH($190, $191, $192)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0007645259938837921, "waitRatioMax": 0.0007645259938837921, "writeMsAvg": "7", "writeMsMax": "7", "writeRatioAvg": 0.005351681957186544, "writeRatioMax": 0.005351681957186544 }, { "completedParallelInputs": "1", "computeMsAvg": "792", "computeMsMax": "792", "computeRatioAvg": 0.6055045871559633, "computeRatioMax": 0.6055045871559633, "endMs": "1665768476263", "id": "9", "inputStages": [ "7" ], "name": "S09: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "258782", "recordsWritten": "258136", "shuffleOutputBytes": "18056536", "shuffleOutputBytesSpilled": "0", "slotMs": "621", "startMs": "1665768475810", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$300, $302, $301, $130, $131, $132", "FROM __stage07_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $310 := $300, $311 := $301, $312 := $302", "$100 := SUM($130)", "$101 := SUM($131)", "$102 := SUM($132)" ] }, { "kind": "WRITE", "substeps": [ "$100, $101, $102, $310, $311, $312", "TO __stage09_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0007645259938837921, "waitRatioMax": 0.0007645259938837921, "writeMsAvg": "35", "writeMsMax": "35", "writeRatioAvg": 0.026758409785932722, "writeRatioMax": 0.026758409785932722 }, { "completedParallelInputs": "1", "computeMsAvg": "239", "computeMsMax": "239", "computeRatioAvg": 0.1827217125382263, "computeRatioMax": 0.1827217125382263, "endMs": "1665768475978", "id": "10", "inputStages": [ "6" ], "name": "S0A: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "128130", "recordsWritten": "128114", "shuffleOutputBytes": "8967716", "shuffleOutputBytesSpilled": "0", "slotMs": "202", "startMs": "1665768475825", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$240, $241, $242, $150, $151, $152", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $250 := $240, $251 := $241, $252 := $242", "$120 := SUM($150)", "$121 := SUM($151)", "$122 := SUM($152)" ] }, { "kind": "WRITE", "substeps": [ "$120, $121, $122, $250, $251, $252", "TO __stage0A_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0007645259938837921, "waitRatioMax": 0.0007645259938837921, "writeMsAvg": "26", "writeMsMax": "26", "writeRatioAvg": 0.019877675840978593, "writeRatioMax": 0.019877675840978593 }, { "completedParallelInputs": "100", "computeMsAvg": "11", "computeMsMax": "20", "computeRatioAvg": 0.008409785932721712, "computeRatioMax": 0.01529051987767584, "endMs": "1665768476087", "id": "11", "inputStages": [ "10" ], "name": "S0B: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "128114", "recordsWritten": "128114", "shuffleOutputBytes": "8967716", "shuffleOutputBytesSpilled": "0", "slotMs": "4401", "startMs": "1665768476019", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0A_output" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.0015290519877675841, "waitRatioMax": 0.0022935779816513763, "writeMsAvg": "15", "writeMsMax": "27", "writeRatioAvg": 0.011467889908256881, "writeRatioMax": 0.020642201834862386 }, { "completedParallelInputs": "100", "computeMsAvg": "12", "computeMsMax": "20", "computeRatioAvg": 0.009174311926605505, "computeRatioMax": 0.01529051987767584, "endMs": "1665768476435", "id": "12", "inputStages": [ "9" ], "name": "S0C: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "258136", "recordsWritten": "258136", "shuffleOutputBytes": "18056536", "shuffleOutputBytesSpilled": "0", "slotMs": "5467", "startMs": "1665768476353", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage09_output" ] } ], "waitMsAvg": "1", "waitMsMax": "3", "waitRatioAvg": 0.0007645259938837921, "waitRatioMax": 0.0022935779816513763, "writeMsAvg": "16", "writeMsMax": "21", "writeRatioAvg": 0.012232415902140673, "writeRatioMax": 0.016055045871559634 }, { "completedParallelInputs": "1", "computeMsAvg": "1060", "computeMsMax": "1060", "computeRatioAvg": 0.8103975535168195, "computeRatioMax": 0.8103975535168195, "endMs": "1665768477037", "id": "13", "inputStages": [ "11", "12", "8" ], "name": "S0D: Join+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "883369", "recordsWritten": "100", "shuffleOutputBytes": "12088", "shuffleOutputBytesSpilled": "0", "slotMs": "904", "startMs": "1665768476357", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$190, $191, $192, $140, $141, $142", "FROM __stage08_output" ] }, { "kind": "READ", "substeps": [ "$120, $121, $122, $250, $251, $252", "FROM __stage0B_output" ] }, { "kind": "READ", "substeps": [ "$100, $101, $102, $310, $311, $312", "FROM __stage0C_output" ] }, { "kind": "SORT", "substeps": [ "$320 ASC, $321 ASC, $322 ASC, $323 DESC, $324 DESC, $325 DESC, $91 ASC, $92 ASC, $93 ASC, $90 ASC", "LIMIT 100" ] }, { "kind": "COMPUTE", "substeps": [ "$90 := round(divide(CAST($323 AS DOUBLE), CAST(add(coalesce($326, 0), coalesce($329, 0)) AS DOUBLE)), 2)", "$91 := add(coalesce($326, 0), coalesce($329, 0))", "$92 := add(coalesce($327, NUMERIC<...>), coalesce($330, NUMERIC<...>))", "$93 := add(coalesce($328, NUMERIC<...>), coalesce($331, NUMERIC<...>))" ] }, { "kind": "FILTER", "substeps": [ "or(greater(coalesce($326, 0), 0), greater(coalesce($329, 0), 0))" ] }, { "kind": "JOIN", "substeps": [ "$320 := $260, $321 := $261, $322 := $262, $323 := $263, $324 := $264, $325 := $265, $326 := $266, $327 := $267, $328 := $268, $329 := $100, $330 := $101, $331 := $102", "LEFT OUTER HASH JOIN EACH WITH ALL ON $260 = $310, $261 = $311, $262 = $312" ] }, { "kind": "JOIN", "substeps": [ "$260 := $200, $261 := $201, $262 := $202, $263 := $110, $264 := $111, $265 := $112, $266 := $120, $267 := $121, $268 := $122", "LEFT OUTER HASH JOIN EACH WITH ALL ON $200 = $250, $201 = $251, $202 = $252" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $200 := $190, $201 := $191, $202 := $192", "$110 := SUM($140)", "$111 := SUM($141)", "$112 := SUM($142)" ] }, { "kind": "WRITE", "substeps": [ "$340, $341, $342, $343, $344, $345, $346, $347, $348, $349", "TO __stage0D_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.0022935779816513763, "waitRatioMax": 0.0022935779816513763, "writeMsAvg": "3", "writeMsMax": "3", "writeRatioAvg": 0.0022935779816513763, "writeRatioMax": 0.0022935779816513763 }, { "completedParallelInputs": "1", "computeMsAvg": "5", "computeMsMax": "5", "computeRatioAvg": 0.00382262996941896, "computeRatioMax": 0.00382262996941896, "endMs": "1665768477179", "id": "14", "inputStages": [ "13" ], "name": "S0E: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "12088", "shuffleOutputBytesSpilled": "0", "slotMs": "545", "startMs": "1665768476369", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$340, $341, $342, $343, $344, $345, $346, $347, $348, $349", "FROM __stage0D_output" ] }, { "kind": "SORT", "substeps": [ "$340 ASC, $341 ASC, $342 ASC, $347 DESC, $348 DESC, $349 DESC, $344 ASC, $345 ASC, $346 ASC, $343 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$350, $351, $352, $353, $354, $355, $356, $357, $358, $359", "TO __stage0E_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0007645259938837921, "waitRatioMax": 0.0007645259938837921, "writeMsAvg": "3", "writeMsMax": "3", "writeRatioAvg": 0.0022935779816513763, "writeRatioMax": 0.0022935779816513763 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "11", "completedUnits": "7", "elapsedMs": "657", "estimatedRunnableUnits": "0", "pendingUnits": "11", "totalSlotMs": "1277" }, { "activeUnits": "2", "completedUnits": "220", "elapsedMs": "1791", "estimatedRunnableUnits": "6", "pendingUnits": "2", "totalSlotMs": "19398" }, { "activeUnits": "2", "completedUnits": "222", "elapsedMs": "2609", "estimatedRunnableUnits": "6", "pendingUnits": "0", "totalSlotMs": "20716" } ], "totalBytesBilled": "364904448", "totalBytesProcessed": "364518168", "totalPartitionsProcessed": "0", "totalSlotMs": "20716", "transferredBytes": "0" }, "startTime": "1665768474690", "totalBytesProcessed": "364518168", "totalSlotMs": "20716" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anonbaa8141d_6ae8_43c8_8257_6a14209c8ea4" }, "priority": "INTERACTIVE", "query": "-- start query 78 in stream 0 using template query78.tpl\nwith ws as\n (select d_year AS ws_sold_year, ws_item_sk,\n ws_bill_customer_sk ws_customer_sk,\n sum(ws_quantity) ws_qty,\n sum(ws_wholesale_cost) ws_wc,\n sum(ws_sales_price) ws_sp\n from web_sales\n left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n join date_dim on ws_sold_date_sk = d_date_sk\n where wr_order_number is null\n group by d_year, ws_item_sk, ws_bill_customer_sk\n ),\ncs as\n (select d_year AS cs_sold_year, cs_item_sk,\n cs_bill_customer_sk cs_customer_sk,\n sum(cs_quantity) cs_qty,\n sum(cs_wholesale_cost) cs_wc,\n sum(cs_sales_price) cs_sp\n from catalog_sales\n left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n join date_dim on cs_sold_date_sk = d_date_sk\n where cr_order_number is null\n group by d_year, cs_item_sk, cs_bill_customer_sk\n ),\nss as\n (select d_year AS ss_sold_year, ss_item_sk,\n ss_customer_sk,\n sum(ss_quantity) ss_qty,\n sum(ss_wholesale_cost) ss_wc,\n sum(ss_sales_price) ss_sp\n from store_sales\n left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n join date_dim on ss_sold_date_sk = d_date_sk\n where sr_ticket_number is null\n group by d_year, ss_item_sk, ss_customer_sk\n )\n select\nss_sold_year, ss_item_sk, ss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2000\norder by \n ss_sold_year, \n ss_item_sk, \n ss_customer_sk,\n ss_qty desc, ss_wc desc, ss_sp desc,\n other_chan_qty,\n other_chan_wholesale_cost,\n other_chan_sales_price,\n ratio\nlimit 100\n;\n\n-- end query 78 in stream 0 using template query78.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "DrKWWld06EEVymFIjG3gSA==", "id": "test-project-364309:europe-west1.query78_1665778591", "jobReference": { "jobId": "query78_1665778591", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query78_1665778591?location=europe-west1", "statistics": { "creationTime": "1665778591789", "endTime": "1665778594400", "finalExecutionDurationMs": "2338", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "364518168", "performanceInsights": { "avgPreviousExecutionMs": "2862" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.004402861860209136, "computeRatioMax": 0.004402861860209136, "endMs": "1665778592051", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.0049532195927352776, "readRatioMax": 0.0049532195927352776, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "6588", "shuffleOutputBytesSpilled": "0", "slotMs": "39", "startMs": "1665778592014", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:d_date_sk, $21:d_year", "FROM date_dim", "WHERE equal($21, 2000)" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage00_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.001651073197578426, "waitRatioMax": 0.001651073197578426, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.010456796917996699, "writeRatioMax": 0.010456796917996699 }, { "completedParallelInputs": "1", "computeMsAvg": "59", "computeMsMax": "59", "computeRatioAvg": 0.032471106219042374, "computeRatioMax": 0.032471106219042374, "endMs": "1665778592083", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.00275178866263071, "readRatioMax": 0.00275178866263071, "recordsRead": "71763", "recordsWritten": "71763", "shuffleOutputBytes": "1291734", "shuffleOutputBytesSpilled": "0", "slotMs": "68", "startMs": "1665778592031", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:wr_item_sk, $81:wr_order_number", "FROM web_returns" ] }, { "kind": "WRITE", "substeps": [ "$80, $81", "TO __stage01_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.001100715465052284, "waitRatioMax": 0.001100715465052284, "writeMsAvg": "11", "writeMsMax": "11", "writeRatioAvg": 0.006053935057787562, "writeRatioMax": 0.006053935057787562 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.006053935057787562, "computeRatioMax": 0.006053935057787562, "endMs": "1665778592101", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.003302146395156852, "readRatioMax": 0.003302146395156852, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "6588", "shuffleOutputBytesSpilled": "0", "slotMs": "47", "startMs": "1665778592056", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_year", "FROM date_dim", "WHERE equal($11, 2000)" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage02_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.001100715465052284, "waitRatioMax": 0.001100715465052284, "writeMsAvg": "16", "writeMsMax": "16", "writeRatioAvg": 0.008805723720418272, "writeRatioMax": 0.008805723720418272 }, { "completedParallelInputs": "1", "computeMsAvg": "187", "computeMsMax": "187", "computeRatioAvg": 0.10291689598238855, "computeRatioMax": 0.10291689598238855, "endMs": "1665778592224", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "10", "readMsMax": "10", "readRatioAvg": 0.00550357732526142, "readRatioMax": 0.00550357732526142, "recordsRead": "287514", "recordsWritten": "287514", "shuffleOutputBytes": "5175252", "shuffleOutputBytesSpilled": "0", "slotMs": "154", "startMs": "1665778592075", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:sr_item_sk, $61:sr_ticket_number", "FROM store_returns" ] }, { "kind": "WRITE", "substeps": [ "$60, $61", "TO __stage03_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.001100715465052284, "waitRatioMax": 0.001100715465052284, "writeMsAvg": "12", "writeMsMax": "12", "writeRatioAvg": 0.006604292790313704, "writeRatioMax": 0.006604292790313704 }, { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.00550357732526142, "computeRatioMax": 0.00550357732526142, "endMs": "1665778592139", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.003852504127682994, "readRatioMax": 0.003852504127682994, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "6588", "shuffleOutputBytesSpilled": "0", "slotMs": "45", "startMs": "1665778592101", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:d_date_sk, $2:d_year", "FROM date_dim", "WHERE equal($2, 2000)" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage04_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.001651073197578426, "waitRatioMax": 0.001651073197578426, "writeMsAvg": "23", "writeMsMax": "23", "writeRatioAvg": 0.012658227848101266, "writeRatioMax": 0.012658227848101266 }, { "completedParallelInputs": "1", "computeMsAvg": "88", "computeMsMax": "88", "computeRatioAvg": 0.048431480462300495, "computeRatioMax": 0.048431480462300495, "endMs": "1665778592212", "id": "5", "name": "S05: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.003852504127682994, "readRatioMax": 0.003852504127682994, "recordsRead": "144067", "recordsWritten": "144067", "shuffleOutputBytes": "2593206", "shuffleOutputBytesSpilled": "0", "slotMs": "118", "startMs": "1665778592123", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:cr_item_sk, $41:cr_order_number", "FROM catalog_returns" ] }, { "kind": "WRITE", "substeps": [ "$40, $41", "TO __stage05_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.001100715465052284, "waitRatioMax": 0.001100715465052284, "writeMsAvg": "12", "writeMsMax": "12", "writeRatioAvg": 0.006604292790313704, "writeRatioMax": 0.006604292790313704 }, { "completedParallelInputs": "1", "computeMsAvg": "992", "computeMsMax": "992", "computeRatioAvg": 0.5459548706659328, "computeRatioMax": 0.5459548706659328, "endMs": "1665778592699", "id": "6", "inputStages": [ "1", "0" ], "name": "S06: Join+", "parallelInputs": "1", "readMsAvg": "23", "readMsMax": "23", "readRatioAvg": 0.012658227848101266, "readRatioMax": 0.012658227848101266, "recordsRead": "791513", "recordsWritten": "128130", "shuffleOutputBytes": "8968372", "shuffleOutputBytesSpilled": "0", "slotMs": "1030", "startMs": "1665778592130", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70:ws_sold_date_sk, $71:ws_item_sk, $72:ws_bill_customer_sk, $73:ws_order_number, $74:ws_quantity, $75:ws_wholesale_cost, $76:ws_sales_price", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$80, $81", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $240 := $235, $241 := $230, $242 := $231", "$150 := SUM($232)", "$151 := SUM($233)", "$152 := SUM($234)" ] }, { "kind": "JOIN", "substeps": [ "$230 := $211, $231 := $212, $232 := $213, $233 := $214, $234 := $215, $235 := $21", "INNER HASH JOIN EACH WITH ALL ON $210 = $20" ] }, { "kind": "FILTER", "substeps": [ "is_null($216)" ] }, { "kind": "JOIN", "substeps": [ "$210 := $70, $211 := $71, $212 := $72, $213 := $74, $214 := $75, $215 := $76, $216 := $81", "LEFT OUTER HASH JOIN EACH WITH ALL ON $73 = $81, $71 = $80" ] }, { "kind": "WRITE", "substeps": [ "$240, $241, $242, $150, $151, $152", "TO __stage06_output", "BY HASH($240, $241, $242)" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.001651073197578426, "waitRatioMax": 0.001651073197578426, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.004402861860209136, "writeRatioMax": 0.004402861860209136 }, { "completedParallelInputs": "5", "computeMsAvg": "496", "computeMsMax": "653", "computeRatioAvg": 0.2729774353329664, "computeRatioMax": 0.3593835993395707, "endMs": "1665778592612", "id": "7", "inputStages": [ "5", "4" ], "name": "S07: Join+", "parallelInputs": "5", "readMsAvg": "21", "readMsMax": "26", "readRatioAvg": 0.011557512383048982, "readRatioMax": 0.014309301045679693, "recordsRead": "2163713", "recordsWritten": "258782", "shuffleOutputBytes": "18084620", "shuffleOutputBytesSpilled": "0", "slotMs": "2244", "startMs": "1665778592247", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:cs_sold_date_sk, $31:cs_bill_customer_sk, $32:cs_item_sk, $33:cs_order_number, $34:cs_quantity, $35:cs_wholesale_cost, $36:cs_sales_price", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$40, $41", "FROM __stage05_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $300 := $295, $301 := $291, $302 := $290", "$130 := SUM($292)", "$131 := SUM($293)", "$132 := SUM($294)" ] }, { "kind": "JOIN", "substeps": [ "$290 := $271, $291 := $272, $292 := $273, $293 := $274, $294 := $275, $295 := $2", "INNER HASH JOIN EACH WITH ALL ON $270 = $1" ] }, { "kind": "FILTER", "substeps": [ "is_null($276)" ] }, { "kind": "JOIN", "substeps": [ "$270 := $30, $271 := $31, $272 := $32, $273 := $34, $274 := $35, $275 := $36, $276 := $41", "LEFT OUTER HASH JOIN EACH WITH ALL ON $33 = $41, $32 = $40" ] }, { "kind": "WRITE", "substeps": [ "$300, $302, $301, $130, $131, $132", "TO __stage07_output", "BY HASH($300, $301, $302)" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.001100715465052284, "waitRatioMax": 0.001651073197578426, "writeMsAvg": "21", "writeMsMax": "23", "writeRatioAvg": 0.011557512383048982, "writeRatioMax": 0.012658227848101266 }, { "completedParallelInputs": "6", "computeMsAvg": "944", "computeMsMax": "1124", "computeRatioAvg": 0.519537699504678, "computeRatioMax": 0.6186020913593836, "endMs": "1665778592868", "id": "8", "inputStages": [ "2", "3" ], "name": "S08: Join+", "parallelInputs": "6", "readMsAvg": "17", "readMsMax": "26", "readRatioAvg": 0.009356081452944413, "readRatioMax": 0.014309301045679693, "recordsRead": "4607684", "recordsWritten": "497119", "shuffleOutputBytes": "34277954", "shuffleOutputBytesSpilled": "0", "slotMs": "5347", "startMs": "1665778592254", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:ss_sold_date_sk, $51:ss_item_sk, $52:ss_customer_sk, $53:ss_ticket_number, $54:ss_quantity, $55:ss_wholesale_cost, $56:ss_sales_price", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$60, $61", "FROM __stage03_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage02_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $190 := $185, $191 := $180, $192 := $181", "$140 := SUM($182)", "$141 := SUM($183)", "$142 := SUM($184)" ] }, { "kind": "JOIN", "substeps": [ "$180 := $161, $181 := $162, $182 := $163, $183 := $164, $184 := $165, $185 := $11", "INNER HASH JOIN EACH WITH ALL ON $160 = $10" ] }, { "kind": "FILTER", "substeps": [ "is_null($166)" ] }, { "kind": "JOIN", "substeps": [ "$160 := $50, $161 := $51, $162 := $52, $163 := $54, $164 := $55, $165 := $56, $166 := $61", "LEFT OUTER HASH JOIN EACH WITH ALL ON $53 = $61, $51 = $60" ] }, { "kind": "WRITE", "substeps": [ "$190, $191, $192, $140, $141, $142", "TO __stage08_output", "BY HASH($190, $191, $192)" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.001100715465052284, "waitRatioMax": 0.001651073197578426, "writeMsAvg": "14", "writeMsMax": "45", "writeRatioAvg": 0.007705008255365988, "writeRatioMax": 0.02476609796367639 }, { "completedParallelInputs": "1", "computeMsAvg": "593", "computeMsMax": "593", "computeRatioAvg": 0.3263621353880022, "computeRatioMax": 0.3263621353880022, "endMs": "1665778593197", "id": "9", "inputStages": [ "7" ], "name": "S09: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "258782", "recordsWritten": "258136", "shuffleOutputBytes": "18056536", "shuffleOutputBytesSpilled": "0", "slotMs": "495", "startMs": "1665778592891", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$300, $302, $301, $130, $131, $132", "FROM __stage07_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $310 := $300, $311 := $301, $312 := $302", "$100 := SUM($130)", "$101 := SUM($131)", "$102 := SUM($132)" ] }, { "kind": "WRITE", "substeps": [ "$100, $101, $102, $310, $311, $312", "TO __stage09_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.001100715465052284, "waitRatioMax": 0.001100715465052284, "writeMsAvg": "24", "writeMsMax": "24", "writeRatioAvg": 0.013208585580627407, "writeRatioMax": 0.013208585580627407 }, { "completedParallelInputs": "1", "computeMsAvg": "461", "computeMsMax": "461", "computeRatioAvg": 0.2537149146945515, "computeRatioMax": 0.2537149146945515, "endMs": "1665778593168", "id": "10", "inputStages": [ "6" ], "name": "S0A: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "128130", "recordsWritten": "128114", "shuffleOutputBytes": "8967716", "shuffleOutputBytesSpilled": "0", "slotMs": "411", "startMs": "1665778592908", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$240, $241, $242, $150, $151, $152", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $250 := $240, $251 := $241, $252 := $242", "$120 := SUM($150)", "$121 := SUM($151)", "$122 := SUM($152)" ] }, { "kind": "WRITE", "substeps": [ "$120, $121, $122, $250, $251, $252", "TO __stage0A_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.001100715465052284, "waitRatioMax": 0.001100715465052284, "writeMsAvg": "26", "writeMsMax": "26", "writeRatioAvg": 0.014309301045679693, "writeRatioMax": 0.014309301045679693 }, { "completedParallelInputs": "100", "computeMsAvg": "11", "computeMsMax": "18", "computeRatioAvg": 0.006053935057787562, "computeRatioMax": 0.009906439185470555, "endMs": "1665778593244", "id": "11", "inputStages": [ "10" ], "name": "S0B: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "128114", "recordsWritten": "128114", "shuffleOutputBytes": "8967716", "shuffleOutputBytesSpilled": "0", "slotMs": "5230", "startMs": "1665778593172", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0A_output" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.001100715465052284, "waitRatioMax": 0.001651073197578426, "writeMsAvg": "15", "writeMsMax": "24", "writeRatioAvg": 0.00825536598789213, "writeRatioMax": 0.013208585580627407 }, { "completedParallelInputs": "100", "computeMsAvg": "13", "computeMsMax": "23", "computeRatioAvg": 0.007154650522839846, "computeRatioMax": 0.012658227848101266, "endMs": "1665778593296", "id": "12", "inputStages": [ "9" ], "name": "S0C: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "258136", "recordsWritten": "258136", "shuffleOutputBytes": "18056536", "shuffleOutputBytesSpilled": "0", "slotMs": "6084", "startMs": "1665778593208", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage09_output" ] } ], "waitMsAvg": "3", "waitMsMax": "5", "waitRatioAvg": 0.001651073197578426, "waitRatioMax": 0.00275178866263071, "writeMsAvg": "19", "writeMsMax": "32", "writeRatioAvg": 0.010456796917996699, "writeRatioMax": 0.017611447440836543 }, { "completedParallelInputs": "1", "computeMsAvg": "1817", "computeMsMax": "1817", "computeRatioAvg": 1, "computeRatioMax": 1, "endMs": "1665778594202", "id": "13", "inputStages": [ "12", "8", "11" ], "name": "S0D: Join+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "883369", "recordsWritten": "100", "shuffleOutputBytes": "12088", "shuffleOutputBytesSpilled": "0", "slotMs": "1644", "startMs": "1665778593212", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$190, $191, $192, $140, $141, $142", "FROM __stage08_output" ] }, { "kind": "READ", "substeps": [ "$120, $121, $122, $250, $251, $252", "FROM __stage0B_output" ] }, { "kind": "READ", "substeps": [ "$100, $101, $102, $310, $311, $312", "FROM __stage0C_output" ] }, { "kind": "SORT", "substeps": [ "$320 ASC, $321 ASC, $322 ASC, $323 DESC, $324 DESC, $325 DESC, $91 ASC, $92 ASC, $93 ASC, $90 ASC", "LIMIT 100" ] }, { "kind": "COMPUTE", "substeps": [ "$90 := round(divide(CAST($323 AS DOUBLE), CAST(add(coalesce($326, 0), coalesce($329, 0)) AS DOUBLE)), 2)", "$91 := add(coalesce($326, 0), coalesce($329, 0))", "$92 := add(coalesce($327, NUMERIC<...>), coalesce($330, NUMERIC<...>))", "$93 := add(coalesce($328, NUMERIC<...>), coalesce($331, NUMERIC<...>))" ] }, { "kind": "FILTER", "substeps": [ "or(greater(coalesce($326, 0), 0), greater(coalesce($329, 0), 0))" ] }, { "kind": "JOIN", "substeps": [ "$320 := $260, $321 := $261, $322 := $262, $323 := $263, $324 := $264, $325 := $265, $326 := $266, $327 := $267, $328 := $268, $329 := $100, $330 := $101, $331 := $102", "LEFT OUTER HASH JOIN EACH WITH ALL ON $260 = $310, $261 = $311, $262 = $312" ] }, { "kind": "JOIN", "substeps": [ "$260 := $200, $261 := $201, $262 := $202, $263 := $110, $264 := $111, $265 := $112, $266 := $120, $267 := $121, $268 := $122", "LEFT OUTER HASH JOIN EACH WITH ALL ON $200 = $250, $201 = $251, $202 = $252" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $200 := $190, $201 := $191, $202 := $192", "$110 := SUM($140)", "$111 := SUM($141)", "$112 := SUM($142)" ] }, { "kind": "WRITE", "substeps": [ "$340, $341, $342, $343, $344, $345, $346, $347, $348, $349", "TO __stage0D_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.001651073197578426, "waitRatioMax": 0.001651073197578426, "writeMsAvg": "4", "writeMsMax": "4", "writeRatioAvg": 0.002201430930104568, "writeRatioMax": 0.002201430930104568 }, { "completedParallelInputs": "1", "computeMsAvg": "5", "computeMsMax": "5", "computeRatioAvg": 0.00275178866263071, "computeRatioMax": 0.00275178866263071, "endMs": "1665778594289", "id": "14", "inputStages": [ "13" ], "name": "S0E: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "12088", "shuffleOutputBytesSpilled": "0", "slotMs": "818", "startMs": "1665778593228", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$340, $341, $342, $343, $344, $345, $346, $347, $348, $349", "FROM __stage0D_output" ] }, { "kind": "SORT", "substeps": [ "$340 ASC, $341 ASC, $342 ASC, $347 DESC, $348 DESC, $349 DESC, $344 ASC, $345 ASC, $346 ASC, $343 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$350, $351, $352, $353, $354, $355, $356, $357, $358, $359", "TO __stage0E_output" ] } ], "waitMsAvg": "4", "waitMsMax": "4", "waitRatioAvg": 0.002201430930104568, "waitRatioMax": 0.002201430930104568, "writeMsAvg": "3", "writeMsMax": "3", "writeRatioAvg": 0.001651073197578426, "writeRatioMax": 0.001651073197578426 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "11", "completedUnits": "7", "elapsedMs": "675", "estimatedRunnableUnits": "0", "pendingUnits": "11", "totalSlotMs": "2651" }, { "activeUnits": "2", "completedUnits": "220", "elapsedMs": "1831", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "21768" }, { "activeUnits": "2", "completedUnits": "222", "elapsedMs": "2510", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "23779" } ], "totalBytesBilled": "364904448", "totalBytesProcessed": "364518168", "totalPartitionsProcessed": "0", "totalSlotMs": "23779", "transferredBytes": "0" }, "startTime": "1665778591840", "totalBytesProcessed": "364518168", "totalSlotMs": "23779" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon259f2967_a835_4564_a420_54b179468f79" }, "priority": "INTERACTIVE", "query": "-- start query 78 in stream 0 using template query78.tpl\nwith ws as\n (select d_year AS ws_sold_year, ws_item_sk,\n ws_bill_customer_sk ws_customer_sk,\n sum(ws_quantity) ws_qty,\n sum(ws_wholesale_cost) ws_wc,\n sum(ws_sales_price) ws_sp\n from web_sales\n left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n join date_dim on ws_sold_date_sk = d_date_sk\n where wr_order_number is null\n group by d_year, ws_item_sk, ws_bill_customer_sk\n ),\ncs as\n (select d_year AS cs_sold_year, cs_item_sk,\n cs_bill_customer_sk cs_customer_sk,\n sum(cs_quantity) cs_qty,\n sum(cs_wholesale_cost) cs_wc,\n sum(cs_sales_price) cs_sp\n from catalog_sales\n left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n join date_dim on cs_sold_date_sk = d_date_sk\n where cr_order_number is null\n group by d_year, cs_item_sk, cs_bill_customer_sk\n ),\nss as\n (select d_year AS ss_sold_year, ss_item_sk,\n ss_customer_sk,\n sum(ss_quantity) ss_qty,\n sum(ss_wholesale_cost) ss_wc,\n sum(ss_sales_price) ss_sp\n from store_sales\n left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n join date_dim on ss_sold_date_sk = d_date_sk\n where sr_ticket_number is null\n group by d_year, ss_item_sk, ss_customer_sk\n )\n select\nss_sold_year, ss_item_sk, ss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2000\norder by \n ss_sold_year, \n ss_item_sk, \n ss_customer_sk,\n ss_qty desc, ss_wc desc, ss_sp desc,\n other_chan_qty,\n other_chan_wholesale_cost,\n other_chan_sales_price,\n ratio\nlimit 100\n;\n\n-- end query 78 in stream 0 using template query78.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "kTPVMmcZgVXsjYR5ZVJazQ==", "id": "test-project-364309:europe-west1.query78_1665778596", "jobReference": { "jobId": "query78_1665778596", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query78_1665778596?location=europe-west1", "statistics": { "creationTime": "1665778596903", "endTime": "1665778599591", "finalExecutionDurationMs": "2357", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "364518168", "performanceInsights": { "avgPreviousExecutionMs": "2787" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.0038576939562794685, "computeRatioMax": 0.0038576939562794685, "endMs": "1665778597191", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.0030004286326618087, "readRatioMax": 0.0030004286326618087, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "6588", "shuffleOutputBytesSpilled": "0", "slotMs": "39", "startMs": "1665778597158", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:d_date_sk, $21:d_year", "FROM date_dim", "WHERE equal($21, 2000)" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0004286326618088298, "waitRatioMax": 0.0004286326618088298, "writeMsAvg": "19", "writeMsMax": "19", "writeRatioAvg": 0.008144020574367767, "writeRatioMax": 0.008144020574367767 }, { "completedParallelInputs": "1", "computeMsAvg": "55", "computeMsMax": "55", "computeRatioAvg": 0.02357479639948564, "computeRatioMax": 0.02357479639948564, "endMs": "1665778597219", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.002571795970852979, "readRatioMax": 0.002571795970852979, "recordsRead": "71763", "recordsWritten": "71763", "shuffleOutputBytes": "1291734", "shuffleOutputBytesSpilled": "0", "slotMs": "58", "startMs": "1665778597173", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:wr_item_sk, $81:wr_order_number", "FROM web_returns" ] }, { "kind": "WRITE", "substeps": [ "$80, $81", "TO __stage01_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0008572653236176596, "waitRatioMax": 0.0008572653236176596, "writeMsAvg": "10", "writeMsMax": "10", "writeRatioAvg": 0.0042863266180882984, "writeRatioMax": 0.0042863266180882984 }, { "completedParallelInputs": "1", "computeMsAvg": "11", "computeMsMax": "11", "computeRatioAvg": 0.004714959279897128, "computeRatioMax": 0.004714959279897128, "endMs": "1665778597222", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.0030004286326618087, "readRatioMax": 0.0030004286326618087, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "6588", "shuffleOutputBytesSpilled": "0", "slotMs": "38", "startMs": "1665778597186", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_year", "FROM date_dim", "WHERE equal($11, 2000)" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0004286326618088298, "waitRatioMax": 0.0004286326618088298, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.0034290612944706386, "writeRatioMax": 0.0034290612944706386 }, { "completedParallelInputs": "1", "computeMsAvg": "114", "computeMsMax": "114", "computeRatioAvg": 0.0488641234462066, "computeRatioMax": 0.0488641234462066, "endMs": "1665778597309", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.0038576939562794685, "readRatioMax": 0.0038576939562794685, "recordsRead": "287514", "recordsWritten": "287514", "shuffleOutputBytes": "5175252", "shuffleOutputBytesSpilled": "0", "slotMs": "145", "startMs": "1665778597199", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:sr_item_sk, $61:sr_ticket_number", "FROM store_returns" ] }, { "kind": "WRITE", "substeps": [ "$60, $61", "TO __stage03_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0004286326618088298, "waitRatioMax": 0.0004286326618088298, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.005572224603514788, "writeRatioMax": 0.005572224603514788 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.005572224603514788, "computeRatioMax": 0.005572224603514788, "endMs": "1665778597245", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.0021431633090441492, "readRatioMax": 0.0021431633090441492, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "6588", "shuffleOutputBytesSpilled": "0", "slotMs": "44", "startMs": "1665778597218", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:d_date_sk, $2:d_year", "FROM date_dim", "WHERE equal($2, 2000)" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage04_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.0012858979854264896, "waitRatioMax": 0.0012858979854264896, "writeMsAvg": "15", "writeMsMax": "15", "writeRatioAvg": 0.006429489927132447, "writeRatioMax": 0.006429489927132447 }, { "completedParallelInputs": "1", "computeMsAvg": "86", "computeMsMax": "86", "computeRatioAvg": 0.036862408915559364, "computeRatioMax": 0.036862408915559364, "endMs": "1665778597316", "id": "5", "name": "S05: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.0030004286326618087, "readRatioMax": 0.0030004286326618087, "recordsRead": "144067", "recordsWritten": "144067", "shuffleOutputBytes": "2593206", "shuffleOutputBytesSpilled": "0", "slotMs": "113", "startMs": "1665778597229", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:cr_item_sk, $41:cr_order_number", "FROM catalog_returns" ] }, { "kind": "WRITE", "substeps": [ "$40, $41", "TO __stage05_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0004286326618088298, "waitRatioMax": 0.0004286326618088298, "writeMsAvg": "10", "writeMsMax": "10", "writeRatioAvg": 0.0042863266180882984, "writeRatioMax": 0.0042863266180882984 }, { "completedParallelInputs": "1", "computeMsAvg": "825", "computeMsMax": "825", "computeRatioAvg": 0.35362194599228464, "computeRatioMax": 0.35362194599228464, "endMs": "1665778597759", "id": "6", "inputStages": [ "0", "1" ], "name": "S06: Join+", "parallelInputs": "1", "readMsAvg": "21", "readMsMax": "21", "readRatioAvg": 0.009001285897985427, "readRatioMax": 0.009001285897985427, "recordsRead": "791513", "recordsWritten": "128130", "shuffleOutputBytes": "8968372", "shuffleOutputBytesSpilled": "0", "slotMs": "788", "startMs": "1665778597240", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70:ws_sold_date_sk, $71:ws_item_sk, $72:ws_bill_customer_sk, $73:ws_order_number, $74:ws_quantity, $75:ws_wholesale_cost, $76:ws_sales_price", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$80, $81", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $240 := $235, $241 := $230, $242 := $231", "$150 := SUM($232)", "$151 := SUM($233)", "$152 := SUM($234)" ] }, { "kind": "JOIN", "substeps": [ "$230 := $211, $231 := $212, $232 := $213, $233 := $214, $234 := $215, $235 := $21", "INNER HASH JOIN EACH WITH ALL ON $210 = $20" ] }, { "kind": "FILTER", "substeps": [ "is_null($216)" ] }, { "kind": "JOIN", "substeps": [ "$210 := $70, $211 := $71, $212 := $72, $213 := $74, $214 := $75, $215 := $76, $216 := $81", "LEFT OUTER HASH JOIN EACH WITH ALL ON $73 = $81, $71 = $80" ] }, { "kind": "WRITE", "substeps": [ "$240, $241, $242, $150, $151, $152", "TO __stage06_output", "BY HASH($240, $241, $242)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0008572653236176596, "waitRatioMax": 0.0008572653236176596, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.0034290612944706386, "writeRatioMax": 0.0034290612944706386 }, { "completedParallelInputs": "6", "computeMsAvg": "861", "computeMsMax": "973", "computeRatioAvg": 0.3690527218174025, "computeRatioMax": 0.41705957993999143, "endMs": "1665778597914", "id": "7", "inputStages": [ "3", "2" ], "name": "S07: Join+", "parallelInputs": "6", "readMsAvg": "19", "readMsMax": "21", "readRatioAvg": 0.008144020574367767, "readRatioMax": 0.009001285897985427, "recordsRead": "4607684", "recordsWritten": "497119", "shuffleOutputBytes": "34277954", "shuffleOutputBytesSpilled": "0", "slotMs": "4821", "startMs": "1665778597323", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:ss_sold_date_sk, $51:ss_item_sk, $52:ss_customer_sk, $53:ss_ticket_number, $54:ss_quantity, $55:ss_wholesale_cost, $56:ss_sales_price", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$60, $61", "FROM __stage03_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage02_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $190 := $185, $191 := $180, $192 := $181", "$140 := SUM($182)", "$141 := SUM($183)", "$142 := SUM($184)" ] }, { "kind": "JOIN", "substeps": [ "$180 := $161, $181 := $162, $182 := $163, $183 := $164, $184 := $165, $185 := $11", "INNER HASH JOIN EACH WITH ALL ON $160 = $10" ] }, { "kind": "FILTER", "substeps": [ "is_null($166)" ] }, { "kind": "JOIN", "substeps": [ "$160 := $50, $161 := $51, $162 := $52, $163 := $54, $164 := $55, $165 := $56, $166 := $61", "LEFT OUTER HASH JOIN EACH WITH ALL ON $53 = $61, $51 = $60" ] }, { "kind": "WRITE", "substeps": [ "$190, $191, $192, $140, $141, $142", "TO __stage07_output", "BY HASH($190, $191, $192)" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.0008572653236176596, "waitRatioMax": 0.0012858979854264896, "writeMsAvg": "7", "writeMsMax": "8", "writeRatioAvg": 0.0030004286326618087, "writeRatioMax": 0.0034290612944706386 }, { "completedParallelInputs": "5", "computeMsAvg": "543", "computeMsMax": "631", "computeRatioAvg": 0.2327475353621946, "computeRatioMax": 0.2704672096013716, "endMs": "1665778597732", "id": "8", "inputStages": [ "5", "4" ], "name": "S08: Join+", "parallelInputs": "5", "readMsAvg": "21", "readMsMax": "25", "readRatioAvg": 0.009001285897985427, "readRatioMax": 0.010715816545220747, "recordsRead": "2163713", "recordsWritten": "258782", "shuffleOutputBytes": "18084620", "shuffleOutputBytesSpilled": "0", "slotMs": "2520", "startMs": "1665778597350", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:cs_sold_date_sk, $31:cs_bill_customer_sk, $32:cs_item_sk, $33:cs_order_number, $34:cs_quantity, $35:cs_wholesale_cost, $36:cs_sales_price", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$40, $41", "FROM __stage05_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $300 := $295, $301 := $291, $302 := $290", "$130 := SUM($292)", "$131 := SUM($293)", "$132 := SUM($294)" ] }, { "kind": "JOIN", "substeps": [ "$290 := $271, $291 := $272, $292 := $273, $293 := $274, $294 := $275, $295 := $2", "INNER HASH JOIN EACH WITH ALL ON $270 = $1" ] }, { "kind": "FILTER", "substeps": [ "is_null($276)" ] }, { "kind": "JOIN", "substeps": [ "$270 := $30, $271 := $31, $272 := $32, $273 := $34, $274 := $35, $275 := $36, $276 := $41", "LEFT OUTER HASH JOIN EACH WITH ALL ON $33 = $41, $32 = $40" ] }, { "kind": "WRITE", "substeps": [ "$300, $302, $301, $130, $131, $132", "TO __stage08_output", "BY HASH($300, $301, $302)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0004286326618088298, "waitRatioMax": 0.0004286326618088298, "writeMsAvg": "22", "writeMsMax": "26", "writeRatioAvg": 0.009429918559794257, "writeRatioMax": 0.011144449207029576 }, { "completedParallelInputs": "1", "computeMsAvg": "710", "computeMsMax": "710", "computeRatioAvg": 0.30432918988426916, "computeRatioMax": 0.30432918988426916, "endMs": "1665778598320", "id": "9", "inputStages": [ "8" ], "name": "S09: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "258782", "recordsWritten": "258136", "shuffleOutputBytes": "18056536", "shuffleOutputBytesSpilled": "0", "slotMs": "629", "startMs": "1665778597936", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$300, $302, $301, $130, $131, $132", "FROM __stage08_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $310 := $300, $311 := $301, $312 := $302", "$100 := SUM($130)", "$101 := SUM($131)", "$102 := SUM($132)" ] }, { "kind": "WRITE", "substeps": [ "$100, $101, $102, $310, $311, $312", "TO __stage09_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0004286326618088298, "waitRatioMax": 0.0004286326618088298, "writeMsAvg": "28", "writeMsMax": "28", "writeRatioAvg": 0.012001714530647235, "writeRatioMax": 0.012001714530647235 }, { "completedParallelInputs": "1", "computeMsAvg": "327", "computeMsMax": "327", "computeRatioAvg": 0.14016288041148736, "computeRatioMax": 0.14016288041148736, "endMs": "1665778598184", "id": "10", "inputStages": [ "6" ], "name": "S0A: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "128130", "recordsWritten": "128114", "shuffleOutputBytes": "8967716", "shuffleOutputBytesSpilled": "0", "slotMs": "333", "startMs": "1665778597953", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$240, $241, $242, $150, $151, $152", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $250 := $240, $251 := $241, $252 := $242", "$120 := SUM($150)", "$121 := SUM($151)", "$122 := SUM($152)" ] }, { "kind": "WRITE", "substeps": [ "$120, $121, $122, $250, $251, $252", "TO __stage0A_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0004286326618088298, "waitRatioMax": 0.0004286326618088298, "writeMsAvg": "23", "writeMsMax": "23", "writeRatioAvg": 0.009858551221603087, "writeRatioMax": 0.009858551221603087 }, { "completedParallelInputs": "100", "computeMsAvg": "10", "computeMsMax": "19", "computeRatioAvg": 0.0042863266180882984, "computeRatioMax": 0.008144020574367767, "endMs": "1665778598263", "id": "11", "inputStages": [ "10" ], "name": "S0B: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "128114", "recordsWritten": "128114", "shuffleOutputBytes": "8967716", "shuffleOutputBytesSpilled": "0", "slotMs": "4814", "startMs": "1665778598202", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0A_output" ] } ], "waitMsAvg": "2", "waitMsMax": "4", "waitRatioAvg": 0.0008572653236176596, "waitRatioMax": 0.0017145306472353193, "writeMsAvg": "15", "writeMsMax": "25", "writeRatioAvg": 0.006429489927132447, "writeRatioMax": 0.010715816545220747 }, { "completedParallelInputs": "100", "computeMsAvg": "12", "computeMsMax": "23", "computeRatioAvg": 0.005143591941705958, "computeRatioMax": 0.009858551221603087, "endMs": "1665778598412", "id": "12", "inputStages": [ "9" ], "name": "S0C: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "258136", "recordsWritten": "258136", "shuffleOutputBytes": "18056536", "shuffleOutputBytesSpilled": "0", "slotMs": "5494", "startMs": "1665778598337", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage09_output" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.0008572653236176596, "waitRatioMax": 0.0012858979854264896, "writeMsAvg": "15", "writeMsMax": "21", "writeRatioAvg": 0.006429489927132447, "writeRatioMax": 0.009001285897985427 }, { "completedParallelInputs": "1", "computeMsAvg": "2333", "computeMsMax": "2333", "computeRatioAvg": 1, "computeRatioMax": 1, "endMs": "1665778599244", "id": "13", "inputStages": [ "12", "7", "11" ], "name": "S0D: Join+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "883369", "recordsWritten": "100", "shuffleOutputBytes": "12088", "shuffleOutputBytesSpilled": "0", "slotMs": "1991", "startMs": "1665778598344", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$190, $191, $192, $140, $141, $142", "FROM __stage07_output" ] }, { "kind": "READ", "substeps": [ "$120, $121, $122, $250, $251, $252", "FROM __stage0B_output" ] }, { "kind": "READ", "substeps": [ "$100, $101, $102, $310, $311, $312", "FROM __stage0C_output" ] }, { "kind": "SORT", "substeps": [ "$320 ASC, $321 ASC, $322 ASC, $323 DESC, $324 DESC, $325 DESC, $91 ASC, $92 ASC, $93 ASC, $90 ASC", "LIMIT 100" ] }, { "kind": "COMPUTE", "substeps": [ "$90 := round(divide(CAST($323 AS DOUBLE), CAST(add(coalesce($326, 0), coalesce($329, 0)) AS DOUBLE)), 2)", "$91 := add(coalesce($326, 0), coalesce($329, 0))", "$92 := add(coalesce($327, NUMERIC<...>), coalesce($330, NUMERIC<...>))", "$93 := add(coalesce($328, NUMERIC<...>), coalesce($331, NUMERIC<...>))" ] }, { "kind": "FILTER", "substeps": [ "or(greater(coalesce($326, 0), 0), greater(coalesce($329, 0), 0))" ] }, { "kind": "JOIN", "substeps": [ "$320 := $260, $321 := $261, $322 := $262, $323 := $263, $324 := $264, $325 := $265, $326 := $266, $327 := $267, $328 := $268, $329 := $100, $330 := $101, $331 := $102", "LEFT OUTER HASH JOIN EACH WITH ALL ON $260 = $310, $261 = $311, $262 = $312" ] }, { "kind": "JOIN", "substeps": [ "$260 := $200, $261 := $201, $262 := $202, $263 := $110, $264 := $111, $265 := $112, $266 := $120, $267 := $121, $268 := $122", "LEFT OUTER HASH JOIN EACH WITH ALL ON $200 = $250, $201 = $251, $202 = $252" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $200 := $190, $201 := $191, $202 := $192", "$110 := SUM($140)", "$111 := SUM($141)", "$112 := SUM($142)" ] }, { "kind": "WRITE", "substeps": [ "$340, $341, $342, $343, $344, $345, $346, $347, $348, $349", "TO __stage0D_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.0012858979854264896, "waitRatioMax": 0.0012858979854264896, "writeMsAvg": "2", "writeMsMax": "2", "writeRatioAvg": 0.0008572653236176596, "writeRatioMax": 0.0008572653236176596 }, { "completedParallelInputs": "1", "computeMsAvg": "6", "computeMsMax": "6", "computeRatioAvg": 0.002571795970852979, "computeRatioMax": 0.002571795970852979, "endMs": "1665778599308", "id": "14", "inputStages": [ "13" ], "name": "S0E: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "12088", "shuffleOutputBytesSpilled": "0", "slotMs": "921", "startMs": "1665778598353", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$340, $341, $342, $343, $344, $345, $346, $347, $348, $349", "FROM __stage0D_output" ] }, { "kind": "SORT", "substeps": [ "$340 ASC, $341 ASC, $342 ASC, $347 DESC, $348 DESC, $349 DESC, $344 ASC, $345 ASC, $346 ASC, $343 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$350, $351, $352, $353, $354, $355, $356, $357, $358, $359", "TO __stage0E_output" ] } ], "waitMsAvg": "3", "waitMsMax": "3", "waitRatioAvg": 0.0012858979854264896, "waitRatioMax": 0.0012858979854264896, "writeMsAvg": "4", "writeMsMax": "4", "writeRatioAvg": 0.0017145306472353193, "writeRatioMax": 0.0017145306472353193 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "11", "completedUnits": "7", "elapsedMs": "667", "estimatedRunnableUnits": "0", "pendingUnits": "11", "totalSlotMs": "2200" }, { "activeUnits": "2", "completedUnits": "220", "elapsedMs": "1713", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "20008" }, { "activeUnits": "2", "completedUnits": "222", "elapsedMs": "2523", "estimatedRunnableUnits": "5", "pendingUnits": "0", "totalSlotMs": "22607" } ], "totalBytesBilled": "364904448", "totalBytesProcessed": "364518168", "totalPartitionsProcessed": "0", "totalSlotMs": "22607", "transferredBytes": "0" }, "startTime": "1665778596992", "totalBytesProcessed": "364518168", "totalSlotMs": "22607" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anonc9097735_3769_418d_8d1b_eb1c29e6f53f" }, "priority": "INTERACTIVE", "query": "-- start query 78 in stream 0 using template query78.tpl\nwith ws as\n (select d_year AS ws_sold_year, ws_item_sk,\n ws_bill_customer_sk ws_customer_sk,\n sum(ws_quantity) ws_qty,\n sum(ws_wholesale_cost) ws_wc,\n sum(ws_sales_price) ws_sp\n from web_sales\n left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n join date_dim on ws_sold_date_sk = d_date_sk\n where wr_order_number is null\n group by d_year, ws_item_sk, ws_bill_customer_sk\n ),\ncs as\n (select d_year AS cs_sold_year, cs_item_sk,\n cs_bill_customer_sk cs_customer_sk,\n sum(cs_quantity) cs_qty,\n sum(cs_wholesale_cost) cs_wc,\n sum(cs_sales_price) cs_sp\n from catalog_sales\n left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n join date_dim on cs_sold_date_sk = d_date_sk\n where cr_order_number is null\n group by d_year, cs_item_sk, cs_bill_customer_sk\n ),\nss as\n (select d_year AS ss_sold_year, ss_item_sk,\n ss_customer_sk,\n sum(ss_quantity) ss_qty,\n sum(ss_wholesale_cost) ss_wc,\n sum(ss_sales_price) ss_sp\n from store_sales\n left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n join date_dim on ss_sold_date_sk = d_date_sk\n where sr_ticket_number is null\n group by d_year, ss_item_sk, ss_customer_sk\n )\n select\nss_sold_year, ss_item_sk, ss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2000\norder by \n ss_sold_year, \n ss_item_sk, \n ss_customer_sk,\n ss_qty desc, ss_wc desc, ss_sp desc,\n other_chan_qty,\n other_chan_wholesale_cost,\n other_chan_sales_price,\n ratio\nlimit 100\n;\n\n-- end query 78 in stream 0 using template query78.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "RNRx2Rl2PNZuwxBwdlSoQg==", "id": "test-project-364309:europe-west1.query78_1665778601", "jobReference": { "jobId": "query78_1665778601", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query78_1665778601?location=europe-west1", "statistics": { "creationTime": "1665778602468", "endTime": "1665778606135", "finalExecutionDurationMs": "3400", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "364518168", "performanceInsights": { "avgPreviousExecutionMs": "2733" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.004043126684636119, "computeRatioMax": 0.004043126684636119, "endMs": "1665778602734", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.0026954177897574125, "readRatioMax": 0.0026954177897574125, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "6588", "shuffleOutputBytesSpilled": "0", "slotMs": "42", "startMs": "1665778602692", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:d_date_sk, $21:d_year", "FROM date_dim", "WHERE equal($21, 2000)" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage00_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0008984725965858042, "waitRatioMax": 0.0008984725965858042, "writeMsAvg": "29", "writeMsMax": "29", "writeRatioAvg": 0.01302785265049416, "writeRatioMax": 0.01302785265049416 }, { "completedParallelInputs": "1", "computeMsAvg": "42", "computeMsMax": "42", "computeRatioAvg": 0.018867924528301886, "computeRatioMax": 0.018867924528301886, "endMs": "1665778602756", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.004043126684636119, "readRatioMax": 0.004043126684636119, "recordsRead": "71763", "recordsWritten": "71763", "shuffleOutputBytes": "1291734", "shuffleOutputBytesSpilled": "0", "slotMs": "49", "startMs": "1665778602711", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:wr_item_sk, $81:wr_order_number", "FROM web_returns" ] }, { "kind": "WRITE", "substeps": [ "$80, $81", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0004492362982929021, "waitRatioMax": 0.0004492362982929021, "writeMsAvg": "10", "writeMsMax": "10", "writeRatioAvg": 0.004492362982929021, "writeRatioMax": 0.004492362982929021 }, { "completedParallelInputs": "1", "computeMsAvg": "15", "computeMsMax": "15", "computeRatioAvg": 0.006738544474393531, "computeRatioMax": 0.006738544474393531, "endMs": "1665778602771", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "11", "readMsMax": "11", "readRatioAvg": 0.004941599281221923, "readRatioMax": 0.004941599281221923, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "6588", "shuffleOutputBytesSpilled": "0", "slotMs": "54", "startMs": "1665778602728", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_year", "FROM date_dim", "WHERE equal($11, 2000)" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0004492362982929021, "waitRatioMax": 0.0004492362982929021, "writeMsAvg": "10", "writeMsMax": "10", "writeRatioAvg": 0.004492362982929021, "writeRatioMax": 0.004492362982929021 }, { "completedParallelInputs": "1", "computeMsAvg": "124", "computeMsMax": "124", "computeRatioAvg": 0.055705300988319856, "computeRatioMax": 0.055705300988319856, "endMs": "1665778602908", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "12", "readMsMax": "12", "readRatioAvg": 0.005390835579514825, "readRatioMax": 0.005390835579514825, "recordsRead": "287514", "recordsWritten": "287514", "shuffleOutputBytes": "5175252", "shuffleOutputBytesSpilled": "0", "slotMs": "159", "startMs": "1665778602757", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:sr_item_sk, $61:sr_ticket_number", "FROM store_returns" ] }, { "kind": "WRITE", "substeps": [ "$60, $61", "TO __stage03_output" ] } ], "waitMsAvg": "9", "waitMsMax": "9", "waitRatioAvg": 0.004043126684636119, "waitRatioMax": 0.004043126684636119, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.005840071877807727, "writeRatioMax": 0.005840071877807727 }, { "completedParallelInputs": "1", "computeMsAvg": "14", "computeMsMax": "14", "computeRatioAvg": 0.006289308176100629, "computeRatioMax": 0.006289308176100629, "endMs": "1665778602818", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.0035938903863432167, "readRatioMax": 0.0035938903863432167, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "6588", "shuffleOutputBytesSpilled": "0", "slotMs": "58", "startMs": "1665778602773", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:d_date_sk, $2:d_year", "FROM date_dim", "WHERE equal($2, 2000)" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage04_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0004492362982929021, "waitRatioMax": 0.0004492362982929021, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.006289308176100629, "writeRatioMax": 0.006289308176100629 }, { "completedParallelInputs": "1", "computeMsAvg": "99", "computeMsMax": "99", "computeRatioAvg": 0.0444743935309973, "computeRatioMax": 0.0444743935309973, "endMs": "1665778602879", "id": "5", "name": "S05: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.0031446540880503146, "readRatioMax": 0.0031446540880503146, "recordsRead": "144067", "recordsWritten": "144067", "shuffleOutputBytes": "2593206", "shuffleOutputBytesSpilled": "0", "slotMs": "124", "startMs": "1665778602789", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:cr_item_sk, $41:cr_order_number", "FROM catalog_returns" ] }, { "kind": "WRITE", "substeps": [ "$40, $41", "TO __stage05_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0004492362982929021, "waitRatioMax": 0.0004492362982929021, "writeMsAvg": "12", "writeMsMax": "12", "writeRatioAvg": 0.005390835579514825, "writeRatioMax": 0.005390835579514825 }, { "completedParallelInputs": "1", "computeMsAvg": "963", "computeMsMax": "963", "computeRatioAvg": 0.4326145552560647, "computeRatioMax": 0.4326145552560647, "endMs": "1665778603331", "id": "6", "inputStages": [ "0", "1" ], "name": "S06: Join+", "parallelInputs": "1", "readMsAvg": "15", "readMsMax": "15", "readRatioAvg": 0.006738544474393531, "readRatioMax": 0.006738544474393531, "recordsRead": "791513", "recordsWritten": "128130", "shuffleOutputBytes": "8968372", "shuffleOutputBytesSpilled": "0", "slotMs": "848", "startMs": "1665778602794", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70:ws_sold_date_sk, $71:ws_item_sk, $72:ws_bill_customer_sk, $73:ws_order_number, $74:ws_quantity, $75:ws_wholesale_cost, $76:ws_sales_price", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$80, $81", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $240 := $235, $241 := $230, $242 := $231", "$150 := SUM($232)", "$151 := SUM($233)", "$152 := SUM($234)" ] }, { "kind": "JOIN", "substeps": [ "$230 := $211, $231 := $212, $232 := $213, $233 := $214, $234 := $215, $235 := $21", "INNER HASH JOIN EACH WITH ALL ON $210 = $20" ] }, { "kind": "FILTER", "substeps": [ "is_null($216)" ] }, { "kind": "JOIN", "substeps": [ "$210 := $70, $211 := $71, $212 := $72, $213 := $74, $214 := $75, $215 := $76, $216 := $81", "LEFT OUTER HASH JOIN EACH WITH ALL ON $73 = $81, $71 = $80" ] }, { "kind": "WRITE", "substeps": [ "$240, $241, $242, $150, $151, $152", "TO __stage06_output", "BY HASH($240, $241, $242)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0004492362982929021, "waitRatioMax": 0.0004492362982929021, "writeMsAvg": "10", "writeMsMax": "10", "writeRatioAvg": 0.004492362982929021, "writeRatioMax": 0.004492362982929021 }, { "completedParallelInputs": "5", "computeMsAvg": "545", "computeMsMax": "694", "computeRatioAvg": 0.24483378256963162, "computeRatioMax": 0.31176999101527403, "endMs": "1665778603347", "id": "7", "inputStages": [ "5", "4" ], "name": "S07: Join+", "parallelInputs": "5", "readMsAvg": "22", "readMsMax": "25", "readRatioAvg": 0.009883198562443846, "readRatioMax": 0.011230907457322551, "recordsRead": "2163713", "recordsWritten": "258782", "shuffleOutputBytes": "18084620", "shuffleOutputBytesSpilled": "0", "slotMs": "2523", "startMs": "1665778602912", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:cs_sold_date_sk, $31:cs_bill_customer_sk, $32:cs_item_sk, $33:cs_order_number, $34:cs_quantity, $35:cs_wholesale_cost, $36:cs_sales_price", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$40, $41", "FROM __stage05_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $300 := $295, $301 := $291, $302 := $290", "$130 := SUM($292)", "$131 := SUM($293)", "$132 := SUM($294)" ] }, { "kind": "JOIN", "substeps": [ "$290 := $271, $291 := $272, $292 := $273, $293 := $274, $294 := $275, $295 := $2", "INNER HASH JOIN EACH WITH ALL ON $270 = $1" ] }, { "kind": "FILTER", "substeps": [ "is_null($276)" ] }, { "kind": "JOIN", "substeps": [ "$270 := $30, $271 := $31, $272 := $32, $273 := $34, $274 := $35, $275 := $36, $276 := $41", "LEFT OUTER HASH JOIN EACH WITH ALL ON $33 = $41, $32 = $40" ] }, { "kind": "WRITE", "substeps": [ "$300, $302, $301, $130, $131, $132", "TO __stage07_output", "BY HASH($300, $301, $302)" ] } ], "waitMsAvg": "1", "waitMsMax": "2", "waitRatioAvg": 0.0004492362982929021, "waitRatioMax": 0.0008984725965858042, "writeMsAvg": "22", "writeMsMax": "24", "writeRatioAvg": 0.009883198562443846, "writeRatioMax": 0.01078167115902965 }, { "completedParallelInputs": "6", "computeMsAvg": "883", "computeMsMax": "1260", "computeRatioAvg": 0.3966756513926325, "computeRatioMax": 0.5660377358490566, "endMs": "1665778603731", "id": "8", "inputStages": [ "2", "3" ], "name": "S08: Join+", "parallelInputs": "6", "readMsAvg": "17", "readMsMax": "28", "readRatioAvg": 0.0076370170709793355, "readRatioMax": 0.012578616352201259, "recordsRead": "4607684", "recordsWritten": "497119", "shuffleOutputBytes": "34277954", "shuffleOutputBytesSpilled": "0", "slotMs": "5151", "startMs": "1665778602915", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:ss_sold_date_sk, $51:ss_item_sk, $52:ss_customer_sk, $53:ss_ticket_number, $54:ss_quantity, $55:ss_wholesale_cost, $56:ss_sales_price", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$60, $61", "FROM __stage03_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage02_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $190 := $185, $191 := $180, $192 := $181", "$140 := SUM($182)", "$141 := SUM($183)", "$142 := SUM($184)" ] }, { "kind": "JOIN", "substeps": [ "$180 := $161, $181 := $162, $182 := $163, $183 := $164, $184 := $165, $185 := $11", "INNER HASH JOIN EACH WITH ALL ON $160 = $10" ] }, { "kind": "FILTER", "substeps": [ "is_null($166)" ] }, { "kind": "JOIN", "substeps": [ "$160 := $50, $161 := $51, $162 := $52, $163 := $54, $164 := $55, $165 := $56, $166 := $61", "LEFT OUTER HASH JOIN EACH WITH ALL ON $53 = $61, $51 = $60" ] }, { "kind": "WRITE", "substeps": [ "$190, $191, $192, $140, $141, $142", "TO __stage08_output", "BY HASH($190, $191, $192)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0004492362982929021, "waitRatioMax": 0.0004492362982929021, "writeMsAvg": "7", "writeMsMax": "9", "writeRatioAvg": 0.0031446540880503146, "writeRatioMax": 0.004043126684636119 }, { "completedParallelInputs": "1", "computeMsAvg": "522", "computeMsMax": "522", "computeRatioAvg": 0.23450134770889489, "computeRatioMax": 0.23450134770889489, "endMs": "1665778604133", "id": "9", "inputStages": [ "7" ], "name": "S09: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "258782", "recordsWritten": "258136", "shuffleOutputBytes": "18056536", "shuffleOutputBytesSpilled": "0", "slotMs": "536", "startMs": "1665778603803", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$300, $302, $301, $130, $131, $132", "FROM __stage07_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $310 := $300, $311 := $301, $312 := $302", "$100 := SUM($130)", "$101 := SUM($131)", "$102 := SUM($132)" ] }, { "kind": "WRITE", "substeps": [ "$100, $101, $102, $310, $311, $312", "TO __stage09_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0008984725965858042, "waitRatioMax": 0.0008984725965858042, "writeMsAvg": "28", "writeMsMax": "28", "writeRatioAvg": 0.012578616352201259, "writeRatioMax": 0.012578616352201259 }, { "completedParallelInputs": "1", "computeMsAvg": "381", "computeMsMax": "381", "computeRatioAvg": 0.1711590296495957, "computeRatioMax": 0.1711590296495957, "endMs": "1665778604037", "id": "10", "inputStages": [ "6" ], "name": "S0A: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "128130", "recordsWritten": "128114", "shuffleOutputBytes": "8967716", "shuffleOutputBytesSpilled": "0", "slotMs": "315", "startMs": "1665778603819", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$240, $241, $242, $150, $151, $152", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $250 := $240, $251 := $241, $252 := $242", "$120 := SUM($150)", "$121 := SUM($151)", "$122 := SUM($152)" ] }, { "kind": "WRITE", "substeps": [ "$120, $121, $122, $250, $251, $252", "TO __stage0A_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0008984725965858042, "waitRatioMax": 0.0008984725965858042, "writeMsAvg": "25", "writeMsMax": "25", "writeRatioAvg": 0.011230907457322551, "writeRatioMax": 0.011230907457322551 }, { "completedParallelInputs": "100", "computeMsAvg": "9", "computeMsMax": "15", "computeRatioAvg": 0.004043126684636119, "computeRatioMax": 0.006738544474393531, "endMs": "1665778604149", "id": "11", "inputStages": [ "10" ], "name": "S0B: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "128114", "recordsWritten": "128114", "shuffleOutputBytes": "8967716", "shuffleOutputBytesSpilled": "0", "slotMs": "3399", "startMs": "1665778604082", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0A_output" ] } ], "waitMsAvg": "3", "waitMsMax": "5", "waitRatioAvg": 0.0013477088948787063, "waitRatioMax": 0.0022461814914645105, "writeMsAvg": "17", "writeMsMax": "29", "writeRatioAvg": 0.0076370170709793355, "writeRatioMax": 0.01302785265049416 }, { "completedParallelInputs": "100", "computeMsAvg": "12", "computeMsMax": "20", "computeRatioAvg": 0.005390835579514825, "computeRatioMax": 0.008984725965858042, "endMs": "1665778604231", "id": "12", "inputStages": [ "9" ], "name": "S0C: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "258136", "recordsWritten": "258136", "shuffleOutputBytes": "18056536", "shuffleOutputBytesSpilled": "0", "slotMs": "4679", "startMs": "1665778604155", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage09_output" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.0008984725965858042, "waitRatioMax": 0.0013477088948787063, "writeMsAvg": "19", "writeMsMax": "33", "writeRatioAvg": 0.008535489667565139, "writeRatioMax": 0.014824797843665768 }, { "completedParallelInputs": "1", "computeMsAvg": "2226", "computeMsMax": "2226", "computeRatioAvg": 1, "computeRatioMax": 1, "endMs": "1665778605367", "id": "13", "inputStages": [ "11", "12", "8" ], "name": "S0D: Join+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "883369", "recordsWritten": "100", "shuffleOutputBytes": "12088", "shuffleOutputBytesSpilled": "0", "slotMs": "1996", "startMs": "1665778604161", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$190, $191, $192, $140, $141, $142", "FROM __stage08_output" ] }, { "kind": "READ", "substeps": [ "$120, $121, $122, $250, $251, $252", "FROM __stage0B_output" ] }, { "kind": "READ", "substeps": [ "$100, $101, $102, $310, $311, $312", "FROM __stage0C_output" ] }, { "kind": "SORT", "substeps": [ "$320 ASC, $321 ASC, $322 ASC, $323 DESC, $324 DESC, $325 DESC, $91 ASC, $92 ASC, $93 ASC, $90 ASC", "LIMIT 100" ] }, { "kind": "COMPUTE", "substeps": [ "$90 := round(divide(CAST($323 AS DOUBLE), CAST(add(coalesce($326, 0), coalesce($329, 0)) AS DOUBLE)), 2)", "$91 := add(coalesce($326, 0), coalesce($329, 0))", "$92 := add(coalesce($327, NUMERIC<...>), coalesce($330, NUMERIC<...>))", "$93 := add(coalesce($328, NUMERIC<...>), coalesce($331, NUMERIC<...>))" ] }, { "kind": "FILTER", "substeps": [ "or(greater(coalesce($326, 0), 0), greater(coalesce($329, 0), 0))" ] }, { "kind": "JOIN", "substeps": [ "$320 := $260, $321 := $261, $322 := $262, $323 := $263, $324 := $264, $325 := $265, $326 := $266, $327 := $267, $328 := $268, $329 := $100, $330 := $101, $331 := $102", "LEFT OUTER HASH JOIN EACH WITH ALL ON $260 = $310, $261 = $311, $262 = $312" ] }, { "kind": "JOIN", "substeps": [ "$260 := $200, $261 := $201, $262 := $202, $263 := $110, $264 := $111, $265 := $112, $266 := $120, $267 := $121, $268 := $122", "LEFT OUTER HASH JOIN EACH WITH ALL ON $200 = $250, $201 = $251, $202 = $252" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $200 := $190, $201 := $191, $202 := $192", "$110 := SUM($140)", "$111 := SUM($141)", "$112 := SUM($142)" ] }, { "kind": "WRITE", "substeps": [ "$340, $341, $342, $343, $344, $345, $346, $347, $348, $349", "TO __stage0D_output" ] } ], "waitMsAvg": "4", "waitMsMax": "4", "waitRatioAvg": 0.0017969451931716084, "waitRatioMax": 0.0017969451931716084, "writeMsAvg": "2", "writeMsMax": "2", "writeRatioAvg": 0.0008984725965858042, "writeRatioMax": 0.0008984725965858042 }, { "completedParallelInputs": "1", "computeMsAvg": "13", "computeMsMax": "13", "computeRatioAvg": 0.005840071877807727, "computeRatioMax": 0.005840071877807727, "endMs": "1665778605666", "id": "14", "inputStages": [ "13" ], "name": "S0E: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "12088", "shuffleOutputBytesSpilled": "0", "slotMs": "1451", "startMs": "1665778604175", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$340, $341, $342, $343, $344, $345, $346, $347, $348, $349", "FROM __stage0D_output" ] }, { "kind": "SORT", "substeps": [ "$340 ASC, $341 ASC, $342 ASC, $347 DESC, $348 DESC, $349 DESC, $344 ASC, $345 ASC, $346 ASC, $343 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$350, $351, $352, $353, $354, $355, $356, $357, $358, $359", "TO __stage0E_output" ] } ], "waitMsAvg": "5", "waitMsMax": "5", "waitRatioAvg": 0.0022461814914645105, "waitRatioMax": 0.0022461814914645105, "writeMsAvg": "7", "writeMsMax": "7", "writeRatioAvg": 0.0031446540880503146, "writeRatioMax": 0.0031446540880503146 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "11", "completedUnits": "7", "elapsedMs": "660", "estimatedRunnableUnits": "0", "pendingUnits": "11", "totalSlotMs": "2741" }, { "activeUnits": "2", "completedUnits": "220", "elapsedMs": "1702", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "17943" }, { "activeUnits": "2", "completedUnits": "222", "elapsedMs": "3554", "estimatedRunnableUnits": "1", "pendingUnits": "0", "totalSlotMs": "21391" } ], "totalBytesBilled": "364904448", "totalBytesProcessed": "364518168", "totalPartitionsProcessed": "0", "totalSlotMs": "21391", "transferredBytes": "0" }, "startTime": "1665778602532", "totalBytesProcessed": "364518168", "totalSlotMs": "21391" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anon8e9c70a3_387b_4875_9251_819405e7f06c" }, "priority": "INTERACTIVE", "query": "-- start query 78 in stream 0 using template query78.tpl\nwith ws as\n (select d_year AS ws_sold_year, ws_item_sk,\n ws_bill_customer_sk ws_customer_sk,\n sum(ws_quantity) ws_qty,\n sum(ws_wholesale_cost) ws_wc,\n sum(ws_sales_price) ws_sp\n from web_sales\n left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n join date_dim on ws_sold_date_sk = d_date_sk\n where wr_order_number is null\n group by d_year, ws_item_sk, ws_bill_customer_sk\n ),\ncs as\n (select d_year AS cs_sold_year, cs_item_sk,\n cs_bill_customer_sk cs_customer_sk,\n sum(cs_quantity) cs_qty,\n sum(cs_wholesale_cost) cs_wc,\n sum(cs_sales_price) cs_sp\n from catalog_sales\n left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n join date_dim on cs_sold_date_sk = d_date_sk\n where cr_order_number is null\n group by d_year, cs_item_sk, cs_bill_customer_sk\n ),\nss as\n (select d_year AS ss_sold_year, ss_item_sk,\n ss_customer_sk,\n sum(ss_quantity) ss_qty,\n sum(ss_wholesale_cost) ss_wc,\n sum(ss_sales_price) ss_sp\n from store_sales\n left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n join date_dim on ss_sold_date_sk = d_date_sk\n where sr_ticket_number is null\n group by d_year, ss_item_sk, ss_customer_sk\n )\n select\nss_sold_year, ss_item_sk, ss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2000\norder by \n ss_sold_year, \n ss_item_sk, \n ss_customer_sk,\n ss_qty desc, ss_wc desc, ss_sp desc,\n other_chan_qty,\n other_chan_wholesale_cost,\n other_chan_sales_price,\n ratio\nlimit 100\n;\n\n-- end query 78 in stream 0 using template query78.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "2/Tg6Zv8alcgpS/BQ1ezwQ==", "id": "test-project-364309:europe-west1.query78_1665778608", "jobReference": { "jobId": "query78_1665778608", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query78_1665778608?location=europe-west1", "statistics": { "creationTime": "1665778608594", "endTime": "1665778611478", "finalExecutionDurationMs": "2629", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "364518168", "performanceInsights": { "avgPreviousExecutionMs": "2807" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.006064690026954178, "computeRatioMax": 0.006064690026954178, "endMs": "1665778608855", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.004043126684636119, "readRatioMax": 0.004043126684636119, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "6588", "shuffleOutputBytesSpilled": "0", "slotMs": "45", "startMs": "1665778608814", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:d_date_sk, $21:d_year", "FROM date_dim", "WHERE equal($21, 2000)" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006738544474393531, "waitRatioMax": 0.0006738544474393531, "writeMsAvg": "28", "writeMsMax": "28", "writeRatioAvg": 0.018867924528301886, "writeRatioMax": 0.018867924528301886 }, { "completedParallelInputs": "1", "computeMsAvg": "47", "computeMsMax": "47", "computeRatioAvg": 0.03167115902964959, "computeRatioMax": 0.03167115902964959, "endMs": "1665778608876", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.0047169811320754715, "readRatioMax": 0.0047169811320754715, "recordsRead": "71763", "recordsWritten": "71763", "shuffleOutputBytes": "1291734", "shuffleOutputBytesSpilled": "0", "slotMs": "59", "startMs": "1665778608832", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:wr_item_sk, $81:wr_order_number", "FROM web_returns" ] }, { "kind": "WRITE", "substeps": [ "$80, $81", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006738544474393531, "waitRatioMax": 0.0006738544474393531, "writeMsAvg": "10", "writeMsMax": "10", "writeRatioAvg": 0.006738544474393531, "writeRatioMax": 0.006738544474393531 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.006064690026954178, "computeRatioMax": 0.006064690026954178, "endMs": "1665778608892", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.0047169811320754715, "readRatioMax": 0.0047169811320754715, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "6588", "shuffleOutputBytesSpilled": "0", "slotMs": "26", "startMs": "1665778608851", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_year", "FROM date_dim", "WHERE equal($11, 2000)" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage02_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0013477088948787063, "waitRatioMax": 0.0013477088948787063, "writeMsAvg": "13", "writeMsMax": "13", "writeRatioAvg": 0.00876010781671159, "writeRatioMax": 0.00876010781671159 }, { "completedParallelInputs": "1", "computeMsAvg": "220", "computeMsMax": "220", "computeRatioAvg": 0.14824797843665768, "computeRatioMax": 0.14824797843665768, "endMs": "1665778609027", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "11", "readMsMax": "11", "readRatioAvg": 0.007412398921832884, "readRatioMax": 0.007412398921832884, "recordsRead": "287514", "recordsWritten": "287514", "shuffleOutputBytes": "5175252", "shuffleOutputBytesSpilled": "0", "slotMs": "222", "startMs": "1665778608869", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:sr_item_sk, $61:sr_ticket_number", "FROM store_returns" ] }, { "kind": "WRITE", "substeps": [ "$60, $61", "TO __stage03_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0013477088948787063, "waitRatioMax": 0.0013477088948787063, "writeMsAvg": "12", "writeMsMax": "12", "writeRatioAvg": 0.008086253369272238, "writeRatioMax": 0.008086253369272238 }, { "completedParallelInputs": "1", "computeMsAvg": "9", "computeMsMax": "9", "computeRatioAvg": 0.006064690026954178, "computeRatioMax": 0.006064690026954178, "endMs": "1665778608923", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.0047169811320754715, "readRatioMax": 0.0047169811320754715, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "6588", "shuffleOutputBytesSpilled": "0", "slotMs": "33", "startMs": "1665778608890", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:d_date_sk, $2:d_year", "FROM date_dim", "WHERE equal($2, 2000)" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage04_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0013477088948787063, "waitRatioMax": 0.0013477088948787063, "writeMsAvg": "7", "writeMsMax": "7", "writeRatioAvg": 0.0047169811320754715, "writeRatioMax": 0.0047169811320754715 }, { "completedParallelInputs": "1", "computeMsAvg": "59", "computeMsMax": "59", "computeRatioAvg": 0.03975741239892183, "computeRatioMax": 0.03975741239892183, "endMs": "1665778608986", "id": "5", "name": "S05: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.004043126684636119, "readRatioMax": 0.004043126684636119, "recordsRead": "144067", "recordsWritten": "144067", "shuffleOutputBytes": "2593206", "shuffleOutputBytesSpilled": "0", "slotMs": "91", "startMs": "1665778608907", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:cr_item_sk, $41:cr_order_number", "FROM catalog_returns" ] }, { "kind": "WRITE", "substeps": [ "$40, $41", "TO __stage05_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006738544474393531, "waitRatioMax": 0.0006738544474393531, "writeMsAvg": "10", "writeMsMax": "10", "writeRatioAvg": 0.006738544474393531, "writeRatioMax": 0.006738544474393531 }, { "completedParallelInputs": "1", "computeMsAvg": "1039", "computeMsMax": "1039", "computeRatioAvg": 0.7001347708894878, "computeRatioMax": 0.7001347708894878, "endMs": "1665778609564", "id": "6", "inputStages": [ "1", "0" ], "name": "S06: Join+", "parallelInputs": "1", "readMsAvg": "21", "readMsMax": "21", "readRatioAvg": 0.014150943396226415, "readRatioMax": 0.014150943396226415, "recordsRead": "791513", "recordsWritten": "128130", "shuffleOutputBytes": "8968372", "shuffleOutputBytesSpilled": "0", "slotMs": "946", "startMs": "1665778608912", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70:ws_sold_date_sk, $71:ws_item_sk, $72:ws_bill_customer_sk, $73:ws_order_number, $74:ws_quantity, $75:ws_wholesale_cost, $76:ws_sales_price", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$80, $81", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $240 := $235, $241 := $230, $242 := $231", "$150 := SUM($232)", "$151 := SUM($233)", "$152 := SUM($234)" ] }, { "kind": "JOIN", "substeps": [ "$230 := $211, $231 := $212, $232 := $213, $233 := $214, $234 := $215, $235 := $21", "INNER HASH JOIN EACH WITH ALL ON $210 = $20" ] }, { "kind": "FILTER", "substeps": [ "is_null($216)" ] }, { "kind": "JOIN", "substeps": [ "$210 := $70, $211 := $71, $212 := $72, $213 := $74, $214 := $75, $215 := $76, $216 := $81", "LEFT OUTER HASH JOIN EACH WITH ALL ON $73 = $81, $71 = $80" ] }, { "kind": "WRITE", "substeps": [ "$240, $241, $242, $150, $151, $152", "TO __stage06_output", "BY HASH($240, $241, $242)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006738544474393531, "waitRatioMax": 0.0006738544474393531, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.005390835579514825, "writeRatioMax": 0.005390835579514825 }, { "completedParallelInputs": "5", "computeMsAvg": "508", "computeMsMax": "623", "computeRatioAvg": 0.3423180592991914, "computeRatioMax": 0.419811320754717, "endMs": "1665778609372", "id": "7", "inputStages": [ "5", "4" ], "name": "S07: Join+", "parallelInputs": "5", "readMsAvg": "19", "readMsMax": "23", "readRatioAvg": 0.012803234501347708, "readRatioMax": 0.01549865229110512, "recordsRead": "2163713", "recordsWritten": "258782", "shuffleOutputBytes": "18084620", "shuffleOutputBytesSpilled": "0", "slotMs": "2764", "startMs": "1665778609013", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:cs_sold_date_sk, $31:cs_bill_customer_sk, $32:cs_item_sk, $33:cs_order_number, $34:cs_quantity, $35:cs_wholesale_cost, $36:cs_sales_price", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$40, $41", "FROM __stage05_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $300 := $295, $301 := $291, $302 := $290", "$130 := SUM($292)", "$131 := SUM($293)", "$132 := SUM($294)" ] }, { "kind": "JOIN", "substeps": [ "$290 := $271, $291 := $272, $292 := $273, $293 := $274, $294 := $275, $295 := $2", "INNER HASH JOIN EACH WITH ALL ON $270 = $1" ] }, { "kind": "FILTER", "substeps": [ "is_null($276)" ] }, { "kind": "JOIN", "substeps": [ "$270 := $30, $271 := $31, $272 := $32, $273 := $34, $274 := $35, $275 := $36, $276 := $41", "LEFT OUTER HASH JOIN EACH WITH ALL ON $33 = $41, $32 = $40" ] }, { "kind": "WRITE", "substeps": [ "$300, $302, $301, $130, $131, $132", "TO __stage07_output", "BY HASH($300, $301, $302)" ] } ], "waitMsAvg": "1", "waitMsMax": "2", "waitRatioAvg": 0.0006738544474393531, "waitRatioMax": 0.0013477088948787063, "writeMsAvg": "22", "writeMsMax": "22", "writeRatioAvg": 0.014824797843665768, "writeRatioMax": 0.014824797843665768 }, { "completedParallelInputs": "6", "computeMsAvg": "1040", "computeMsMax": "1210", "computeRatioAvg": 0.7008086253369272, "computeRatioMax": 0.8153638814016172, "endMs": "1665778609776", "id": "8", "inputStages": [ "3", "2" ], "name": "S08: Join+", "parallelInputs": "6", "readMsAvg": "20", "readMsMax": "29", "readRatioAvg": 0.013477088948787063, "readRatioMax": 0.01954177897574124, "recordsRead": "4607684", "recordsWritten": "497119", "shuffleOutputBytes": "34277954", "shuffleOutputBytesSpilled": "0", "slotMs": "5643", "startMs": "1665778609054", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:ss_sold_date_sk, $51:ss_item_sk, $52:ss_customer_sk, $53:ss_ticket_number, $54:ss_quantity, $55:ss_wholesale_cost, $56:ss_sales_price", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$60, $61", "FROM __stage03_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage02_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $190 := $185, $191 := $180, $192 := $181", "$140 := SUM($182)", "$141 := SUM($183)", "$142 := SUM($184)" ] }, { "kind": "JOIN", "substeps": [ "$180 := $161, $181 := $162, $182 := $163, $183 := $164, $184 := $165, $185 := $11", "INNER HASH JOIN EACH WITH ALL ON $160 = $10" ] }, { "kind": "FILTER", "substeps": [ "is_null($166)" ] }, { "kind": "JOIN", "substeps": [ "$160 := $50, $161 := $51, $162 := $52, $163 := $54, $164 := $55, $165 := $56, $166 := $61", "LEFT OUTER HASH JOIN EACH WITH ALL ON $53 = $61, $51 = $60" ] }, { "kind": "WRITE", "substeps": [ "$190, $191, $192, $140, $141, $142", "TO __stage08_output", "BY HASH($190, $191, $192)" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0013477088948787063, "waitRatioMax": 0.0013477088948787063, "writeMsAvg": "9", "writeMsMax": "12", "writeRatioAvg": 0.006064690026954178, "writeRatioMax": 0.008086253369272238 }, { "completedParallelInputs": "1", "computeMsAvg": "688", "computeMsMax": "688", "computeRatioAvg": 0.4636118598382749, "computeRatioMax": 0.4636118598382749, "endMs": "1665778610164", "id": "9", "inputStages": [ "7" ], "name": "S09: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "258782", "recordsWritten": "258136", "shuffleOutputBytes": "18056536", "shuffleOutputBytesSpilled": "0", "slotMs": "639", "startMs": "1665778609801", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$300, $302, $301, $130, $131, $132", "FROM __stage07_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $310 := $300, $311 := $301, $312 := $302", "$100 := SUM($130)", "$101 := SUM($131)", "$102 := SUM($132)" ] }, { "kind": "WRITE", "substeps": [ "$100, $101, $102, $310, $311, $312", "TO __stage09_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006738544474393531, "waitRatioMax": 0.0006738544474393531, "writeMsAvg": "25", "writeMsMax": "25", "writeRatioAvg": 0.016846361185983826, "writeRatioMax": 0.016846361185983826 }, { "completedParallelInputs": "1", "computeMsAvg": "356", "computeMsMax": "356", "computeRatioAvg": 0.2398921832884097, "computeRatioMax": 0.2398921832884097, "endMs": "1665778609976", "id": "10", "inputStages": [ "6" ], "name": "S0A: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "128130", "recordsWritten": "128114", "shuffleOutputBytes": "8967716", "shuffleOutputBytesSpilled": "0", "slotMs": "300", "startMs": "1665778609820", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$240, $241, $242, $150, $151, $152", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $250 := $240, $251 := $241, $252 := $242", "$120 := SUM($150)", "$121 := SUM($151)", "$122 := SUM($152)" ] }, { "kind": "WRITE", "substeps": [ "$120, $121, $122, $250, $251, $252", "TO __stage0A_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0006738544474393531, "waitRatioMax": 0.0006738544474393531, "writeMsAvg": "21", "writeMsMax": "21", "writeRatioAvg": 0.014150943396226415, "writeRatioMax": 0.014150943396226415 }, { "completedParallelInputs": "100", "computeMsAvg": "11", "computeMsMax": "22", "computeRatioAvg": 0.007412398921832884, "computeRatioMax": 0.014824797843665768, "endMs": "1665778610088", "id": "11", "inputStages": [ "10" ], "name": "S0B: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "128114", "recordsWritten": "128114", "shuffleOutputBytes": "8967716", "shuffleOutputBytesSpilled": "0", "slotMs": "5242", "startMs": "1665778610008", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0A_output" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.0013477088948787063, "waitRatioMax": 0.0020215633423180594, "writeMsAvg": "15", "writeMsMax": "34", "writeRatioAvg": 0.010107816711590296, "writeRatioMax": 0.022911051212938006 }, { "completedParallelInputs": "100", "computeMsAvg": "12", "computeMsMax": "19", "computeRatioAvg": 0.008086253369272238, "computeRatioMax": 0.012803234501347708, "endMs": "1665778610289", "id": "12", "inputStages": [ "9" ], "name": "S0C: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "258136", "recordsWritten": "258136", "shuffleOutputBytes": "18056536", "shuffleOutputBytesSpilled": "0", "slotMs": "5961", "startMs": "1665778610197", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage09_output" ] } ], "waitMsAvg": "3", "waitMsMax": "4", "waitRatioAvg": 0.0020215633423180594, "waitRatioMax": 0.0026954177897574125, "writeMsAvg": "16", "writeMsMax": "25", "writeRatioAvg": 0.01078167115902965, "writeRatioMax": 0.016846361185983826 }, { "completedParallelInputs": "1", "computeMsAvg": "1484", "computeMsMax": "1484", "computeRatioAvg": 1, "computeRatioMax": 1, "endMs": "1665778611205", "id": "13", "inputStages": [ "12", "11", "8" ], "name": "S0D: Join+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "883369", "recordsWritten": "100", "shuffleOutputBytes": "12088", "shuffleOutputBytesSpilled": "0", "slotMs": "1490", "startMs": "1665778610202", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$190, $191, $192, $140, $141, $142", "FROM __stage08_output" ] }, { "kind": "READ", "substeps": [ "$120, $121, $122, $250, $251, $252", "FROM __stage0B_output" ] }, { "kind": "READ", "substeps": [ "$100, $101, $102, $310, $311, $312", "FROM __stage0C_output" ] }, { "kind": "SORT", "substeps": [ "$320 ASC, $321 ASC, $322 ASC, $323 DESC, $324 DESC, $325 DESC, $91 ASC, $92 ASC, $93 ASC, $90 ASC", "LIMIT 100" ] }, { "kind": "COMPUTE", "substeps": [ "$90 := round(divide(CAST($323 AS DOUBLE), CAST(add(coalesce($326, 0), coalesce($329, 0)) AS DOUBLE)), 2)", "$91 := add(coalesce($326, 0), coalesce($329, 0))", "$92 := add(coalesce($327, NUMERIC<...>), coalesce($330, NUMERIC<...>))", "$93 := add(coalesce($328, NUMERIC<...>), coalesce($331, NUMERIC<...>))" ] }, { "kind": "FILTER", "substeps": [ "or(greater(coalesce($326, 0), 0), greater(coalesce($329, 0), 0))" ] }, { "kind": "JOIN", "substeps": [ "$320 := $260, $321 := $261, $322 := $262, $323 := $263, $324 := $264, $325 := $265, $326 := $266, $327 := $267, $328 := $268, $329 := $100, $330 := $101, $331 := $102", "LEFT OUTER HASH JOIN EACH WITH ALL ON $260 = $310, $261 = $311, $262 = $312" ] }, { "kind": "JOIN", "substeps": [ "$260 := $200, $261 := $201, $262 := $202, $263 := $110, $264 := $111, $265 := $112, $266 := $120, $267 := $121, $268 := $122", "LEFT OUTER HASH JOIN EACH WITH ALL ON $200 = $250, $201 = $251, $202 = $252" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $200 := $190, $201 := $191, $202 := $192", "$110 := SUM($140)", "$111 := SUM($141)", "$112 := SUM($142)" ] }, { "kind": "WRITE", "substeps": [ "$340, $341, $342, $343, $344, $345, $346, $347, $348, $349", "TO __stage0D_output" ] } ], "waitMsAvg": "5", "waitMsMax": "5", "waitRatioAvg": 0.0033692722371967657, "waitRatioMax": 0.0033692722371967657, "writeMsAvg": "1", "writeMsMax": "1", "writeRatioAvg": 0.0006738544474393531, "writeRatioMax": 0.0006738544474393531 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.005390835579514825, "computeRatioMax": 0.005390835579514825, "endMs": "1665778611356", "id": "14", "inputStages": [ "13" ], "name": "S0E: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "12088", "shuffleOutputBytesSpilled": "0", "slotMs": "956", "startMs": "1665778610217", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$340, $341, $342, $343, $344, $345, $346, $347, $348, $349", "FROM __stage0D_output" ] }, { "kind": "SORT", "substeps": [ "$340 ASC, $341 ASC, $342 ASC, $347 DESC, $348 DESC, $349 DESC, $344 ASC, $345 ASC, $346 ASC, $343 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$350, $351, $352, $353, $354, $355, $356, $357, $358, $359", "TO __stage0E_output" ] } ], "waitMsAvg": "5", "waitMsMax": "5", "waitRatioAvg": 0.0033692722371967657, "waitRatioMax": 0.0033692722371967657, "writeMsAvg": "5", "writeMsMax": "5", "writeRatioAvg": 0.0033692722371967657, "writeRatioMax": 0.0033692722371967657 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "13", "completedUnits": "8", "elapsedMs": "670", "estimatedRunnableUnits": "0", "pendingUnits": "10", "totalSlotMs": "3441" }, { "activeUnits": "2", "completedUnits": "220", "elapsedMs": "1835", "estimatedRunnableUnits": "0", "pendingUnits": "2", "totalSlotMs": "22146" }, { "activeUnits": "1", "completedUnits": "222", "elapsedMs": "2788", "estimatedRunnableUnits": "1", "pendingUnits": "0", "totalSlotMs": "24382" } ], "totalBytesBilled": "364904448", "totalBytesProcessed": "364518168", "totalPartitionsProcessed": "0", "totalSlotMs": "24382", "transferredBytes": "0" }, "startTime": "1665778608645", "totalBytesProcessed": "364518168", "totalSlotMs": "24382" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
{ "configuration": { "jobType": "QUERY", "query": { "defaultDataset": { "datasetId": "call_center", "projectId": "test-project-364309" }, "destinationTable": { "datasetId": "_a0aa936c5cea243efb3c6dc011c66cfad39bfcb7", "projectId": "test-project-364309", "tableId": "anona0690d74_823d_4d64_b7e8_507aa5be5356" }, "priority": "INTERACTIVE", "query": "-- start query 78 in stream 0 using template query78.tpl\nwith ws as\n (select d_year AS ws_sold_year, ws_item_sk,\n ws_bill_customer_sk ws_customer_sk,\n sum(ws_quantity) ws_qty,\n sum(ws_wholesale_cost) ws_wc,\n sum(ws_sales_price) ws_sp\n from web_sales\n left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk\n join date_dim on ws_sold_date_sk = d_date_sk\n where wr_order_number is null\n group by d_year, ws_item_sk, ws_bill_customer_sk\n ),\ncs as\n (select d_year AS cs_sold_year, cs_item_sk,\n cs_bill_customer_sk cs_customer_sk,\n sum(cs_quantity) cs_qty,\n sum(cs_wholesale_cost) cs_wc,\n sum(cs_sales_price) cs_sp\n from catalog_sales\n left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk\n join date_dim on cs_sold_date_sk = d_date_sk\n where cr_order_number is null\n group by d_year, cs_item_sk, cs_bill_customer_sk\n ),\nss as\n (select d_year AS ss_sold_year, ss_item_sk,\n ss_customer_sk,\n sum(ss_quantity) ss_qty,\n sum(ss_wholesale_cost) ss_wc,\n sum(ss_sales_price) ss_sp\n from store_sales\n left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk\n join date_dim on ss_sold_date_sk = d_date_sk\n where sr_ticket_number is null\n group by d_year, ss_item_sk, ss_customer_sk\n )\n select\nss_sold_year, ss_item_sk, ss_customer_sk,\nround(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,\nss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,\ncoalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,\ncoalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,\ncoalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price\nfrom ss\nleft join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)\nleft join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)\nwhere (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2000\norder by \n ss_sold_year, \n ss_item_sk, \n ss_customer_sk,\n ss_qty desc, ss_wc desc, ss_sp desc,\n other_chan_qty,\n other_chan_wholesale_cost,\n other_chan_sales_price,\n ratio\nlimit 100\n;\n\n-- end query 78 in stream 0 using template query78.tpl", "useLegacySql": false, "useQueryCache": false, "writeDisposition": "WRITE_TRUNCATE" } }, "etag": "te1DWhaV91d760radq+2VQ==", "id": "test-project-364309:europe-west1.query78_1665778613", "jobReference": { "jobId": "query78_1665778613", "location": "europe-west1", "projectId": "test-project-364309" }, "kind": "bigquery#job", "principal_subject": "user:jesuispotatos@gmail.com", "selfLink": "https://bigquery.googleapis.com/bigquery/v2/projects/test-project-364309/jobs/query78_1665778613?location=europe-west1", "statistics": { "creationTime": "1665778613778", "endTime": "1665778617061", "finalExecutionDurationMs": "2996", "query": { "billingTier": 1, "cacheHit": false, "estimatedBytesProcessed": "364518168", "performanceInsights": { "avgPreviousExecutionMs": "2789" }, "queryPlan": [ { "completedParallelInputs": "1", "computeMsAvg": "10", "computeMsMax": "10", "computeRatioAvg": 0.005851375073142188, "computeRatioMax": 0.005851375073142188, "endMs": "1665778614029", "id": "0", "name": "S00: Input", "parallelInputs": "1", "readMsAvg": "6", "readMsMax": "6", "readRatioAvg": 0.003510825043885313, "readRatioMax": 0.003510825043885313, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "6588", "shuffleOutputBytesSpilled": "0", "slotMs": "32", "startMs": "1665778613998", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$20:d_date_sk, $21:d_year", "FROM date_dim", "WHERE equal($21, 2000)" ] }, { "kind": "WRITE", "substeps": [ "$20, $21", "TO __stage00_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005851375073142189, "waitRatioMax": 0.0005851375073142189, "writeMsAvg": "7", "writeMsMax": "7", "writeRatioAvg": 0.004095962551199532, "writeRatioMax": 0.004095962551199532 }, { "completedParallelInputs": "1", "computeMsAvg": "46", "computeMsMax": "46", "computeRatioAvg": 0.026916325336454067, "computeRatioMax": 0.026916325336454067, "endMs": "1665778614048", "id": "1", "name": "S01: Input", "parallelInputs": "1", "readMsAvg": "5", "readMsMax": "5", "readRatioAvg": 0.002925687536571094, "readRatioMax": 0.002925687536571094, "recordsRead": "71763", "recordsWritten": "71763", "shuffleOutputBytes": "1291734", "shuffleOutputBytesSpilled": "0", "slotMs": "49", "startMs": "1665778614011", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$80:wr_item_sk, $81:wr_order_number", "FROM web_returns" ] }, { "kind": "WRITE", "substeps": [ "$80, $81", "TO __stage01_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005851375073142189, "waitRatioMax": 0.0005851375073142189, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.004681100058513751, "writeRatioMax": 0.004681100058513751 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.007021650087770626, "computeRatioMax": 0.007021650087770626, "endMs": "1665778614071", "id": "2", "name": "S02: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.0052662375658279695, "readRatioMax": 0.0052662375658279695, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "6588", "shuffleOutputBytesSpilled": "0", "slotMs": "44", "startMs": "1665778614032", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$10:d_date_sk, $11:d_year", "FROM date_dim", "WHERE equal($11, 2000)" ] }, { "kind": "WRITE", "substeps": [ "$10, $11", "TO __stage02_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005851375073142189, "waitRatioMax": 0.0005851375073142189, "writeMsAvg": "9", "writeMsMax": "9", "writeRatioAvg": 0.0052662375658279695, "writeRatioMax": 0.0052662375658279695 }, { "completedParallelInputs": "1", "computeMsAvg": "116", "computeMsMax": "116", "computeRatioAvg": 0.06787595084844938, "computeRatioMax": 0.06787595084844938, "endMs": "1665778614159", "id": "3", "name": "S03: Input", "parallelInputs": "1", "readMsAvg": "9", "readMsMax": "9", "readRatioAvg": 0.0052662375658279695, "readRatioMax": 0.0052662375658279695, "recordsRead": "287514", "recordsWritten": "287514", "shuffleOutputBytes": "5175252", "shuffleOutputBytesSpilled": "0", "slotMs": "142", "startMs": "1665778614046", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$60:sr_item_sk, $61:sr_ticket_number", "FROM store_returns" ] }, { "kind": "WRITE", "substeps": [ "$60, $61", "TO __stage03_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005851375073142189, "waitRatioMax": 0.0005851375073142189, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.008191925102399064, "writeRatioMax": 0.008191925102399064 }, { "completedParallelInputs": "1", "computeMsAvg": "12", "computeMsMax": "12", "computeRatioAvg": 0.007021650087770626, "computeRatioMax": 0.007021650087770626, "endMs": "1665778614105", "id": "4", "name": "S04: Input", "parallelInputs": "1", "readMsAvg": "7", "readMsMax": "7", "readRatioAvg": 0.004095962551199532, "readRatioMax": 0.004095962551199532, "recordsRead": "73049", "recordsWritten": "366", "shuffleOutputBytes": "6588", "shuffleOutputBytesSpilled": "0", "slotMs": "29", "startMs": "1665778614063", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$1:d_date_sk, $2:d_year", "FROM date_dim", "WHERE equal($2, 2000)" ] }, { "kind": "WRITE", "substeps": [ "$1, $2", "TO __stage04_output" ] } ], "waitMsAvg": "2", "waitMsMax": "2", "waitRatioAvg": 0.0011702750146284377, "waitRatioMax": 0.0011702750146284377, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.008191925102399064, "writeRatioMax": 0.008191925102399064 }, { "completedParallelInputs": "1", "computeMsAvg": "73", "computeMsMax": "73", "computeRatioAvg": 0.042715038033937974, "computeRatioMax": 0.042715038033937974, "endMs": "1665778614149", "id": "5", "name": "S05: Input", "parallelInputs": "1", "readMsAvg": "8", "readMsMax": "8", "readRatioAvg": 0.004681100058513751, "readRatioMax": 0.004681100058513751, "recordsRead": "144067", "recordsWritten": "144067", "shuffleOutputBytes": "2593206", "shuffleOutputBytesSpilled": "0", "slotMs": "98", "startMs": "1665778614075", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$40:cr_item_sk, $41:cr_order_number", "FROM catalog_returns" ] }, { "kind": "WRITE", "substeps": [ "$40, $41", "TO __stage05_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005851375073142189, "waitRatioMax": 0.0005851375073142189, "writeMsAvg": "14", "writeMsMax": "14", "writeRatioAvg": 0.008191925102399064, "writeRatioMax": 0.008191925102399064 }, { "completedParallelInputs": "1", "computeMsAvg": "846", "computeMsMax": "846", "computeRatioAvg": 0.4950263311878291, "computeRatioMax": 0.4950263311878291, "endMs": "1665778614611", "id": "6", "inputStages": [ "1", "0" ], "name": "S06: Join+", "parallelInputs": "1", "readMsAvg": "20", "readMsMax": "20", "readRatioAvg": 0.011702750146284377, "readRatioMax": 0.011702750146284377, "recordsRead": "791513", "recordsWritten": "128130", "shuffleOutputBytes": "8968372", "shuffleOutputBytesSpilled": "0", "slotMs": "748", "startMs": "1665778614078", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$70:ws_sold_date_sk, $71:ws_item_sk, $72:ws_bill_customer_sk, $73:ws_order_number, $74:ws_quantity, $75:ws_wholesale_cost, $76:ws_sales_price", "FROM web_sales" ] }, { "kind": "READ", "substeps": [ "$80, $81", "FROM __stage01_output" ] }, { "kind": "READ", "substeps": [ "$20, $21", "FROM __stage00_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $240 := $235, $241 := $230, $242 := $231", "$150 := SUM($232)", "$151 := SUM($233)", "$152 := SUM($234)" ] }, { "kind": "JOIN", "substeps": [ "$230 := $211, $231 := $212, $232 := $213, $233 := $214, $234 := $215, $235 := $21", "INNER HASH JOIN EACH WITH ALL ON $210 = $20" ] }, { "kind": "FILTER", "substeps": [ "is_null($216)" ] }, { "kind": "JOIN", "substeps": [ "$210 := $70, $211 := $71, $212 := $72, $213 := $74, $214 := $75, $215 := $76, $216 := $81", "LEFT OUTER HASH JOIN EACH WITH ALL ON $73 = $81, $71 = $80" ] }, { "kind": "WRITE", "substeps": [ "$240, $241, $242, $150, $151, $152", "TO __stage06_output", "BY HASH($240, $241, $242)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005851375073142189, "waitRatioMax": 0.0005851375073142189, "writeMsAvg": "8", "writeMsMax": "8", "writeRatioAvg": 0.004681100058513751, "writeRatioMax": 0.004681100058513751 }, { "completedParallelInputs": "5", "computeMsAvg": "587", "computeMsMax": "849", "computeRatioAvg": 0.34347571679344646, "computeRatioMax": 0.4967817437097718, "endMs": "1665778614547", "id": "7", "inputStages": [ "4", "5" ], "name": "S07: Join+", "parallelInputs": "5", "readMsAvg": "24", "readMsMax": "30", "readRatioAvg": 0.014043300175541252, "readRatioMax": 0.017554125219426564, "recordsRead": "2163713", "recordsWritten": "258782", "shuffleOutputBytes": "18084620", "shuffleOutputBytesSpilled": "0", "slotMs": "2815", "startMs": "1665778614171", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$30:cs_sold_date_sk, $31:cs_bill_customer_sk, $32:cs_item_sk, $33:cs_order_number, $34:cs_quantity, $35:cs_wholesale_cost, $36:cs_sales_price", "FROM catalog_sales" ] }, { "kind": "READ", "substeps": [ "$40, $41", "FROM __stage05_output" ] }, { "kind": "READ", "substeps": [ "$1, $2", "FROM __stage04_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $300 := $295, $301 := $291, $302 := $290", "$130 := SUM($292)", "$131 := SUM($293)", "$132 := SUM($294)" ] }, { "kind": "JOIN", "substeps": [ "$290 := $271, $291 := $272, $292 := $273, $293 := $274, $294 := $275, $295 := $2", "INNER HASH JOIN EACH WITH ALL ON $270 = $1" ] }, { "kind": "FILTER", "substeps": [ "is_null($276)" ] }, { "kind": "JOIN", "substeps": [ "$270 := $30, $271 := $31, $272 := $32, $273 := $34, $274 := $35, $275 := $36, $276 := $41", "LEFT OUTER HASH JOIN EACH WITH ALL ON $33 = $41, $32 = $40" ] }, { "kind": "WRITE", "substeps": [ "$300, $302, $301, $130, $131, $132", "TO __stage07_output", "BY HASH($300, $301, $302)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005851375073142189, "waitRatioMax": 0.0005851375073142189, "writeMsAvg": "22", "writeMsMax": "26", "writeRatioAvg": 0.012873025160912814, "writeRatioMax": 0.015213575190169689 }, { "completedParallelInputs": "6", "computeMsAvg": "984", "computeMsMax": "1205", "computeRatioAvg": 0.5757753071971914, "computeRatioMax": 0.7050906963136337, "endMs": "1665778614965", "id": "8", "inputStages": [ "3", "2" ], "name": "S08: Join+", "parallelInputs": "6", "readMsAvg": "19", "readMsMax": "27", "readRatioAvg": 0.011117612638970159, "readRatioMax": 0.01579871269748391, "recordsRead": "4607684", "recordsWritten": "497119", "shuffleOutputBytes": "34277954", "shuffleOutputBytesSpilled": "0", "slotMs": "5324", "startMs": "1665778614174", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$50:ss_sold_date_sk, $51:ss_item_sk, $52:ss_customer_sk, $53:ss_ticket_number, $54:ss_quantity, $55:ss_wholesale_cost, $56:ss_sales_price", "FROM store_sales" ] }, { "kind": "READ", "substeps": [ "$60, $61", "FROM __stage03_output" ] }, { "kind": "READ", "substeps": [ "$10, $11", "FROM __stage02_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $190 := $185, $191 := $180, $192 := $181", "$140 := SUM($182)", "$141 := SUM($183)", "$142 := SUM($184)" ] }, { "kind": "JOIN", "substeps": [ "$180 := $161, $181 := $162, $182 := $163, $183 := $164, $184 := $165, $185 := $11", "INNER HASH JOIN EACH WITH ALL ON $160 = $10" ] }, { "kind": "FILTER", "substeps": [ "is_null($166)" ] }, { "kind": "JOIN", "substeps": [ "$160 := $50, $161 := $51, $162 := $52, $163 := $54, $164 := $55, $165 := $56, $166 := $61", "LEFT OUTER HASH JOIN EACH WITH ALL ON $53 = $61, $51 = $60" ] }, { "kind": "WRITE", "substeps": [ "$190, $191, $192, $140, $141, $142", "TO __stage08_output", "BY HASH($190, $191, $192)" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005851375073142189, "waitRatioMax": 0.0005851375073142189, "writeMsAvg": "7", "writeMsMax": "8", "writeRatioAvg": 0.004095962551199532, "writeRatioMax": 0.004681100058513751 }, { "completedParallelInputs": "1", "computeMsAvg": "869", "computeMsMax": "869", "computeRatioAvg": 0.5084844938560562, "computeRatioMax": 0.5084844938560562, "endMs": "1665778615503", "id": "9", "inputStages": [ "7" ], "name": "S09: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "258782", "recordsWritten": "258136", "shuffleOutputBytes": "18056536", "shuffleOutputBytesSpilled": "0", "slotMs": "805", "startMs": "1665778615047", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$300, $302, $301, $130, $131, $132", "FROM __stage07_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $310 := $300, $311 := $301, $312 := $302", "$100 := SUM($130)", "$101 := SUM($131)", "$102 := SUM($132)" ] }, { "kind": "WRITE", "substeps": [ "$100, $101, $102, $310, $311, $312", "TO __stage09_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005851375073142189, "waitRatioMax": 0.0005851375073142189, "writeMsAvg": "30", "writeMsMax": "30", "writeRatioAvg": 0.017554125219426564, "writeRatioMax": 0.017554125219426564 }, { "completedParallelInputs": "1", "computeMsAvg": "386", "computeMsMax": "386", "computeRatioAvg": 0.22586307782328846, "computeRatioMax": 0.22586307782328846, "endMs": "1665778615297", "id": "10", "inputStages": [ "6" ], "name": "S0A: Aggregate", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "128130", "recordsWritten": "128114", "shuffleOutputBytes": "8967716", "shuffleOutputBytesSpilled": "0", "slotMs": "349", "startMs": "1665778615062", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$240, $241, $242, $150, $151, $152", "FROM __stage06_output" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $250 := $240, $251 := $241, $252 := $242", "$120 := SUM($150)", "$121 := SUM($151)", "$122 := SUM($152)" ] }, { "kind": "WRITE", "substeps": [ "$120, $121, $122, $250, $251, $252", "TO __stage0A_output" ] } ], "waitMsAvg": "1", "waitMsMax": "1", "waitRatioAvg": 0.0005851375073142189, "waitRatioMax": 0.0005851375073142189, "writeMsAvg": "27", "writeMsMax": "27", "writeRatioAvg": 0.01579871269748391, "writeRatioMax": 0.01579871269748391 }, { "completedParallelInputs": "100", "computeMsAvg": "9", "computeMsMax": "15", "computeRatioAvg": 0.0052662375658279695, "computeRatioMax": 0.008777062609713282, "endMs": "1665778615385", "id": "11", "inputStages": [ "10" ], "name": "S0B: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "128114", "recordsWritten": "128114", "shuffleOutputBytes": "8967716", "shuffleOutputBytesSpilled": "0", "slotMs": "4284", "startMs": "1665778615321", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage0A_output" ] } ], "waitMsAvg": "2", "waitMsMax": "3", "waitRatioAvg": 0.0011702750146284377, "waitRatioMax": 0.0017554125219426564, "writeMsAvg": "15", "writeMsMax": "23", "writeRatioAvg": 0.008777062609713282, "writeRatioMax": 0.013458162668227034 }, { "completedParallelInputs": "100", "computeMsAvg": "11", "computeMsMax": "24", "computeRatioAvg": 0.006436512580456407, "computeRatioMax": 0.014043300175541252, "endMs": "1665778615605", "id": "12", "inputStages": [ "9" ], "name": "S0C: Coalesce", "parallelInputs": "100", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "258136", "recordsWritten": "258136", "shuffleOutputBytes": "18056536", "shuffleOutputBytesSpilled": "0", "slotMs": "4033", "startMs": "1665778615552", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "FROM __stage09_output" ] } ], "waitMsAvg": "2", "waitMsMax": "9", "waitRatioAvg": 0.0011702750146284377, "waitRatioMax": 0.0052662375658279695, "writeMsAvg": "13", "writeMsMax": "19", "writeRatioAvg": 0.0076067875950848445, "writeRatioMax": 0.011117612638970159 }, { "completedParallelInputs": "1", "computeMsAvg": "1709", "computeMsMax": "1709", "computeRatioAvg": 1, "computeRatioMax": 1, "endMs": "1665778616646", "id": "13", "inputStages": [ "11", "12", "8" ], "name": "S0D: Join+", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "883369", "recordsWritten": "100", "shuffleOutputBytes": "12088", "shuffleOutputBytesSpilled": "0", "slotMs": "1697", "startMs": "1665778615561", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$190, $191, $192, $140, $141, $142", "FROM __stage08_output" ] }, { "kind": "READ", "substeps": [ "$120, $121, $122, $250, $251, $252", "FROM __stage0B_output" ] }, { "kind": "READ", "substeps": [ "$100, $101, $102, $310, $311, $312", "FROM __stage0C_output" ] }, { "kind": "SORT", "substeps": [ "$320 ASC, $321 ASC, $322 ASC, $323 DESC, $324 DESC, $325 DESC, $91 ASC, $92 ASC, $93 ASC, $90 ASC", "LIMIT 100" ] }, { "kind": "COMPUTE", "substeps": [ "$90 := round(divide(CAST($323 AS DOUBLE), CAST(add(coalesce($326, 0), coalesce($329, 0)) AS DOUBLE)), 2)", "$91 := add(coalesce($326, 0), coalesce($329, 0))", "$92 := add(coalesce($327, NUMERIC<...>), coalesce($330, NUMERIC<...>))", "$93 := add(coalesce($328, NUMERIC<...>), coalesce($331, NUMERIC<...>))" ] }, { "kind": "FILTER", "substeps": [ "or(greater(coalesce($326, 0), 0), greater(coalesce($329, 0), 0))" ] }, { "kind": "JOIN", "substeps": [ "$320 := $260, $321 := $261, $322 := $262, $323 := $263, $324 := $264, $325 := $265, $326 := $266, $327 := $267, $328 := $268, $329 := $100, $330 := $101, $331 := $102", "LEFT OUTER HASH JOIN EACH WITH ALL ON $260 = $310, $261 = $311, $262 = $312" ] }, { "kind": "JOIN", "substeps": [ "$260 := $200, $261 := $201, $262 := $202, $263 := $110, $264 := $111, $265 := $112, $266 := $120, $267 := $121, $268 := $122", "LEFT OUTER HASH JOIN EACH WITH ALL ON $200 = $250, $201 = $251, $202 = $252" ] }, { "kind": "AGGREGATE", "substeps": [ "GROUP BY $200 := $190, $201 := $191, $202 := $192", "$110 := SUM($140)", "$111 := SUM($141)", "$112 := SUM($142)" ] }, { "kind": "WRITE", "substeps": [ "$340, $341, $342, $343, $344, $345, $346, $347, $348, $349", "TO __stage0D_output" ] } ], "waitMsAvg": "10", "waitMsMax": "10", "waitRatioAvg": 0.005851375073142188, "waitRatioMax": 0.005851375073142188, "writeMsAvg": "1", "writeMsMax": "1", "writeRatioAvg": 0.0005851375073142189, "writeRatioMax": 0.0005851375073142189 }, { "completedParallelInputs": "1", "computeMsAvg": "8", "computeMsMax": "8", "computeRatioAvg": 0.004681100058513751, "computeRatioMax": 0.004681100058513751, "endMs": "1665778616798", "id": "14", "inputStages": [ "13" ], "name": "S0E: Output", "parallelInputs": "1", "readMsAvg": "0", "readMsMax": "0", "readRatioAvg": 0, "readRatioMax": 0, "recordsRead": "100", "recordsWritten": "100", "shuffleOutputBytes": "12088", "shuffleOutputBytesSpilled": "0", "slotMs": "1079", "startMs": "1665778615566", "status": "COMPLETE", "steps": [ { "kind": "READ", "substeps": [ "$340, $341, $342, $343, $344, $345, $346, $347, $348, $349", "FROM __stage0D_output" ] }, { "kind": "SORT", "substeps": [ "$340 ASC, $341 ASC, $342 ASC, $347 DESC, $348 DESC, $349 DESC, $344 ASC, $345 ASC, $346 ASC, $343 ASC", "LIMIT 100" ] }, { "kind": "WRITE", "substeps": [ "$350, $351, $352, $353, $354, $355, $356, $357, $358, $359", "TO __stage0E_output" ] } ], "waitMsAvg": "4", "waitMsMax": "4", "waitRatioAvg": 0.0023405500292568754, "waitRatioMax": 0.0023405500292568754, "writeMsAvg": "5", "writeMsMax": "5", "writeRatioAvg": 0.002925687536571094, "writeRatioMax": 0.002925687536571094 } ], "referencedTables": [ { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "date_dim" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "catalog_returns" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "store_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_sales" }, { "datasetId": "call_center", "projectId": "test-project-364309", "tableId": "web_returns" } ], "statementType": "SELECT", "timeline": [ { "activeUnits": "11", "completedUnits": "9", "elapsedMs": "645", "estimatedRunnableUnits": "0", "pendingUnits": "9", "totalSlotMs": "4973" }, { "activeUnits": "0", "completedUnits": "120", "elapsedMs": "1695", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "14726" }, { "activeUnits": "2", "completedUnits": "222", "elapsedMs": "3144", "estimatedRunnableUnits": "0", "pendingUnits": "0", "totalSlotMs": "21492" } ], "totalBytesBilled": "364904448", "totalBytesProcessed": "364518168", "totalPartitionsProcessed": "0", "totalSlotMs": "21492", "transferredBytes": "0" }, "startTime": "1665778613854", "totalBytesProcessed": "364518168", "totalSlotMs": "21492" }, "status": { "state": "DONE" }, "user_email": "jesuispotatos@gmail.com" }
